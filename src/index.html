<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Helen ËÄÅÂ∏àÁöÑ PET È≠îÊ≥ïËã±ËØ≠Â±ã</title>
    <style>
        :root {
            color-scheme: light;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: "Nunito", "PingFang SC", "Microsoft YaHei", sans-serif;
        }

        * {
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        body {
            background: linear-gradient(135deg,
                    rgba(232, 245, 233, 0.95) 0%,
                    rgba(241, 248, 244, 0.9) 30%,
                    rgba(255, 243, 224, 0.85) 60%,
                    rgba(248, 249, 255, 0.9) 100%);
            background-attachment: fixed;
            color: #1a1a1a;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 30%, rgba(255, 182, 193, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(173, 216, 230, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(255, 228, 181, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .app {
            width: 100%;
            height: 100%;
            margin: 0;
            background: transparent;
            border-radius: 0;
            box-shadow: none;
            padding: 0;
            border: none;
            position: relative;
            display: flex;
            overflow: hidden;
            z-index: 1;
        }

        /* Â∑¶‰æßËæπÊ†è - Áé∞‰ª£DashboardÈ£éÊ†º */
        .sidebar {
            width: 280px;
            background: #F8FAFC;
            border-right: 1px solid rgba(0, 0, 0, 0.05);
            padding: 24px 16px;
            display: flex;
            flex-direction: column;
            transition: width 0.3s ease;
            position: relative;
            overflow-y: auto;
            overflow-x: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            z-index: 10;
        }

        .sidebar.collapsed {
            width: 60px;
        }

        .sidebar-toggle {
            position: absolute;
            top: 24px;
            right: -12px;
            width: 24px;
            height: 24px;
            background: #F8FAFC;
            border: 1px solid rgba(0, 0, 0, 0.08);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #64748B;
            font-size: 12px;
            z-index: 100;
            transition: all 0.2s ease;
        }

        .sidebar-toggle:hover {
            background: #F1F5F9;
            color: #1E293B;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            margin-bottom: 32px;
        }

        .sidebar.collapsed .sidebar-header {
            justify-content: center;
            margin-bottom: 20px;
        }

        .sidebar-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1E293B;
            white-space: nowrap;
            overflow: hidden;
        }

        .sidebar.collapsed .sidebar-title {
            display: none;
        }

        .sidebar-section {
            margin-bottom: 12px;
        }

        .sidebar-section:last-of-type {
            margin-bottom: 0;
        }

        .sidebar-section-title {
            font-size: 16px;
            font-weight: 600;
            color: #1E293B;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            padding: 8px 12px;
            background: rgba(186, 230, 253, 0.5);
            border-radius: 6px;
            white-space: nowrap;
            overflow: hidden;
        }

        .sidebar.collapsed .sidebar-section-title {
            display: none;
        }

        .sidebar-badges {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .sidebar-badge {
            background: transparent;
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            font-weight: 500;
            color: #1E293B;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            white-space: nowrap;
            overflow: hidden;
        }

        .sidebar.collapsed .sidebar-badge {
            justify-content: center;
            padding: 8px;
            min-width: 40px;
        }

        .sidebar.collapsed .sidebar-badge span:not(.badge-icon) {
            display: none;
        }

        .sidebar-badge:hover {
            background: rgba(0, 0, 0, 0.02);
        }

        .sidebar-badge.active {
            background: rgba(254, 240, 138, 0.6);
            color: #1E293B;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(254, 240, 138, 0.3);
        }

        .sidebar-badge:active {
            transform: scale(0.98);
        }

        .badge-icon {
            font-size: 18px;
            width: 20px;
            height: 20px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #64748b;
            transition: color 0.2s ease;
        }

        .sidebar-badge.active .badge-icon {
            color: #1E293B;
        }

        .sidebar-badge:hover .badge-icon {
            color: #1E293B;
        }

        .sidebar-badge-text {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 0.875rem;
            line-height: 1.5;
        }

        /* Â∫ïÈÉ®Áî®Êà∑‰ø°ÊÅØÂå∫Âüü */
        .sidebar-user-section {
            margin-top: 8px;
            padding-top: 12px;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
        }

        .sidebar-user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .sidebar.collapsed .sidebar-user-info {
            justify-content: center;
        }

        .sidebar-user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff6b9d 0%, #ff9a62 50%, #ffc857 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .sidebar-user-details {
            flex: 1;
            min-width: 0;
        }

        .sidebar.collapsed .sidebar-user-details {
            display: none;
        }

        .sidebar-user-name {
            font-size: 0.875rem;
            font-weight: 500;
            color: #1E293B;
            margin-bottom: 2px;
        }

        .sidebar-user-role {
            font-size: 0.75rem;
            color: #94A3B8;
        }

        .sidebar-logout {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            color: #64748B;
            cursor: pointer;
            transition: color 0.2s ease;
            border: none;
            background: transparent;
            font-size: 0.875rem;
            font-weight: 500;
            width: 100%;
            text-align: left;
        }

        .sidebar.collapsed .sidebar-logout {
            justify-content: center;
            padding: 8px;
        }

        .sidebar.collapsed .sidebar-logout span:not(:first-child) {
            display: none;
        }

        .sidebar-logout:hover {
            color: #1E293B;
        }

        .sidebar-logout-icon {
            font-size: 16px;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* È¢òÂ∫ìÁªüËÆ°Ê†∑Âºè - ‰∏Ä‰ΩìÂåñÂç°Áâá */
        .sidebar-stats {
            background: #F1F5F9;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .sidebar-stats-header {
            padding: 12px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background 0.2s ease;
            user-select: none;
        }

        .sidebar-stats-header:hover {
            background: rgba(0, 0, 0, 0.02);
        }

        .sidebar-stats-title {
            font-size: 0.875rem;
            font-weight: 500;
            color: #1E293B;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sidebar.collapsed .sidebar-stats-title span:not(:first-child) {
            display: none;
        }

        .sidebar-stats-toggle {
            font-size: 0.75rem;
            color: #64748B;
            transition: transform 0.3s ease;
        }

        .sidebar.collapsed .sidebar-stats-toggle {
            display: none;
        }

        .sidebar-stats.collapsed .sidebar-stats-toggle {
            transform: rotate(-90deg);
        }

        .sidebar-stats-content {
            max-height: 500px;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
            padding: 0 16px 16px;
        }

        .sidebar-stats.collapsed .sidebar-stats-content {
            max-height: 0;
            padding: 0 16px;
        }

        .sidebar-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            padding: 8px 0;
        }

        .sidebar.collapsed .sidebar-stats-grid {
            grid-template-columns: 1fr;
            gap: 8px;
        }

        .sidebar-stat-item {
            background: transparent;
            border: none;
            border-radius: 0;
            padding: 0;
            text-align: left;
            transition: all 0.2s ease;
        }

        .sidebar-stat-item:hover {
            background: transparent;
        }

        .sidebar-stat-number {
            font-size: 18px;
            font-weight: 600;
            color: #1E293B;
            margin-bottom: 4px;
            display: block;
            line-height: 1.2;
            background: transparent;
            border: none;
            padding: 0;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            width: 100%;
            text-align: left;
        }

        .sidebar-stat-number:hover {
            color: #3B82F6;
            text-decoration: underline;
        }

        .sidebar-stat-number:active {
            transform: scale(0.95);
        }

        .sidebar.collapsed .sidebar-stat-number {
            font-size: 1.125rem;
            margin-bottom: 0;
        }

        .sidebar-stat-label {
            font-size: 12px;
            color: #64748B;
            margin-top: 2px;
            font-weight: 400;
        }

        /* È¢òÂ∫ìËØ¶ÊÉÖÂàóË°®Ê†∑Âºè */
        .bank-detail-list {
            max-height: 60vh;
            overflow-y: auto;
            padding: 16px;
        }

        .bank-detail-item {
            display: grid;
            grid-template-columns: 50px 1fr auto auto;
            gap: 12px;
            align-items: center;
            padding: 12px;
            background: #f8fafc;
            border-radius: 8px;
            margin-bottom: 8px;
            transition: background 0.2s ease;
        }

        /* ÂΩì .bank-detail-item ‰ΩøÁî® display: block Êó∂ÁöÑÊ†∑Âºè */
        .bank-detail-item[style*="display: block"] {
            grid-template-columns: none;
        }

        .bank-detail-item:hover {
            background: #f1f5f9;
        }

        .bank-detail-index {
            font-weight: 600;
            color: #64748B;
            font-size: 14px;
        }

        .bank-detail-word {
            font-weight: 600;
            color: #1E293B;
            font-size: 16px;
        }

        .bank-detail-meaning {
            color: #475569;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .bank-detail-title {
            font-weight: 600;
            color: #1E293B;
            font-size: 15px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .bank-detail-question {
            color: #475569;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .bank-detail-answer {
            color: #059669;
            font-size: 14px;
            font-weight: 500;
        }

        .bank-detail-questions {
            color: #64748B;
            font-size: 13px;
            padding: 2px 8px;
            background: #e2e8f0;
            border-radius: 4px;
        }

        .bank-detail-difficulty {
            color: #f59e0b;
            font-size: 13px;
            white-space: nowrap;
        }

        .bank-detail-total {
            text-align: center;
            padding: 16px;
            font-size: 16px;
            font-weight: 600;
            color: #1E293B;
            background: #f8fafc;
            border-radius: 8px;
            margin: 16px;
        }

        .bank-empty {
            text-align: center;
            padding: 40px 20px;
            color: #94a3b8;
            font-size: 16px;
        }

        .sidebar.collapsed .sidebar-stat-label {
            display: none;
        }

        .main-content {
            flex: 1;
            padding: 32px 40px 0 40px;
            overflow-y: auto;
            overflow-x: hidden;
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border-left: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow:
                inset 0 1px 0 0 rgba(255, 255, 255, 0.6),
                0 8px 32px 0 rgba(0, 0, 0, 0.08);
            position: relative;
            z-index: 10;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .main-content>.card:last-child {
            margin-bottom: 0 !important;
        }

        .main-content>*:last-child {
            margin-bottom: 0 !important;
            padding-bottom: 0 !important;
        }

        .main-content>*:last-child {
            margin-bottom: 0 !important;
            padding-bottom: 0 !important;
        }

        .hero {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 25px;
            margin-bottom: 32px;
            padding: 0;
        }

        .hero-avatar {
            width: 130px;
            height: 130px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff6b9d 0%, #ff9a62 50%, #ffc857 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 56px;
            box-shadow: 0 8px 24px rgba(255, 154, 98, 0.4);
            position: relative;
            overflow: hidden;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px) rotate(0deg);
            }

            50% {
                transform: translateY(-10px) rotate(5deg);
            }
        }

        .hero-avatar::after {
            content: "";
            position: absolute;
            inset: 0;
            background: url("data:image/svg+xml,%3Csvg width='120' height='120' viewBox='0 0 120 120' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='45' cy='45' r='35' fill='%23fff2f2'/%3E%3Ccircle cx='75' cy='50' r='20' fill='%23ffe4d4'/%3E%3Ccircle cx='60' cy='80' r='25' fill='%23ffd9bf'/%3E%3C/svg%3E") center/cover no-repeat;
            opacity: 0.35;
        }

        .hero-avatar span {
            position: relative;
            font-size: 58px;
        }

        h1 {
            font-size: 2rem;
            color: #212529;
            font-weight: 600;
            margin: 0;
        }

        .hero-tagline {
            font-size: 0.9375rem;
            margin-top: 8px;
            margin-bottom: 12px;
            color: #6c757d;
        }

        .progress-panel {
            display: flex;
            gap: 18px;
            flex-wrap: wrap;
        }

        .badge {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            border: 2px solid #ffcc80;
            border-radius: 20px;
            padding: 12px 20px;
            font-weight: 600;
            color: #e65100;
            box-shadow: 0 4px 12px rgba(255, 152, 0, 0.2);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.02);
            }
        }

        /* üîç ËØçÂÖ∏Êü•ËØ¢ÂäüËÉΩÊ†∑Âºè */
        .search-container {
            position: relative;
            margin-top: 15px;
        }

        .dict-settings-btn {
            cursor: pointer;
            font-size: 1.1rem;
            padding: 8px 12px;
            color: #6c757d;
            transition: all 0.2s;
            border-left: 1px solid #e9ecef;
            margin-left: 8px;
        }

        .dict-settings-btn:hover {
            color: #495057;
            transform: rotate(90deg);
        }

        .search-box {
            display: flex;
            align-items: center;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
            border: 2px solid #d0e4ff;
            border-radius: 14px;
            padding: 14px 20px;
            max-width: 500px;
            box-shadow: 0 4px 12px rgba(142, 166, 255, 0.15);
            transition: all 0.3s ease;
        }

        .search-box:focus-within {
            border-color: #8ea6ff;
            box-shadow: 0 6px 20px rgba(142, 166, 255, 0.3);
            transform: translateY(-2px);
        }

        .search-box input {
            flex: 1;
            border: none;
            outline: none;
            font-size: 1rem;
            color: #243b53;
            background: transparent;
        }

        .search-box input::placeholder {
            color: #adb5bd;
        }

        .search-icon {
            font-size: 1.2rem;
            margin-right: 10px;
            cursor: pointer;
        }

        /* Êü•ËØ¢Ê∞îÊ≥° */
        .word-popup {
            position: absolute;
            background: #ffffff;
            border: 2px solid #70a1ff;
            border-radius: 12px;
            padding: 12px 16px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            z-index: 10000;
            max-width: 300px;
            font-size: 0.9rem;
            display: none;
        }

        .word-popup.show {
            display: block;
            animation: popupFadeIn 0.1s ease;
        }

        @keyframes popupFadeIn {
            from {
                opacity: 0;
                transform: translate(-50%, -100%) translateY(-5px);
            }

            to {
                opacity: 1;
                transform: translate(-50%, -100%) translateY(0);
            }
        }

        .word-popup .popup-word {
            font-weight: bold;
            color: #4c55a4;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .word-popup .popup-meaning {
            color: #51627a;
            margin-bottom: 8px;
            min-height: 20px;
        }

        .word-popup .popup-loading {
            color: #8ea6ff;
            font-style: italic;
        }

        .word-popup .popup-action {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .popup-btn {
            flex: 1;
            padding: 6px 12px;
            border: 1px solid #8ea6ff;
            border-radius: 6px;
            background: #f3f6ff;
            color: #4c55a4;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .popup-btn:hover {
            background: #eef5ff;
            border-color: #70a1ff;
        }

        /* È´ò‰∫ÆÈÄâ‰∏≠ÊñáÊú¨ */
        .word-highlight {
            background: #fff3cd;
            padding: 2px 4px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .word-highlight:hover {
            background: #ffe69c;
        }

        /* ËØçÂÖ∏ÁªìÊûúÊ®°ÊÄÅÊ°Ü */
        .dict-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10001;
            overflow-y: auto;
            animation: fadeIn 0.3s ease;
        }

        .dict-modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .dict-modal-content {
            background: #ffffff;
            border-radius: 20px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .dict-modal-header {
            padding: 24px 28px;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: #ffffff;
            z-index: 10;
        }

        .dict-modal-header h2 {
            font-size: 1.8rem;
            color: #1b2540;
            margin: 0;
        }

        .dict-modal-close {
            font-size: 1.5rem;
            cursor: pointer;
            color: #8ea6ff;
            transition: color 0.2s, transform 0.2s;
            position: relative;
            z-index: 10006;
            pointer-events: auto;
            user-select: none;
            -webkit-user-select: none;
            padding: 4px 8px;
            border-radius: 4px;
            min-width: 32px;
            min-height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* üë¶üèªüëßüèª Â∞èÂ≠¶ÁîüÂèãÂ•ΩËØçÂÖ∏Âç°ÁâáÔºà‰∏≠Ëã±Êñá + ÂõæÊñáÔºâ */
        .dict-kids-card {
            display: grid;
            grid-template-columns: 1.2fr 1fr;
            gap: 18px;
            padding: 18px;
            border-radius: 16px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.92), rgba(239, 246, 255, 0.92));
            border: 1px solid rgba(142, 166, 255, 0.15);
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.06);
            margin: 12px 0 4px;
        }

        .dict-kids-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .dict-kids-word {
            font-size: 1.6rem;
            font-weight: 700;
            color: #1b2540;
            letter-spacing: 0.5px;
        }

        .dict-kids-phonetic {
            color: #6c7a9b;
            font-weight: 600;
            background: rgba(142, 166, 255, 0.14);
            display: inline-block;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 0.95rem;
        }

        .dict-kids-meaning-cn {
            font-size: 1.05rem;
            color: #0f172a;
            font-weight: 650;
            line-height: 1.6;
        }

        .dict-kids-meaning-en {
            font-size: 0.98rem;
            color: #334155;
            background: rgba(16, 185, 129, 0.08);
            border-left: 4px solid rgba(16, 185, 129, 0.45);
            padding: 8px 10px;
            border-radius: 10px;
        }

        .dict-kids-example {
            font-size: 0.95rem;
            color: #475569;
            background: rgba(74, 108, 247, 0.07);
            border-radius: 10px;
            padding: 10px 12px;
            border: 1px dashed rgba(74, 108, 247, 0.2);
        }

        .dict-kids-image {
            position: relative;
            border-radius: 14px;
            overflow: hidden;
            background: linear-gradient(135deg, #c7d2fe, #fbcfe8);
            min-height: 180px;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.8);
        }

        .dict-kids-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            transition: transform 0.6s ease;
        }

        .dict-kids-image img:hover {
            transform: scale(1.03);
        }

        .dict-image-fallback {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #0f172a;
            font-weight: 700;
            background: repeating-linear-gradient(135deg, rgba(255, 255, 255, 0.6) 0 14px, rgba(255, 255, 255, 0.45) 14px 28px);
            text-align: center;
            padding: 12px;
        }

        @media (max-width: 780px) {
            .dict-kids-card {
                grid-template-columns: 1fr;
            }
        }

        .dict-modal-close:hover {
            color: #70a1ff;
            background: #f0f7ff;
            transform: scale(1.1);
        }

        .dict-modal-close:active {
            transform: scale(0.95);
            background: #e0e8ff;
        }

        /* Ëá™ÂÆö‰πâAlertÊ®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .custom-alert-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10004;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.2s ease;
        }

        .custom-alert-modal.show {
            display: flex;
        }

        .custom-alert-content {
            background: #ffffff;
            border-radius: 16px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            position: relative;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .custom-alert-header {
            padding: 20px 24px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .custom-alert-header h3 {
            font-size: 1.3rem;
            color: #1b2540;
            margin: 0;
            font-weight: 600;
        }

        .custom-alert-close {
            font-size: 1.8rem;
            cursor: pointer;
            color: #8ea6ff;
            transition: all 0.2s;
            position: absolute;
            top: 16px;
            right: 20px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: #f0f7ff;
            line-height: 1;
            z-index: 10005;
            pointer-events: auto;
        }

        .custom-alert-close:hover {
            color: #70a1ff;
            background: #e0e8ff;
            transform: scale(1.1);
        }

        .custom-alert-close:active {
            transform: scale(0.95);
        }

        .custom-alert-body {
            padding: 24px;
            color: #243b53;
            font-size: 1rem;
            line-height: 1.6;
            white-space: pre-line;
        }

        .custom-alert-footer {
            padding: 16px 24px;
            border-top: 1px solid #f0f0f0;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .custom-alert-btn {
            padding: 10px 24px;
            border: none;
            border-radius: 8px;
            background: #8ea6ff;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .custom-alert-btn:hover {
            background: #70a1ff;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(112, 161, 255, 0.3);
        }

        .custom-alert-btn:active {
            transform: translateY(0);
        }

        .dict-modal-body {
            padding: 28px;
        }

        .dict-word-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .dict-word-container {
            flex: 1;
        }

        .dict-word {
            font-size: 1.8rem;
            font-weight: bold;
            color: #4c55a4;
            margin-bottom: 6px;
            line-height: 1.2;
        }

        .dict-chinese-meaning {
            font-size: 1.05rem;
            margin-top: 6px;
            margin-bottom: 8px;
            line-height: 1.8;
            color: #243b53;
            font-weight: 500;
        }

        .dict-chinese-meaning-separator {
            color: #8ea6ff;
            margin: 0 6px;
            font-weight: 400;
        }

        .dict-english-words-container {
            margin-top: 12px;
            margin-bottom: 12px;
            padding: 12px 16px;
            background: linear-gradient(135deg, #f0f7ff 0%, #e8f4ff 100%);
            border-radius: 12px;
            border: 1px solid #d0e4ff;
        }

        .dict-english-words-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #4c55a4;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .dict-english-words-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }

        .dict-english-word-tag {
            display: inline-block;
            padding: 8px 14px;
            background: #ffffff;
            border: 2px solid #c5d9ff;
            border-radius: 20px;
            font-size: 0.95rem;
            font-weight: 500;
            color: #4c55a4;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(78, 85, 164, 0.1);
        }

        .dict-english-word-tag:hover {
            background: linear-gradient(135deg, #70a1ff 0%, #8ea6ff 100%);
            color: #ffffff;
            border-color: #70a1ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(78, 85, 164, 0.2);
        }

        .dict-english-word-tag.primary {
            background: linear-gradient(135deg, #70a1ff 0%, #8ea6ff 100%);
            color: #ffffff;
            border-color: #70a1ff;
            font-weight: 600;
            box-shadow: 0 3px 6px rgba(78, 85, 164, 0.15);
        }

        .dict-english-word-tag.primary:hover {
            background: linear-gradient(135deg, #5a8fff 0%, #70a1ff 100%);
            transform: translateY(-2px) scale(1.05);
        }

        .dict-phonetic {
            font-size: 1rem;
            color: #51627a;
            font-style: italic;
            margin-top: 4px;
            margin-bottom: 2px;
        }

        .dict-pronounce-btn {
            background: #f3f6ff;
            border: 2px solid #8ea6ff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.2s;
        }

        .dict-pronounce-btn:hover {
            background: #eef5ff;
            transform: scale(1.1);
        }

        .dict-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .dict-tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: transparent;
            color: #51627a;
            font-size: 1rem;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }

        .dict-tab.active {
            color: #4c55a4;
            border-bottom-color: #70a1ff;
            font-weight: 600;
        }

        .dict-tab-content {
            display: none;
        }

        .dict-tab-content.active {
            display: block;
        }

        .dict-meaning-item {
            margin-bottom: 20px;
            padding: 15px;
            background: #f7f9ff;
            border-radius: 12px;
            border-left: 4px solid #8ea6ff;
        }

        .dict-meaning-type {
            font-weight: 600;
            color: #4c55a4;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .dict-meaning-text {
            color: #243b53;
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .dict-examples {
            margin-top: 10px;
        }

        .dict-example {
            padding: 8px 12px;
            background: #ffffff;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 3px solid #70a1ff;
        }

        .dict-example-en {
            color: #243b53;
            margin-bottom: 4px;
        }

        .dict-example-cn {
            color: #8ea6ff;
            font-size: 0.9rem;
        }

        .dict-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
            padding-top: 24px;
            border-top: 2px solid #f0f0f0;
        }

        .dict-action-btn {
            flex: 1;
            padding: 12px 24px;
            border: 2px solid #8ea6ff;
            border-radius: 12px;
            background: #f3f6ff;
            color: #4c55a4;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .dict-action-btn:hover {
            background: #eef5ff;
            border-color: #70a1ff;
            transform: translateY(-2px);
        }

        .dict-action-btn.primary {
            background: linear-gradient(135deg, #70a1ff, #8ea6ff);
            color: #ffffff;
            border: none;
        }

        .dict-action-btn.primary:hover {
            background: linear-gradient(135deg, #8ea6ff, #70a1ff);
        }

        /* Âä†ÂÖ•ÁîüËØçÊú¨ÊåâÈíÆÊ†∑Âºè */
        .dict-add-btn {
            background: linear-gradient(135deg, #ff9a9e, #fad0c4) !important;
            color: #ffffff !important;
            border: 2px solid #ff9a9e !important;
            font-size: 1.05rem !important;
        }

        .dict-add-btn:hover {
            background: linear-gradient(135deg, #ffb3b6, #ffded5) !important;
            border-color: #ffb3b6 !important;
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 4px 12px rgba(255, 154, 158, 0.3);
        }

        .dict-loading {
            text-align: center;
            padding: 40px;
            color: #8ea6ff;
        }

        .dict-error {
            text-align: center;
            padding: 40px;
            color: #ef5350;
        }

        /* ËØçÂÖ∏ÁªìÊûúÊ†∑Âºè */
        .dict-header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 2px solid #f0f0f0;
            margin-bottom: 20px;
        }

        .dict-word {
            font-size: 2rem;
            color: #4c55a4;
            margin: 0;
            font-weight: 700;
        }

        .dict-phonetic {
            display: inline-block;
            margin-left: 10px;
            color: #8ea6ff;
            font-size: 1.1rem;
        }

        /* ‰∏≠ÊñáËæìÂÖ•Êó∂ÁöÑÁøªËØëÊèêÁ§∫Ê†∑Âºè */
        .dict-translation-hint {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .dict-chinese-word {
            font-size: 1.5rem;
            color: #ff6b6b;
            font-weight: 600;
        }

        .dict-arrow {
            font-size: 1.5rem;
            color: #70a1ff;
            font-weight: 700;
        }

        .dict-translation-hint .dict-word {
            font-size: 2rem;
            color: #4c55a4;
            margin: 0;
            font-weight: 700;
        }

        .dict-section {
            margin-bottom: 28px;
            padding: 20px;
            background: linear-gradient(135deg, #f8faff, #f0f4ff);
            border-radius: 16px;
            border: 2px solid #e8eeff;
            box-shadow: 0 2px 8px rgba(78, 89, 164, 0.08);
        }

        .dict-section-title {
            color: #4c55a4;
            font-size: 1.25rem;
            margin: 0 0 16px 0;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .dict-meanings-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .dict-meaning-item {
            color: #1a1a2e;
            font-size: 1.05rem;
            line-height: 1.8;
            padding: 12px 16px;
            background: #ffffff;
            border-radius: 10px;
            border-left: 4px solid #70a1ff;
            transition: all 0.2s ease;
        }

        .dict-meaning-item:hover {
            background: #f8faff;
            transform: translateX(3px);
        }

        .dict-part-of-speech {
            color: #5b7fff;
            font-weight: 700;
            margin-bottom: 14px;
            font-size: 1.1rem;
            text-transform: capitalize;
            letter-spacing: 0.5px;
        }

        /* HTML‰∏≠‰ΩøÁî®ÁöÑÊòØ dict-partofspeechÔºàÊó†ËøûÂ≠óÁ¨¶ÔºâÔºåÈúÄË¶ÅÂçïÁã¨ÂÆö‰πâ */
        .dict-partofspeech {
            color: #5b7fff;
            font-weight: 700;
            margin-bottom: 14px;
            font-size: 1.1rem;
            text-transform: capitalize;
            letter-spacing: 0.5px;
        }

        /* Âº∫Âà∂Ë¶ÜÁõñÊâÄÊúâËØçÊÄßÊòæÁ§∫ÔºàÂåÖÊã¨ÊúâËøûÂ≠óÁ¨¶ÂíåÊó†ËøûÂ≠óÁ¨¶ÁöÑÁâàÊú¨Ôºâ */
        .dict-part-of-speech,
        .dict-partofspeech {
            color: #5b7fff !important;
            font-weight: 700 !important;
            font-size: 1.15rem !important;
            margin-bottom: 16px !important;
            text-transform: capitalize !important;
        }

        .dict-definition-item {
            display: flex;
            margin-bottom: 12px;
            line-height: 1.8;
        }

        .dict-def-number {
            color: #70a1ff;
            font-weight: 700;
            margin-right: 10px;
            min-width: 30px;
            font-size: 1rem;
        }

        .dict-definition {
            color: #1a1a2e;
            flex: 1;
            font-size: 1rem;
        }

        .dict-example {
            margin: 12px 0 12px 40px;
            padding: 14px 16px;
            background: #ffffff;
            border-left: 4px solid #ffd43b;
            border-radius: 10px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        }

        .dict-example-en {
            color: #2c3e50;
            font-style: italic;
            margin-bottom: 8px;
            font-size: 1.05rem;
            font-weight: 500;
        }

        .dict-example-cn {
            color: #666;
            font-size: 1rem;
            line-height: 1.6;
        }

        .dict-synonyms {
            margin-top: 16px;
            padding: 14px;
            background: #ffffff;
            border-radius: 10px;
            font-size: 1rem;
            border: 2px dashed #e8eeff;
        }

        .dict-synonyms-label {
            color: #70a1ff;
            font-weight: 700;
            margin-right: 10px;
            font-size: 1.05rem;
        }

        .dict-synonym-word {
            display: inline-block;
            padding: 6px 12px;
            margin: 4px;
            background: linear-gradient(135deg, #e8f0ff, #d6e4ff);
            color: #4c55a4;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .dict-synonym-word:hover {
            background: #70a1ff;
            color: #ffffff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(112, 161, 255, 0.3);
        }

        .dict-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 24px;
            padding-top: 24px;
            border-top: 2px solid #f0f0f0;
        }

        /* ÂçïËØçÂõæÁâáÊ†∑Âºè */
        .dict-image-container {
            text-align: center;
            margin-bottom: 20px;
            padding: 0 10px;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dict-word-image {
            max-width: 100%;
            width: 100%;
            max-width: 500px;
            height: auto;
            aspect-ratio: 4 / 3;
            object-fit: cover;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s ease;
            background: linear-gradient(135deg, #f5f7fa, #e8eef5);
        }

        .dict-word-image:hover {
            transform: scale(1.02);
        }

        /* ÂõæÁâáÂä†ËΩΩÂ§±Ë¥•Êó∂ÁöÑ emoji Âç†‰ΩçÁ¨¶ */
        .dict-image-container::before {
            content: attr(data-word);
            font-size: 3rem;
            font-weight: 700;
            color: #8ea6ff;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #f5f7fa, #e8eef5);
            border-radius: 16px;
            border: 3px dashed #8ea6ff;
            padding: 20px;
            word-break: break-word;
            text-transform: uppercase;
        }

        .dict-image-container::after {
            content: 'üìñ';
            display: block;
            font-size: 4rem;
            margin-top: 10px;
        }

        /* ÁÆÄÂåñÈáä‰πâÂå∫ÂüüÔºàÂ∞èÂ≠¶ÁîüÂèãÂ•ΩÔºâ */
        .dict-simple-section {
            background: linear-gradient(135deg, #fff9e6, #ffe8cc);
            border: 2px solid #ffb84d;
            border-radius: 16px;
            padding: 20px;
        }

        .dict-translate-tip {
            margin-top: 12px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            font-size: 0.9rem;
            color: #8b7355;
            text-align: center;
        }

        .dict-simple-meanings {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .dict-simple-item {
            font-size: 1.3rem;
            font-weight: 600;
            color: #d35400;
            padding: 12px 16px;
            background: #ffffff;
            border-radius: 12px;
            line-height: 1.6;
        }

        /* ‰æãÂè•Ê†∑ÂºèÔºàÂ§ßÂ≠óÂè∑Ôºâ */
        .dict-examples-section {
            background: linear-gradient(135deg, #e8f5ff, #d6eaff);
        }

        .dict-example-item {
            margin-bottom: 16px;
            padding: 16px;
            background: #ffffff;
            border-radius: 12px;
            border-left: 4px solid #70a1ff;
        }

        .dict-example-en-large {
            font-size: 1.15rem;
            color: #2c3e50;
            margin-bottom: 8px;
            line-height: 1.7;
            font-weight: 500;
        }

        .dict-example-cn-large {
            font-size: 1.1rem;
            color: #7f8c8d;
            line-height: 1.6;
        }

        /* Âêå‰πâËØçÊ†∑ÂºèÔºàÂ§ßÂè∑Ôºâ */
        .dict-synonyms-section {
            background: linear-gradient(135deg, #f0e6ff, #e6d6ff);
        }

        .dict-synonyms-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .dict-synonym-word-large {
            display: inline-block;
            padding: 8px 16px;
            background: #ffffff;
            color: #6c5ce7;
            border-radius: 20px;
            font-size: 1.05rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .dict-synonym-word-large:hover {
            background: #6c5ce7;
            color: #ffffff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(108, 92, 231, 0.3);
        }

        /* Âú∫ÊôØÂè•Â≠êÊ†∑Âºè */
        .dict-scenes-section {
            background: linear-gradient(135deg, #fff0e6, #ffe6cc);
        }

        .dict-scenes-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .dict-scene-item {
            padding: 12px 16px;
            background: #ffffff;
            border-radius: 12px;
            border-left: 4px solid #ff9f43;
            transition: all 0.3s ease;
        }

        .dict-scene-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 12px rgba(255, 159, 67, 0.2);
        }

        .dict-scene-tag {
            display: inline-block;
            padding: 4px 12px;
            background: linear-gradient(135deg, #ff9f43, #ff6b35);
            color: #ffffff;
            border-radius: 16px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .dict-scene-en {
            font-size: 1.05rem;
            color: #2c3e50;
            margin-bottom: 6px;
            line-height: 1.5;
        }

        .dict-scene-cn {
            font-size: 1rem;
            color: #7f8c8d;
            line-height: 1.4;
        }

        /* ============ ËØçÂÖ∏ÊòæÁ§∫‰ºòÂåñÔºàÈÄÇÂêàÂ∞èÂ≠¶È´òÂπ¥Á∫ßÂíåÂàù‰∏≠Ôºâ ============ */

        /* Âº∫Âà∂Ë¶ÜÁõñ‰∏≠ÊñáÈáä‰πâÈÉ®ÂàÜ */
        .dict-meanings-section .dict-section-title {
            font-size: 1.3rem !important;
            font-weight: 700 !important;
        }

        .dict-meanings-section .dict-meaning-item {
            font-size: 1.05rem !important;
            line-height: 1.8 !important;
            padding: 14px 18px !important;
            background: #ffffff !important;
            border-radius: 10px !important;
            border-left: 4px solid #70a1ff !important;
            margin-bottom: 10px !important;
        }

        .dict-meanings-section .dict-partofspeech {
            font-size: 1.15rem !important;
            color: #4c55a4 !important;
            margin-bottom: 16px !important;
        }

        /* Âº∫Âà∂Ë¶ÜÁõñËã±ÊñáÈáä‰πâÈÉ®ÂàÜ */
        .dict-english-section .dict-partofspeech {
            font-size: 1.1rem !important;
            color: #70a1ff !important;
            font-weight: 700 !important;
            margin-bottom: 12px !important;
        }

        .dict-english-section .dict-def-number {
            font-size: 1rem !important;
            color: #70a1ff !important;
            font-weight: 700 !important;
        }

        .dict-english-section .dict-definition {
            font-size: 1rem !important;
            color: #1a1a2e !important;
            line-height: 1.7 !important;
        }

        /* ‰ºòÂåñ‰æãÂè•Ê†∑Âºè - Êõ¥Ê∏©ÊöñÁöÑÈ¢úËâ≤ÔºåÊõ¥Â§ßÁöÑÂ≠ó‰Ωì */
        .dict-examples-section {
            background: linear-gradient(135deg, #fff8e1, #fff3c4) !important;
            border: 2px solid #ffe6a7 !important;
        }

        .dict-example-item {
            margin-bottom: 18px !important;
            padding: 18px !important;
            background: #ffffff !important;
            border-radius: 14px !important;
            border-left: 5px solid #ffd43b !important;
            box-shadow: 0 3px 10px rgba(255, 212, 59, 0.15) !important;
            transition: all 0.3s ease !important;
        }

        .dict-example-item:hover {
            transform: translateX(5px) !important;
            box-shadow: 0 5px 15px rgba(255, 212, 59, 0.25) !important;
        }

        .dict-example-en-large {
            font-size: 1.2rem !important;
            color: #2c3e50 !important;
            margin-bottom: 10px !important;
            line-height: 1.7 !important;
            font-weight: 600 !important;
        }

        .dict-example-cn-large {
            font-size: 1.15rem !important;
            color: #666 !important;
            line-height: 1.6 !important;
            font-weight: 400 !important;
        }

        /* ‰ºòÂåñÂêå‰πâËØçÊ†∑Âºè - Á¥´Ëâ≤‰∏ªÈ¢ò */
        .dict-synonyms-section {
            background: linear-gradient(135deg, #f3e5f5, #e1bee7) !important;
            border: 2px solid #e0b0e8 !important;
        }

        .dict-synonyms-list {
            gap: 12px !important;
        }

        .dict-synonym-word-large {
            padding: 10px 18px !important;
            background: #ffffff !important;
            color: #8e44ad !important;
            border-radius: 24px !important;
            font-size: 1.1rem !important;
            font-weight: 600 !important;
            border: 2px solid #d7b3e0 !important;
            box-shadow: 0 2px 6px rgba(142, 68, 173, 0.1) !important;
        }

        .dict-synonym-word-large:hover {
            background: #9b59b6 !important;
            color: #ffffff !important;
            transform: translateY(-3px) !important;
            box-shadow: 0 6px 16px rgba(155, 89, 182, 0.4) !important;
        }

        /* ‰ºòÂåñÂú∫ÊôØÂè•Â≠êÊ†∑Âºè - ÈùíÁªøËâ≤‰∏ªÈ¢ò */
        .dict-scenes-section {
            background: linear-gradient(135deg, #e8f8f5, #d4f1ec) !important;
            border: 2px solid #b8e6e0 !important;
        }

        .dict-scenes-list {
            gap: 14px !important;
        }

        .dict-scene-item {
            padding: 16px 18px !important;
            background: #ffffff !important;
            border-radius: 14px !important;
            border-left: 5px solid #00d2d3 !important;
            box-shadow: 0 2px 8px rgba(0, 210, 211, 0.1) !important;
        }

        .dict-scene-item:hover {
            transform: translateX(6px) !important;
            box-shadow: 0 4px 16px rgba(0, 210, 211, 0.2) !important;
        }

        .dict-scene-tag {
            padding: 6px 14px !important;
            background: linear-gradient(135deg, #00d2d3, #00b5b5) !important;
            border-radius: 20px !important;
            font-size: 0.95rem !important;
            font-weight: 700 !important;
            margin-bottom: 10px !important;
            box-shadow: 0 2px 6px rgba(0, 210, 211, 0.3) !important;
        }

        .dict-scene-en {
            font-size: 1.1rem !important;
            color: #2c3e50 !important;
            margin-bottom: 8px !important;
            line-height: 1.6 !important;
            font-weight: 500 !important;
        }

        .dict-scene-cn {
            font-size: 1.05rem !important;
            color: #7f8c8d !important;
            line-height: 1.6 !important;
        }

        /* ÂìçÂ∫îÂºèË∞ÉÊï¥ */
        @media (max-width: 768px) {
            .dict-word-image {
                width: 100%;
                height: 180px;
            }

            .dict-simple-item {
                font-size: 1.15rem;
            }

            .dict-example-en-large {
                font-size: 1.05rem;
            }

            .dict-example-cn-large {
                font-size: 1rem;
            }
        }

        /* üìö ÁîüËØçÊú¨Ê®°ÂùóÊ†∑Âºè */
        .wordbook-item {
            background: #f7f9ff;
            border: 2px solid #e0e8ff;
            border-radius: 12px;
            padding: 16px;
            transition: all 0.2s;
        }

        .wordbook-item:hover {
            border-color: #8ea6ff;
            box-shadow: 0 4px 12px rgba(142, 166, 255, 0.15);
            transform: translateY(-2px);
        }

        .wordbook-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .wordbook-word {
            font-size: 1.3rem;
            font-weight: bold;
            color: #4c55a4;
        }

        .wordbook-actions {
            display: flex;
            gap: 8px;
        }

        .wordbook-btn {
            padding: 6px 12px;
            border: 1px solid #8ea6ff;
            border-radius: 6px;
            background: #ffffff;
            color: #4c55a4;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .wordbook-btn:hover {
            background: #eef5ff;
            border-color: #70a1ff;
        }

        .wordbook-btn.danger {
            border-color: #ef5350;
            color: #ef5350;
        }

        .wordbook-btn.danger:hover {
            background: #ffebee;
        }

        .wordbook-meaning {
            color: #51627a;
            margin-bottom: 8px;
            line-height: 1.6;
        }

        .wordbook-example {
            color: #8ea6ff;
            font-style: italic;
            font-size: 0.9rem;
            padding-left: 12px;
            border-left: 3px solid #8ea6ff;
        }

        .wordbook-chinese {
            color: #4caf50;
            font-weight: 600;
            margin-top: 8px;
            padding: 8px;
            background: #f1f8f4;
            border-radius: 6px;
        }

        .tabs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 32px;
            margin-bottom: 24px;
        }

        .tab {
            border-radius: 14px;
            padding: 18px 22px;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        /* ÂçïËØçËÉåËØµ - ÊüîÂíåÁÅ∞ÁªøËâ≤ËÉåÊôØÔºåÈªëËâ≤Â≠ó‰Ωì */
        .tab[data-target="vocab"] {
            background: linear-gradient(135deg, rgba(236, 253, 245, 0.7) 0%, rgba(220, 252, 231, 0.65) 100%);
            border-color: rgba(16, 185, 129, 0.2);
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.1);
            color: #1E293B;
        }

        .tab[data-target="vocab"].active {
            background: linear-gradient(135deg, rgba(236, 253, 245, 0.9) 0%, rgba(220, 252, 231, 0.85) 100%);
            border-color: rgba(16, 185, 129, 0.3);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.15);
            transform: translateY(-2px);
            color: #1E293B;
        }

        .tab[data-target="vocab"]:hover:not(.active) {
            background: linear-gradient(135deg, rgba(236, 253, 245, 0.8) 0%, rgba(220, 252, 231, 0.75) 100%);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.12);
            transform: translateY(-1px);
        }

        /* ÈòÖËØªÁêÜËß£ - ‰ºòÈõÖËñ∞Ë°£ËçâÁ¥´ */
        .tab[data-target="reading"] {
            background: linear-gradient(135deg, rgba(221, 214, 254, 0.35) 0%, rgba(196, 181, 253, 0.3) 100%);
            border-color: rgba(139, 92, 246, 0.3);
            box-shadow: 0 2px 8px rgba(139, 92, 246, 0.15);
        }

        .tab[data-target="reading"].active {
            background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%);
            border-color: #8b5cf6;
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.35);
            transform: translateY(-2px);
            color: #fff;
        }

        .tab[data-target="reading"]:hover:not(.active) {
            background: linear-gradient(135deg, rgba(221, 214, 254, 0.45) 0%, rgba(196, 181, 253, 0.4) 100%);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.25);
            transform: translateY(-1px);
        }

        /* Âõ∫ÂÆöÊê≠ÈÖç - Ê∏ÖÊñ∞Â§©ËìùËâ≤ */
        .tab[data-target="collocation"] {
            background: linear-gradient(135deg, rgba(186, 230, 253, 0.35) 0%, rgba(147, 197, 253, 0.3) 100%);
            border-color: rgba(59, 130, 246, 0.3);
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);
        }

        .tab[data-target="collocation"].active {
            background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%);
            border-color: #3b82f6;
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.35);
            transform: translateY(-2px);
            color: #fff;
        }

        .tab[data-target="collocation"]:hover:not(.active) {
            background: linear-gradient(135deg, rgba(186, 230, 253, 0.45) 0%, rgba(147, 197, 253, 0.4) 100%);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.25);
            transform: translateY(-1px);
        }

        /* ÂÆåÂΩ¢Â°´Á©∫ - Ê∏©ÊöñÁèäÁëöÊ©ô */
        .tab[data-target="cloze"] {
            background: linear-gradient(135deg, rgba(254, 215, 170, 0.35) 0%, rgba(253, 186, 116, 0.3) 100%);
            border-color: rgba(249, 115, 22, 0.3);
            box-shadow: 0 2px 8px rgba(249, 115, 22, 0.15);
        }

        .tab[data-target="cloze"].active {
            background: linear-gradient(135deg, #f97316 0%, #fb923c 100%);
            border-color: #f97316;
            box-shadow: 0 6px 20px rgba(249, 115, 22, 0.35);
            transform: translateY(-2px);
            color: #fff;
        }

        .tab[data-target="cloze"]:hover:not(.active) {
            background: linear-gradient(135deg, rgba(254, 215, 170, 0.45) 0%, rgba(253, 186, 116, 0.4) 100%);
            box-shadow: 0 4px 12px rgba(249, 115, 22, 0.25);
            transform: translateY(-1px);
        }

        /* ÁîüËØçÊú¨ - ÊüîÂíåÁé´Áë∞Á≤â */
        .tab[data-target="wordbook"] {
            background: linear-gradient(135deg, rgba(251, 207, 232, 0.35) 0%, rgba(244, 114, 182, 0.25) 100%);
            border-color: rgba(236, 72, 153, 0.3);
            box-shadow: 0 2px 8px rgba(236, 72, 153, 0.15);
        }

        .tab[data-target="wordbook"].active {
            background: linear-gradient(135deg, #ec4899 0%, #f472b6 100%);
            border-color: #ec4899;
            box-shadow: 0 6px 20px rgba(236, 72, 153, 0.35);
            transform: translateY(-2px);
            color: #fff;
        }

        .tab[data-target="wordbook"]:hover:not(.active) {
            background: linear-gradient(135deg, rgba(251, 207, 232, 0.45) 0%, rgba(244, 114, 182, 0.35) 100%);
            box-shadow: 0 4px 12px rgba(236, 72, 153, 0.25);
            transform: translateY(-1px);
        }

        .tab h3 {
            font-size: 1.2rem;
            margin-bottom: 4px;
            color: #1E293B;
        }

        .tab[data-target="vocab"] h3 {
            color: #1E293B;
        }

        .tab[data-target="vocab"].active h3 {
            color: #1E293B;
        }

        .tab span {
            font-size: .95rem;
            color: #64748b;
        }

        .tab[data-target="vocab"] span {
            color: #64748b;
        }

        .tab[data-target="vocab"].active span {
            color: #64748b;
        }

        .card {
            border-radius: 24px;
            padding: 32px;
            border: 1px solid rgba(255, 255, 255, 0.6);
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px) saturate(150%);
            -webkit-backdrop-filter: blur(10px) saturate(150%);
            box-shadow:
                0 8px 32px 0 rgba(0, 0, 0, 0.12),
                inset 0 1px 0 0 rgba(255, 255, 255, 0.8);
            margin-top: 24px;
            margin-bottom: 0;
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow:
                0 12px 40px 0 rgba(0, 0, 0, 0.15),
                inset 0 1px 0 0 rgba(255, 255, 255, 0.9);
        }

        /* ÂçïËØçËÉåËØµÂç°Áâá - ÁªøËâ≤ */
        /* ÂçïËØçËÉåËØµÂç°Áâá - ÊüîÂíåÁÅ∞ÁªøËâ≤ */
        #vocab.card {
            background: rgba(236, 253, 245, 0.7);
            border-color: rgba(16, 185, 129, 0.25);
        }

        /* ÈòÖËØªÁêÜËß£Âç°Áâá - ‰ºòÈõÖËñ∞Ë°£ËçâÁ¥´ */
        #reading.card {
            background: rgba(221, 214, 254, 0.6);
            border-color: rgba(139, 92, 246, 0.35);
        }

        /* Âõ∫ÂÆöÊê≠ÈÖçÂç°Áâá - Ê∏ÖÊñ∞Â§©ËìùËâ≤ */
        #collocation.card {
            background: rgba(186, 230, 253, 0.6);
            border-color: rgba(59, 130, 246, 0.35);
        }

        /* ÂÆåÂΩ¢Â°´Á©∫Âç°Áâá - Ê∏©ÊöñÁèäÁëöÊ©ô */
        #cloze.card {
            background: rgba(254, 215, 170, 0.6);
            border-color: rgba(249, 115, 22, 0.35);
        }

        /* ÁîüËØçÊú¨Âç°Áâá - ÊüîÂíåÁé´Áë∞Á≤â */
        #wordbook.card {
            background: rgba(251, 207, 232, 0.6);
            border-color: rgba(236, 72, 153, 0.35);
        }

        .card h2 {
            font-size: 1.375rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #212529;
            font-weight: 600;
        }

        .word-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(16, 185, 129, 0.15);
            border-radius: 20px;
            padding: 28px;
            margin-bottom: 20px;
            position: relative;
            box-shadow:
                0 8px 24px rgba(16, 185, 129, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
        }

        .word-card .word-content {
            transition: filter .2s ease;
        }

        .word-card.quiz-hidden .word-content {
            filter: blur(18px);
            pointer-events: none;
        }

        .word-card .cover-tag {
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(0, 0, 0, 0.55);
            color: #fff;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: .85rem;
            display: none;
        }

        .word-card.quiz-hidden .cover-tag {
            display: inline-flex;
        }

        .word-card h3 {
            font-size: 1.8rem;
            margin-bottom: 8px;
            color: #10b981;
            font-weight: 600;
        }

        .small-label {
            font-size: .9rem;
            color: #64748b;
        }

        #vocab .small-label {
            color: #64748b;
        }

        .question-text {
            margin-top: 14px;
            font-weight: 600;
            color: #2f3f68;
        }

        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 18px;
        }

        .hint-text {
            margin-top: 8px;
            font-size: .9rem;
            color: #6d7897;
        }

        .example {
            margin-top: 12px;
            padding: 14px;
            background: rgba(16, 185, 129, 0.06);
            border-left: 3px solid rgba(16, 185, 129, 0.25);
            border-radius: 8px;
            font-style: italic;
            color: #334155;
            line-height: 1.6;
        }

        #vocab .example {
            background: rgba(16, 185, 129, 0.06);
            border-left-color: rgba(16, 185, 129, 0.25);
        }

        button {
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-weight: 500;
            font-size: 0.9375rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        button:hover {
            transform: translateY(-1px);
        }

        .primary-btn {
            background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);
            color: #fff;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .primary-btn:hover {
            background: linear-gradient(135deg, #45a049 0%, #4caf50 100%);
            box-shadow: 0 6px 16px rgba(76, 175, 80, 0.4);
            transform: translateY(-2px);
        }

        /* ÂçïËØçËÉåËØµÊ®°Âùó - ÊüîÂíåÁÅ∞ÁªøËâ≤ÊåâÈíÆ */
        #vocab .primary-btn,
        #vocab #quizWordBtn {
            background: linear-gradient(135deg, #10b981 0%, #34d399 100%) !important;
            color: #fff !important;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        #vocab .primary-btn:hover,
        #vocab #quizWordBtn:hover {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%) !important;
            box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
        }

        /* ÂçïËØçËÉåËØµÊ®°Âùó - Êç¢‰∏Ä‰∏™ÂçïËØçÊåâÈíÆÔºöÈÄèÊòéËÉåÊôØÔºåÁªøËâ≤Â≠ó */
        #vocab #nextWordBtn {
            background: transparent !important;
            color: #10b981 !important;
            border: 1px solid rgba(16, 185, 129, 0.3) !important;
            box-shadow: none !important;
        }

        #vocab #nextWordBtn:hover {
            background: rgba(16, 185, 129, 0.1) !important;
            border-color: rgba(16, 185, 129, 0.5) !important;
            color: #059669 !important;
        }

        /* ÈòÖËØªÁêÜËß£Ê®°Âùó - Á¥´Ëâ≤ÊåâÈíÆ */
        #reading .primary-btn,
        #reading #checkReadingBtn {
            background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }

        #reading .primary-btn:hover,
        #reading #checkReadingBtn:hover {
            background: linear-gradient(135deg, #7c3aed 0%, #8b5cf6 100%);
            box-shadow: 0 6px 16px rgba(139, 92, 246, 0.4);
        }

        /* Âõ∫ÂÆöÊê≠ÈÖçÊ®°Âùó - ËìùËâ≤ÊåâÈíÆ */
        #collocation .primary-btn,
        #collocation #checkCollocationBtn {
            background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        #collocation .primary-btn:hover,
        #collocation #checkCollocationBtn:hover {
            background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
            box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4);
        }

        /* ÂÆåÂΩ¢Â°´Á©∫Ê®°Âùó - Ê©ôËâ≤ÊåâÈíÆ */
        #cloze .primary-btn,
        #cloze #checkClozeBtn {
            background: linear-gradient(135deg, #f97316 0%, #fb923c 100%);
            box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
        }

        #cloze .primary-btn:hover,
        #cloze #checkClozeBtn:hover {
            background: linear-gradient(135deg, #ea580c 0%, #f97316 100%);
            box-shadow: 0 6px 16px rgba(249, 115, 22, 0.4);
        }

        /* ÁîüËØçÊú¨Ê®°Âùó - Á≤âËâ≤ÊåâÈíÆ */
        #wordbook .primary-btn {
            background: linear-gradient(135deg, #ec4899 0%, #f472b6 100%);
            box-shadow: 0 4px 12px rgba(236, 72, 153, 0.3);
        }

        #wordbook .primary-btn:hover {
            background: linear-gradient(135deg, #db2777 0%, #ec4899 100%);
            box-shadow: 0 6px 16px rgba(236, 72, 153, 0.4);
        }

        .secondary-btn {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
            color: #4c55a4;
            border: 2px solid #d0e4ff;
            box-shadow: 0 2px 6px rgba(142, 166, 255, 0.15);
        }

        .secondary-btn:hover {
            background: linear-gradient(135deg, #f0f7ff 0%, #e8f4ff 100%);
            border-color: #8ea6ff;
            box-shadow: 0 4px 12px rgba(142, 166, 255, 0.25);
        }

        /* ÂçïËØçËÉåËØµÊ®°Âùó - Êç¢‰∏Ä‰∏™ÂçïËØçÊåâÈíÆ */
        #vocab .secondary-btn,
        #vocab #nextWordBtn {
            background: rgba(236, 253, 245, 0.8);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
            box-shadow: 0 2px 6px rgba(16, 185, 129, 0.15);
        }

        #vocab .secondary-btn:hover,
        #vocab #nextWordBtn:hover {
            background: rgba(209, 250, 229, 0.9);
            border-color: rgba(16, 185, 129, 0.4);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.25);
        }

        /* ÈòÖËØªÁêÜËß£Ê®°Âùó - Êç¢‰∏ÄÁØáÊñáÁ´†ÊåâÈíÆ */
        #reading .secondary-btn,
        #reading #nextReadingBtn {
            background: rgba(221, 214, 254, 0.6);
            color: #8b5cf6;
            border: 1px solid rgba(139, 92, 246, 0.3);
            box-shadow: 0 2px 6px rgba(139, 92, 246, 0.15);
        }

        #reading .secondary-btn:hover,
        #reading #nextReadingBtn:hover {
            background: rgba(221, 214, 254, 0.8);
            border-color: rgba(139, 92, 246, 0.4);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.25);
        }

        /* Âõ∫ÂÆöÊê≠ÈÖçÊ®°Âùó - Êç¢‰∏ÄÈ¢òÊåâÈíÆ */
        #collocation .secondary-btn,
        #collocation #nextCollocationBtn {
            background: rgba(186, 230, 253, 0.6);
            color: #3b82f6;
            border: 1px solid rgba(59, 130, 246, 0.3);
            box-shadow: 0 2px 6px rgba(59, 130, 246, 0.15);
        }

        #collocation .secondary-btn:hover,
        #collocation #nextCollocationBtn:hover {
            background: rgba(186, 230, 253, 0.8);
            border-color: rgba(59, 130, 246, 0.4);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.25);
        }

        /* ÂÆåÂΩ¢Â°´Á©∫Ê®°Âùó - Êç¢‰∏Ä‰∏™ÊïÖ‰∫ãÊåâÈíÆ */
        #cloze .secondary-btn,
        #cloze #nextClozeBtn {
            background: rgba(254, 215, 170, 0.6);
            color: #f97316;
            border: 1px solid rgba(249, 115, 22, 0.3);
            box-shadow: 0 2px 6px rgba(249, 115, 22, 0.15);
        }

        #cloze .secondary-btn:hover,
        #cloze #nextClozeBtn:hover {
            background: rgba(254, 215, 170, 0.8);
            border-color: rgba(249, 115, 22, 0.4);
            box-shadow: 0 4px 12px rgba(249, 115, 22, 0.25);
        }

        .choices {
            display: grid;
            gap: 12px;
            margin: 18px 0;
        }

        .choice {
            border-radius: 12px;
            padding: 16px 20px;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
            border: 2px solid #e0e8ff;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(142, 166, 255, 0.1);
        }

        .choice:hover {
            border-color: #8ea6ff;
            background: linear-gradient(135deg, #f0f7ff 0%, #e8f4ff 100%);
            box-shadow: 0 4px 12px rgba(142, 166, 255, 0.2);
            transform: translateY(-2px);
        }

        .choice.selected {
            border-color: #4caf50;
            background: linear-gradient(135deg, #e8f5e9 0%, #f1f8f4 100%);
            box-shadow: 0 4px 16px rgba(76, 175, 80, 0.25);
        }

        .choice.correct {
            border-color: #4caf50;
            background: linear-gradient(135deg, #c8e6c9 0%, #e8f5e9 100%);
            box-shadow: 0 4px 16px rgba(76, 175, 80, 0.3);
        }

        .choice.wrong {
            border-color: #f44336;
            background: linear-gradient(135deg, #ffcdd2 0%, #ffebee 100%);
            box-shadow: 0 4px 16px rgba(244, 67, 54, 0.2);
        }

        /* Êñá‰ª∂È¢ÑËßàÊ®°ÊÄÅÊ°Ü */
        .preview-header h3 {
            margin: 0;
            font-size: 1.1rem;
            color: #1b2540;
            flex: 1;
        }

        .preview-body img {
            max-width: 100%;
            max-height: 70vh;
            object-fit: contain;
        }

        .preview-body iframe {
            width: 100%;
            height: 70vh;
            border: none;
        }

        .preview-body object {
            width: 100%;
            height: 70vh;
        }

        .cloze {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            line-height: 1.9;
        }

        select {
            border-radius: 14px;
            border: 2px solid #dae3ff;
            padding: 6px 10px;
            font-size: 1rem;
            background: #f9fbff;
        }

        .result {
            margin-top: 12px;
            font-weight: 700;
        }

        /* Âç°ÈÄöHelenËÄÅÂ∏àÂΩ¢Ë±° */
        .helen-teacher {
            position: fixed;
            z-index: 1;
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .helen-teacher.bottom-left {
            bottom: 20px;
            left: 20px;
            width: 100px;
            height: 100px;
        }

        .helen-teacher.top-right {
            top: 20px;
            right: 20px;
            width: 80px;
            height: 80px;
        }

        .helen-teacher-content {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #ff6b9d 0%, #ff9a62 50%, #ffc857 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            box-shadow: 0 8px 24px rgba(255, 154, 98, 0.3);
            position: relative;
            overflow: hidden;
            animation: float 3s ease-in-out infinite;
            opacity: 0.85;
        }

        .helen-teacher.top-right .helen-teacher-content {
            font-size: 32px;
            animation: float 3s ease-in-out infinite 1.5s;
        }

        .helen-teacher-content::before {
            content: "";
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.3), transparent 50%);
        }

        .helen-teacher-content::after {
            content: "üë©‚Äçüè´";
            position: relative;
            z-index: 1;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px) rotate(0deg);
            }

            50% {
                transform: translateY(-10px) rotate(5deg);
            }
        }

        @media (max-width: 768px) {
            .helen-teacher {
                display: none;
            }
        }

        .floating-mascot {
            display: none;
            font-size: 56px;
            box-shadow: 0 20px 50px rgba(249, 129, 58, 0.35);
        }


        /* È¢òÂ∫ìÂØºÂÖ•Ê®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .import-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .import-modal.active {
            display: flex;
        }

        .import-content {
            background: white;
            border-radius: 20px;
            max-width: 600px;
            width: 100%;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .import-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid #e4e9ff;
            background: linear-gradient(135deg, #f7f9ff, #eef5ff);
        }

        .import-header h3 {
            margin: 0;
            font-size: 1.3rem;
            color: #1b2540;
        }

        .import-close {
            background: #ff6b6b;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            transition: all 0.2s;
        }

        .import-close:hover {
            background: #ff5252;
            transform: scale(1.1);
        }

        .import-body {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        .import-section {
            margin-bottom: 24px;
        }

        .import-section h4 {
            margin: 0 0 16px 0;
            font-size: 1.1rem;
            color: #2f3f68;
            font-weight: 600;
        }

        .type-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
        }

        .type-option {
            cursor: pointer;
            border: 2px solid #e4e9ff;
            border-radius: 16px;
            background: #f9fbff;
            transition: all 0.2s ease;
            position: relative;
        }

        .type-option:hover {
            border-color: #8ea6ff;
            background: #f0f7ff;
            transform: translateY(-2px);
        }

        .type-option input[type="radio"] {
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }

        .type-option input[type="radio"]:checked+.type-card {
            border-color: #70a1ff;
            background: #eef5ff;
            box-shadow: 0 8px 20px rgba(57, 128, 255, 0.2);
        }

        .type-card {
            padding: 16px 12px;
            text-align: center;
            border-radius: 14px;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        .type-icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .type-name {
            font-weight: 600;
            color: #2f3f68;
            font-size: 0.95rem;
            margin-bottom: 4px;
        }

        .type-desc {
            font-size: 0.85rem;
            color: #6d7897;
        }

        .file-upload-area {
            margin-top: 16px;
        }

        .file-upload-label {
            display: block;
            padding: 40px 20px;
            border: 2px dashed #dae3ff;
            border-radius: 16px;
            background: #f9fbff;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload-label:hover {
            border-color: #8ea6ff;
            background: #f0f7ff;
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 12px;
        }

        .upload-text {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2f3f68;
            margin-bottom: 8px;
        }

        .upload-hint {
            font-size: 0.9rem;
            color: #6d7897;
        }

        .selected-files {
            margin-top: 16px;
            max-height: 200px;
            overflow-y: auto;
        }

        .file-name {
            font-weight: 500;
            color: #2f3f68;
            flex: 1;
            margin-right: 12px;
        }

        .file-size {
            font-size: 0.85rem;
            color: #6d7897;
        }

        .import-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 20px 24px;
            border-top: 1px solid #e4e9ff;
            background: #f9fbff;
        }

        /* ÂÜÖÂÆπÂ∫ìËØ¶ÊÉÖÂºπÁ™óÊ†∑Âºè */
        .bank-detail-item {
            background: #f9fbff;
            border: 1px solid #e4e9ff;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.2s ease;
        }

        .bank-detail-item:hover {
            background: #f0f7ff;
            border-color: #8ea6ff;
            box-shadow: 0 2px 8px rgba(78, 85, 164, 0.1);
        }

        .bank-detail-word {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1b2540;
            margin-bottom: 8px;
        }

        .bank-detail-meaning {
            font-size: 0.95rem;
            color: #51627a;
            margin-bottom: 8px;
        }

        .bank-detail-example {
            font-size: 0.9rem;
            color: #6d7897;
            font-style: italic;
            background: #ffffff;
            padding: 8px 12px;
            border-radius: 8px;
            border-left: 3px solid #70a1ff;
        }

        .bank-detail-question {
            font-size: 1rem;
            font-weight: 600;
            color: #1b2540;
            margin-bottom: 12px;
        }

        .bank-detail-text {
            font-size: 0.95rem;
            color: #51627a;
            margin-bottom: 12px;
            line-height: 1.6;
            background: #ffffff;
            padding: 12px;
            border-radius: 8px;
            border-left: 3px solid #70a1ff;
        }

        .bank-detail-choices {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 12px;
        }

        .bank-detail-choice {
            padding: 8px 12px;
            background: #ffffff;
            border: 1px solid #e4e9ff;
            border-radius: 8px;
            font-size: 0.9rem;
            color: #51627a;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .bank-detail-choice.correct {
            background: #e8f5e9;
            border-color: #4caf50;
            color: #2e7d32;
        }

        .bank-detail-choice.wrong {
            background: #ffebee;
            border-color: #f44336;
            color: #c62828;
        }

        .bank-detail-cloze-text {
            font-size: 0.95rem;
            color: #51627a;
            line-height: 2;
            background: #ffffff;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .bank-detail-cloze-blank {
            display: inline-block;
            min-width: 80px;
            padding: 2px 8px;
            border-bottom: 2px solid #70a1ff;
            font-weight: 600;
            color: #4c55a4;
            margin: 0 4px;
        }

        .bank-detail-cloze-blank.correct {
            background: #e8f5e9;
            border-color: #4caf50;
            color: #2e7d32;
        }

        .bank-detail-cloze-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .bank-detail-cloze-option {
            padding: 6px 12px;
            background: #ffffff;
            border: 1px solid #e4e9ff;
            border-radius: 6px;
            font-size: 0.85rem;
            color: #51627a;
        }

        .bank-detail-cloze-option.correct {
            background: #e8f5e9;
            border-color: #4caf50;
            color: #2e7d32;
            font-weight: 600;
        }

        .bank-detail-pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 16px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e4e9ff;
        }

        .bank-detail-page-info {
            font-size: 0.9rem;
            color: #6d7897;
        }

        .bank-detail-search {
            margin-bottom: 20px;
        }

        .bank-detail-search input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e4e9ff;
            border-radius: 12px;
            font-size: 0.95rem;
            transition: all 0.2s ease;
        }

        .bank-detail-search input:focus {
            outline: none;
            border-color: #70a1ff;
            box-shadow: 0 0 0 3px rgba(112, 161, 255, 0.1);
        }

        @media (max-width: 768px) {
            .app {
                flex-direction: column;
                padding: 0;
            }

            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #e9ecef;
                max-height: 300px;
            }

            .sidebar.collapsed {
                width: 100%;
                max-height: 60px;
            }

            .sidebar-toggle {
                right: 15px;
            }

            .main-content {
                padding: 24px 20px;
            }

            .hero {
                flex-direction: column;
                text-align: center;
            }

            .import-content {
                max-width: 95vw;
                max-height: 90vh;
            }

            .import-body {
                padding: 20px;
            }

            .type-options {
                grid-template-columns: repeat(2, 1fr);
            }

            .import-footer {
                flex-direction: column;
            }

            .import-footer button {
                width: 100%;
            }
        }

        /* ========== ËØçÂÖ∏ÊòæÁ§∫Ê†∑ÂºèÂº∫Âà∂Ë¶ÜÁõñÔºàÂ∞èÂ≠¶È´òÂπ¥Á∫ßÂíåÂàù‰∏≠‰ºòÂåñÔºâ ========== */

        /* ‰∏≠ÊñáÈáä‰πâÂå∫Âüü */
        .dict-meanings-section {
            background: linear-gradient(135deg, #f0f4ff, #e8eeff) !important;
            border: 2px solid #d0d9ff !important;
        }

        .dict-meanings-section .dict-section-title {
            font-size: 1.3rem !important;
            font-weight: 700 !important;
            color: #4c55a4 !important;
        }

        .dict-meanings-section .dict-meaning-item {
            font-size: 1.08rem !important;
            line-height: 1.8 !important;
            padding: 14px 18px !important;
            background: #ffffff !important;
            border-radius: 12px !important;
            border-left: 4px solid #70a1ff !important;
            margin-bottom: 10px !important;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06) !important;
        }

        .dict-meanings-section .dict-part-of-speech,
        .dict-meanings-section .dict-partofspeech {
            font-size: 1.15rem !important;
            color: #4c55a4 !important;
            font-weight: 700 !important;
            margin-bottom: 16px !important;
        }

        /* Ëã±ÊñáÈáä‰πâÂå∫Âüü */
        .dict-english-section {
            background: linear-gradient(135deg, #e8f4ff, #d6e4ff) !important;
            border: 2px solid #c4d9ff !important;
            box-shadow: 0 4px 12px rgba(112, 161, 255, 0.1) !important;
        }

        .dict-english-section .dict-section-title {
            font-size: 1.25rem !important;
            font-weight: 700 !important;
            color: #4c55a4 !important;
        }

        .dict-english-section .dict-part-of-speech,
        .dict-english-section .dict-partofspeech {
            font-size: 1.15rem !important;
            color: #5b7fff !important;
            font-weight: 700 !important;
            margin-bottom: 16px !important;
            padding: 8px 16px !important;
            display: inline-block !important;
            background: linear-gradient(135deg, #e8f0ff, #d6e4ff) !important;
            border-radius: 20px !important;
            border: 2px solid #c4d9ff !important;
        }

        .dict-english-section .dict-definition-item {
            margin-bottom: 14px !important;
            padding: 16px !important;
            background: #ffffff !important;
            border-radius: 12px !important;
            border-left: 4px solid #70a1ff !important;
            box-shadow: 0 2px 8px rgba(112, 161, 255, 0.08) !important;
            transition: all 0.3s ease !important;
        }

        .dict-english-section .dict-definition-item:hover {
            transform: translateX(4px) !important;
            box-shadow: 0 4px 12px rgba(112, 161, 255, 0.15) !important;
        }

        .dict-english-section .dict-def-number {
            font-size: 1.05rem !important;
            color: #ffffff !important;
            font-weight: 700 !important;
            min-width: 32px !important;
            background: linear-gradient(135deg, #70a1ff, #5b7fff) !important;
            border-radius: 8px !important;
            padding: 4px 10px !important;
            text-align: center !important;
            display: inline-block !important;
        }

        .dict-english-section .dict-definition {
            font-size: 1.05rem !important;
            color: #1a1a2e !important;
            line-height: 1.7 !important;
            font-weight: 500 !important;
        }

        /* ‰æãÂè•Âå∫Âüü */
        .dict-examples-section .dict-section-title {
            font-size: 1.25rem !important;
            font-weight: 700 !important;
        }

        .dict-examples-section .dict-example-item {
            margin-bottom: 18px !important;
            padding: 18px !important;
            background: #ffffff !important;
            border-radius: 14px !important;
            border-left: 5px solid #ffd43b !important;
            box-shadow: 0 3px 10px rgba(255, 212, 59, 0.15) !important;
        }

        .dict-examples-section .dict-example-en-large {
            font-size: 1.2rem !important;
            color: #2c3e50 !important;
            margin-bottom: 10px !important;
            line-height: 1.7 !important;
            font-weight: 600 !important;
        }

        .dict-examples-section .dict-example-cn-large {
            font-size: 1.15rem !important;
            color: #666 !important;
            line-height: 1.6 !important;
            font-weight: 400 !important;
        }

        /* Âêå‰πâËØçÂå∫Âüü */
        .dict-synonyms-section .dict-section-title {
            font-size: 1.25rem !important;
            font-weight: 700 !important;
        }

        .dict-synonyms-section .dict-synonym-word-large {
            padding: 10px 18px !important;
            background: #ffffff !important;
            color: #8e44ad !important;
            border-radius: 24px !important;
            font-size: 1.1rem !important;
            font-weight: 600 !important;
            border: 2px solid #d7b3e0 !important;
            box-shadow: 0 2px 6px rgba(142, 68, 173, 0.1) !important;
        }

        .dict-synonyms-section .dict-synonym-word-large:hover {
            background: #9b59b6 !important;
            color: #ffffff !important;
            transform: translateY(-3px) !important;
            box-shadow: 0 6px 16px rgba(155, 89, 182, 0.4) !important;
        }
    </style>
</head>

<body>
    <div class="app">
        <!-- Âç°ÈÄöHelenËÄÅÂ∏àÂΩ¢Ë±° - Â∑¶‰∏ãËßí -->
        <div class="helen-teacher bottom-left" aria-hidden="true">
            <div class="helen-teacher-content"></div>
        </div>

        <!-- Âç°ÈÄöHelenËÄÅÂ∏àÂΩ¢Ë±° - Âè≥‰∏äËßí -->
        <div class="helen-teacher top-right" aria-hidden="true">
            <div class="helen-teacher-content"></div>
        </div>

        <!-- Â∑¶‰æßËæπÊ†è -->
        <div class="sidebar" id="sidebar">
            <button class="sidebar-toggle" id="sidebarToggle" title="ÊäòÂè†/Â±ïÂºÄ">‚óÄ</button>
            <div class="sidebar-header">
                <div class="sidebar-title">ÂØºËà™</div>
            </div>

            <!-- ÁªüËÆ°‰ø°ÊÅØ -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Â≠¶‰π†ËøõÂ∫¶</div>
                <div class="sidebar-badges">
                    <div class="sidebar-badge" id="starsBadge">
                        <span class="badge-icon">üåü</span>
                        <span class="sidebar-badge-text">ÊòüÊòüÔºö0</span>
                    </div>
                    <div class="sidebar-badge" id="wordCountBadge">
                        <span class="badge-icon">üçé</span>
                        <span class="sidebar-badge-text">ÂçïËØçÔºö0</span>
                    </div>
                    <div class="sidebar-badge" id="levelBadge">
                        <span class="badge-icon">üéØ</span>
                        <span class="sidebar-badge-text">Á≠âÁ∫ßÔºöÁßçÂ≠êÊé¢Èô©ÂÆ∂</span>
                    </div>
                </div>
            </div>

            <!-- Êï∞ÊçÆÁÆ°ÁêÜ -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Êï∞ÊçÆÁÆ°ÁêÜ</div>
                <div class="sidebar-badges">
                    <div class="sidebar-badge" id="importBtn" style="cursor: pointer;">
                        <span class="badge-icon">üìÅ</span>
                        <span class="sidebar-badge-text">ÂØºÂÖ•È¢òÂ∫ì</span>
                    </div>
                    <div class="sidebar-badge" id="exportAllDataBtn"
                        onclick="if(typeof window.exportAllData === 'function') { window.exportAllData(); } else { alert('ÂØºÂá∫ÂäüËÉΩÊöÇÊó∂‰∏çÂèØÁî®'); } return false;"
                        style="cursor: pointer;">
                        <span class="badge-icon">üíæ</span>
                        <span class="sidebar-badge-text">ÂØºÂá∫Êï∞ÊçÆ</span>
                    </div>
                    <div class="sidebar-badge" id="versionHistoryBtn" style="cursor: pointer;">
                        <span class="badge-icon">üìú</span>
                        <span class="sidebar-badge-text">ÂéÜÂè≤ÁâàÊú¨</span>
                    </div>
                    <div class="sidebar-badge" id="clearStorageBtn" style="cursor: pointer;">
                        <span class="badge-icon">üóëÔ∏è</span>
                        <span class="sidebar-badge-text">Ê∏ÖÈô§ÁºìÂ≠ò</span>
                    </div>
                </div>
            </div>

            <!-- ÂÖ∂‰ªñÂäüËÉΩ -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">ÂÖ∂‰ªñÂäüËÉΩ</div>
                <div class="sidebar-badges">
                    <div class="sidebar-badge" id="checkinBtn" style="cursor: pointer;">
                        <span class="badge-icon">üìÖ</span>
                        <span class="sidebar-badge-text">ÊâìÂç°ËÆ∞ÂΩï</span>
                    </div>
                    <div class="sidebar-badge" id="settingsBtn" style="cursor: pointer;">
                        <span class="badge-icon">‚öôÔ∏è</span>
                        <span class="sidebar-badge-text">ËÆæÁΩÆ</span>
                    </div>
                </div>
            </div>

            <!-- È¢òÂ∫ìÁªüËÆ° -->
            <div class="sidebar-section">
                <div class="sidebar-stats" id="sidebarStats">
                    <div class="sidebar-stats-header" id="sidebarStatsHeader">
                        <div class="sidebar-stats-title">
                            <span>ÂΩìÂâçÈ¢òÂ∫ìÁªüËÆ°</span>
                        </div>
                        <span class="sidebar-stats-toggle">‚ñº</span>
                    </div>
                    <div class="sidebar-stats-content">
                        <div class="sidebar-stats-grid">
                            <div class="sidebar-stat-item">
                                <button class="sidebar-stat-number" id="statVocabCount" data-type="vocab"
                                    title="ÁÇπÂáªÊü•ÁúãÂçïËØçÂ∫ìËØ¶ÊÉÖ">0</button>
                                <div class="sidebar-stat-label">ÂçïËØç</div>
                            </div>
                            <div class="sidebar-stat-item">
                                <button class="sidebar-stat-number" id="statReadingCount" data-type="reading"
                                    title="ÁÇπÂáªÊü•ÁúãÈòÖËØªÂ∫ìËØ¶ÊÉÖ">0</button>
                                <div class="sidebar-stat-label">ÈòÖËØª</div>
                            </div>
                            <div class="sidebar-stat-item">
                                <button class="sidebar-stat-number" id="statCollocationCount" data-type="collocation"
                                    title="ÁÇπÂáªÊü•ÁúãÊê≠ÈÖçÂ∫ìËØ¶ÊÉÖ">0</button>
                                <div class="sidebar-stat-label">Êê≠ÈÖç</div>
                            </div>
                            <div class="sidebar-stat-item">
                                <button class="sidebar-stat-number" id="statClozeCount" data-type="cloze"
                                    title="ÁÇπÂáªÊü•ÁúãÂÆåÂΩ¢Â°´Á©∫Â∫ìËØ¶ÊÉÖ">0</button>
                                <div class="sidebar-stat-label">ÂÆåÂΩ¢</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Â∫ïÈÉ®Áî®Êà∑‰ø°ÊÅØ -->
            <div class="sidebar-user-section">
                <div class="sidebar-user-info">
                    <div class="sidebar-user-avatar">üë©‚Äçüè´</div>
                    <div class="sidebar-user-details">
                        <div class="sidebar-user-name">Helen ËÄÅÂ∏à</div>
                        <div class="sidebar-user-role">Ëã±ËØ≠ÂØºÂ∏à</div>
                    </div>
                </div>
            </div>

            <input type="file" id="importAllDataInput" accept=".json" style="display: none;">
        </div>

        <!-- ‰∏ªÂÜÖÂÆπÂå∫Âüü -->
        <div class="main-content">
            <div class="hero">
                <div class="hero-avatar">
                    <span>H</span>
                </div>
                <div>
                    <h1>Helen ËÄÅÂ∏àÁöÑ PET È≠îÊ≥ïËã±ËØ≠Â±ã</h1>
                    <p class="hero-tagline">Helen ËÄÅÂ∏àÂú®ËøôÈáåÈô™‰Ω†ÁªÉÂçïËØç„ÄÅÈòÖËØª„ÄÅÂê¨Âäõ„ÄÅÂÆåÂΩ¢ÂíåÂõ∫ÂÆöÊê≠ÈÖçÔºåÈõÜÈΩêÊòüÊòüÂçáÁ∫ßÈ≠îÊ≥ïÂæΩÁ´†ÔºÅ</p>
                    <div class="search-container">
                        <div class="search-box">
                            <span class="search-icon">üîç</span>
                            <input type="text" id="dictSearchInput" placeholder="ËæìÂÖ•Ëã±ÊñáÂçïËØçÊàñ‰∏≠ÊñáËØçËØ≠Êü•ËØ¢ËØçÂÖ∏ÔºàÊàñÂèåÂáªÊñáÊú¨‰∏≠ÁöÑÂçïËØçÔºâ" />
                            <span class="dict-settings-btn" id="dictSettingsBtn" title="ËØçÂÖ∏ËÆæÁΩÆ">‚öôÔ∏è</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tabs">
                <div class="tab active" data-target="vocab">
                    <h3>üçÄ ÂçïËØçËÉåËØµ</h3><span>Flip Âç°Áâá + Â∞èÊµã</span>
                </div>
                <div class="tab" data-target="reading">
                    <h3>üìñ ÈòÖËØªÁêÜËß£</h3><span>Áü≠Êñá + ÈÄâÊã©È¢ò</span>
                </div>
                <div class="tab" data-target="collocation">
                    <h3>üîó Âõ∫ÂÆöÊê≠ÈÖç</h3><span>Áü≠ËØ≠ + ÈÄâÊã©</span>
                </div>
                <div class="tab" data-target="cloze">
                    <h3>üß© ÂÆåÂΩ¢Â°´Á©∫</h3><span>ÊïÖ‰∫ãË°•ÂÖ®</span>
                </div>
                <div class="tab" data-target="wordbook">
                    <h3>üìö ÁîüËØçÊú¨</h3><span>ÊàëÁöÑÂçïËØçÂ∫ì</span>
                </div>
            </div>

            <div class="card" id="vocab" aria-live="polite">
                <h2>üçÄ ÂçïËØçËÉåËØµ</h2>
                <p class="small-label" style="margin-bottom: 10px;"><span id="vocabProgress"
                        style="color: #8ea6ff; font-weight: 600;"></span></p>
                <div class="word-card">
                    <span class="cover-tag" id="wordCoverTag">Ê≠£Âú®ÊµãÈ™å</span>
                    <div class="word-content">
                        <div class="small-label">Word / ‰∏≠ÊñáÈáä‰πâ</div>
                        <h3 id="wordText">adventure</h3>
                        <p id="wordMeaning">ÂÜíÈô©ÔºåÂ•áÈÅá</p>
                        <div class="example" id="wordExample">We started a new adventure in the forest.</div>
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="primary-btn" id="nextWordBtn">Êç¢‰∏Ä‰∏™ÂçïËØç</button>
                    <button class="secondary-btn" id="quizWordBtn">Êù•‰∏™Â∞èÊµã</button>
                </div>
                <div class="choices" id="wordChoices" hidden></div>
                <div class="result" id="wordResult"></div>
            </div>

            <div class="card" id="reading" hidden>
                <h2>üìñ ÈòÖËØªÁêÜËß£</h2>
                <p class="small-label" style="margin-bottom: 10px;">ÈòÖËØªÁü≠ÊñáÔºåÈÄâÊã©Ê≠£Á°ÆÁ≠îÊ°à<span id="readingProgress"
                        style="margin-left: 10px; color: #8ea6ff; font-weight: 600;"></span></p>

                <p id="readingStory">
                    Emma loves to help at her school library. Every Wednesday she arranges the books and recommends her
                    favourite story to
                    classmates.
                </p>
                <p class="question-text" id="readingQuestion"></p>
                <div class="choices" id="readingChoices"></div>
                <div class="action-buttons">
                    <button class="secondary-btn" id="nextReadingBtn">Êç¢‰∏ÄÁØáÊñáÁ´†</button>
                    <button class="primary-btn" id="checkReadingBtn">Êèê‰∫§Á≠îÊ°à</button>
                </div>
                <div class="result" id="readingResult"></div>
                <p class="hint-text" id="readingHint"></p>
            </div>

            <div class="card" id="collocation" hidden>
                <h2>üîó Âõ∫ÂÆöÊê≠ÈÖç</h2>
                <p class="small-label">ÈÄâÊã©Ê≠£Á°ÆÁöÑÂõ∫ÂÆöÊê≠ÈÖçÂ°´ÂÖ•Âè•Â≠ê<span id="collocationProgress"
                        style="margin-left: 10px; color: #8ea6ff; font-weight: 600;"></span></p>
                <p class="question-text" id="collocationSentence"></p>
                <div class="choices" id="collocationChoices"></div>
                <div class="action-buttons">
                    <button class="secondary-btn" id="nextCollocationBtn">Êç¢‰∏ÄÈ¢ò</button>
                    <button class="primary-btn" id="checkCollocationBtn">Êèê‰∫§Á≠îÊ°à</button>
                </div>
                <div class="result" id="collocationResult"></div>
                <p class="hint-text" id="collocationHint"></p>
            </div>

            <div class="card" id="cloze" hidden>
                <h2>üß© ÂÆåÂΩ¢Â°´Á©∫</h2>
                <p class="small-label">ÈÄâËØçÂ°´Á©∫ÔºàÊØèÁ©∫ 1 ÂàÜÔºâ<span id="clozeProgress"
                        style="margin-left: 10px; color: #8ea6ff; font-weight: 600;"></span></p>
                <div class="cloze" id="clozeContainer"></div>
                <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; align-items: center;">
                </div>
                <div class="action-buttons">
                    <button class="secondary-btn" id="nextClozeBtn">Êç¢‰∏Ä‰∏™ÊïÖ‰∫ã</button>
                    <button class="primary-btn" id="checkClozeBtn">Ê£ÄÊü•Á≠îÊ°à</button>
                </div>
                <div class="result" id="clozeResult"></div>
                <p class="hint-text" id="clozeHint"></p>
            </div>

            <div class="card" id="wordbook" hidden>
                <h2>üìö ÁîüËØçÊú¨</h2>
                <p class="small-label">ÁÆ°ÁêÜ‰ªéËØçÂÖ∏Êü•ËØ¢Ê∑ªÂä†ÁöÑÂçïËØç</p>

                <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                    <input type="text" id="wordbookSearch" placeholder="üîç ÊêúÁ¥¢ÂçïËØç..."
                        style="flex: 1; min-width: 200px; padding: 10px; border: 2px solid #8ea6ff; border-radius: 8px; font-size: 1rem;">
                    <button class="secondary-btn" onclick="exportWordbook()">üì• ÂØºÂá∫ÁîüËØçÊú¨</button>
                    <button class="secondary-btn" id="importWordbookBtn">üì§ ÂØºÂÖ•ÁîüËØçÊú¨</button>
                    <input type="file" id="wordbookFileInput" accept=".json" style="display: none;">
                </div>

                <div id="wordbookStats"
                    style="background: #f7f9ff; padding: 12px; border-radius: 12px; margin-bottom: 20px; text-align: center;">
                    <span style="font-weight: 600; color: #4c55a4;">ÊÄªÂçïËØçÊï∞Ôºö<span id="wordbookCount">0</span></span>
                </div>

                <div id="wordbookList" style="display: grid; gap: 15px;">
                    <!-- ÁîüËØçÂàóË°®Â∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                </div>

                <div id="wordbookEmpty" style="text-align: center; padding: 40px; color: #8ea6ff; display: none;">
                    <div style="font-size: 3rem; margin-bottom: 10px;">üìù</div>
                    <div style="font-size: 1.2rem; margin-bottom: 8px;">ÁîüËØçÊú¨ËøòÊòØÁ©∫ÁöÑ</div>
                    <div style="font-size: 0.9rem;">‰ªéËØçÂÖ∏Êü•ËØ¢‰∏≠Ê∑ªÂä†ÂçïËØçÂà∞ÁîüËØçÊú¨ÂêßÔºÅ</div>
                </div>
            </div>
        </div>

        <!-- ËÆæÁΩÆÊ®°ÊÄÅÊ°Ü -->
        <div class="import-modal" id="settingsModal">
            <div class="import-content" style="max-width: 600px;">
                <div class="import-header">
                    <h3>‚öôÔ∏è ËÆæÁΩÆ</h3>
                    <button class="import-close" id="settingsCloseBtn" aria-label="ÂÖ≥Èó≠" title="ÂÖ≥Èó≠">‚úï</button>
                </div>
                <div class="import-body">
                    <div class="import-section">
                        <h4 style="margin-bottom: 16px;">Â∫îÁî®ËÆæÁΩÆ</h4>
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="autoSaveCheckbox" checked>
                                <span>Ëá™Âä®‰øùÂ≠òÂ≠¶‰π†ËøõÂ∫¶</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="soundEnabledCheckbox" checked>
                                <span>ÂêØÁî®ÊèêÁ§∫Èü≥</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="autoNextCheckbox">
                                <span>Á≠îÂØπÂêéËá™Âä®ÂàáÊç¢‰∏ã‰∏ÄÈ¢ò</span>
                            </label>
                        </div>
                    </div>
                    <div class="import-section">
                        <h4 style="margin-bottom: 16px;">ÊòæÁ§∫ËÆæÁΩÆ</h4>
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="showStatsCheckbox" checked>
                                <span>ÊòæÁ§∫È¢òÂ∫ìÁªüËÆ°</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="compactModeCheckbox">
                                <span>Á¥ßÂáëÊ®°Âºè</span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="import-footer">
                    <button class="secondary-btn" id="settingsCloseBtn2">ÂÖ≥Èó≠</button>
                    <button class="primary-btn" id="saveSettingsBtn">‰øùÂ≠òËÆæÁΩÆ</button>
                </div>
            </div>
        </div>

        <!-- ÊâìÂç°ËÆ∞ÂΩïÊ®°ÊÄÅÊ°Ü -->
        <div class="import-modal" id="checkinModal">
            <div class="import-content" style="max-width: 800px;">
                <div class="import-header">
                    <h3>üìÖ ÊâìÂç°ËÆ∞ÂΩï‰∏éÁªüËÆ°</h3>
                    <button class="import-close" id="checkinCloseBtn" aria-label="ÂÖ≥Èó≠" title="ÂÖ≥Èó≠">‚úï</button>
                </div>
                <div class="import-body">
                    <div class="import-section">
                        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                            <button class="primary-btn" id="weekViewBtn" style="flex: 1;">üìä Êú¨Âë®ÁªüËÆ°</button>
                            <button class="secondary-btn" id="monthViewBtn" style="flex: 1;">üìà Êú¨ÊúàÂ§çÁõò</button>
                        </div>
                        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                            <button class="secondary-btn" id="exportCheckinBtn"
                                style="flex: 1; background: #4caf50; color: white; border-color: #4caf50;">üíæ
                                ÂØºÂá∫ÊâìÂç°ËÆ∞ÂΩï</button>
                            <button class="secondary-btn" id="importCheckinBtn"
                                style="flex: 1; background: #2196f3; color: white; border-color: #2196f3;">üì•
                                ÂØºÂÖ•ÊâìÂç°ËÆ∞ÂΩï</button>
                        </div>
                        <input type="file" id="checkinFileInput" accept=".json" style="display: none;">

                        <!-- Êú¨Âë®ÁªüËÆ°ËßÜÂõæ -->
                        <div id="weekView" style="display: block;">
                            <h4 style="margin-bottom: 16px;">üìä Êú¨Âë®ÁªüËÆ°ÔºàÊúÄËøë7Â§©Ôºâ</h4>
                            <div id="weekStats"
                                style="background: #f9fbff; padding: 16px; border-radius: 12px; margin-bottom: 16px;">
                                <div
                                    style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; text-align: center;">
                                    <div>
                                        <div style="font-size: 1.8rem; font-weight: bold; color: #ff9800;"
                                            id="weekStars">0</div>
                                        <div style="font-size: 0.9rem; color: #6d7897; margin-top: 4px;">üåü Êú¨Âë®ÊòüÊòü</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 1.8rem; font-weight: bold; color: #4caf50;"
                                            id="weekDays">0</div>
                                        <div style="font-size: 0.9rem; color: #6d7897; margin-top: 4px;">üìÖ ÊâìÂç°Â§©Êï∞</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 1.8rem; font-weight: bold; color: #2196f3;"
                                            id="weekRecords">0</div>
                                        <div style="font-size: 0.9rem; color: #6d7897; margin-top: 4px;">üìù ÊâìÂç°Ê¨°Êï∞</div>
                                    </div>
                                </div>
                            </div>
                            <div id="weekRecordsList" style="max-height: 400px; overflow-y: auto;">
                                <!-- Êú¨Âë®ÊâìÂç°ËÆ∞ÂΩïÂàóË°® -->
                            </div>
                        </div>

                        <!-- Êú¨ÊúàÂ§çÁõòËßÜÂõæ -->
                        <div id="monthView" style="display: none;">
                            <h4 style="margin-bottom: 16px;">üìà Êú¨ÊúàÂ§çÁõò</h4>
                            <div id="monthStats"
                                style="background: #f9fbff; padding: 16px; border-radius: 12px; margin-bottom: 16px;">
                                <div
                                    style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; text-align: center;">
                                    <div>
                                        <div style="font-size: 1.8rem; font-weight: bold; color: #ff9800;"
                                            id="monthStars">0</div>
                                        <div style="font-size: 0.9rem; color: #6d7897; margin-top: 4px;">üåü Êú¨ÊúàÊòüÊòü</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 1.8rem; font-weight: bold; color: #4caf50;"
                                            id="monthDays">0</div>
                                        <div style="font-size: 0.9rem; color: #6d7897; margin-top: 4px;">üìÖ ÊâìÂç°Â§©Êï∞</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 1.8rem; font-weight: bold; color: #2196f3;"
                                            id="monthRecords">0</div>
                                        <div style="font-size: 0.9rem; color: #6d7897; margin-top: 4px;">üìù ÊâìÂç°Ê¨°Êï∞</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 1.8rem; font-weight: bold; color: #9c27b0;"
                                            id="monthAvg">0</div>
                                        <div style="font-size: 0.9rem; color: #6d7897; margin-top: 4px;">‚≠ê Êó•ÂùáÊòüÊòü</div>
                                    </div>
                                </div>
                            </div>
                            <div style="margin-bottom: 16px;">
                                <h4 style="font-size: 1rem; margin-bottom: 12px;">üìä ÊØèÊó•ÊâìÂç°Ë∂ãÂäø</h4>
                                <div id="monthChart"
                                    style="background: #fff; padding: 16px; border-radius: 12px; min-height: 200px; display: flex; align-items: flex-end; justify-content: space-around; gap: 4px;">
                                    <!-- ÂõæË°®Â∞ÜÂú®ËøôÈáåÁîüÊàê -->
                                </div>
                            </div>
                            <div id="monthRecordsList" style="max-height: 300px; overflow-y: auto;">
                                <!-- Êú¨ÊúàÊâìÂç°ËÆ∞ÂΩïÂàóË°® -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="import-footer">
                    <button class="secondary-btn" id="checkinCloseBtn2">ÂÖ≥Èó≠</button>
                </div>
            </div>
        </div>

        <!-- ÂÜÖÂÆπÂ∫ìËØ¶ÊÉÖÊ®°ÊÄÅÊ°Ü -->
        <div class="import-modal" id="bankDetailModal">
            <div class="import-content" style="max-width: 900px; max-height: 90vh; overflow: hidden;">
                <div class="import-header">
                    <h3 id="bankDetailTitle">üìö ÂÜÖÂÆπÂ∫ìËØ¶ÊÉÖ</h3>
                    <button class="import-close" id="bankDetailCloseBtn" aria-label="ÂÖ≥Èó≠" title="ÂÖ≥Èó≠">‚úï</button>
                </div>
                <div class="import-body" style="max-height: calc(90vh - 140px); overflow-y: auto;">
                    <div id="bankDetailContent">
                        <!-- ÂÜÖÂÆπÂ∫ìËØ¶ÊÉÖÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                    </div>
                </div>
                <div class="import-footer">
                    <button class="secondary-btn" id="bankDetailCloseBtn2">ÂÖ≥Èó≠</button>
                </div>
            </div>
        </div>

        <!-- ËØçÂÖ∏Êü•ËØ¢Ê®°ÊÄÅÊ°Ü -->
        <div class="dict-modal" id="dictModal">
            <div class="dict-modal-content">
                <div class="dict-modal-header">
                    <h2>üìñ ËØçÂÖ∏Êü•ËØ¢</h2>
                    <span class="dict-modal-close" id="dictModalClose"
                        onclick="if(typeof closeDictModal === 'function') { closeDictModal(); } else { document.getElementById('dictModal').classList.remove('show'); } return false;"
                        style="position: relative; z-index: 10003; pointer-events: auto;">‚úï</span>
                </div>
                <div class="dict-modal-body" id="dictModalBody">
                    <div class="dict-loading">Ê≠£Âú®Êü•ËØ¢...</div>
                </div>
            </div>
        </div>

        <!-- ËØçÂÖ∏ËÆæÁΩÆÊ®°ÊÄÅÊ°Ü -->
        <div class="dict-modal" id="dictSettingsModal" style="z-index: 10002;">
            <div class="dict-modal-content" style="max-width: 600px; max-height: 90vh; overflow-y: auto;">
                <div class="dict-modal-header">
                    <h2>‚öôÔ∏è ËØçÂÖ∏ËÆæÁΩÆ</h2>
                    <span class="dict-modal-close"
                        onclick="closeAllModals(); return false;"
                        style="position: relative; z-index: 10006; pointer-events: auto; cursor: pointer;">‚úï</span>
                </div>
                <div class="dict-modal-body" style="padding: 24px;">
                    <!-- MCPËØçÂÖ∏ËÆæÁΩÆ -->
                    <div
                        style="margin-bottom: 30px; padding: 20px; background: #f9fbff; border-radius: 12px; border: 2px solid #e0e8ff;">
                        <h3 style="margin: 0 0 12px 0; color: #1b2540; font-size: 1.1rem;">üîå MCPËØçÂÖ∏Êé•Âè£</h3>
                        <p style="color: #51627a; font-size: 0.85rem; margin-bottom: 12px; line-height: 1.5;">
                            MCP (Model Context Protocol) ÊòØ‰∏Ä‰∏™ÂºÄÊîæÁöÑÂçèËÆÆÊ†áÂáÜ„ÄÇËØ∑ÈÖçÁΩÆÊÇ®ÁöÑMCPÊúçÂä°Âô®Âú∞ÂùÄÂíåÂ∑•ÂÖ∑ÂêçÁß∞„ÄÇ
                        </p>
                        <details
                            style="margin-bottom: 16px; padding: 12px; background: #ffffff; border-radius: 8px; border: 1px solid #e0e8ff;">
                            <summary
                                style="cursor: pointer; font-weight: 600; color: #4c55a4; font-size: 0.9rem; user-select: none;">
                                üìñ Êü•ÁúãÈÖçÁΩÆËØ¥Êòé</summary>
                            <div
                                style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #e0e8ff; font-size: 0.85rem; color: #51627a; line-height: 1.6;">
                                <p style="margin-bottom: 8px;"><strong>MCPÊúçÂä°Âô®Ë¶ÅÊ±ÇÔºö</strong></p>
                                <ul style="margin-left: 20px; margin-bottom: 12px;">
                                    <li>ÊîØÊåÅ JSON-RPC 2.0 ÂçèËÆÆ</li>
                                    <li>Êèê‰æõ <code
                                            style="background: #f0f4ff; padding: 2px 6px; border-radius: 3px;">tools/call</code>
                                        ÊñπÊ≥ï</li>
                                    <li>Êé•ÂèóÂèÇÊï∞Ôºö<code
                                            style="background: #f0f4ff; padding: 2px 6px; border-radius: 3px;">{"word": "Êü•ËØ¢ÁöÑÂçïËØç"}</code>
                                    </li>
                                </ul>
                                <p style="margin-bottom: 8px;"><strong>ËøîÂõûÊ†ºÂºèÁ§∫‰æãÔºö</strong></p>
                                <pre
                                    style="background: #f5f7ff; padding: 10px; border-radius: 6px; overflow-x: auto; font-size: 0.8rem; margin: 0;">{
  "jsonrpc": "2.0",
  "result": {
    "content": "‰∏≠ÊñáÈáä‰πâ",
    "phonetic": "/Èü≥Ê†á/",
    "meanings": ["Èáä‰πâ1", "Èáä‰πâ2"]
  }
}</pre>
                            </div>
                        </details>
                        <div style="margin-bottom: 12px;">
                            <label style="display: flex; align-items: center; margin-bottom: 8px;">
                                <input type="checkbox" id="mcpEnabled"
                                    style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">
                                <span style="font-weight: 600; color: #243b53;">ÂêØÁî®MCPËØçÂÖ∏</span>
                            </label>
                        </div>
                        <div style="margin-bottom: 16px;">
                            <label
                                style="display: block; margin-bottom: 8px; font-weight: 600; color: #243b53;">ÊúçÂä°Âô®Âú∞ÂùÄ:</label>
                            <input type="text" id="mcpServerUrl"
                                placeholder="‰æãÂ¶Ç: https://your-mcp-server.com/api Êàñ http://localhost:3000/mcp"
                                style="width: 100%; padding: 10px 12px; border: 2px solid #e0e8ff; border-radius: 8px; font-size: 0.95rem; outline: none; transition: border-color 0.2s;" />
                            <div
                                style="margin-top: 8px; padding: 10px; background: #f0f4ff; border-radius: 6px; border-left: 3px solid #4c55a4;">
                                <p style="margin: 0 0 6px 0; font-size: 0.85rem; font-weight: 600; color: #243b53;">üìå
                                    MCPÊúçÂä°Âô®Âú∞ÂùÄËØ¥ÊòéÔºö</p>
                                <p style="margin: 0 0 4px 0; font-size: 0.8rem; color: #51627a; line-height: 1.5;">
                                    <strong>‰ªÄ‰πàÊòØMCPÊúçÂä°Âô®Âú∞ÂùÄÔºü</strong><br>
                                    MCPÊúçÂä°Âô®Âú∞ÂùÄÊòØÊèê‰æõËØçÂÖ∏ÊúçÂä°ÁöÑAPIÁ´ØÁÇπURL„ÄÇÊÇ®ÂèØ‰ª•‰ΩøÁî®Ôºö
                                </p>
                                <ul style="margin: 4px 0 0 20px; font-size: 0.8rem; color: #51627a; line-height: 1.6;">
                                    <li><strong>ÂÖ¨ÂºÄÊúçÂä°Ôºö</strong>‰ΩøÁî®‰ªñ‰∫∫Êèê‰æõÁöÑMCPËØçÂÖ∏ÊúçÂä°Âô®ÔºàÈúÄË¶ÅÊâæÂà∞ÂèØÁî®ÁöÑÂÖ¨ÂºÄÊúçÂä°Ôºâ</li>
                                    <li><strong>Êú¨Âú∞ÊúçÂä°Ôºö</strong>Ëá™Â∑±Êê≠Âª∫ÁöÑMCPÊúçÂä°Âô®ÔºåÂ¶Ç <code
                                            style="background: #fff; padding: 2px 4px; border-radius: 3px;">http://localhost:3000/mcp</code>
                                    </li>
                                    <li><strong>ËøúÁ®ãÊúçÂä°Ôºö</strong>ÈÉ®ÁΩ≤Âú®Ëá™Â∑±ÊúçÂä°Âô®‰∏äÁöÑMCPÊúçÂä°ÔºåÂ¶Ç <code
                                            style="background: #fff; padding: 2px 4px; border-radius: 3px;">https://your-server.com/mcp</code>
                                    </li>
                                </ul>
                                <p style="margin: 8px 0 0 0; font-size: 0.8rem; color: #51627a; line-height: 1.5;">
                                    <strong>üí° ÊèêÁ§∫Ôºö</strong>Â¶ÇÊûúÊÇ®Ê≤°ÊúâMCPÊúçÂä°Âô®ÔºåÁ≥ªÁªü‰ºöËá™Âä®‰ΩøÁî®Â§öÊ∫êÂÖçË¥πÁøªËØëAPI„ÄÇÂ¶ÇÈúÄÊê≠Âª∫MCPÊúçÂä°Âô®ÔºåËØ∑ÂèÇËÄÉMCPÂçèËÆÆÊñáÊ°£„ÄÇ
                                </p>
                            </div>
                        </div>
                        <div style="margin-bottom: 16px;">
                            <label
                                style="display: block; margin-bottom: 8px; font-weight: 600; color: #243b53;">Â∑•ÂÖ∑ÂêçÁß∞:</label>
                            <input type="text" id="mcpToolName" placeholder="dictionary" value="dictionary"
                                style="width: 100%; padding: 10px 12px; border: 2px solid #e0e8ff; border-radius: 8px; font-size: 0.95rem; outline: none; transition: border-color 0.2s;" />
                            <p style="margin-top: 6px; font-size: 0.8rem; color: #8ea6ff;">üí° ÈªòËÆ§‰∏∫
                                "dictionary"ÔºåÊ†πÊçÆÊÇ®ÁöÑMCPÊúçÂä°Âô®ÈÖçÁΩÆË∞ÉÊï¥</p>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="secondary-btn" id="testMcpConnection" style="flex: 1;">üîç ÊµãËØïMCPËøûÊé•</button>
                        </div>
                        <div id="mcpTestResult"
                            style="margin-top: 16px; padding: 12px; border-radius: 8px; display: none;"></div>
                    </div>

                    <!-- ÈòÖËØªÁêÜËß£APIÈÖçÁΩÆ -->
                    <div
                        style="margin-bottom: 20px; padding: 20px; background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); border-radius: 12px; border: 2px solid #ff9800;">
                        <h3 style="margin: 0 0 12px 0; color: #1b2540; font-size: 1.1rem;">üìñ ÈòÖËØªÁêÜËß£È¢òÁõÆÊêúÁ¥¢APIÈÖçÁΩÆ</h3>
                        <p style="color: #51627a; font-size: 0.85rem; margin-bottom: 16px; line-height: 1.5;">
                            <strong>‚ö†Ô∏è ÈáçË¶ÅÊèêÁ§∫Ôºö</strong>ÂâëÊ°•Â§ßÂ≠¶ËÄÉËØïÂßîÂëò‰ºö‰∏çÊèê‰æõÂÖçË¥πÁöÑÂÖ¨ÂºÄAPIËé∑ÂèñÂéüÈ¢ò„ÄÇ‰ª•‰∏ãÈÄâÈ°πÂèØ‰ª•ÁîüÊàêÁ¨¶ÂêàPETÈöæÂ∫¶ÁöÑÈ¢òÁõÆÔºö
                        </p>

                        <!-- OpenAIÈÖçÁΩÆ -->
                        <div
                            style="margin-bottom: 16px; padding: 16px; background: #ffffff; border-radius: 8px; border: 1px solid #e0e0e0;">
                            <label style="display: flex; align-items: center; margin-bottom: 12px;">
                                <input type="checkbox" id="openaiEnabled"
                                    style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">
                                <span style="font-weight: 600; color: #243b53;">ü§ñ OpenAI API</span>
                            </label>
                            <div style="margin-bottom: 10px;">
                                <label
                                    style="display: block; margin-bottom: 6px; font-size: 0.85rem; color: #51627a;">API
                                    Key:</label>
                                <input type="password" id="openaiApiKey" placeholder="sk-..."
                                    style="width: 100%; padding: 8px 10px; border: 2px solid #e0e8ff; border-radius: 6px; font-size: 0.9rem; outline: none;" />
                            </div>
                            <div style="margin-bottom: 10px;">
                                <label
                                    style="display: block; margin-bottom: 6px; font-size: 0.85rem; color: #51627a;">Ê®°Âûã:</label>
                                <select id="openaiModel"
                                    style="width: 100%; padding: 8px 10px; border: 2px solid #e0e8ff; border-radius: 6px; font-size: 0.9rem;">
                                    <option value="gpt-3.5-turbo">gpt-3.5-turbo (Êé®ËçêÔºå‰æøÂÆú)</option>
                                    <option value="gpt-4">gpt-4 (Êõ¥ÂáÜÁ°ÆÔºåÊõ¥Ë¥µ)</option>
                                    <option value="gpt-4-turbo">gpt-4-turbo</option>
                                </select>
                            </div>
                            <p style="margin: 0; font-size: 0.75rem; color: #8ea6ff;">üí° Ëé∑ÂèñAPI Key: <a
                                    href="https://platform.openai.com/api-keys" target="_blank"
                                    style="color: #4c55a4;">platform.openai.com</a></p>
                        </div>

                        <!-- PerplexityÈÖçÁΩÆ -->
                        <div
                            style="margin-bottom: 16px; padding: 16px; background: #ffffff; border-radius: 8px; border: 1px solid #e0e0e0;">
                            <label style="display: flex; align-items: center; margin-bottom: 12px;">
                                <input type="checkbox" id="perplexityEnabled"
                                    style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">
                                <span style="font-weight: 600; color: #243b53;">üîç Perplexity API</span>
                            </label>
                            <div style="margin-bottom: 10px;">
                                <label
                                    style="display: block; margin-bottom: 6px; font-size: 0.85rem; color: #51627a;">API
                                    Key:</label>
                                <input type="password" id="perplexityApiKey" placeholder="pplx-..."
                                    style="width: 100%; padding: 8px 10px; border: 2px solid #e0e8ff; border-radius: 6px; font-size: 0.9rem; outline: none;" />
                            </div>
                            <p style="margin: 0; font-size: 0.75rem; color: #8ea6ff;">üí° Ëé∑ÂèñAPI Key: <a
                                    href="https://www.perplexity.ai/settings/api" target="_blank"
                                    style="color: #4c55a4;">perplexity.ai</a></p>
                        </div>

                        <!-- AnthropicÈÖçÁΩÆ -->
                        <div
                            style="margin-bottom: 16px; padding: 16px; background: #ffffff; border-radius: 8px; border: 1px solid #e0e0e0;">
                            <label style="display: flex; align-items: center; margin-bottom: 12px;">
                                <input type="checkbox" id="anthropicEnabled"
                                    style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">
                                <span style="font-weight: 600; color: #243b53;">üß† Anthropic (Claude) API</span>
                            </label>
                            <div style="margin-bottom: 10px;">
                                <label
                                    style="display: block; margin-bottom: 6px; font-size: 0.85rem; color: #51627a;">API
                                    Key:</label>
                                <input type="password" id="anthropicApiKey" placeholder="sk-ant-..."
                                    style="width: 100%; padding: 8px 10px; border: 2px solid #e0e8ff; border-radius: 6px; font-size: 0.9rem; outline: none;" />
                            </div>
                            <p style="margin: 0; font-size: 0.75rem; color: #8ea6ff;">üí° Ëé∑ÂèñAPI Key: <a
                                    href="https://console.anthropic.com/" target="_blank"
                                    style="color: #4c55a4;">console.anthropic.com</a></p>
                        </div>

                        <!-- ÂÖçË¥πÁîüÊàêÈÄâÈ°π -->
                        <div
                            style="margin-bottom: 16px; padding: 16px; background: #ffffff; border-radius: 8px; border: 1px solid #e0e0e0;">
                            <label style="display: flex; align-items: center;">
                                <input type="checkbox" id="useFreeGeneration" checked
                                    style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">
                                <span style="font-weight: 600; color: #243b53;">‚ú® ‰ΩøÁî®ÂÖçË¥πÈ¢òÁõÆÁîüÊàêÔºàÊó†ÈúÄAPI KeyÔºâ</span>
                            </label>
                            <p style="margin: 8px 0 0 0; font-size: 0.8rem; color: #51627a; line-height: 1.5;">
                                Â¶ÇÊûúÊú™ÈÖçÁΩÆ‰ªª‰ΩïAPIÊàñÊâÄÊúâAPIÈÉΩÂ§±Ë¥•ÔºåÁ≥ªÁªü‰ºö‰ΩøÁî®ÂÜÖÁΩÆÊ®°ÊùøÁîüÊàêÁ¨¶ÂêàPETÈöæÂ∫¶ÁöÑÈ¢òÁõÆ„ÄÇ
                            </p>
                        </div>

                        <div style="display: flex; gap: 10px;">
                            <button class="primary-btn" id="saveReadingApiConfig" style="flex: 1;">üíæ ‰øùÂ≠òÈÖçÁΩÆ</button>
                            <button class="secondary-btn" id="testReadingApi" style="flex: 1;">üîç ÊµãËØïAPI</button>
                        </div>
                        <div id="readingApiTestResult"
                            style="margin-top: 16px; padding: 12px; border-radius: 8px; display: none;"></div>
                    </div>

                    <!-- Â§öÊ∫êÁøªËØëÁä∂ÊÄÅ -->
                    <div
                        style="margin-bottom: 20px; padding: 20px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%); border-radius: 12px; border: 2px solid #81c784;">
                        <h3 style="margin: 0 0 12px 0; color: #1b2540; font-size: 1.1rem;">üåê Â§öÊ∫êÁøªËØëÂºïÊìé</h3>
                        <p style="color: #51627a; font-size: 0.85rem; margin-bottom: 16px; line-height: 1.5;">
                            Á≥ªÁªüÂ∑≤ÈõÜÊàêÂ§ö‰∏™ÂÖçË¥πÁøªËØëAPIÔºåËá™Âä®ÂàáÊç¢‰ª•Á°Æ‰øùÊúÄ‰Ω≥ÁøªËØëË¥®Èáè„ÄÇÊó†ÈúÄÈÖçÁΩÆÔºåÂºÄÁÆ±Âç≥Áî®ÔºÅ
                        </p>
                        <div
                            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-bottom: 12px;">
                            <div
                                style="padding: 12px; background: #ffffff; border-radius: 8px; border: 1px solid #c8e6c9;">
                                <div style="font-weight: 600; color: #2e7d32; margin-bottom: 4px;">üî∑ Google Translate
                                </div>
                                <div style="font-size: 0.75rem; color: #66bb6a;">‰ºòÂÖàÁøªËØëÊ∫ê</div>
                            </div>
                            <div
                                style="padding: 12px; background: #ffffff; border-radius: 8px; border: 1px solid #c8e6c9;">
                                <div style="font-weight: 600; color: #2e7d32; margin-bottom: 4px;">üî∑ LibreTranslate
                                </div>
                                <div style="font-size: 0.75rem; color: #66bb6a;">Â§áÁî®ÁøªËØëÊ∫ê</div>
                            </div>
                            <div
                                style="padding: 12px; background: #ffffff; border-radius: 8px; border: 1px solid #c8e6c9;">
                                <div style="font-weight: 600; color: #2e7d32; margin-bottom: 4px;">üî∑ MyMemory</div>
                                <div style="font-size: 0.75rem; color: #66bb6a;">ÊúÄÂêéÂ§áÈÄâ</div>
                            </div>
                        </div>
                        <div
                            style="padding: 10px; background: #ffffff; border-radius: 6px; border-left: 3px solid #4caf50;">
                            <p style="margin: 0; font-size: 0.8rem; color: #2e7d32; line-height: 1.5;">
                                <strong>‚ú® Êô∫ËÉΩÂàáÊç¢Ôºö</strong>Á≥ªÁªü‰ºöËá™Âä®Â∞ùËØïÂ§ö‰∏™ÁøªËØëÊ∫êÔºåÈÄâÊã©ÊúÄÂáÜÁ°ÆÁöÑÁªìÊûú„ÄÇÂ¶ÇÊûúÊüê‰∏™APIÂ§±Ë¥•Ôºå‰ºöËá™Âä®ÂàáÊç¢Âà∞‰∏ã‰∏Ä‰∏™ÔºåÁ°Æ‰øùÁøªËØëÊúçÂä°ÂßãÁªàÂèØÁî®„ÄÇ
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÁâàÊú¨ÂéÜÂè≤Ê®°ÊÄÅÊ°Ü -->
        <div class="dict-modal" id="versionHistoryModal" style="z-index: 10002;">
            <div class="dict-modal-content" style="max-width: 800px; max-height: 85vh; overflow-y: auto;">
                <div class="dict-modal-header">
                    <h2>üìú ÂéÜÂè≤ÁâàÊú¨</h2>
                    <span class="dict-modal-close"
                        onclick="closeAllModals(); return false;"
                        style="position: relative; z-index: 10006; pointer-events: auto; cursor: pointer;">‚úï</span>
                </div>
                <div class="dict-modal-body" style="padding: 24px;">
                    <div id="versionHistoryList">
                        <div style="text-align: center; padding: 40px; color: #8ea6ff;">
                            <div style="font-size: 2rem; margin-bottom: 12px;">‚è≥</div>
                            <div>Ê≠£Âú®Âä†ËΩΩÁâàÊú¨ÂéÜÂè≤...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Êü•ËØ¢Ê∞îÊ≥° -->
        <div class="word-popup" id="wordPopup"></div>

        <!-- Ëá™ÂÆö‰πâAlertÊ®°ÊÄÅÊ°Ü -->
        <div class="custom-alert-modal" id="customAlertModal">
            <div class="custom-alert-content">
                <div class="custom-alert-header">
                    <h3 id="customAlertTitle">ÊèêÁ§∫</h3>
                    <span class="custom-alert-close" id="customAlertClose" onclick="closeCustomAlert()">‚úï</span>
                </div>
                <div class="custom-alert-body" id="customAlertBody">
                    <!-- ÂÜÖÂÆπÂ∞ÜÂä®ÊÄÅÊèíÂÖ• -->
                </div>
                <div class="custom-alert-footer">
                    <button class="custom-alert-btn" id="customAlertConfirm" onclick="closeCustomAlert()">Á°ÆÂÆö</button>
                </div>
            </div>
        </div>

        <!-- È¢òÂ∫ìÂØºÂÖ•Ê®°ÊÄÅÊ°Ü -->
        <div class="import-modal" id="importModal">
            <div class="import-content">
                <div class="import-header">
                    <h3>üìö ÂØºÂÖ•È¢òÂ∫ì</h3>
                    <button class="import-close" id="importCloseBtn" aria-label="ÂÖ≥Èó≠" title="ÂÖ≥Èó≠">‚úï</button>
                </div>
                <div class="import-body">
                    <div class="import-section">
                        <h4>ÈÄâÊã©ÂØºÂÖ•Á±ªÂûã</h4>
                        <div class="type-options">
                            <label class="type-option">
                                <input type="radio" name="importType" value="vocab" checked>
                                <div class="type-card">
                                    <div class="type-icon">üçé</div>
                                    <div class="type-name">ÂçïËØçËÉåËØµ</div>
                                    <div class="type-desc">ÂØºÂÖ•ÂçïËØçËØçÊ±á</div>
                                </div>
                            </label>
                            <label class="type-option">
                                <input type="radio" name="importType" value="reading">
                                <div class="type-card">
                                    <div class="type-icon">üìñ</div>
                                    <div class="type-name">ÈòÖËØªÁêÜËß£</div>
                                    <div class="type-desc">ÂØºÂÖ•ÈòÖËØªÁü≠Êñá</div>
                                </div>
                            </label>
                            <label class="type-option">
                                <input type="radio" name="importType" value="collocation">
                                <div class="type-card">
                                    <div class="type-icon">üîó</div>
                                    <div class="type-name">Âõ∫ÂÆöÊê≠ÈÖç</div>
                                    <div class="type-desc">ÂØºÂÖ•Êê≠ÈÖçÈ¢ò</div>
                                </div>
                            </label>
                            <label class="type-option">
                                <input type="radio" name="importType" value="cloze">
                                <div class="type-card">
                                    <div class="type-icon">üß©</div>
                                    <div class="type-name">ÂÆåÂΩ¢Â°´Á©∫</div>
                                    <div class="type-desc">ÂØºÂÖ•ÂÆåÂΩ¢ÊïÖ‰∫ã</div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <div class="import-section">
                        <h4>ÈÄâÊã©È¢òÂ∫ìÊñá‰ª∂</h4>
                        <div class="file-upload-area">
                            <input id="modalImportInput" type="file" accept=".xlsx" multiple style="display: none">
                            <label for="modalImportInput" class="file-upload-label">
                                <div class="upload-icon">üìÅ</div>
                                <div class="upload-text">ÁÇπÂáªÈÄâÊã©Êñá‰ª∂ÊàñÊãñÊãΩÂà∞Ê≠§Â§Ñ</div>
                                <div class="upload-hint">ÊîØÊåÅ .xlsx Ê†ºÂºè</div>
                            </label>
                        </div>
                        <div id="selectedFiles" class="selected-files"></div>
                    </div>
                </div>
                <div class="import-footer">
                    <button class="secondary-btn" id="cancelImportBtn">ÂèñÊ∂à</button>
                    <button class="primary-btn" id="confirmImportBtn">Á°ÆËÆ§ÂØºÂÖ•</button>
                </div>
            </div>
        </div>

    </div>

    <script src="../libs/xlsx.full.min.js"></script>
    <script src="pet-content.js?v=15&timestamp=20251205"></script>
    <script>
        // Ë∞ÉËØïÔºöÊ£ÄÊü•Êï∞ÊçÆÂä†ËΩΩ
        console.log('=== Êï∞ÊçÆÂä†ËΩΩË∞ÉËØï ===');
        console.log('window.petContent:', window.petContent ? `Â≠òÂú®` : '‰∏çÂ≠òÂú®');
        let data;
        try {
            if (!window.petContent) {
                console.error('‚ùå window.petContent ‰∏çÂ≠òÂú®ÔºÅËØ∑Ê£ÄÊü• pet-content.js ÊòØÂê¶Âä†ËΩΩ');
                // ÂàõÂª∫‰∏Ä‰∏™Á©∫ÁöÑÊï∞ÊçÆÁªìÊûÑÔºåinitÂáΩÊï∞‰ºöÂ§ÑÁêÜ
                data = { vocab: [], readingSets: [], collocationSets: [], clozeSets: [] };
            } else {
                data = window.petContent;
                console.log('‚úÖ ÂÜÖÁΩÆÊï∞ÊçÆÂä†ËΩΩÊàêÂäü');
                console.log('  ÂçïËØç:', data.vocab?.length || 0);
                console.log('  ÈòÖËØª:', data.readingSets?.length || 0);
                console.log('  Âõ∫ÂÆöÊê≠ÈÖç:', data.collocationSets?.length || 0);
                console.log('  ÂÆåÂΩ¢Â°´Á©∫:', data.clozeSets?.length || 0);
            }

            // Á°Æ‰øùdataÂØπË±°ÊúâÊâÄÊúâÂøÖË¶ÅÁöÑÂ≠óÊÆµ
            if (!data) data = {};
            if (!data.vocab) data.vocab = [];
            if (!data.readingSets) data.readingSets = [];
            if (!data.collocationSets) data.collocationSets = [];
            if (!data.clozeSets) data.clozeSets = [];
        } catch (error) {
            console.error("Âä†ËΩΩÈ¢òÂ∫ìÂ§±Ë¥•„ÄÇ", error);
            data = { vocab: [], readingSets: [], collocationSets: [], clozeSets: [] };
        }

        let stars = 0;
        let points = 0;
        let selectedWordIndex = 0;
        let readingIndex = 0;
        let collocationIndex = 0;
        let clozeIndex = 0;
        let selectedDifficulty = 'all'; // ÂΩìÂâçÈÄâÊã©ÁöÑÈöæÂ∫¶Á≠õÈÄâÔºà'all' Êàñ '1'-'5'Ôºâ

        let nextWordLock = false; // Èò≤Ê≠¢ÈáçÂ§çË∞ÉÁî®
        let isQuizMode = false; // ÊòØÂê¶Âú®ÊµãËØïÊ®°Âºè
        let isWordQuizActive = false;
        let preferredHelenVoice = null;

        // üìÖ ÊâìÂç°ËÆ∞ÂΩïÊï∞ÊçÆ
        let checkinRecords = []; // Ê†ºÂºè: [{date: "2025-01-05", stars: 2, reason: "ÂçïËØçÊåëÊàòÊàêÂäü", timestamp: 1234567890, words: ["word1", "word2"]}]

        // üîç ËØçÂÖ∏Êü•ËØ¢Áõ∏ÂÖ≥ÂèòÈáè
        const dictSearchInput = document.getElementById("dictSearchInput");
        const dictModal = document.getElementById("dictModal");
        const dictModalClose = document.getElementById("dictModalClose");
        const dictModalBody = document.getElementById("dictModalBody");
        const wordPopup = document.getElementById("wordPopup");
        let dictCache = {}; // ÁºìÂ≠òÊü•ËØ¢ÁªìÊûú
        let hasUsedDictSearch = false; // ÊòØÂê¶‰ΩøÁî®ËøáÊêúÁ¥¢ÂäüËÉΩ
        let hasAddedToVocab = false; // ÊòØÂê¶Ê∑ªÂä†ËøáÁîüËØçÊú¨

        // üìö ÁîüËØçÊú¨Êï∞ÊçÆÔºàÁã¨Á´ã‰∫éÂçïËØçËÉåËØµÊ®°ÂùóÔºâ
        let wordbookData = []; // Ê†ºÂºè: [{word, meaning, chinese, example, addedDate}]

        const tabElements = document.querySelectorAll(".tab");
        const sections = document.querySelectorAll(".card");
        const wordCard = document.querySelector(".word-card");
        const wordText = document.getElementById("wordText");
        const wordMeaning = document.getElementById("wordMeaning");
        const wordExample = document.getElementById("wordExample");
        const wordResult = document.getElementById("wordResult");
        const wordChoices = document.getElementById("wordChoices");
        const readingStory = document.getElementById("readingStory");
        const readingQuestion = document.getElementById("readingQuestion");
        const readingChoices = document.getElementById("readingChoices");
        const readingResult = document.getElementById("readingResult");
        const readingHint = document.getElementById("readingHint");
        const collocationSentence = document.getElementById("collocationSentence");
        const collocationChoices = document.getElementById("collocationChoices");
        const collocationResult = document.getElementById("collocationResult");
        const collocationHint = document.getElementById("collocationHint");
        const clozeContainer = document.getElementById("clozeContainer");
        const clozeResult = document.getElementById("clozeResult");
        const clozeHint = document.getElementById("clozeHint");
        const importBtn = document.getElementById("importBtn");
        const importModal = document.getElementById("importModal");
        const importCloseBtn = document.getElementById("importCloseBtn");
        const modalImportInput = document.getElementById("modalImportInput");
        const cancelImportBtn = document.getElementById("cancelImportBtn");
        const confirmImportBtn = document.getElementById("confirmImportBtn");
        const selectedFiles = document.getElementById("selectedFiles");
        const starsBadge = document.getElementById("starsBadge");
        const levelBadge = document.getElementById("levelBadge");
        const wordCountBadge = document.getElementById("wordCountBadge");
        const pointsLog = document.getElementById("pointsLog"); // Â∑≤ÁßªÈô§Ôºå‰øùÁïôÂèòÈáèÈÅøÂÖçÊä•Èîô

        const nextReadingBtn = document.getElementById("nextReadingBtn");
        const nextCollocationBtn = document.getElementById("nextCollocationBtn");
        const nextClozeBtn = document.getElementById("nextClozeBtn");

        const pickRandomIndex = (length, exclude = null) => {
            if (length <= 1) return 0;
            let candidate = Math.floor(Math.random() * length);
            if (exclude === null) return candidate;
            while (candidate === exclude) {
                candidate = Math.floor(Math.random() * length);
            }
            return candidate;
        };

        const shuffle = (array) => {
            const cloned = [...array];
            for (let i = cloned.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [cloned[i], cloned[j]] = [cloned[j], cloned[i]];
            }
            return cloned;
        };

        const normalizeText = (text) => {
            if (Array.isArray(text)) {
                return text.join(" ");
            }
            return text ?? "";
        };

        // üíæ ‰øùÂ≠òÊâìÂç°ËÆ∞ÂΩïÔºàÂ¢ûÂº∫ÁâàÔºåÁ°Æ‰øù‰øùÂ≠òÊàêÂäüÔºâ
        function saveCheckinRecords() {
            try {
                // Á°Æ‰øùcheckinRecordsÊòØÊï∞ÁªÑ
                if (!Array.isArray(checkinRecords)) {
                    console.warn('‚ö†Ô∏è checkinRecords‰∏çÊòØÊï∞ÁªÑÔºåÈáçÁΩÆ‰∏∫Á©∫Êï∞ÁªÑ');
                    checkinRecords = [];
                }

                const jsonString = JSON.stringify(checkinRecords);
                if (!jsonString) {
                    throw new Error('Â∫èÂàóÂåñÊâìÂç°ËÆ∞ÂΩïÂ§±Ë¥•');
                }

                localStorage.setItem('petCheckinRecords', jsonString);

                // È™åËØÅ‰øùÂ≠òÊòØÂê¶ÊàêÂäü
                const verifyData = localStorage.getItem('petCheckinRecords');
                if (!verifyData) {
                    throw new Error('‰øùÂ≠òÂêéÈ™åËØÅÂ§±Ë¥•ÔºölocalStorage‰∏≠Ê≤°ÊúâÊï∞ÊçÆ');
                }

                const verifyParsed = JSON.parse(verifyData);
                console.log('‚úÖ ÊâìÂç°ËÆ∞ÂΩïÂ∑≤‰øùÂ≠ò:', checkinRecords.length, 'Êù°');
                console.log('üìä ‰øùÂ≠òÈ™åËØÅ:', {
                    ÊÄªËÆ∞ÂΩïÊï∞: verifyParsed.length,
                    ÊúÄÊñ∞ËÆ∞ÂΩï: verifyParsed.length > 0 ? verifyParsed[verifyParsed.length - 1] : null
                });

                return true;
            } catch (error) {
                console.error('‚ùå ‰øùÂ≠òÊâìÂç°ËÆ∞ÂΩïÂ§±Ë¥•:', error);
                console.error('ÈîôËØØËØ¶ÊÉÖ:', {
                    ÈîôËØØ‰ø°ÊÅØ: error.message,
                    ËÆ∞ÂΩïÊï∞Èáè: checkinRecords.length,
                    localStorageÂèØÁî®: typeof (Storage) !== "undefined"
                });

                // Â∞ùËØï‰øùÂ≠òÂà∞Â§áÁî®key
                try {
                    localStorage.setItem('petCheckinRecords_backup', JSON.stringify(checkinRecords));
                    console.log('‚úÖ Â∑≤‰øùÂ≠òÂà∞Â§áÁî®‰ΩçÁΩÆ');
                } catch (backupError) {
                    console.error('‚ùå Â§áÁî®‰øùÂ≠ò‰πüÂ§±Ë¥•:', backupError);
                }

                return false;
            }
        }

        // üíæ Âä†ËΩΩÊâìÂç°ËÆ∞ÂΩïÔºàÂ¢ûÂº∫ÁâàÔºåÊîØÊåÅÊÅ¢Â§çÔºâ
        function loadCheckinRecords() {
            try {
                // ‰ºòÂÖà‰ªé‰∏ªkeyÂä†ËΩΩ
                let saved = localStorage.getItem('petCheckinRecords');

                // Â¶ÇÊûú‰∏ªkeyÊ≤°ÊúâÊï∞ÊçÆÔºåÂ∞ùËØï‰ªéÂ§áÁî®keyÊÅ¢Â§ç
                if (!saved) {
                    const backup = localStorage.getItem('petCheckinRecords_backup');
                    if (backup) {
                        console.log('‚ö†Ô∏è ‰ªéÂ§áÁî®‰ΩçÁΩÆÊÅ¢Â§çÊâìÂç°ËÆ∞ÂΩï');
                        saved = backup;
                        // ÊÅ¢Â§çÂêé‰øùÂ≠òÂà∞‰∏ªkey
                        localStorage.setItem('petCheckinRecords', backup);
                    }
                }

                if (saved) {
                    const parsed = JSON.parse(saved);

                    // È™åËØÅÊï∞ÊçÆÊ†ºÂºè
                    if (!Array.isArray(parsed)) {
                        throw new Error('ÊâìÂç°ËÆ∞ÂΩïÊ†ºÂºèÈîôËØØÔºö‰∏çÊòØÊï∞ÁªÑ');
                    }

                    // È™åËØÅÊØèÊù°ËÆ∞ÂΩïÁöÑÂøÖË¶ÅÂ≠óÊÆµ
                    const validRecords = parsed.filter(record => {
                        return record &&
                            typeof record.date === 'string' &&
                            typeof record.stars === 'number' &&
                            typeof record.timestamp === 'number';
                    });

                    if (validRecords.length !== parsed.length) {
                        console.warn('‚ö†Ô∏è ÂèëÁé∞Êó†ÊïàËÆ∞ÂΩïÔºåÂ∑≤ËøáÊª§:', parsed.length - validRecords.length, 'Êù°');
                    }

                    checkinRecords = validRecords;

                    // ÊåâÊó∂Èó¥Êà≥ÊéíÂ∫èÔºåÁ°Æ‰øùÈ°∫Â∫èÊ≠£Á°Æ
                    checkinRecords.sort((a, b) => a.timestamp - b.timestamp);

                    console.log('‚úÖ ÊâìÂç°ËÆ∞ÂΩïÂ∑≤Âä†ËΩΩ:', checkinRecords.length, 'Êù°');
                    console.log('üìä Âä†ËΩΩÁªüËÆ°:', {
                        ÊÄªËÆ∞ÂΩïÊï∞: checkinRecords.length,
                        ÊúÄÊó©ËÆ∞ÂΩï: checkinRecords.length > 0 ? checkinRecords[0].date : null,
                        ÊúÄÊñ∞ËÆ∞ÂΩï: checkinRecords.length > 0 ? checkinRecords[checkinRecords.length - 1].date : null
                    });

                    // Â¶ÇÊûúÂä†ËΩΩÊàêÂäüÔºå‰øùÂ≠ò‰∏ÄÊ¨°Á°Æ‰øùÊï∞ÊçÆÂÆåÊï¥
                    saveCheckinRecords();
                } else {
                    console.log('üìù È¶ñÊ¨°‰ΩøÁî®ÔºåÊâìÂç°ËÆ∞ÂΩï‰∏∫Á©∫');
                    checkinRecords = [];
                }
            } catch (error) {
                console.error('‚ùå Âä†ËΩΩÊâìÂç°ËÆ∞ÂΩïÂ§±Ë¥•:', error);
                console.error('ÈîôËØØËØ¶ÊÉÖ:', {
                    ÈîôËØØ‰ø°ÊÅØ: error.message,
                    localStorageÂèØÁî®: typeof (Storage) !== "undefined"
                });

                // Â∞ùËØï‰ªéÂ§áÁî®keyÊÅ¢Â§ç
                try {
                    const backup = localStorage.getItem('petCheckinRecords_backup');
                    if (backup) {
                        console.log('‚ö†Ô∏è Â∞ùËØï‰ªéÂ§áÁî®‰ΩçÁΩÆÊÅ¢Â§ç');
                        checkinRecords = JSON.parse(backup);
                        if (Array.isArray(checkinRecords)) {
                            console.log('‚úÖ ‰ªéÂ§áÁî®‰ΩçÁΩÆÊÅ¢Â§çÊàêÂäü:', checkinRecords.length, 'Êù°');
                            saveCheckinRecords(); // ‰øùÂ≠òÂà∞‰∏ªkey
                        } else {
                            throw new Error('Â§áÁî®Êï∞ÊçÆÊ†ºÂºèÈîôËØØ');
                        }
                    } else {
                        checkinRecords = [];
                    }
                } catch (backupError) {
                    console.error('‚ùå Â§áÁî®ÊÅ¢Â§ç‰πüÂ§±Ë¥•:', backupError);
                    checkinRecords = [];
                }
            }
        }

        // üíæ Áªü‰∏ÄÁöÑ‰øùÂ≠òÂáΩÊï∞ÔºåÁ°Æ‰øùÊï∞ÊçÆ‰∏ÄËá¥ÊÄßÔºàÂ¢ûÂº∫ÁâàÔºöÂ§öÈáçÂ§á‰ªΩ‰øùÊä§Ôºâ
        function saveDataToLocalStorage(forceSave = false) {
            try {
                // üîí ‰øùÊä§Êú∫Âà∂Ôºö‰øùÂ≠òÂâçÂÖàÂ§á‰ªΩÂΩìÂâçÊï∞ÊçÆ
                const currentData = localStorage.getItem('petEnglishData');
                if (currentData && !forceSave) {
                    // ‰øùÂ≠òÂΩìÂâçÊï∞ÊçÆ‰∏∫"‰øùÂ≠òÂâçÂ§á‰ªΩ"
                    try {
                        localStorage.setItem('petEnglishData_before_save_' + Date.now(), currentData);
                        // Âè™‰øùÁïôÊúÄËøë5‰∏™Â§á‰ªΩ
                        const backupKeys = [];
                        for (let i = 0; i < localStorage.length; i++) {
                            const key = localStorage.key(i);
                            if (key && key.startsWith('petEnglishData_before_save_')) {
                                backupKeys.push(key);
                            }
                        }
                        if (backupKeys.length > 5) {
                            backupKeys.sort().slice(0, backupKeys.length - 5).forEach(key => {
                                localStorage.removeItem(key);
                            });
                        }
                    } catch (e) {
                        console.warn('‰øùÂ≠òÂâçÂ§á‰ªΩÂ§±Ë¥•ÔºåÁªßÁª≠‰øùÂ≠ò:', e);
                    }
                }

                const dataToSave = {
                    vocab: Array.isArray(data.vocab) ? data.vocab : [],
                    readingSets: Array.isArray(data.readingSets) ? data.readingSets : [],
                    collocationSets: Array.isArray(data.collocationSets) ? data.collocationSets : [],
                    clozeSets: Array.isArray(data.clozeSets) ? data.clozeSets : []
                };

                // üîí Êï∞ÊçÆÈ™åËØÅÔºöÁ°Æ‰øù‰∏ç‰ºö‰øùÂ≠òÁ©∫Êï∞ÊçÆË¶ÜÁõñÂ∑≤ÊúâÊï∞ÊçÆ
                const currentSaved = localStorage.getItem('petEnglishData');
                if (currentSaved && !forceSave) {
                    try {
                        const currentParsed = JSON.parse(currentSaved);
                        const currentTotal = (currentParsed.vocab?.length || 0) +
                            (currentParsed.readingSets?.length || 0) +
                            (currentParsed.collocationSets?.length || 0) +
                            (currentParsed.clozeSets?.length || 0);
                        const newTotal = dataToSave.vocab.length +
                            dataToSave.readingSets.length +
                            dataToSave.collocationSets.length +
                            dataToSave.clozeSets.length;

                        // Â¶ÇÊûúÊñ∞Êï∞ÊçÆÊòéÊòæÂ∞ë‰∫éÊóßÊï∞ÊçÆÔºàÂáèÂ∞ëË∂ÖËøá10%ÔºâÔºåÂèØËÉΩÊòØÊï∞ÊçÆ‰∏¢Â§±ÔºåÂèëÂá∫Ë≠¶Âëä
                        if (currentTotal > 0 && newTotal < currentTotal * 0.9) {
                            console.warn('‚ö†Ô∏è Ë≠¶ÂëäÔºö‰øùÂ≠òÁöÑÊï∞ÊçÆÈáèÊòéÊòæÂáèÂ∞ëÔºÅ', {
                                ÊóßÊï∞ÊçÆÊÄªÈáè: currentTotal,
                                Êñ∞Êï∞ÊçÆÊÄªÈáè: newTotal,
                                ÂáèÂ∞ëÊØî‰æã: ((currentTotal - newTotal) / currentTotal * 100).toFixed(1) + '%'
                            });
                            // ‰∏çÈòªÊ≠¢‰øùÂ≠òÔºå‰ΩÜËÆ∞ÂΩïË≠¶Âëä
                        }
                    } catch (e) {
                        console.warn('Êï∞ÊçÆÈ™åËØÅÂ§±Ë¥•ÔºåÁªßÁª≠‰øùÂ≠ò:', e);
                    }
                }

                const jsonString = JSON.stringify(dataToSave);
                if (!jsonString || jsonString === '{}') {
                    throw new Error('‰øùÂ≠òÁöÑÊï∞ÊçÆ‰∏∫Á©∫');
                }

                // ‰øùÂ≠òÂà∞ÊâÄÊúâ‰ΩçÁΩÆÔºàÂ§öÈáç‰øùÈô©Ôºâ
                const saveKeys = ['petEnglishData', 'petEnglishData_backup', 'petEnglishData_old', 'petData'];
                let saveSuccess = false;

                saveKeys.forEach(key => {
                    try {
                        localStorage.setItem(key, jsonString);
                        // Á´ãÂç≥È™åËØÅ
                        const verify = localStorage.getItem(key);
                        if (verify && verify === jsonString) {
                            saveSuccess = true;
                        }
                    } catch (e) {
                        console.warn(`‰øùÂ≠òÂà∞ ${key} Â§±Ë¥•:`, e);
                    }
                });

                if (!saveSuccess) {
                    throw new Error('ÊâÄÊúâ‰øùÂ≠ò‰ΩçÁΩÆÈÉΩÂ§±Ë¥•');
                }

                console.log('‚úÖ Êï∞ÊçÆÂ∑≤‰øùÂ≠òÂà∞ÊâÄÊúâ‰ΩçÁΩÆ:', {
                    ÂçïËØç: dataToSave.vocab.length,
                    ÈòÖËØª: dataToSave.readingSets.length,
                    Âõ∫ÂÆöÊê≠ÈÖç: dataToSave.collocationSets.length,
                    ÂÆåÂΩ¢: dataToSave.clozeSets.length
                });

                return true;
            } catch (error) {
                console.error('‚ùå ‰øùÂ≠òÊï∞ÊçÆÂ§±Ë¥•:', error);
                // Â∞ùËØï‰øùÂ≠òÂà∞Â§áÁî®key
                try {
                    const dataToSave = {
                        vocab: Array.isArray(data.vocab) ? data.vocab : [],
                        readingSets: Array.isArray(data.readingSets) ? data.readingSets : [],
                        collocationSets: Array.isArray(data.collocationSets) ? data.collocationSets : [],
                        clozeSets: Array.isArray(data.clozeSets) ? data.clozeSets : []
                    };
                    localStorage.setItem('petEnglishData_backup', JSON.stringify(dataToSave));
                    console.log('‚úÖ Â∑≤‰øùÂ≠òÂà∞Â§áÁî®‰ΩçÁΩÆ');
                } catch (backupError) {
                    console.error('‚ùå Â§áÁî®‰øùÂ≠ò‰πüÂ§±Ë¥•:', backupError);
                }
                return false;
            }
        }

        function resetSelection(containerSelector) {
            document.querySelectorAll(`${containerSelector} .choice`).forEach(el => {
                el.classList.remove("selected", "correct", "wrong");
            });
        }

        function setWordCover(active) {
            isWordQuizActive = active;
            // Âè™ÂØπwordMeaningÂÖÉÁ¥†Ê∑ªÂä†ÈÅÆÊå°ÊïàÊûú
            const wordMeaningEl = document.getElementById("wordMeaning");
            if (wordMeaningEl) {
                if (active) {
                    wordMeaningEl.style.filter = "blur(8px)";
                    wordMeaningEl.style.pointerEvents = "none";
                    // ÊòæÁ§∫ÈÅÆÊå°Ê†áÁ≠æ
                    const coverTag = document.getElementById("wordCoverTag");
                    if (coverTag) coverTag.style.display = "inline-flex";
                } else {
                    wordMeaningEl.style.filter = "";
                    wordMeaningEl.style.pointerEvents = "";
                    // ÈöêËóèÈÅÆÊå°Ê†áÁ≠æ
                    const coverTag = document.getElementById("wordCoverTag");
                    if (coverTag) coverTag.style.display = "none";
                }
            }
        }

        function formatBytes(bytes) {
            if (!bytes && bytes !== 0) return "--";
            const units = ["B", "KB", "MB", "GB"];
            let size = bytes;
            let unitIndex = 0;
            while (size >= 1024 && unitIndex < units.length - 1) {
                size /= 1024;
                unitIndex++;
            }
            return `${size.toFixed(size < 10 && unitIndex > 0 ? 1 : 0)} ${units[unitIndex]}`;
        }


        function initHelenVoice() {
            if (!("speechSynthesis" in window)) return;
            const voices = speechSynthesis.getVoices();
            if (!voices.length) return;
            const preferredNames = ["Samantha", "Serena", "Victoria", "Zoe", "Fiona", "Female"];
            preferredHelenVoice = voices.find(voice =>
                preferredNames.some(name => voice.name.toLowerCase().includes(name.toLowerCase()))
            ) || voices.find(voice => voice.lang?.toLowerCase().startsWith("en")) || voices[0] || null;
        }

        if ("speechSynthesis" in window) {
            speechSynthesis.addEventListener("voiceschanged", initHelenVoice);
            initHelenVoice();
        }

        function updateWordCountBadge() {
            const vocabLength = data.vocab ? data.vocab.length : 0;
            const wordCountBadgeEl = document.getElementById("wordCountBadge");
            if (wordCountBadgeEl) {
                const textEl = wordCountBadgeEl.querySelector('.sidebar-badge-text');
                if (textEl) {
                    textEl.textContent = `ÂçïËØçÔºö${vocabLength}`;
                }
            }
            // Ë∞ÉËØï‰ø°ÊÅØ
            console.log('ËØçÊ±áÊï∞ÊçÆÁªüËÆ°:', { 'data.vocab': vocabLength });
        }

        function loadWord(index = 0) {
            console.log('üìñ loadWord Ë¢´Ë∞ÉÁî®ÔºåÁ¥¢Âºï:', index);
            console.log('üìä loadWord Êï∞ÊçÆÊ£ÄÊü•:', {
                hasVocab: !!data.vocab,
                vocabLength: data.vocab?.length || 0,
                index: index,
                indexType: typeof index
            });

            if (!data.vocab || data.vocab.length === 0) {
                console.warn('‚ö†Ô∏è ÂçïËØçÊï∞ÊçÆ‰∏∫Á©∫ÔºåÊó†Ê≥ïÂä†ËΩΩÂçïËØç');
                return false;
            }

            // Á°Æ‰øù index ÊòØÊï∞Â≠ó
            const numIndex = typeof index === 'number' ? index : parseInt(index, 10);
            if (isNaN(numIndex)) {
                console.error('‚ùå loadWord: Á¥¢Âºï‰∏çÊòØÊúâÊïàÊï∞Â≠ó:', index);
                return false;
            }

            selectedWordIndex = numIndex % data.vocab.length;
            const item = data.vocab[selectedWordIndex];

            console.log('üìù Âä†ËΩΩÂçïËØç:', {
                index: selectedWordIndex,
                word: item?.word,
                meaning: item?.meaning
            });

            if (!item) {
                console.error('‚ùå ÂçïËØçÊï∞ÊçÆÁ¥¢ÂºïÈîôËØØ:', selectedWordIndex);
                return;
            }

            // ÈáçÊñ∞Ëé∑ÂèñÂÖÉÁ¥†ÂºïÁî®ÔºåÁ°Æ‰øùÊòØÊúÄÊñ∞ÁöÑDOMÂÖÉÁ¥†
            const currentWordText = document.getElementById("wordText");
            const currentWordMeaning = document.getElementById("wordMeaning");
            const currentWordExample = document.getElementById("wordExample");
            const currentWordResult = document.getElementById("wordResult");
            const currentWordChoices = document.getElementById("wordChoices");

            console.log('üîç DOMÂÖÉÁ¥†Áä∂ÊÄÅ:', {
                wordText: currentWordText ? 'Â≠òÂú®' : '‰∏çÂ≠òÂú®',
                wordMeaning: currentWordMeaning ? 'Â≠òÂú®' : '‰∏çÂ≠òÂú®',
                wordExample: currentWordExample ? 'Â≠òÂú®' : '‰∏çÂ≠òÂú®'
            });

            if (currentWordText) {
                currentWordText.textContent = item.word;
                console.log('‚úÖ wordText Â∑≤Êõ¥Êñ∞:', item.word);
            } else {
                console.error('‚ùå Êâæ‰∏çÂà∞ wordText ÂÖÉÁ¥†');
            }

            if (currentWordMeaning) {
                currentWordMeaning.textContent = item.meaning;
                console.log('‚úÖ wordMeaning Â∑≤Êõ¥Êñ∞:', item.meaning);
            } else {
                console.error('‚ùå Êâæ‰∏çÂà∞ wordMeaning ÂÖÉÁ¥†');
            }

            if (currentWordExample) {
                currentWordExample.textContent = item.example;
                console.log('‚úÖ wordExample Â∑≤Êõ¥Êñ∞:', item.example);
            } else {
                console.error('‚ùå Êâæ‰∏çÂà∞ wordExample ÂÖÉÁ¥†');
            }

            // Êõ¥Êñ∞ÂçïËØçËøõÂ∫¶ÊòæÁ§∫
            const vocabProgress = document.getElementById("vocabProgress");
            if (vocabProgress && data.vocab && data.vocab.length > 0) {
                vocabProgress.textContent = `(Á¨¨ ${selectedWordIndex + 1} / ${data.vocab.length} ‰∏™ÂçïËØç)`;
            }

            if (currentWordResult) {
                currentWordResult.textContent = "";
            }

            if (currentWordChoices) {
                currentWordChoices.hidden = true;
                currentWordChoices.innerHTML = "";
            }

            setWordCover(false);

            // ÈáçÊñ∞ÂêØÁî®ÂèåÂáªÊü•ËØ¢ÔºàÂÜÖÂÆπÊõ¥Êñ∞ÂêéÔºâ- Âª∂ËøüÊõ¥ÈïøÊó∂Èó¥ÔºåÁ°Æ‰øùDOMÂ∑≤Êõ¥Êñ∞
            setTimeout(() => {
                try {
                    // ÈáçÊñ∞Ëé∑ÂèñÂÖÉÁ¥†ÂºïÁî®ÔºåÁ°Æ‰øùÊòØÂΩìÂâçDOM‰∏≠ÁöÑÂÖÉÁ¥†
                    const currentWordCard = document.querySelector(".word-card");
                    const currentWordText = document.getElementById("wordText");
                    const currentWordExample = document.getElementById("wordExample");

                    console.log('üîç Ê£ÄÊü•ÂÖÉÁ¥†Áä∂ÊÄÅ:', {
                        wordCard: currentWordCard ? 'Â≠òÂú®' : '‰∏çÂ≠òÂú®',
                        wordText: currentWordText ? 'Â≠òÂú®' : '‰∏çÂ≠òÂú®',
                        wordExample: currentWordExample ? 'Â≠òÂú®' : '‰∏çÂ≠òÂú®'
                    });

                    // Âè™Âú®ÂÖÉÁ¥†Â≠òÂú®‰∏îÊúâÁà∂ËäÇÁÇπÊó∂ÊâçÊ∑ªÂä†ÂèåÂáªÊü•ËØ¢
                    if (currentWordCard && currentWordCard.parentNode && currentWordCard.isConnected) {
                        addDoubleClickQuery(currentWordCard);
                    }
                    if (currentWordText && currentWordText.parentNode && currentWordText.isConnected) {
                        addDoubleClickQuery(currentWordText);
                    }
                    if (currentWordExample && currentWordExample.parentNode && currentWordExample.isConnected) {
                        addDoubleClickQuery(currentWordExample);
                    }
                } catch (error) {
                    console.error('‚ùå Ê∑ªÂä†ÂèåÂáªÊü•ËØ¢Êó∂Âá∫Èîô:', error);
                    // ‰∏çÈòªÊ≠¢ÂçïËØçÂàáÊç¢ÔºåÂè™ÊòØÂèåÂáªÊü•ËØ¢ÂäüËÉΩÂèØËÉΩÊöÇÊó∂‰∏çÂèØÁî®
                }
            }, 200);
        }

        function nextWord() {
            // Â¶ÇÊûúÊ≠£Âú®ÊµãËØïÊ®°ÂºèÔºå‰∏çÂÖÅËÆ∏ÂàáÊç¢ÂçïËØç
            if (isQuizMode) {
                console.log('‚è∏Ô∏è ÊµãËØïÊ®°Âºè‰∏≠Ôºå‰∏çÂÖÅËÆ∏ÂàáÊç¢ÂçïËØç');
                alert('ËØ∑ÂÖàÂÆåÊàêÂΩìÂâçÂçïËØçÁöÑÊµãËØïÔºåÊâçËÉΩÂàáÊç¢Âà∞‰∏ã‰∏Ä‰∏™ÂçïËØç');
                return;
            }

            // Èò≤Ê≠¢ÈáçÂ§çË∞ÉÁî®
            if (nextWordLock) {
                console.log('‚è∏Ô∏è nextWord Ê≠£Âú®ÊâßË°åÔºåÂøΩÁï•ÈáçÂ§çË∞ÉÁî®');
                return;
            }

            console.log('üîÑ nextWord Ë¢´Ë∞ÉÁî®');
            console.log('üìä ÂΩìÂâçÊï∞ÊçÆÁä∂ÊÄÅ:', {
                vocabLength: data.vocab?.length || 0,
                selectedWordIndex: selectedWordIndex,
                isQuizMode: isQuizMode
            });

            if (!data.vocab || data.vocab.length === 0) {
                console.warn('‚ö†Ô∏è ÂçïËØçÊï∞ÊçÆ‰∏∫Á©∫ÔºåÊó†Ê≥ïÂàáÊç¢ÂçïËØç');
                alert('ÂçïËØçÊï∞ÊçÆ‰∏∫Á©∫ÔºåËØ∑ÂÖàÂØºÂÖ•ÂçïËØçÊï∞ÊçÆ');
                return;
            }

            nextWordLock = true; // ÈîÅÂÆö

            try {
                // ÊåâÈ°∫Â∫èÂàáÊç¢Ôºö‰∏ã‰∏Ä‰∏™Á¥¢Âºï
                const newIndex = (selectedWordIndex + 1) % data.vocab.length;
                console.log('‚úÖ ÂàáÊç¢Âà∞‰∏ã‰∏Ä‰∏™Á¥¢Âºï:', newIndex, '/', data.vocab.length);
                console.log('üìû ÂáÜÂ§áË∞ÉÁî® loadWordÔºåÂèÇÊï∞:', newIndex);
                // Áõ¥Êé•Ë∞ÉÁî® loadWordÔºå‰∏çÂú®ËøôÈáåÂ§ÑÁêÜÂèåÂáªÊü•ËØ¢
                const result = loadWord(newIndex);
                console.log('üìû loadWord Ë∞ÉÁî®ÂÆåÊàêÔºåËøîÂõûÂÄº:', result);
            } catch (error) {
                console.error('‚ùå nextWord ÊâßË°åÂá∫Èîô:', error);
                console.error('ÈîôËØØÂ†ÜÊ†à:', error.stack);
                alert('ÂàáÊç¢ÂçïËØçÊó∂Âá∫Èîô: ' + error.message);
            } finally {
                // Âª∂ËøüËß£ÈîÅÔºåÈò≤Ê≠¢Âø´ÈÄüËøûÁª≠ÁÇπÂáª
                setTimeout(() => {
                    nextWordLock = false;
                }, 300);
            }
        }

        function buildMeaningOptions(correctMeaning) {
            const pool = data.vocab
                .map(item => item.meaning)
                .filter(meaning => meaning !== correctMeaning);
            const distractors = shuffle(pool).slice(0, Math.min(3, pool.length));
            return shuffle([correctMeaning, ...distractors]);
        }

        function startWordQuiz() {
            // Á°Æ‰øù‰ΩøÁî®ÂΩìÂâçÊòæÁ§∫ÁöÑÂçïËØçÔºà‰ªéDOMËé∑ÂèñÔºåÁ°Æ‰øùÂêåÊ≠•Ôºâ
            const currentWordText = document.getElementById("wordText");
            const currentWordMeaning = document.getElementById("wordMeaning");

            // ‰ªéDOMËé∑ÂèñÂΩìÂâçÊòæÁ§∫ÁöÑÂçïËØç
            const displayedWord = currentWordText ? currentWordText.textContent.trim() : null;
            const displayedMeaning = currentWordMeaning ? currentWordMeaning.textContent.trim() : null;

            console.log('üìù ÂºÄÂßãÂ∞èÊµã:', {
                selectedWordIndex: selectedWordIndex,
                displayedWord: displayedWord,
                displayedMeaning: displayedMeaning
            });

            // Ê†πÊçÆÊòæÁ§∫ÁöÑÂçïËØçÊâæÂà∞ÂØπÂ∫îÁöÑÊï∞ÊçÆÔºàÂøÖÈ°ªÂÆåÂÖ®ÂåπÈÖçÔºâ
            let correct = null;
            if (displayedWord && data.vocab) {
                // ÂÖàÂ∞ùËØï‰ΩøÁî®ÂΩìÂâçÁ¥¢ÂºïÔºåÁ°Æ‰øùÂçïËØçÂÆåÂÖ®ÂåπÈÖç
                if (data.vocab[selectedWordIndex] && data.vocab[selectedWordIndex].word === displayedWord) {
                    correct = data.vocab[selectedWordIndex];
                } else {
                    // Â¶ÇÊûú‰∏çÂêåÊ≠•ÔºåÈÄöËøáÂçïËØçÊñáÊú¨Á≤æÁ°ÆÊü•Êâæ
                    correct = data.vocab.find(item => item.word && item.word.toLowerCase() === displayedWord.toLowerCase());
                    if (correct) {
                        // Êõ¥Êñ∞Á¥¢Âºï‰ª•‰øùÊåÅÂêåÊ≠•
                        selectedWordIndex = data.vocab.indexOf(correct);
                        console.log('üîÑ Â∑≤ÂêåÊ≠•Á¥¢ÂºïÂà∞:', selectedWordIndex);
                    }
                }
            }

            // Â¶ÇÊûúËøòÊòØÊâæ‰∏çÂà∞Ôºå‰ΩøÁî®ÂΩìÂâçÁ¥¢ÂºïÁöÑÂçïËØç
            if (!correct && data.vocab && data.vocab[selectedWordIndex]) {
                correct = data.vocab[selectedWordIndex];
                console.log('‚ö†Ô∏è ‰ΩøÁî®Á¥¢ÂºïÂçïËØçÔºåÂèØËÉΩ‰∏çÂêåÊ≠•');
            }

            if (!correct) {
                console.error('‚ùå Êó†Ê≥ïÊâæÂà∞ÂΩìÂâçÂçïËØç');
                alert('Êó†Ê≥ïÂºÄÂßãÊµãËØïÔºåËØ∑ÂÖàÈÄâÊã©‰∏Ä‰∏™ÂçïËØç');
                return;
            }

            // È™åËØÅÂçïËØçÊòØÂê¶‰∏éÊòæÁ§∫ÁöÑÂçïËØç‰∏ÄËá¥
            if (correct.word !== displayedWord) {
                console.error('‚ùå ÂçïËØç‰∏çÂåπÈÖç:', {
                    Êï∞ÊçÆ‰∏≠ÁöÑÂçïËØç: correct.word,
                    ÊòæÁ§∫ÁöÑÂçïËØç: displayedWord
                });
                alert('ÂçïËØç‰∏çÂåπÈÖçÔºåËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï');
                return;
            }

            console.log('‚úÖ ‰ΩøÁî®ÂçïËØçËøõË°åÊµãËØï:', correct.word, correct.meaning);

            // ËøõÂÖ•ÊµãËØïÊ®°Âºè
            isQuizMode = true;

            // Á¶ÅÁî®"Êç¢‰∏Ä‰∏™ÂçïËØç"ÊåâÈíÆ
            const nextWordBtn = document.getElementById("nextWordBtn");
            if (nextWordBtn) {
                nextWordBtn.disabled = true;
                nextWordBtn.style.opacity = '0.5';
                nextWordBtn.style.cursor = 'not-allowed';
            }

            const options = buildMeaningOptions(correct.meaning);
            wordChoices.innerHTML = "";
            options.forEach(option => {
                const div = document.createElement("div");
                div.className = "choice";
                div.textContent = option;
                div.addEventListener("click", () => {
                    evaluateWordChoice(div, option === correct.meaning, correct.meaning, correct);
                });
                wordChoices.appendChild(div);
            });
            wordChoices.hidden = false;
            wordResult.textContent = "ÁÇπÂáª‰∏≠ÊñáÈáä‰πâÔºåÁúãÁúã‰Ω†ÊòØÂê¶ÈÄâÂØπÂï¶ÔΩû";
            setWordCover(true);
        }

        function evaluateWordChoice(element, isCorrect, correctMeaning, correctWordData) {
            wordChoices.querySelectorAll(".choice").forEach(choiceEl => {
                choiceEl.classList.remove("selected", "correct", "wrong");
                if (choiceEl.textContent === correctMeaning) {
                    choiceEl.classList.add("correct");
                }
            });
            element.classList.add(isCorrect ? "correct" : "wrong");
            setWordCover(false);

            // ÈÄÄÂá∫ÊµãËØïÊ®°Âºè
            isQuizMode = false;

            // ÈáçÊñ∞ÂêØÁî®"Êç¢‰∏Ä‰∏™ÂçïËØç"ÊåâÈíÆ
            const nextWordBtn = document.getElementById("nextWordBtn");
            if (nextWordBtn) {
                nextWordBtn.disabled = false;
                nextWordBtn.style.opacity = '1';
                nextWordBtn.style.cursor = 'pointer';
            }

            if (isCorrect) {
                // ËÆ∞ÂΩïÊâìÂç°Êó∂ÂåÖÂê´ÂΩìÂâçÂçïËØç
                const currentWord = correctWordData?.word || '';
                addReward(1, "ÂçïËØçÊåëÊàòÊàêÂäü", currentWord);
                wordResult.textContent = "ÂõûÁ≠îÊ≠£Á°ÆÔºÅÂèØ‰ª•ÁÇπÂáª\"Êç¢‰∏Ä‰∏™ÂçïËØç\"ÁªßÁª≠Â≠¶‰π†ÔΩû";
                // ‰∏çÂÜçËá™Âä®ÂàáÊç¢ÔºåËÆ©Áî®Êà∑ÊâãÂä®ÁÇπÂáª"Êç¢‰∏Ä‰∏™ÂçïËØç"
            } else {
                wordResult.textContent = `Â∑Æ‰∏ÄÁÇπÁÇπÔºåÊ≠£Á°ÆÁ≠îÊ°àÊòØ ${correctMeaning}`;
            }
        }

        // ------------ Tabs ------------
        tabElements.forEach(tab => {
            tab.addEventListener("click", () => {
                document.querySelector(".tab.active")?.classList.remove("active");
                tab.classList.add("active");
                const targetId = tab.dataset.target;
                sections.forEach(section => {
                    section.hidden = section.id !== targetId;
                });

                // Â¶ÇÊûúÂàáÊç¢Âà∞ÁîüËØçÊú¨ÔºåÊ∏≤ÊüìÂàóË°®
                if (targetId === 'wordbook') {
                    renderWordbook();
                }
            });
        });

        // ------------ Reading ------------
        function loadReading(index = 0) {
            console.log('üìñ loadReading Ë¢´Ë∞ÉÁî®ÔºåÁ¥¢Âºï:', index);

            if (!data.readingSets || data.readingSets.length === 0) {
                console.warn('‚ö†Ô∏è ÈòÖËØªÊï∞ÊçÆ‰∏∫Á©∫');
                return;
            }

            // Êõ¥Êñ∞ÂÖ®Â±ÄÁ¥¢Âºï
            readingIndex = index;

            // Â¶ÇÊûúÈÄâÊã©‰∫ÜÁâπÂÆöÈöæÂ∫¶ÔºåÂè™‰ªéËØ•ÈöæÂ∫¶ÁöÑÈ¢òÁõÆ‰∏≠ÈÄâÊã©
            let availableItems = data.readingSets;
            if (selectedDifficulty !== 'all') {
                availableItems = data.readingSets.filter(item => {
                    const itemDifficulty = item.difficulty || 1;
                    return itemDifficulty.toString() === selectedDifficulty;
                });
            }

            // Ëé∑ÂèñÂΩìÂâçÈ¢òÁõÆÔºàÂÆö‰πâÂú®ifÂùóÂ§ñÔºåÁ°Æ‰øùÂú®ÂêéÁª≠‰ª£Á†Å‰∏≠ÂèØËÆøÈóÆÔºâ
            const item = data.readingSets[readingIndex];
            if (!item) {
                console.error('‚ùå Êó†Ê≥ïËé∑ÂèñÈòÖËØªÈ¢òÁõÆÔºåÁ¥¢Âºï:', readingIndex);
                return;
            }

            // ÈáçÊñ∞Ëé∑ÂèñÂÖÉÁ¥†ÂºïÁî®ÔºåÁ°Æ‰øùÊòØÊúÄÊñ∞ÁöÑDOMÂÖÉÁ¥†
            const currentReadingStory = document.getElementById("readingStory");
            const currentReadingQuestion = document.getElementById("readingQuestion");
            const currentReadingChoices = document.getElementById("readingChoices");
            const currentReadingResult = document.getElementById("readingResult");
            const currentReadingHint = document.getElementById("readingHint");
            const readingDifficulty = document.getElementById("readingDifficulty");

            console.log('üìù Âä†ËΩΩÈòÖËØªÈ¢òÁõÆ:', {
                index: readingIndex,
                question: item.question?.substring(0, 50) + '...'
            });

            console.log('üîç DOMÂÖÉÁ¥†Áä∂ÊÄÅ:', {
                readingStory: currentReadingStory ? 'Â≠òÂú®' : '‰∏çÂ≠òÂú®',
                readingQuestion: currentReadingQuestion ? 'Â≠òÂú®' : '‰∏çÂ≠òÂú®',
                readingChoices: currentReadingChoices ? 'Â≠òÂú®' : '‰∏çÂ≠òÂú®',
                readingDifficulty: readingDifficulty ? 'Â≠òÂú®' : '‰∏çÂ≠òÂú®'
            });

            if (currentReadingStory) {
                currentReadingStory.textContent = normalizeText(item.text);
                console.log('‚úÖ readingStory Â∑≤Êõ¥Êñ∞');
            } else {
                console.error('‚ùå Êâæ‰∏çÂà∞ readingStory ÂÖÉÁ¥†');
            }

            if (currentReadingQuestion) {
                currentReadingQuestion.textContent = item.question ?? "";
                console.log('‚úÖ readingQuestion Â∑≤Êõ¥Êñ∞:', item.question?.substring(0, 30));
            } else {
                console.error('‚ùå Êâæ‰∏çÂà∞ readingQuestion ÂÖÉÁ¥†');
            }

            if (currentReadingHint) {
                currentReadingHint.textContent = item.tip ?? "";
                currentReadingHint.hidden = !item.tip;
            }

            // Êõ¥Êñ∞ÈòÖËØªËøõÂ∫¶ÊòæÁ§∫ÔºàÊ†πÊçÆÊòØÂê¶ÈÄâÊã©‰∫ÜÈöæÂ∫¶ÊòæÁ§∫‰∏çÂêåÁöÑÊï∞ÈáèÔºâ
            const readingProgress = document.getElementById("readingProgress");
            if (readingProgress) {
                let totalCount = data.readingSets.length;
                let currentPosition = readingIndex + 1;

                // Â¶ÇÊûúÈÄâÊã©‰∫ÜÁâπÂÆöÈöæÂ∫¶ÔºåÊòæÁ§∫ËøáÊª§ÂêéÁöÑÈ¢òÁõÆÊï∞ÈáèÂíå‰ΩçÁΩÆ
                if (selectedDifficulty !== 'all') {
                    totalCount = availableItems.length;
                    // ËÆ°ÁÆóÂΩìÂâçÈ¢òÁõÆÂú®ËøáÊª§ÂàóË°®‰∏≠ÁöÑ‰ΩçÁΩÆ
                    const filteredIndex = availableItems.findIndex(r => r === item);
                    currentPosition = filteredIndex !== -1 ? filteredIndex + 1 : 1;
                }

                readingProgress.textContent = `(Á¨¨ ${currentPosition} / ${totalCount} È¢ò)`;
            }

            // ÊòæÁ§∫ÈöæÂ∫¶Á≠âÁ∫ß
            if (readingDifficulty && item.difficulty) {
                const difficultyLevel = item.difficulty;
                const difficultyStars = '‚≠ê'.repeat(difficultyLevel);
                const difficultyText = ['ÂàùÁ∫ß', 'ÂàùÁ∫ß+', '‰∏≠Á∫ß', '‰∏≠Á∫ß+', 'È´òÁ∫ß'][difficultyLevel - 1] || `ÈöæÂ∫¶ ${difficultyLevel}`;

                // ÊòæÁ§∫ÂΩìÂâçÈ¢òÁõÆÈöæÂ∫¶ÂíåÂèØÁî®È¢òÁõÆÊï∞Èáè
                let availableCount = data.readingSets.length;
                let matchStatus = '';

                // Ê£ÄÊü•ÂΩìÂâçÈ¢òÁõÆÈöæÂ∫¶ÊòØÂê¶‰∏éÈÄâÊã©ÁöÑÈöæÂ∫¶ÂåπÈÖç
                if (selectedDifficulty !== 'all' && selectedDifficulty !== difficultyLevel.toString()) {
                    matchStatus = '(‰∏çÂåπÈÖç)';
                }

                readingDifficulty.textContent = `ÂΩìÂâçÈ¢òÁõÆ: ${difficultyText} ${difficultyStars} ${matchStatus} | ÂèØÁî®È¢òÁõÆ: ${availableCount}`;

                // Â¶ÇÊûú‰∏çÂåπÈÖçÔºåÊòæÁ§∫Ë≠¶ÂëäÊ†∑Âºè
                if (matchStatus) {
                    readingDifficulty.style.color = '#ff6b6b';
                } else {
                    readingDifficulty.style.color = '#8ea6ff';
                }
            }

            // Êõ¥Êñ∞ÈöæÂ∫¶ÈÄâÊã©Âô®ÁöÑÊòæÁ§∫Áä∂ÊÄÅ
            if (typeof updateDifficultySelector === 'function') {
                updateDifficultySelector();
            }

            if (currentReadingResult) {
                currentReadingResult.textContent = "";
            }

            if (currentReadingChoices) {
                currentReadingChoices.innerHTML = "";
            }

            // Â¶ÇÊûúchoicesÊòØÂ≠óÁ¨¶‰∏≤ÊâçËß£ÊûêÔºåÂ¶ÇÊûúÂ∑≤ÁªèÊòØÂØπË±°Â∞±Áõ¥Êé•‰ΩøÁî®
            let choices = item.choices;
        if (typeof choices === 'string') {
            try {
                choices = JSON.parse(choices);
            } catch (e) {
                console.error('‚ùå Ëß£ÊûêchoicesÂ§±Ë¥•:', e);
                choices = [];
            }
        }

        // È™åËØÅchoicesÊ†ºÂºè
        if (!Array.isArray(choices)) {
            console.error('‚ùå choices‰∏çÊòØÊï∞ÁªÑ:', choices);
            choices = [];
        }

        console.log('üìã È¢òÁõÆÊï∞ÊçÆ:', {
            text: item.text?.substring(0, 50) + '...',
            question: item.question,
            choicesCount: choices.length,
            choices: choices.map(c => typeof c === 'object' ? c.text : c)
        });

        if (Array.isArray(choices) && choices.length > 0 && currentReadingChoices) {
            choices.forEach((choice, idx) => {
                const div = document.createElement("div");
                div.className = "choice";

                // Â§ÑÁêÜchoiceÊ†ºÂºèÔºöÂèØËÉΩÊòØÂØπË±° {text: "...", correct: true/false} ÊàñÂ≠óÁ¨¶‰∏≤
                if (typeof choice === 'object' && choice.text) {
                    div.textContent = choice.text;
                } else if (typeof choice === 'string') {
                    div.textContent = choice;
                } else {
                    console.warn('‚ö†Ô∏è Êú™Áü•ÁöÑchoiceÊ†ºÂºè:', choice);
                    div.textContent = String(choice);
                }

                div.dataset.index = idx;
                div.addEventListener("click", () => {
                    resetSelection("#readingChoices");
                    div.classList.add("selected");
                });
                currentReadingChoices.appendChild(div);
            });
            console.log('‚úÖ ÈÄâÈ°πÂ∑≤Êõ¥Êñ∞ÔºåÂÖ±', choices.length, '‰∏™');
        } else {
            console.warn('‚ö†Ô∏è Ê≤°ÊúâÂèØÁî®ÁöÑÈÄâÈ°πÊàñchoicesÂÖÉÁ¥†‰∏çÂ≠òÂú®');
            if (currentReadingChoices) {
                currentReadingChoices.innerHTML = '<p style="color: #ff6b6b;">‚ö†Ô∏è È¢òÁõÆÈÄâÈ°πÂä†ËΩΩÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•È¢òÁõÆÊ†ºÂºè</p>';
            }
        }

        // ÈáçÊñ∞ÂêØÁî®ÂèåÂáªÊü•ËØ¢ÂíåÈ´ò‰∫ÆÔºàÂÜÖÂÆπÊõ¥Êñ∞ÂêéÔºâ
        setTimeout(() => {
            if (currentReadingStory && currentReadingStory.parentNode) {
                try {
                    addDoubleClickQuery(currentReadingStory);
                    highlightWords(currentReadingStory);
                } catch (error) {
                    console.error('‚ùå Ê∑ªÂä†ÂèåÂáªÊü•ËØ¢Â§±Ë¥•:', error);
                }
            }
        }, 100);
        }

        function nextReading() {
            if (!data.readingSets || data.readingSets.length === 0) {
                console.warn('‚ö†Ô∏è ÈòÖËØªÊï∞ÊçÆ‰∏∫Á©∫');
                return;
            }

            // Â¶ÇÊûúÈÄâÊã©‰∫ÜÁâπÂÆöÈöæÂ∫¶ÔºåÂè™‰ªéËØ•ÈöæÂ∫¶ÁöÑÈ¢òÁõÆ‰∏≠ÈÄâÊã©
            let availableItems = data.readingSets;
            if (selectedDifficulty !== 'all') {
                availableItems = data.readingSets.filter(item => {
                    const itemDifficulty = item.difficulty || 1;
                    return itemDifficulty.toString() === selectedDifficulty;
                });
            }

            if (availableItems.length === 0) {
                return;
            }

            // Âú®ÂΩìÂâçÂèØÁî®È¢òÁõÆ‰∏≠ÊâæÂà∞ÂΩìÂâçÈ¢òÁõÆÁöÑÁ¥¢Âºï
            const currentItem = data.readingSets[readingIndex];
            const currentIndexInAvailable = availableItems.findIndex(item => item === currentItem);

            // ÂàáÊç¢Âà∞‰∏ã‰∏Ä‰∏™È¢òÁõÆ
            const nextIndexInAvailable = (currentIndexInAvailable + 1) % availableItems.length;
            const nextItem = availableItems[nextIndexInAvailable];

            // ÊâæÂà∞‰∏ã‰∏Ä‰∏™È¢òÁõÆÂú®ÂéüÂßãÊï∞ÁªÑ‰∏≠ÁöÑÁ¥¢Âºï
            const nextIndex = data.readingSets.findIndex(item => item === nextItem);

            if (nextIndex !== -1) {
                loadReading(nextIndex);
            } else {
                // Â¶ÇÊûúÊâæ‰∏çÂà∞Ôºå‰ΩøÁî®Á¨¨‰∏Ä‰∏™ÂèØÁî®È¢òÁõÆ
                const firstItem = availableItems[0];
                const firstIndex = data.readingSets.findIndex(item => item === firstItem);
                if (firstIndex !== -1) {
                    loadReading(firstIndex);
                }
            }
        }

        function checkReading() {
            const selected = document.querySelector("#readingChoices .choice.selected");
            if (!selected) {
                readingResult.textContent = "ÂÖàÈÄâÊã©‰∏Ä‰∏™Á≠îÊ°àÂì¶ÔΩû";
                return;
            }
            const idx = Number(selected.dataset.index);
            const current = data.readingSets[readingIndex];
            const isCorrect = current.choices[idx].correct;
            document.querySelectorAll("#readingChoices .choice").forEach((el, i) => {
                el.classList.toggle("correct", current.choices[i].correct);
                el.classList.toggle("wrong", !current.choices[i].correct && i === idx);
            });
            if (isCorrect) {
                addReward(2, "ÈòÖËØªÁêÜËß£ÈóØÂÖ≥ÊàêÂäü");
                readingResult.textContent = current.feedbackCorrect ?? "Á≠îÂØπÂï¶ÔºÅÂÜçÂ§öËØªÂá†ÈÅçÊïÖ‰∫ãËØïËØï„ÄÇ";
                // 3ÁßíÂêéËá™Âä®ÂàáÊç¢‰∏ã‰∏ÄÈ¢ò
                setTimeout(() => {
                    nextReading();
                }, 3000);
            } else {
                readingResult.textContent = current.feedbackWrong ?? "ÂÜçÊÉ≥ÊÉ≥ÔºåÊèêÁ§∫ËóèÂú®ÁªÜËäÇÈáåÔΩû";
            }
        }

        // ------------ Collocation ------------
        function loadCollocation(index = 0) {
            console.log('üîó loadCollocation Ë¢´Ë∞ÉÁî®ÔºåÁ¥¢Âºï:', index);

            if (!data.collocationSets || data.collocationSets.length === 0) {
                console.warn('‚ö†Ô∏è Âõ∫ÂÆöÊê≠ÈÖçÊï∞ÊçÆ‰∏∫Á©∫');
                const currentCollocationSentence = document.getElementById("collocationSentence");
                if (currentCollocationSentence) {
                    currentCollocationSentence.textContent = "ÊöÇÊó†Âõ∫ÂÆöÊê≠ÈÖçÈ¢òÁõÆÔºåËØ∑ÂØºÂÖ•È¢òÂ∫ì„ÄÇ";
                }
                const currentCollocationChoices = document.getElementById("collocationChoices");
                if (currentCollocationChoices) {
                    currentCollocationChoices.innerHTML = "";
                }
                const currentCollocationResult = document.getElementById("collocationResult");
                if (currentCollocationResult) {
                    currentCollocationResult.textContent = "";
                }
                const currentCollocationHint = document.getElementById("collocationHint");
                if (currentCollocationHint) {
                    currentCollocationHint.textContent = "";
                }
                return;
            }

            collocationIndex = index % data.collocationSets.length;
            const item = data.collocationSets[collocationIndex];

            console.log('üìù Âä†ËΩΩÂõ∫ÂÆöÊê≠ÈÖçÈ¢òÁõÆ:', {
                index: collocationIndex,
                sentence: item.sentence?.substring(0, 50) + '...'
            });

            // ÈáçÊñ∞Ëé∑ÂèñÂÖÉÁ¥†ÂºïÁî®ÔºåÁ°Æ‰øùÊòØÊúÄÊñ∞ÁöÑDOMÂÖÉÁ¥†
            const currentCollocationSentence = document.getElementById("collocationSentence");
            const currentCollocationChoices = document.getElementById("collocationChoices");
            const currentCollocationResult = document.getElementById("collocationResult");
            const currentCollocationHint = document.getElementById("collocationHint");

            console.log('üîç DOMÂÖÉÁ¥†Áä∂ÊÄÅ:', {
                collocationSentence: currentCollocationSentence ? 'Â≠òÂú®' : '‰∏çÂ≠òÂú®',
                collocationChoices: currentCollocationChoices ? 'Â≠òÂú®' : '‰∏çÂ≠òÂú®'
            });

            if (currentCollocationSentence) {
                currentCollocationSentence.textContent = item.sentence || "";
                console.log('‚úÖ collocationSentence Â∑≤Êõ¥Êñ∞');
            } else {
                console.error('‚ùå Êâæ‰∏çÂà∞ collocationSentence ÂÖÉÁ¥†');
            }

            // Êõ¥Êñ∞Âõ∫ÂÆöÊê≠ÈÖçËøõÂ∫¶ÊòæÁ§∫
            const collocationProgress = document.getElementById("collocationProgress");
            if (collocationProgress && data.collocationSets && data.collocationSets.length > 0) {
                collocationProgress.textContent = `(Á¨¨ ${collocationIndex + 1} / ${data.collocationSets.length} È¢ò)`;
            }

            // Ê∏ÖÁ©∫ÊèêÁ§∫ÂíåÁªìÊûúÔºàÂú®Êèê‰∫§Á≠îÊ°àÂâç‰∏çÊòæÁ§∫Ôºâ
            if (currentCollocationHint) {
                currentCollocationHint.textContent = "";
                currentCollocationHint.hidden = true;
            }

            if (currentCollocationResult) {
                currentCollocationResult.textContent = "";
            }

            if (currentCollocationChoices) {
                currentCollocationChoices.innerHTML = "";
            }

            // ÈáçÊñ∞Â∫îÁî®È´ò‰∫ÆÂäüËÉΩÔºàÂª∂ËøüÊâßË°åÔºåÁ°Æ‰øùDOMÊõ¥Êñ∞ÂÆåÊàêÔºâ
            setTimeout(() => {
                if (currentCollocationSentence && currentCollocationSentence.parentNode && currentCollocationSentence.textContent.trim()) {
                    try {
                        highlightWords(currentCollocationSentence);
                    } catch (error) {
                        console.error('‚ùå Ê∑ªÂä†È´ò‰∫ÆÂ§±Ë¥•:', error);
                    }
                }
            }, 100);

            if (Array.isArray(item.options) && currentCollocationChoices) {
                item.options.forEach((option, idx) => {
                    const div = document.createElement("div");
                    div.className = "choice";
                    div.textContent = option;
                    div.dataset.index = idx;
                    div.dataset.option = option;
                    div.addEventListener("click", () => {
                        resetSelection("#collocationChoices");
                        div.classList.add("selected");
                    });
                    currentCollocationChoices.appendChild(div);
                });
                console.log('‚úÖ ÈÄâÈ°πÂ∑≤Êõ¥Êñ∞ÔºåÂÖ±', item.options.length, '‰∏™');
            }
        }

        function nextCollocation() {
            const nextIndex = (collocationIndex + 1) % data.collocationSets.length;
            loadCollocation(nextIndex);
        }

        function checkCollocation() {
            const selected = document.querySelector("#collocationChoices .choice.selected");
            if (!selected) {
                collocationResult.textContent = "ÂÖàÈÄâÊã©‰∏Ä‰∏™Á≠îÊ°àÂì¶ÔΩû";
                return;
            }
            const selectedOption = selected.dataset.option;
            const current = data.collocationSets[collocationIndex];
            const isCorrect = selectedOption === current.answer;

            document.querySelectorAll("#collocationChoices .choice").forEach((el) => {
                const option = el.dataset.option;
                el.classList.toggle("correct", option === current.answer);
                el.classList.toggle("wrong", !isCorrect && option === selectedOption);
            });

            // Êèê‰∫§Á≠îÊ°àÂêéÊòæÁ§∫ÊèêÁ§∫
            const currentCollocationHint = document.getElementById("collocationHint");
            if (currentCollocationHint && current.tip) {
                currentCollocationHint.textContent = current.tip;
                currentCollocationHint.hidden = false;
            }

            if (isCorrect) {
                addReward(2, "Âõ∫ÂÆöÊê≠ÈÖçÊéåÊè°‰∫Ü");
                collocationResult.textContent = current.feedbackCorrect ?? "Á≠îÂæóÂ•ΩÔºåÊê≠ÈÖçÁî®ÂæóÂæàÂáÜÔºÅ";
                // 3ÁßíÂêéËá™Âä®ÂàáÊç¢‰∏ã‰∏ÄÈ¢ò
                setTimeout(() => {
                    nextCollocation();
                }, 3000);
            } else {
                collocationResult.textContent = current.feedbackWrong ?? "ÂÜçËØªËØªÂè•Â≠êÔºåÊÉ≥ÊÉ≥ËØ≠Â¢ÉÈúÄË¶ÅÂì™‰∏™Êê≠ÈÖç„ÄÇ";
            }
        }

        // ------------ Cloze ------------
        function loadCloze(index = 0) {
            console.log('üß© loadCloze Ë¢´Ë∞ÉÁî®ÔºåÁ¥¢Âºï:', index);
            console.log('üìä ÂÆåÂΩ¢Â°´Á©∫Êï∞ÊçÆÁªüËÆ°:', {
                ÊÄªÊï∞Èáè: data.clozeSets?.length || 0,
                ÂΩìÂâçÁ¥¢Âºï: index,
                ÂÆûÈôÖÁ¥¢Âºï: index % (data.clozeSets?.length || 1)
            });

            if (!data.clozeSets || data.clozeSets.length === 0) {
                console.warn('‚ö†Ô∏è ÂÆåÂΩ¢Â°´Á©∫Êï∞ÊçÆ‰∏∫Á©∫');
                return;
            }

            const actualIndex = index % data.clozeSets.length;
            clozeIndex = actualIndex;
            const item = data.clozeSets[clozeIndex];

            if (!item) {
                console.error('‚ùå È¢òÁõÆÊï∞ÊçÆ‰∏çÂ≠òÂú®ÔºåÁ¥¢Âºï:', clozeIndex);
                // Â¶ÇÊûúÂΩìÂâçÈ¢òÁõÆÊó†ÊïàÔºåÂ∞ùËØï‰∏ã‰∏Ä‰∏™
                if (data.clozeSets.length > 1) {
                    const nextIndex = (clozeIndex + 1) % data.clozeSets.length;
                    console.log('üîÑ Â∞ùËØïÂä†ËΩΩ‰∏ã‰∏Ä‰∏™È¢òÁõÆÔºåÁ¥¢Âºï:', nextIndex);
                    return loadCloze(nextIndex);
                }
                return;
            }

            console.log('üìù Âä†ËΩΩÂÆåÂΩ¢Â°´Á©∫È¢òÁõÆ:', {
                Á¥¢Âºï: clozeIndex,
                ÊÄªÊï∞Èáè: data.clozeSets.length,
                hasText: !!item?.text,
                hasId: !!item?.id,
                itemKeys: Object.keys(item || {})
            });

            // ÈáçÊñ∞Ëé∑ÂèñÂÖÉÁ¥†ÂºïÁî®ÔºåÁ°Æ‰øùÊòØÊúÄÊñ∞ÁöÑDOMÂÖÉÁ¥†
            const currentClozeContainer = document.getElementById("clozeContainer");
            const currentClozeResult = document.getElementById("clozeResult");
            const currentClozeHint = document.getElementById("clozeHint");

            console.log('üîç DOMÂÖÉÁ¥†Áä∂ÊÄÅ:', {
                clozeContainer: currentClozeContainer ? 'Â≠òÂú®' : '‰∏çÂ≠òÂú®',
                clozeResult: currentClozeResult ? 'Â≠òÂú®' : '‰∏çÂ≠òÂú®',
                clozeHint: currentClozeHint ? 'Â≠òÂú®' : '‰∏çÂ≠òÂú®'
            });

            if (!currentClozeContainer) {
                console.error('‚ùå Êâæ‰∏çÂà∞ clozeContainer ÂÖÉÁ¥†');
                return;
            }

            // Ê∏ÖÁ©∫ÂÆπÂô®
            currentClozeContainer.innerHTML = "";

            // Ê£ÄÊü•È¢òÁõÆÊï∞ÊçÆÊòØÂê¶ÊúâÊïà
            if (!item.text) {
                console.error('‚ùå È¢òÁõÆÊ≤°ÊúâtextÂ≠óÊÆµÔºåÁ¥¢Âºï:', clozeIndex, 'È¢òÁõÆ:', item);
                currentClozeContainer.innerHTML = '<div style="padding: 20px; text-align: center; color: #ff6b6b;">‚ö†Ô∏è È¢òÁõÆÊï∞ÊçÆÊó†ÊïàÔºàÁº∫Â∞ëtextÂ≠óÊÆµÔºâ</div>';
                return;
            }

            // Â¶ÇÊûútextÊòØÂ≠óÁ¨¶‰∏≤ÊâçËß£ÊûêÔºåÂ¶ÇÊûúÂ∑≤ÁªèÊòØÂØπË±°Â∞±Áõ¥Êé•‰ΩøÁî®
            let textPieces = item.text;
            if (typeof textPieces === 'string') {
                try {
                    textPieces = JSON.parse(textPieces);
                } catch (e) {
                    console.error('‚ùå Ëß£ÊûêtextÂ§±Ë¥•:', e, 'ÂéüÂßãtext:', textPieces?.substring(0, 100));
                    currentClozeContainer.innerHTML = '<div style="padding: 20px; text-align: center; color: #ff6b6b;">‚ö†Ô∏è È¢òÁõÆÊï∞ÊçÆÊ†ºÂºèÈîôËØØ</div>';
                    return;
                }
            }

            if (!Array.isArray(textPieces) || textPieces.length === 0) {
                console.error('‚ùå text‰∏çÊòØÊï∞ÁªÑÊàñ‰∏∫Á©∫:', textPieces, 'Á¥¢Âºï:', clozeIndex);
                currentClozeContainer.innerHTML = '<div style="padding: 20px; text-align: center; color: #ff6b6b;">‚ö†Ô∏è È¢òÁõÆÊï∞ÊçÆÊ†ºÂºèÈîôËØØÔºàtext‰∏çÊòØÊï∞ÁªÑÔºâ</div>';
                return;
            }

            textPieces.forEach(piece => {
                if (typeof piece === "string") {
                    const span = document.createElement("span");
                    span.textContent = piece;
                    currentClozeContainer.appendChild(span);
                } else if (piece && typeof piece === 'object') {
                    const select = document.createElement("select");
                    if (Array.isArray(piece.options)) {
                        piece.options.forEach(opt => {
                            const option = document.createElement("option");
                            option.value = opt;
                            option.textContent = opt;
                            select.appendChild(option);
                        });
                    }
                    if (piece.answer) {
                        select.dataset.answer = piece.answer;
                    }
                    if (piece.options && piece.options.length > 0) {
                        select.value = piece.options[0];
                    }
                    select.style.borderColor = "#dae3ff";
                    currentClozeContainer.appendChild(select);
                }
            });

            console.log('‚úÖ ÂÆåÂΩ¢Â°´Á©∫ÂÜÖÂÆπÂ∑≤Êõ¥Êñ∞ÔºåÂÖ±', textPieces.length, '‰∏™ÁâáÊÆµ');

            // Êõ¥Êñ∞È¢òÁõÆËøõÂ∫¶ÊòæÁ§∫
            const clozeProgress = document.getElementById("clozeProgress");
            if (clozeProgress) {
                clozeProgress.textContent = `(Á¨¨ ${clozeIndex + 1} / ${data.clozeSets.length} È¢ò)`;
            }

            // Êõ¥Êñ∞ÁîüÊàêÊåâÈíÆÊñáÊú¨
            const generateClozeBtn = document.getElementById("generateClozeBtn");
            if (generateClozeBtn) {
                const currentTotal = data.clozeSets?.length || 0;
                if (currentTotal >= 100) {
                    generateClozeBtn.textContent = `‚ú® ÁîüÊàêÊñ∞È¢òÁõÆÔºàÂΩìÂâç${currentTotal}ÈÅìÔºâ`;
                } else {
                    generateClozeBtn.textContent = '‚ú® ÁîüÊàêÊñ∞È¢òÁõÆÔºàÂ¢ûÂä†Ëá≥100+Ôºâ';
                }
            }

            if (currentClozeResult) {
                currentClozeResult.textContent = "";
            }

            if (currentClozeHint) {
                currentClozeHint.textContent = item.tip ?? "";
                currentClozeHint.hidden = !item.tip;
            }

            // ÈáçÊñ∞ÂêØÁî®ÂèåÂáªÊü•ËØ¢ÂíåÈ´ò‰∫ÆÔºàÂÜÖÂÆπÊõ¥Êñ∞ÂêéÔºâ
            setTimeout(() => {
                if (currentClozeContainer && currentClozeContainer.parentNode) {
                    try {
                        addDoubleClickQuery(currentClozeContainer);
                        highlightWords(currentClozeContainer);
                    } catch (error) {
                        console.error('‚ùå Ê∑ªÂä†ÂèåÂáªÊü•ËØ¢Â§±Ë¥•:', error);
                    }
                }
            }, 100);
        }

        function nextCloze() {
            console.log('üîÑ nextCloze Ë¢´Ë∞ÉÁî®');
            console.log('üìä ÂΩìÂâçÁä∂ÊÄÅ:', {
                ÂΩìÂâçÁ¥¢Âºï: clozeIndex,
                ÊÄªÊï∞Èáè: data.clozeSets?.length || 0
            });

            if (!data.clozeSets || data.clozeSets.length === 0) {
                console.warn('‚ö†Ô∏è ÂÆåÂΩ¢Â°´Á©∫Êï∞ÊçÆ‰∏∫Á©∫ÔºåÊó†Ê≥ïÂàáÊç¢');
                alert('ÂÆåÂΩ¢Â°´Á©∫Êï∞ÊçÆ‰∏∫Á©∫ÔºåËØ∑ÂÖàÂØºÂÖ•È¢òÂ∫ì');
                return;
            }

            // ÊåâÈ°∫Â∫èÂàáÊç¢Ôºö‰∏ã‰∏Ä‰∏™Á¥¢Âºï
            const nextIndex = (clozeIndex + 1) % data.clozeSets.length;
            console.log('‚úÖ ÂàáÊç¢Âà∞‰∏ã‰∏Ä‰∏™Á¥¢Âºï:', nextIndex, '/', data.clozeSets.length);
            loadCloze(nextIndex);
        }

        function checkCloze() {
            // ÈáçÊñ∞Ëé∑ÂèñÂÖÉÁ¥†ÂºïÁî®
            const currentClozeContainer = document.getElementById("clozeContainer");
            const currentClozeResult = document.getElementById("clozeResult");

            if (!currentClozeContainer) {
                console.error('‚ùå Êâæ‰∏çÂà∞ clozeContainer ÂÖÉÁ¥†');
                return;
            }

            const selects = currentClozeContainer.querySelectorAll("select");
            let score = 0;
            selects.forEach(select => {
                if (select.value === select.dataset.answer) {
                    select.style.borderColor = "#58d68d";
                    score++;
                } else {
                    select.style.borderColor = "#ff8b8b";
                }
            });
            if (!currentClozeResult) {
                console.error('‚ùå Êâæ‰∏çÂà∞ clozeResult ÂÖÉÁ¥†');
                return;
            }

            if (score === selects.length) {
                addReward(3, "ÂÆåÂΩ¢Â°´Á©∫ÂÖ®ÂØπ");
                currentClozeResult.textContent = "Êª°ÂàÜËÄ∂ÔºÅÊïÖ‰∫ãËÆ≤ÂæóË∂ÖÊ∏ÖÊ•öÔΩû";
                // 3ÁßíÂêéËá™Âä®ÂàáÊç¢‰∏ã‰∏ÄÈ¢ò
                setTimeout(() => {
                    nextCloze();
                }, 3000);
            } else {
                currentClozeResult.textContent = `ÂæóÂàÜ ${score}/${selects.length}„ÄÇÂÜçËØª‰∏ÄÈÅçÊïÖ‰∫ãÔºåÁïôÂøÉÂä®ËØçÔΩû`;
            }
        }

        // ------------ Rewards / Levels ------------
        function addReward(value, reason, words = null) {
            stars += value;
            points += value;

            // üìÖ ËÆ∞ÂΩïÊâìÂç°
            const now = new Date();
            const dateStr = now.toISOString().split('T')[0]; // YYYY-MM-DD
            const timestamp = now.getTime();

            // Á°Æ‰øùcheckinRecordsÊòØÊï∞ÁªÑ
            if (!Array.isArray(checkinRecords)) {
                console.warn('‚ö†Ô∏è checkinRecords‰∏çÊòØÊï∞ÁªÑÔºåÈáçÊñ∞ÂàùÂßãÂåñ');
                checkinRecords = [];
            }

            const newRecord = {
                date: dateStr,
                stars: value,
                reason: reason,
                timestamp: timestamp
            };

            // Â¶ÇÊûúÊòØÂçïËØçÊâìÂç°ÔºåËÆ∞ÂΩïÂÖ∑‰ΩìÂçïËØç
            if (words && Array.isArray(words) && words.length > 0) {
                newRecord.words = words;
            } else if (words && typeof words === 'string') {
                // Â¶ÇÊûú‰º†ÂÖ•ÁöÑÊòØÂçï‰∏™ÂçïËØçÂ≠óÁ¨¶‰∏≤ÔºåËΩ¨Êç¢‰∏∫Êï∞ÁªÑ
                newRecord.words = [words];
            }

            checkinRecords.push(newRecord);
            console.log('üìù Êñ∞Â¢ûÊâìÂç°ËÆ∞ÂΩï:', newRecord);

            // Á´ãÂç≥‰øùÂ≠òÊâìÂç°ËÆ∞ÂΩïÔºàÁ°Æ‰øùÊï∞ÊçÆ‰∏ç‰∏¢Â§±Ôºâ
            const saveSuccess = saveCheckinRecords();
            if (!saveSuccess) {
                console.error('‚ùå ‰øùÂ≠òÊâìÂç°ËÆ∞ÂΩïÂ§±Ë¥•Ôºå‰ΩÜËÆ∞ÂΩïÂ∑≤Ê∑ªÂä†Âà∞ÂÜÖÂ≠ò‰∏≠');
                // Âç≥‰Ωø‰øùÂ≠òÂ§±Ë¥•Ôºå‰πüÁªßÁª≠ÊâßË°åÔºåÂõ†‰∏∫Êï∞ÊçÆÂú®ÂÜÖÂ≠ò‰∏≠
            }

            updateBadges();
            if (pointsLog) {
                pointsLog.textContent = `üéâ ‰ªäÊó•ÁßØÂàÜÔºö${points} ‚Äî‚Äî ${reason}!`;
            }
        }

        function updateBadges() {
            // Êõ¥Êñ∞‰æßËæπÊ†è‰∏≠ÁöÑbadge
            const starsBadgeEl = document.getElementById("starsBadge");
            const wordCountBadgeEl = document.getElementById("wordCountBadge");
            const levelBadgeEl = document.getElementById("levelBadge");

            if (starsBadgeEl) {
                const textEl = starsBadgeEl.querySelector('.sidebar-badge-text');
                if (textEl) {
                    textEl.textContent = `ÊòüÊòüÔºö${stars}`;
                }
            }

            if (wordCountBadgeEl) {
                const textEl = wordCountBadgeEl.querySelector('.sidebar-badge-text');
                if (textEl) {
                    textEl.textContent = `ÂçïËØçÔºö${data.vocab?.length || 0}`;
                }
            }

            if (levelBadgeEl) {
                let level = "ÁßçÂ≠êÊé¢Èô©ÂÆ∂";
                if (stars >= 12) level = "Ë∂ÖÁ∫ßÊòüÈôÖÈòüÈïø";
                else if (stars >= 8) level = "ÂãáÊï¢Â∞èÈ™ëÂ£´";
                else if (stars >= 4) level = "Èì∂Ê≤≥Â≠¶Âëò";
                const textEl = levelBadgeEl.querySelector('.sidebar-badge-text');
                if (textEl) {
                    textEl.textContent = `Á≠âÁ∫ßÔºö${level}`;
                }
            }
        }

        function updateBankStatistics() {
            const statVocabCount = document.getElementById("statVocabCount");
            const statReadingCount = document.getElementById("statReadingCount");
            const statCollocationCount = document.getElementById("statCollocationCount");
            const statClozeCount = document.getElementById("statClozeCount");

            const vocabCount = data.vocab?.length ?? 0;
            const readingCount = data.readingSets?.length ?? 0;
            const collocationCount = data.collocationSets?.length ?? 0;
            const clozeCount = data.clozeSets?.length ?? 0;

            console.log('üìä Êõ¥Êñ∞È¢òÂ∫ìÁªüËÆ°:', {
                ÂçïËØç: vocabCount,
                ÈòÖËØª: readingCount,
                Âõ∫ÂÆöÊê≠ÈÖç: collocationCount,
                ÂÆåÂΩ¢Â°´Á©∫: clozeCount
            });

            if (statVocabCount) statVocabCount.textContent = vocabCount;
            if (statReadingCount) statReadingCount.textContent = readingCount;
            if (statCollocationCount) statCollocationCount.textContent = collocationCount;
            if (statClozeCount) statClozeCount.textContent = clozeCount;
        }

        // ÊòæÁ§∫È¢òÂ∫ìËØ¶ÊÉÖ
        function showBankDetail(type) {
            const modal = document.getElementById('bankDetailModal');
            const title = document.getElementById('bankDetailTitle');
            const content = document.getElementById('bankDetailContent');

            if (!modal || !title || !content) {
                console.error('‚ùå È¢òÂ∫ìËØ¶ÊÉÖÊ®°ÊÄÅÊ°ÜÂÖÉÁ¥†Êú™ÊâæÂà∞');
                return;
            }

            let html = '';
            let titleText = '';

            switch (type) {
                case 'vocab':
                    titleText = 'üçé ÂçïËØçÂ∫ìËØ¶ÊÉÖ';
                    if (data.vocab && data.vocab.length > 0) {
                        html += '<div class="bank-detail-list">';
                        data.vocab.forEach((item, index) => {
                            const word = item.word || item.ÂçïËØç || '';
                            const meaning = item.meaning || item.Èáä‰πâ || item.meaning_CN || '';
                            const difficulty = item.difficulty || item.ÈöæÂ∫¶ || 1;
                            html += `
                                <div class="bank-detail-item">
                                    <span class="bank-detail-index">${index + 1}.</span>
                                    <span class="bank-detail-word">${word}</span>
                                    <span class="bank-detail-meaning">${meaning}</span>
                                    <span class="bank-detail-difficulty" title="ÈöæÂ∫¶">‚≠ê ${difficulty}</span>
                                </div>
                            `;
                        });
                        html += '</div>';
                        html += `<p class="bank-detail-total">ÂÖ± ${data.vocab.length} ‰∏™ÂçïËØç</p>`;
                    } else {
                        html = '<p class="bank-empty">ÊöÇÊó†ÂçïËØçÊï∞ÊçÆÔºåËØ∑ÂØºÂÖ•È¢òÂ∫ì„ÄÇ</p>';
                    }
                    break;

                case 'reading':
                    titleText = 'üìñ ÈòÖËØªÁêÜËß£Â∫ìËØ¶ÊÉÖ';
                    if (data.readingSets && data.readingSets.length > 0) {
                        html += '<div class="bank-detail-list">';
                        data.readingSets.forEach((item, index) => {
                            // Â∞ùËØïÂ§ö‰∏™ÂèØËÉΩÁöÑÂ≠óÊÆµÂêç
                            let title = item.title || item.Ê†áÈ¢ò || item.head || item.headline || '';
                            let content = item.content || item.text || item.article || item.passage || '';

                            // Â¶ÇÊûúÊ≤°ÊúâÊ†áÈ¢òÔºå‰ΩøÁî®ÂÜÖÂÆπÁöÑÂâç30‰∏™Â≠óÁ¨¶‰Ωú‰∏∫Ê†áÈ¢ò
                            if (!title && content) {
                                const contentStr = typeof content === 'string' ? content : JSON.stringify(content);
                                title = contentStr.substring(0, 30) + (contentStr.length > 30 ? '...' : '');
                            }
                            if (!title) title = `ÈòÖËØª ${index + 1}`;

                            const difficulty = item.difficulty || item.ÈöæÂ∫¶ || 1;
                            const questionCount = item.questions?.length || 0;

                            // ÊòæÁ§∫ÂÜÖÂÆπÈ¢ÑËßàÔºàÂâç100Â≠óÁ¨¶Ôºâ
                            let contentPreview = '';
                            if (content) {
                                const contentStr = typeof content === 'string' ? content : JSON.stringify(content);
                                contentPreview = contentStr.substring(0, 100).replace(/\n/g, ' ') + (contentStr.length > 100 ? '...' : '');
                            }

                            html += `
                                <div class="bank-detail-item" style="display: block;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                        <span class="bank-detail-index">${index + 1}.</span>
                                        <span class="bank-detail-title" style="flex: 1;">${title}</span>
                                        <span class="bank-detail-questions">${questionCount} È¢ò</span>
                                        <span class="bank-detail-difficulty" title="ÈöæÂ∫¶">‚≠ê ${difficulty}</span>
                                    </div>
                                    ${contentPreview ? `<div style="font-size: 13px; color: #64748B; padding: 8px 0 0 50px; line-height: 1.5;">${contentPreview}</div>` : ''}
                                </div>
                            `;
                        });
                        html += '</div>';
                        html += `<p class="bank-detail-total">ÂÖ± ${data.readingSets.length} ÁØáÈòÖËØª</p>`;
                    } else {
                        html = '<p class="bank-empty">ÊöÇÊó†ÈòÖËØªÁêÜËß£Êï∞ÊçÆÔºåËØ∑ÂØºÂÖ•È¢òÂ∫ì„ÄÇ</p>';
                    }
                    break;

                case 'collocation':
                    titleText = 'üîó Âõ∫ÂÆöÊê≠ÈÖçÂ∫ìËØ¶ÊÉÖ';
                    if (data.collocationSets && data.collocationSets.length > 0) {
                        html += '<div class="bank-detail-list">';
                        data.collocationSets.forEach((item, index) => {
                            // Â∞ùËØïÂ§ö‰∏™ÂèØËÉΩÁöÑÂ≠óÊÆµÂêç
                            const question = item.question || item.È¢òÁõÆ || item.prompt || item.sentence || item.text || '';
                            const answer = item.answer || item.Á≠îÊ°à || item.correct || item.rightAnswer || '';
                            const difficulty = item.difficulty || item.ÈöæÂ∫¶ || 1;

                            // Â¶ÇÊûúËøòÊòØÁ©∫ÁöÑÔºåÊòæÁ§∫Êï¥‰∏™ÂØπË±°ÁöÑÁªìÊûÑÔºàÁî®‰∫éË∞ÉËØïÔºâ
                            let displayQuestion = question;
                            let displayAnswer = answer;

                            if (!displayQuestion && !displayAnswer) {
                                // Â∞ùËØïÊòæÁ§∫ÂÖ∂‰ªñÂèØËÉΩÁöÑÂ≠óÊÆµ
                                const keys = Object.keys(item).filter(k => k !== 'id' && k !== 'difficulty' && k !== 'ÈöæÂ∫¶');
                                if (keys.length > 0) {
                                    displayQuestion = `[${keys[0]}]: ${String(item[keys[0]]).substring(0, 50)}`;
                                }
                            }

                            html += `
                                <div class="bank-detail-item" style="display: block;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span class="bank-detail-index">${index + 1}.</span>
                                        <span class="bank-detail-difficulty" title="ÈöæÂ∫¶">‚≠ê ${difficulty}</span>
                                    </div>
                                    ${displayQuestion ? `<div style="font-size: 14px; color: #1E293B; padding: 8px 0 4px 50px;">È¢òÁõÆ: ${displayQuestion}</div>` : ''}
                                    ${displayAnswer ? `<div style="font-size: 14px; color: #059669; padding: 4px 0 0 50px;">Á≠îÊ°à: ‚úì ${displayAnswer}</div>` : ''}
                                </div>
                            `;
                        });
                        html += '</div>';
                        html += `<p class="bank-detail-total">ÂÖ± ${data.collocationSets.length} ÈÅìÊê≠ÈÖçÈ¢ò</p>`;
                    } else {
                        html = '<p class="bank-empty">ÊöÇÊó†Âõ∫ÂÆöÊê≠ÈÖçÊï∞ÊçÆÔºåËØ∑ÂØºÂÖ•È¢òÂ∫ì„ÄÇ</p>';
                    }
                    break;

                case 'cloze':
                    titleText = 'üß© ÂÆåÂΩ¢Â°´Á©∫Â∫ìËØ¶ÊÉÖ';
                    if (data.clozeSets && data.clozeSets.length > 0) {
                        console.log('üîç ÂÆåÂΩ¢Â°´Á©∫Êï∞ÊçÆË∞ÉËØïÔºåÂâç3Êù°:', data.clozeSets.slice(0, 3).map(item => ({
                            id: item.id,
                            Â≠óÊÆµ: Object.keys(item),
                            textÁ±ªÂûã: typeof item.text,
                            Êúâtext: !!item.text
                        })));
                        html += '<div class="bank-detail-list">';
                        data.clozeSets.forEach((item, index) => {
                            console.log(`üîç ÂÆåÂΩ¢Â°´Á©∫ [${index}] ÊâÄÊúâÂ≠óÊÆµ:`, Object.keys(item));

                            // Â∞ùËØïÂ§ö‰∏™ÂèØËÉΩÁöÑÂ≠óÊÆµÂêç
                            let title = item.title || item.Ê†áÈ¢ò || '';

                            // Â∞ùËØï‰ªéÂêÑÁßçÂèØËÉΩÁöÑÂ≠óÊÆµÊèêÂèñÂÜÖÂÆπ
                            let textContent = '';

                            // 1. Â∞ùËØï text Â≠óÊÆµÔºàÊúÄÂ∏∏ËßÅÔºâ
                            if (item.text) {
                                if (typeof item.text === 'string') {
                                    textContent = item.text;
                                } else if (Array.isArray(item.text)) {
                                    // text ÊòØÊï∞ÁªÑÊ†ºÂºèÔºö["text", {answer: "xxx", options: [...]}, "more text"]
                                    textContent = item.text.map(part => {
                                        if (typeof part === 'string') return part;
                                        if (part && typeof part === 'object') {
                                            // ÊòæÁ§∫Á≠îÊ°àÊàñÁ¨¨‰∏Ä‰∏™ÈÄâÈ°π
                                            if (part.answer) return ` [${part.answer}] `;
                                            if (part.options && part.options.length > 0) return ` [${part.options[0]}] `;
                                        }
                                        return ' [...] ';
                                    }).join('');
                                } else if (typeof item.text === 'object') {
                                    textContent = JSON.stringify(item.text);
                                }
                            }

                            // 2. Â∞ùËØï content Â≠óÊÆµ
                            if (!textContent && item.content) {
                                textContent = typeof item.content === 'string' ? item.content : JSON.stringify(item.content);
                            }

                            // 3. Â∞ùËØï passage Â≠óÊÆµ
                            if (!textContent && item.passage) {
                                textContent = typeof item.passage === 'string' ? item.passage : JSON.stringify(item.passage);
                            }

                            // 4. Â∞ùËØï article Â≠óÊÆµ
                            if (!textContent && item.article) {
                                textContent = typeof item.article === 'string' ? item.article : JSON.stringify(item.article);
                            }

                            // Ê∏ÖÁêÜÊñáÊú¨ÔºàÂéªÈô§Â§ö‰ΩôÁöÑÁ©∫ÁôΩÔºâ
                            textContent = textContent.replace(/\s+/g, ' ').trim();

                            // Â¶ÇÊûúÊ≤°ÊúâÊ†áÈ¢òÔºå‰ΩøÁî®ÊñáÊú¨ÂÜÖÂÆπÁöÑÂâç30‰∏™Â≠óÁ¨¶
                            if (!title && textContent) {
                                title = textContent.substring(0, 30) + (textContent.length > 30 ? '...' : '');
                            }
                            if (!title) title = `ÂÆåÂΩ¢Â°´Á©∫ ${index + 1}`;

                            const difficulty = item.difficulty || item.ÈöæÂ∫¶ || 1;

                            // ËÆ°ÁÆóÈ¢òÁõÆÊï∞Èáè
                            let questionCount = item.questions?.length || 0;
                            if (questionCount === 0 && item.text) {
                                if (Array.isArray(item.text)) {
                                    questionCount = item.text.filter(t => typeof t === 'object' && t.options).length;
                                } else if (typeof item.text === 'string') {
                                    const matches = item.text.match(/\{[^}]*\}/g) || item.text.match(/_{3,}/g);
                                    questionCount = matches ? matches.length : 0;
                                }
                            }

                            // ÊòæÁ§∫ÂÜÖÂÆπÈ¢ÑËßàÔºàÂâç150Â≠óÁ¨¶Ôºâ
                            let contentPreview = textContent ? textContent.substring(0, 150) + (textContent.length > 150 ? '...' : '') : '';

                            html += `
                                <div class="bank-detail-item" style="display: block;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                        <span class="bank-detail-index">${index + 1}.</span>
                                        <span class="bank-detail-title" style="flex: 1;">${title}</span>
                                        <span class="bank-detail-questions">${questionCount} È¢ò</span>
                                        <span class="bank-detail-difficulty" title="ÈöæÂ∫¶">‚≠ê ${difficulty}</span>
                                    </div>
                                    ${contentPreview ? `<div style="font-size: 13px; color: #64748B; padding: 8px 0 0 50px; line-height: 1.6; background: #f1f5f9; padding: 10px; border-radius: 6px;">${contentPreview}</div>` : '<div style="font-size: 12px; color: #94a3b8; padding: 8px 0 0 50px;">ÔºàÊó†ÂÜÖÂÆπÈ¢ÑËßàÔºâ</div>'}
                                </div>
                            `;
                        });
                        html += '</div>';
                        html += `<p class="bank-detail-total">ÂÖ± ${data.clozeSets.length} ÁØáÂÆåÂΩ¢Â°´Á©∫</p>`;
                    } else {
                        html = '<p class="bank-empty">ÊöÇÊó†ÂÆåÂΩ¢Â°´Á©∫Êï∞ÊçÆÔºåËØ∑ÂØºÂÖ•È¢òÂ∫ì„ÄÇ</p>';
                    }
                    break;

                default:
                    html = '<p class="bank-empty">Êú™Áü•Á±ªÂûã</p>';
            }

            title.textContent = titleText;
            content.innerHTML = html;
            modal.style.display = 'flex';
            console.log(`‚úÖ ÊòæÁ§∫È¢òÂ∫ìËØ¶ÊÉÖ: ${type}`);
        }

        // ÁªëÂÆöÈ¢òÂ∫ìÁªüËÆ°ÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂
        function bindBankStatisticsClickEvents() {
            const statButtons = document.querySelectorAll('.sidebar-stat-number');
            statButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const type = this.getAttribute('data-type');
                    if (type) {
                        showBankDetail(type);
                    }
                });
            });

            // ÁªëÂÆöÂÖ≥Èó≠ÊåâÈíÆ
            const closeButtons = [document.getElementById('bankDetailCloseBtn'), document.getElementById('bankDetailCloseBtn2')];
            closeButtons.forEach(btn => {
                if (btn) {
                    btn.addEventListener('click', function() {
                        const modal = document.getElementById('bankDetailModal');
                        if (modal) {
                            modal.style.display = 'none';
                        }
                    });
                }
            });

            // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
            const modal = document.getElementById('bankDetailModal');
            if (modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            }

            console.log('‚úÖ È¢òÂ∫ìÁªüËÆ°ÁÇπÂáª‰∫ã‰ª∂Â∑≤ÁªëÂÆö');
        }

        // ============ üîç ËØçÂÖ∏Êü•ËØ¢ÂäüËÉΩ ============

        // ÁøªËØëÊ∫êËøΩË∏™ÔºàÁî®‰∫éÊòæÁ§∫‰ΩøÁî®‰∫ÜÂì™‰∏™ÁøªËØëÊ∫êÔºâ
        let currentTranslationSource = '';

        // MCPËØçÂÖ∏ÈÖçÁΩÆ
        let mcpConfig = {
            serverUrl: '',
            toolName: 'dictionary', // MCPÂ∑•ÂÖ∑ÂêçÁß∞ÔºåÈªòËÆ§‰∏∫dictionary
            enabled: false
        };


        // Âä†ËΩΩMCPËØçÂÖ∏ÈÖçÁΩÆ
        function loadMcpConfig() {
            try {
                const saved = localStorage.getItem('petMcpConfig');
                if (saved) {
                    mcpConfig = JSON.parse(saved);
                    console.log('‚úÖ MCPËØçÂÖ∏ÈÖçÁΩÆÂ∑≤Âä†ËΩΩ');
                }
            } catch (error) {
                console.error('‚ùå Âä†ËΩΩMCPËØçÂÖ∏ÈÖçÁΩÆÂ§±Ë¥•:', error);
            }
        }

        // ‰øùÂ≠òMCPËØçÂÖ∏ÈÖçÁΩÆ
        function saveMcpConfig() {
            try {
                localStorage.setItem('petMcpConfig', JSON.stringify(mcpConfig));
                console.log('‚úÖ MCPËØçÂÖ∏ÈÖçÁΩÆÂ∑≤‰øùÂ≠ò');
            } catch (error) {
                console.error('‚ùå ‰øùÂ≠òMCPËØçÂÖ∏ÈÖçÁΩÆÂ§±Ë¥•:', error);
            }
        }

        // MD5ÂìàÂ∏åÂáΩÊï∞ÔºàÁÆÄÂåñÁâàÔºåÁî®‰∫éÊúâÈÅìAPIÁ≠æÂêçÔºâ
        async function md5Hash(text) {
            const encoder = new TextEncoder();
            const data = encoder.encode(text);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            // ÊúâÈÅìAPI‰ΩøÁî®MD5Ôºå‰ΩÜÊµèËßàÂô®‰∏çÊîØÊåÅMD5ÔºåÊàë‰ª¨‰ΩøÁî®SHA-256ÁöÑÂâç16Â≠óËäÇ‰Ωú‰∏∫Êõø‰ª£
            // Ê≥®ÊÑèÔºöÂÆûÈôÖ‰ΩøÁî®‰∏≠ÔºåÊúâÈÅìAPIË¶ÅÊ±ÇMD5ÔºåËøôÈáåÈúÄË¶ÅÂºïÂÖ•MD5Â∫ìÊàñ‰ΩøÁî®ÊúçÂä°Âô®Á´Ø‰ª£ÁêÜ
            return hashArray.slice(0, 16).map(b => b.toString(16).padStart(2, '0')).join('');
        }

        // ÁÆÄÂçïÁöÑMD5ÂÆûÁé∞ÔºàÁî®‰∫éÊúâÈÅìAPIÁ≠æÂêçÔºâ
        function md5(string) {
            function md5_RotateLeft(lValue, iShiftBits) {
                return (lValue << iShiftBits) | (lValue >>> (32 - iShiftBits));
            }
            function md5_AddUnsigned(lX, lY) {
                var lX4, lY4, lX8, lY8, lResult;
                lX8 = (lX & 0x80000000);
                lY8 = (lY & 0x80000000);
                lX4 = (lX & 0x40000000);
                lY4 = (lY & 0x40000000);
                lResult = (lX & 0x3FFFFFFF) + (lY & 0x3FFFFFFF);
                if (lX4 & lY4) {
                    return (lResult ^ 0x80000000 ^ lX8 ^ lY8);
                }
                if (lX4 | lY4) {
                    if (lResult & 0x40000000) {
                        return (lResult ^ 0xC0000000 ^ lX8 ^ lY8);
                    } else {
                        return (lResult ^ 0x40000000 ^ lX8 ^ lY8);
                    }
                } else {
                    return (lResult ^ lX8 ^ lY8);
                }
            }
            function md5_F(x, y, z) { return (x & y) | ((~x) & z); }
            function md5_G(x, y, z) { return (x & z) | (y & (~z)); }
            function md5_H(x, y, z) { return (x ^ y ^ z); }
            function md5_I(x, y, z) { return (y ^ (x | (~z))); }
            function md5_FF(a, b, c, d, x, s, ac) {
                a = md5_AddUnsigned(a, md5_AddUnsigned(md5_AddUnsigned(md5_F(b, c, d), x), ac));
                return md5_AddUnsigned(md5_RotateLeft(a, s), b);
            }
            function md5_GG(a, b, c, d, x, s, ac) {
                a = md5_AddUnsigned(a, md5_AddUnsigned(md5_AddUnsigned(md5_G(b, c, d), x), ac));
                return md5_AddUnsigned(md5_RotateLeft(a, s), b);
            }
            function md5_HH(a, b, c, d, x, s, ac) {
                a = md5_AddUnsigned(a, md5_AddUnsigned(md5_AddUnsigned(md5_H(b, c, d), x), ac));
                return md5_AddUnsigned(md5_RotateLeft(a, s), b);
            }
            function md5_II(a, b, c, d, x, s, ac) {
                a = md5_AddUnsigned(a, md5_AddUnsigned(md5_AddUnsigned(md5_I(b, c, d), x), ac));
                return md5_AddUnsigned(md5_RotateLeft(a, s), b);
            }
            function md5_ConvertToWordArray(string) {
                var lWordCount;
                var lMessageLength = string.length;
                var lNumberOfWords_temp1 = lMessageLength + 8;
                var lNumberOfWords_temp2 = (lNumberOfWords_temp1 - (lNumberOfWords_temp1 % 64)) / 64;
                var lNumberOfWords = (lNumberOfWords_temp2 + 1) * 16;
                var lWordArray = Array(lNumberOfWords - 1);
                var lBytePosition = 0;
                var lByteCount = 0;
                while (lByteCount < lMessageLength) {
                    lWordCount = (lByteCount - (lByteCount % 4)) / 4;
                    lBytePosition = (lByteCount % 4) * 8;
                    lWordArray[lWordCount] = (lWordArray[lWordCount] | (string.charCodeAt(lByteCount) << lBytePosition));
                    lByteCount++;
                }
                lWordCount = (lByteCount - (lByteCount % 4)) / 4;
                lBytePosition = (lByteCount % 4) * 8;
                lWordArray[lWordCount] = lWordArray[lWordCount] | (0x80 << lBytePosition);
                lWordArray[lNumberOfWords - 2] = lMessageLength << 3;
                lWordArray[lNumberOfWords - 1] = lMessageLength >>> 29;
                return lWordArray;
            }
            function md5_WordToHex(lValue) {
                var WordToHexValue = "", WordToHexValue_temp = "", lByte, lCount;
                for (lCount = 0; lCount <= 3; lCount++) {
                    lByte = (lValue >>> (lCount * 8)) & 255;
                    WordToHexValue_temp = "0" + lByte.toString(16);
                    WordToHexValue = WordToHexValue + WordToHexValue_temp.substr(WordToHexValue_temp.length - 2, 2);
                }
                return WordToHexValue;
            }
            function md5_Utf8Encode(string) {
                string = string.replace(/\r\n/g, "\n");
                var utftext = "";
                for (var n = 0; n < string.length; n++) {
                    var c = string.charCodeAt(n);
                    if (c < 128) {
                        utftext += String.fromCharCode(c);
                    } else if ((c > 127) && (c < 2048)) {
                        utftext += String.fromCharCode((c >> 6) | 192);
                        utftext += String.fromCharCode((c & 63) | 128);
                    } else {
                        utftext += String.fromCharCode((c >> 12) | 224);
                        utftext += String.fromCharCode(((c >> 6) & 63) | 128);
                        utftext += String.fromCharCode((c & 63) | 128);
                    }
                }
                return utftext;
            }
            var x = Array();
            var k, AA, BB, CC, DD, a, b, c, d;
            var S11 = 7, S12 = 12, S13 = 17, S14 = 22;
            var S21 = 5, S22 = 9, S23 = 14, S24 = 20;
            var S31 = 4, S32 = 11, S33 = 16, S34 = 23;
            var S41 = 6, S42 = 10, S43 = 15, S44 = 21;
            string = md5_Utf8Encode(string);
            x = md5_ConvertToWordArray(string);
            a = 0x67452301; b = 0xEFCDAB89; c = 0x98BADCFE; d = 0x10325476;
            for (k = 0; k < x.length; k += 16) {
                AA = a; BB = b; CC = c; DD = d;
                a = md5_FF(a, b, c, d, x[k + 0], S11, 0xD76AA478);
                d = md5_FF(d, a, b, c, x[k + 1], S12, 0xE8C7B756);
                c = md5_FF(c, d, a, b, x[k + 2], S13, 0x242070DB);
                b = md5_FF(b, c, d, a, x[k + 3], S14, 0xC1BDCEEE);
                a = md5_FF(a, b, c, d, x[k + 4], S11, 0xF57C0FAF);
                d = md5_FF(d, a, b, c, x[k + 5], S12, 0x4787C62A);
                c = md5_FF(c, d, a, b, x[k + 6], S13, 0xA8304613);
                b = md5_FF(b, c, d, a, x[k + 7], S14, 0xFD469501);
                a = md5_FF(a, b, c, d, x[k + 8], S11, 0x698098D8);
                d = md5_FF(d, a, b, c, x[k + 9], S12, 0x8B44F7AF);
                c = md5_FF(c, d, a, b, x[k + 10], S13, 0xFFFF5BB1);
                b = md5_FF(b, c, d, a, x[k + 11], S14, 0x895CD7BE);
                a = md5_FF(a, b, c, d, x[k + 12], S11, 0x6B901122);
                d = md5_FF(d, a, b, c, x[k + 13], S12, 0xFD987193);
                c = md5_FF(c, d, a, b, x[k + 14], S13, 0xA679438E);
                b = md5_FF(b, c, d, a, x[k + 15], S14, 0x49B40821);
                a = md5_GG(a, b, c, d, x[k + 1], S21, 0xF61E2562);
                d = md5_GG(d, a, b, c, x[k + 6], S22, 0xC040B340);
                c = md5_GG(c, d, a, b, x[k + 11], S23, 0x265E5A51);
                b = md5_GG(b, c, d, a, x[k + 0], S24, 0xE9B6C7AA);
                a = md5_GG(a, b, c, d, x[k + 5], S21, 0xD62F105D);
                d = md5_GG(d, a, b, c, x[k + 10], S22, 0x2441453);
                c = md5_GG(c, d, a, b, x[k + 15], S23, 0xD8A1E681);
                b = md5_GG(b, c, d, a, x[k + 4], S24, 0xE7D3FBC8);
                a = md5_GG(a, b, c, d, x[k + 9], S21, 0x21E1CDE6);
                d = md5_GG(d, a, b, c, x[k + 14], S22, 0xC33707D6);
                c = md5_GG(c, d, a, b, x[k + 3], S23, 0xF4D50D87);
                b = md5_GG(b, c, d, a, x[k + 8], S24, 0x455A14ED);
                a = md5_GG(a, b, c, d, x[k + 13], S21, 0xA9E3E905);
                d = md5_GG(d, a, b, c, x[k + 2], S22, 0xFCEFA3F8);
                c = md5_GG(c, d, a, b, x[k + 7], S23, 0x676F02D9);
                b = md5_GG(b, c, d, a, x[k + 12], S24, 0x8D2A4C8A);
                a = md5_HH(a, b, c, d, x[k + 5], S31, 0xFFFA3942);
                d = md5_HH(d, a, b, c, x[k + 8], S32, 0x8771F681);
                c = md5_HH(c, d, a, b, x[k + 11], S33, 0x6D9D6122);
                b = md5_HH(b, c, d, a, x[k + 14], S34, 0xFDE5380C);
                a = md5_HH(a, b, c, d, x[k + 1], S31, 0xA4BEEA44);
                d = md5_HH(d, a, b, c, x[k + 4], S32, 0x4BDECFA9);
                c = md5_HH(c, d, a, b, x[k + 7], S33, 0xF6BB4B60);
                b = md5_HH(b, c, d, a, x[k + 10], S34, 0xBEBFBC70);
                a = md5_HH(a, b, c, d, x[k + 13], S31, 0x289B7EC6);
                d = md5_HH(d, a, b, c, x[k + 0], S32, 0xEAA127FA);
                c = md5_HH(c, d, a, b, x[k + 3], S33, 0xD4EF3085);
                b = md5_HH(b, c, d, a, x[k + 6], S34, 0x4881D05);
                a = md5_HH(a, b, c, d, x[k + 9], S31, 0xD9D4D039);
                d = md5_HH(d, a, b, c, x[k + 12], S32, 0xE6DB99E5);
                c = md5_HH(c, d, a, b, x[k + 15], S33, 0x1FA27CF8);
                b = md5_HH(b, c, d, a, x[k + 2], S34, 0xC4AC5665);
                a = md5_II(a, b, c, d, x[k + 0], S41, 0xF4292244);
                d = md5_II(d, a, b, c, x[k + 7], S42, 0x432AFF97);
                c = md5_II(c, d, a, b, x[k + 14], S43, 0xAB9423A7);
                b = md5_II(b, c, d, a, x[k + 5], S44, 0xFC93A039);
                a = md5_II(a, b, c, d, x[k + 12], S41, 0x655B59C3);
                d = md5_II(d, a, b, c, x[k + 3], S42, 0x8F0CCC92);
                c = md5_II(c, d, a, b, x[k + 10], S43, 0xFFEFF47D);
                b = md5_II(b, c, d, a, x[k + 1], S44, 0x85845DD1);
                a = md5_II(a, b, c, d, x[k + 8], S41, 0x6FA87E4F);
                d = md5_II(d, a, b, c, x[k + 15], S42, 0xFE2CE6E0);
                c = md5_II(c, d, a, b, x[k + 6], S43, 0xA3014314);
                b = md5_II(b, c, d, a, x[k + 13], S44, 0x4E0811A1);
                a = md5_II(a, b, c, d, x[k + 4], S41, 0xF7537E82);
                d = md5_II(d, a, b, c, x[k + 11], S42, 0xBD3AF235);
                c = md5_II(c, d, a, b, x[k + 2], S43, 0x2AD7D2BB);
                b = md5_II(b, c, d, a, x[k + 9], S44, 0xEB86D391);
                a = md5_AddUnsigned(a, AA);
                b = md5_AddUnsigned(b, BB);
                c = md5_AddUnsigned(c, CC);
                d = md5_AddUnsigned(d, DD);
            }
            return (md5_WordToHex(a) + md5_WordToHex(b) + md5_WordToHex(c) + md5_WordToHex(d)).toLowerCase();
        }

        // Âä†ËΩΩÁºìÂ≠ò
        function loadDictCache() {
            try {
                const cached = localStorage.getItem('petDictCache');
                if (cached) {
                    dictCache = JSON.parse(cached);
                    console.log('‚úÖ ËØçÂÖ∏ÁºìÂ≠òÂ∑≤Âä†ËΩΩ:', Object.keys(dictCache).length, 'Êù°');
                }
            } catch (error) {
                console.error('‚ùå Âä†ËΩΩËØçÂÖ∏ÁºìÂ≠òÂ§±Ë¥•:', error);
                dictCache = {};
            }
        }

        // ‰øùÂ≠òÁºìÂ≠ò
        function saveDictCache() {
            try {
                // Âè™‰øùÁïôÊúÄËøë100Êù°ÁºìÂ≠òÔºåÈÅøÂÖçlocalStorageËøáÂ§ß
                const keys = Object.keys(dictCache);
                if (keys.length > 100) {
                    // ÊåâÊó∂Èó¥ÊéíÂ∫èÔºåÂà†Èô§ÊúÄÊóßÁöÑ
                    const sorted = keys.sort((a, b) => {
                        return (dictCache[b].timestamp || 0) - (dictCache[a].timestamp || 0);
                    });
                    sorted.slice(100).forEach(key => delete dictCache[key]);
                }
                localStorage.setItem('petDictCache', JSON.stringify(dictCache));
            } catch (error) {
                console.error('‚ùå ‰øùÂ≠òËØçÂÖ∏ÁºìÂ≠òÂ§±Ë¥•:', error);
            }
        }

        // Êü•ËØ¢MCPËØçÂÖ∏APIÔºà‰ΩøÁî®MCPÂçèËÆÆÔºâ
        async function queryMcpDictionary(word) {
            if (!mcpConfig.enabled || !mcpConfig.serverUrl) {
                return null; // Êú™ÈÖçÁΩÆÔºåËøîÂõûnull
            }

            const wordLower = word.toLowerCase().trim();

            try {
                console.log('üîç ‰ΩøÁî®MCPËØçÂÖ∏Êü•ËØ¢:', wordLower);

                // Ê∑ªÂä†Ë∂ÖÊó∂Êú∫Âà∂Ôºà5ÁßíÔºâ
                const timeoutPromise = new Promise((_, reject) => {
                    setTimeout(() => reject(new Error('MCPÊü•ËØ¢Ë∂ÖÊó∂')), 5000);
                });

                // MCPÂçèËÆÆ‰ΩøÁî®JSON-RPCÊ†ºÂºè
                const requestBody = {
                    jsonrpc: '2.0',
                    id: Date.now(),
                    method: 'tools/call',
                    params: {
                        name: mcpConfig.toolName || 'dictionary',
                        arguments: {
                            word: wordLower
                        }
                    }
                };

                const response = await Promise.race([
                    fetch(mcpConfig.serverUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(requestBody)
                    }),
                    timeoutPromise
                ]);

                if (!response.ok) {
                    throw new Error(`MCP APIÈîôËØØ: ${response.status}`);
                }

                const data = await response.json();

                // Ê£ÄÊü•JSON-RPCÈîôËØØ
                if (data.error) {
                    console.error('MCP APIÈîôËØØ:', data.error);
                    return null;
                }

                // Ëß£ÊûêMCPËøîÂõûÁªìÊûú
                const result = data.result;
                if (!result || !result.content) {
                    return null;
                }

                // Ê†ºÂºèÂåñMCPËøîÂõûÁöÑÊï∞ÊçÆ
                const formatted = {
                    word: wordLower,
                    phonetic: result.phonetic || '',
                    chineseMeanings: [],
                    meanings: [],
                    examples: []
                };

                // Â§ÑÁêÜMCPËøîÂõûÁöÑÂÜÖÂÆπÔºàÂèØËÉΩÊòØÊñáÊú¨ÊàñÁªìÊûÑÂåñÊï∞ÊçÆÔºâ
                if (typeof result.content === 'string') {
                    // Â¶ÇÊûúÊòØÂ≠óÁ¨¶‰∏≤ÔºåÂ∞ùËØïËß£ÊûêJSON
                    try {
                        const parsed = JSON.parse(result.content);
                        if (parsed.meanings) {
                            formatted.chineseMeanings = parsed.meanings;
                        }
                        if (parsed.phonetic) {
                            formatted.phonetic = parsed.phonetic;
                        }
                        if (parsed.examples) {
                            formatted.examples = parsed.examples;
                        }
                    } catch (e) {
                        // Â¶ÇÊûú‰∏çÊòØJSONÔºå‰Ωú‰∏∫‰∏≠ÊñáÈáä‰πâÂ§ÑÁêÜ
                        formatted.chineseMeanings = [result.content];
                    }
                } else if (result.content.text) {
                    // Â¶ÇÊûúcontentÊòØÂØπË±°‰∏îÊúâtextÂ≠óÊÆµ
                    formatted.chineseMeanings = [result.content.text];
                } else if (Array.isArray(result.content)) {
                    // Â¶ÇÊûúÊòØÊï∞ÁªÑ
                    result.content.forEach(item => {
                        if (typeof item === 'string') {
                            formatted.chineseMeanings.push(item);
                        } else if (item.text) {
                            formatted.chineseMeanings.push(item.text);
                        }
                    });
                }

                // Â§ÑÁêÜÂÖ∂‰ªñÂ≠óÊÆµ
                if (result.phonetic) formatted.phonetic = result.phonetic;
                if (result.meanings) formatted.meanings = result.meanings;
                if (result.examples) formatted.examples = result.examples;

                return formatted;
            } catch (error) {
                console.error('‚ùå Êü•ËØ¢MCPËØçÂÖ∏Â§±Ë¥•:', error);
                return null;
            }
        }

        // Âú∫ÊôØÂè•Â≠êÂ∫ìÔºàÂ∏∏Áî®ÁîüÊ¥ªÂú∫ÊôØÔºâ
        const sceneSentences = {
            // ÈóÆÂÄôÂíåÁ§ºË≤å
            'hello': [
                { en: 'Hello! How are you today?', cn: '‰Ω†Â•ΩÔºÅ‰Ω†‰ªäÂ§©ÊÄé‰πàÊ†∑Ôºü', scene: 'üëã ÈóÆÂÄô' },
                { en: 'Hello, nice to meet you!', cn: '‰Ω†Â•ΩÔºåÂæàÈ´òÂÖ¥ËÆ§ËØÜ‰Ω†ÔºÅ', scene: 'ü§ù ËßÅÈù¢' }
            ],
            'thank': [
                { en: 'Thank you for your help!', cn: 'Ë∞¢Ë∞¢‰Ω†ÁöÑÂ∏ÆÂä©ÔºÅ', scene: 'üíñ ÊÑüË∞¢' },
                { en: 'Thanks a lot!', cn: 'ÈùûÂ∏∏ÊÑüË∞¢ÔºÅ', scene: 'üôè Ë°®ËææÊÑüË∞¢' }
            ],
            'please': [
                { en: 'Can you help me, please?', cn: 'ËØ∑ÈóÆ‰Ω†ËÉΩÂ∏ÆÊàëÂêóÔºü', scene: 'üòä Á§ºË≤åËØ∑Ê±Ç' },
                { en: 'Please pass me the book.', cn: 'ËØ∑Êää‰π¶ÈÄíÁªôÊàë„ÄÇ', scene: 'üìö ËØæÂ†Ç' }
            ],
            // Â≠¶Ê†°ÂíåÂ≠¶‰π†
            'school': [
                { en: 'I go to school every day.', cn: 'ÊàëÊØèÂ§©ÈÉΩÂéª‰∏äÂ≠¶„ÄÇ', scene: 'üè´ Êó•Â∏∏ÁîüÊ¥ª' },
                { en: 'Our school has a big library.', cn: 'Êàë‰ª¨Â≠¶Ê†°Êúâ‰∏Ä‰∏™Â§ßÂõæ‰π¶È¶Ü„ÄÇ', scene: 'üìñ Â≠¶Ê†°ËÆæÊñΩ' }
            ],
            'teacher': [
                { en: 'Our teacher is very kind.', cn: 'Êàë‰ª¨ÁöÑËÄÅÂ∏àÂæà‰∫≤Âàá„ÄÇ', scene: 'üë©‚Äçüè´ ÊèèËø∞ËÄÅÂ∏à' },
                { en: 'The teacher is reading a story.', cn: 'ËÄÅÂ∏àÊ≠£Âú®ËØªÊïÖ‰∫ã„ÄÇ', scene: 'üìñ ËØæÂ†ÇÊ¥ªÂä®' }
            ],
            'student': [
                { en: 'I am a good student.', cn: 'ÊàëÊòØ‰∏™Â•ΩÂ≠¶Áîü„ÄÇ', scene: 'üéì Ëá™Êàë‰ªãÁªç' },
                { en: 'Students listen to the teacher.', cn: 'Â≠¶Áîü‰ª¨Âê¨ËÄÅÂ∏àËÆ≤ËØæ„ÄÇ', scene: 'üëÇ ËØæÂ†Ç' }
            ],
            'book': [
                { en: 'I like reading story books.', cn: 'ÊàëÂñúÊ¨¢ËØªÊïÖ‰∫ã‰π¶„ÄÇ', scene: 'üìö ÈòÖËØª' },
                { en: 'This book is very interesting.', cn: 'ËøôÊú¨‰π¶ÂæàÊúâË∂£„ÄÇ', scene: '‚≠ê ËØÑ‰ª∑' },
                { en: 'Open your book to page 10.', cn: 'Êää‰π¶ÁøªÂà∞Á¨¨10È°µ„ÄÇ', scene: 'üìñ ËØæÂ†ÇÊåá‰ª§' }
            ],
            'pencil': [
                { en: 'Can I borrow your pencil?', cn: 'ÊàëÂèØ‰ª•ÂÄüÁî®‰Ω†ÁöÑÈìÖÁ¨îÂêóÔºü', scene: '‚úèÔ∏è ÂÄü‰∏úË•ø' },
                { en: 'I sharpened my pencil.', cn: 'ÊàëÂâäÂ•Ω‰∫ÜÈìÖÁ¨î„ÄÇ', scene: 'üìù ÂáÜÂ§áÂ≠¶‰π†' }
            ],
            'pen': [
                { en: 'I have a blue pen.', cn: 'ÊàëÊúâ‰∏ÄÊîØËìùËâ≤ÁöÑÈí¢Á¨î„ÄÇ', scene: '‚úèÔ∏è ÊèèËø∞Áâ©ÂìÅ' },
                { en: 'Can I use your pen?', cn: 'ÊàëÂèØ‰ª•Áî®‰Ω†ÁöÑÈí¢Á¨îÂêóÔºü', scene: 'üôè ËØ∑Ê±Ç' }
            ],
            'read': [
                { en: 'I like to read books.', cn: 'ÊàëÂñúÊ¨¢ËØª‰π¶„ÄÇ', scene: 'üìö Áà±Â•Ω' },
                { en: 'Please read this sentence.', cn: 'ËØ∑ËØªËøô‰∏™Âè•Â≠ê„ÄÇ', scene: 'üëÑ ËØæÂ†Ç' }
            ],
            'write': [
                { en: 'I write with my pen.', cn: 'ÊàëÁî®Èí¢Á¨îÂÜôÂ≠ó„ÄÇ', scene: '‚úçÔ∏è ÊèèËø∞Âä®‰Ωú' },
                { en: 'Write your name here.', cn: 'Âú®ËøôÈáåÂÜô‰Ω†ÁöÑÂêçÂ≠ó„ÄÇ', scene: 'üìù Êåá‰ª§' }
            ],
            // ÂÆ∂Â∫≠
            'family': [
                { en: 'I love my family.', cn: 'ÊàëÁà±ÊàëÁöÑÂÆ∂‰∫∫„ÄÇ', scene: 'üíï Ë°®ËææÁà±' },
                { en: 'My family is big.', cn: 'ÊàëÁöÑÂÆ∂Â∫≠ÂæàÂ§ß„ÄÇ', scene: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ ÊèèËø∞ÂÆ∂Â∫≠' }
            ],
            'mother': [
                { en: 'My mother cooks delicious food.', cn: 'ÊàëÂ¶àÂ¶àÂÅöÁöÑÈ•≠ÂæàÂ•ΩÂêÉ„ÄÇ', scene: 'üç≥ ÂÆ∂Â∫≠ÁîüÊ¥ª' },
                { en: 'I help my mother with housework.', cn: 'ÊàëÂ∏ÆÂ¶àÂ¶àÂÅöÂÆ∂Âä°„ÄÇ', scene: 'üßπ Â∏ÆÂøô' },
                { en: 'Mother is reading a book.', cn: 'Â¶àÂ¶àÊ≠£Âú®ËØª‰π¶„ÄÇ', scene: 'üìñ Ê¥ªÂä®' }
            ],
            'father': [
                { en: 'My father is tall.', cn: 'ÊàëÁà∏Áà∏ÂæàÈ´ò„ÄÇ', scene: 'üìè ÊèèËø∞Â§ñË≤å' },
                { en: 'Father plays football with me.', cn: 'Áà∏Áà∏ÂíåÊàë‰∏ÄËµ∑Ë∏¢Ë∂≥ÁêÉ„ÄÇ', scene: '‚öΩ ÂÆ∂Â∫≠Ê¥ªÂä®' },
                { en: 'My father goes to work by car.', cn: 'ÊàëÁà∏Áà∏ÂºÄËΩ¶Âéª‰∏äÁè≠„ÄÇ', scene: 'üöó Êó•Â∏∏ÁîüÊ¥ª' }
            ],
            'brother': [
                { en: 'My brother is older than me.', cn: 'ÊàëÂì•Âì•ÊØîÊàëÂ§ß„ÄÇ', scene: 'üë¶ ÂÆ∂Â∫≠ÂÖ≥Á≥ª' },
                { en: 'I play with my brother.', cn: 'ÊàëÂíåÂì•Âì•‰∏ÄËµ∑Áé©„ÄÇ', scene: 'üéÆ Ê¥ªÂä®' }
            ],
            'sister': [
                { en: 'My sister is beautiful.', cn: 'ÊàëÂßêÂßêÂæàÊºÇ‰∫Æ„ÄÇ', scene: 'üëß ÊèèËø∞' },
                { en: 'Sister helps me with homework.', cn: 'ÂßêÂßêÂ∏ÆÊàëÂÅö‰Ωú‰∏ö„ÄÇ', scene: 'üìö Â≠¶‰π†' }
            ],
            'home': [
                { en: 'I go home after school.', cn: 'ÊîæÂ≠¶ÂêéÊàëÂõûÂÆ∂„ÄÇ', scene: 'üè† Êó•Â∏∏' },
                { en: 'My home is near the school.', cn: 'ÊàëÂÆ∂Âú®Â≠¶Ê†°ÈôÑËøë„ÄÇ', scene: 'üìç ‰ΩçÁΩÆ' }
            ],
            'house': [
                { en: 'This is my house.', cn: 'ËøôÊòØÊàëÁöÑÊàøÂ≠ê„ÄÇ', scene: 'üè† ‰ªãÁªç' },
                { en: 'The house is big and clean.', cn: 'ËøôÊâÄÊàøÂ≠êÂèàÂ§ßÂèàÂπ≤ÂáÄ„ÄÇ', scene: 'üëÄ ÊèèËø∞' }
            ],
            // È£üÁâ©
            'apple': [
                { en: 'I eat an apple every day.', cn: 'ÊàëÊØèÂ§©ÂêÉ‰∏Ä‰∏™ËãπÊûú„ÄÇ', scene: 'üçé Êó•Â∏∏‰π†ÊÉØ' },
                { en: 'The apple is sweet and red.', cn: 'Ëøô‰∏™ËãπÊûúÂèàÁîúÂèàÁ∫¢„ÄÇ', scene: 'üëÄ ÊèèËø∞È£üÁâ©' },
                { en: 'Can I have an apple?', cn: 'ÊàëÂèØ‰ª•ÂêÉ‰∏™ËãπÊûúÂêóÔºü', scene: 'üòã ÊÉ≥Ë¶ÅÈ£üÁâ©' },
                { en: 'Apples are good for health.', cn: 'ËãπÊûúÂØπÂÅ•Â∫∑ÊúâÁõä„ÄÇ', scene: 'üí™ ÂÅ•Â∫∑' }
            ],
            'banana': [
                { en: 'Monkeys like to eat bananas.', cn: 'Áå¥Â≠êÂñúÊ¨¢ÂêÉÈ¶ôËïâ„ÄÇ', scene: 'üêí Âä®Áâ©' },
                { en: 'This banana is yellow.', cn: 'Ëøô‰∏™È¶ôËïâÊòØÈªÑËâ≤ÁöÑ„ÄÇ', scene: 'üü° ÊèèËø∞È¢úËâ≤' },
                { en: 'I eat a banana for breakfast.', cn: 'ÊàëÊó©È§êÂêÉÈ¶ôËïâ„ÄÇ', scene: 'üçå Êó©È§ê' }
            ],
            'orange': [
                { en: 'I like oranges.', cn: 'ÊàëÂñúÊ¨¢Ê©òÂ≠ê„ÄÇ', scene: 'üçä ÂÅèÂ•Ω' },
                { en: 'The orange is sweet.', cn: 'Ëøô‰∏™Ê©òÂ≠êÂæàÁîú„ÄÇ', scene: 'üòã Âë≥ÈÅì' }
            ],
            'food': [
                { en: 'I like Chinese food.', cn: 'ÊàëÂñúÊ¨¢‰∏≠ÂõΩÈ£üÁâ©„ÄÇ', scene: 'üçú ÂÅèÂ•Ω' },
                { en: 'The food is delicious.', cn: 'ËøôÈ£üÁâ©ÂæàÂ•ΩÂêÉ„ÄÇ', scene: 'üòã ËØÑ‰ª∑' }
            ],
            'water': [
                { en: 'I drink water every day.', cn: 'ÊàëÊØèÂ§©ÈÉΩÂñùÊ∞¥„ÄÇ', scene: 'üíß Êó•Â∏∏‰π†ÊÉØ' },
                { en: 'Can I have some water?', cn: 'ÊàëÂèØ‰ª•ÂñùÁÇπÊ∞¥ÂêóÔºü', scene: 'ü•§ Âè£Ê∏¥' },
                { en: 'Water is important for us.', cn: 'Ê∞¥ÂØπÊàë‰ª¨ÂæàÈáçË¶Å„ÄÇ', scene: 'üíß ÂÅ•Â∫∑' }
            ],
            'milk': [
                { en: 'I drink milk for breakfast.', cn: 'ÊàëÊó©È§êÂñùÁâõÂ•∂„ÄÇ', scene: 'ü•õ Êó©È§êÊó∂Èó¥' },
                { en: 'Milk is good for your health.', cn: 'ÁâõÂ•∂ÂØπ‰Ω†ÁöÑÂÅ•Â∫∑ÊúâÁõä„ÄÇ', scene: 'üí™ ÂÅ•Â∫∑' },
                { en: 'This milk is white.', cn: 'ËøôÁâõÂ•∂ÊòØÁôΩËâ≤ÁöÑ„ÄÇ', scene: 'ü•õ ÊèèËø∞' }
            ],
            'bread': [
                { en: 'I eat bread for breakfast.', cn: 'ÊàëÊó©È§êÂêÉÈù¢ÂåÖ„ÄÇ', scene: 'üçû Êó©È§ê' },
                { en: 'The bread is soft.', cn: 'ËøôÈù¢ÂåÖÂæàËΩØ„ÄÇ', scene: 'üçû ÊèèËø∞' }
            ],
            'egg': [
                { en: 'I have an egg for breakfast.', cn: 'ÊàëÊó©È§êÂêÉ‰∏Ä‰∏™È∏°Ëõã„ÄÇ', scene: 'üç≥ Êó©È§ê' },
                { en: 'The hen lays eggs.', cn: 'ÊØçÈ∏°‰∏ãËõã„ÄÇ', scene: 'üêî Âä®Áâ©' }
            ],
            'rice': [
                { en: 'I like to eat rice.', cn: 'ÊàëÂñúÊ¨¢ÂêÉÁ±≥È•≠„ÄÇ', scene: 'üçö ÂÅèÂ•Ω' },
                { en: 'Rice is our main food.', cn: 'Á±≥È•≠ÊòØÊàë‰ª¨ÁöÑ‰∏ªÈ£ü„ÄÇ', scene: 'üçΩÔ∏è È•ÆÈ£ü' }
            ],
            // Âä®Áâ©
            'dog': [
                { en: 'I have a cute dog.', cn: 'ÊàëÊúâ‰∏ÄÂè™ÂèØÁà±ÁöÑÁãó„ÄÇ', scene: 'üêï ÂÆ†Áâ©' },
                { en: 'The dog is playing in the park.', cn: 'ÁãóÂú®ÂÖ¨Âõ≠ÈáåÁé©ËÄç„ÄÇ', scene: 'üå≥ ÂÖ¨Âõ≠Âú∫ÊôØ' },
                { en: 'Dogs are loyal friends.', cn: 'ÁãóÊòØÂø†ËØöÁöÑÊúãÂèã„ÄÇ', scene: 'üíï ÂèãË∞ä' },
                { en: 'My dog can run fast.', cn: 'ÊàëÁöÑÁãóË∑ëÂæóÂæàÂø´„ÄÇ', scene: 'üèÉ ËÉΩÂäõ' }
            ],
            'cat': [
                { en: 'The cat is sleeping on the sofa.', cn: 'Áå´Âú®Ê≤ôÂèë‰∏äÁù°Ëßâ„ÄÇ', scene: 'üò¥ ‰ºëÊÅØ' },
                { en: 'Cats like to catch mice.', cn: 'Áå´ÂñúÊ¨¢ÊäìËÄÅÈº†„ÄÇ', scene: 'üê≠ Âä®Áâ©‰π†ÊÄß' },
                { en: 'My cat is very cute.', cn: 'ÊàëÁöÑÁå´ÂæàÂèØÁà±„ÄÇ', scene: 'üòä ÂñúÁà±' }
            ],
            'bird': [
                { en: 'The bird can fly high in the sky.', cn: 'È∏üËÉΩÂú®Â§©Á©∫‰∏≠È£ûÂæóÂæàÈ´ò„ÄÇ', scene: '‚òÅÔ∏è Â§©Á©∫' },
                { en: 'I see a bird in the tree.', cn: 'ÊàëÁúãÂà∞Ê†ë‰∏äÊúâ‰∏ÄÂè™È∏ü„ÄÇ', scene: 'üå≥ ËßÇÂØü' },
                { en: 'The bird sings beautifully.', cn: 'ËøôÂè™È∏üÂî±ÂæóÂæàÂä®Âê¨„ÄÇ', scene: 'üéµ Â£∞Èü≥' }
            ],
            'fish': [
                { en: 'Fish swim in the water.', cn: 'È±ºÂú®Ê∞¥ÈáåÊ∏∏„ÄÇ', scene: 'üèä Âä®‰Ωú' },
                { en: 'I like to eat fish.', cn: 'ÊàëÂñúÊ¨¢ÂêÉÈ±º„ÄÇ', scene: 'üçΩÔ∏è È£üÁâ©' },
                { en: 'The fish is small.', cn: 'ËøôÊù°È±ºÂæàÂ∞è„ÄÇ', scene: 'üëÄ ÊèèËø∞' }
            ],
            'rabbit': [
                { en: 'The rabbit has long ears.', cn: 'ÂÖîÂ≠êÊúâÈïøËÄ≥Êúµ„ÄÇ', scene: 'üê∞ Â§ñË≤å' },
                { en: 'Rabbits like to eat carrots.', cn: 'ÂÖîÂ≠êÂñúÊ¨¢ÂêÉËÉ°ËêùÂçú„ÄÇ', scene: 'ü•ï È£üÁâ©' }
            ],
            'monkey': [
                { en: 'Monkeys live in the forest.', cn: 'Áå¥Â≠ê‰ΩèÂú®Ê£ÆÊûóÈáå„ÄÇ', scene: 'üå≤ Ê†ñÊÅØÂú∞' },
                { en: 'The monkey is climbing the tree.', cn: 'Áå¥Â≠êÊ≠£Âú®Áà¨Ê†ë„ÄÇ', scene: 'üå≥ Âä®‰Ωú' }
            ],
            'elephant': [
                { en: 'The elephant is very big.', cn: 'Â§ßË±°ÈùûÂ∏∏Â§ß„ÄÇ', scene: 'üëÄ ÊèèËø∞' },
                { en: 'Elephants have long noses.', cn: 'Â§ßË±°ÊúâÈïøÈïøÁöÑÈºªÂ≠ê„ÄÇ', scene: 'üêò Â§ñË≤å' }
            ],
            // ÊÉÖÁª™ÂíåÊÑüÂèó
            'happy': [
                { en: 'I am very happy today!', cn: 'Êàë‰ªäÂ§©ÂæàÂºÄÂøÉÔºÅ', scene: 'üòä Ë°®ËææÊÉÖÁª™' },
                { en: 'Happy birthday to you!', cn: 'Á•ù‰Ω†ÁîüÊó•Âø´‰πêÔºÅ', scene: 'üéÇ Á•ùÁ¶è' },
                { en: 'I feel happy when I play.', cn: 'ÊàëÁé©ÁöÑÊó∂ÂÄôÂæàÂºÄÂøÉ„ÄÇ', scene: 'üéÆ ÊÉÖÊôØ' }
            ],
            'sad': [
                { en: 'I feel sad when I lose my toy.', cn: 'Êàë‰∏¢‰∫ÜÁé©ÂÖ∑Êó∂ÊÑüÂà∞ÈöæËøá„ÄÇ', scene: 'üò¢ Â§±ËêΩ' },
                { en: "Don't be sad, my friend.", cn: 'Âà´ÈöæËøáÔºåÊàëÁöÑÊúãÂèã„ÄÇ', scene: 'ü§ó ÂÆâÊÖ∞' },
                { en: 'She looks sad today.', cn: 'Â•π‰ªäÂ§©ÁúãËµ∑Êù•Âæà‰º§ÂøÉ„ÄÇ', scene: 'üòî ÊèèËø∞' }
            ],
            'angry': [
                { en: 'Why are you angry?', cn: '‰Ω†‰∏∫‰ªÄ‰πàÁîüÊ∞îÔºü', scene: 'üò† ËØ¢ÈóÆÂéüÂõ†' },
                { en: 'I am not angry anymore.', cn: 'Êàë‰∏çÂÜçÁîüÊ∞î‰∫Ü„ÄÇ', scene: 'üòå ÂéüË∞Ö' },
                { en: 'He looks very angry.', cn: '‰ªñÁúãËµ∑Êù•ÂæàÁîüÊ∞î„ÄÇ', scene: 'üò† ÊèèËø∞' }
            ],
            'love': [
                { en: 'I love my parents.', cn: 'ÊàëÁà±ÊàëÁöÑÁà∂ÊØç„ÄÇ', scene: 'üíï Ë°®ËææÁà±' },
                { en: 'I love to read books.', cn: 'ÊàëÂñúÊ¨¢ËØª‰π¶„ÄÇ', scene: 'üìö Áà±Â•Ω' }
            ],
            'like': [
                { en: 'I like playing football.', cn: 'ÊàëÂñúÊ¨¢Ë∏¢Ë∂≥ÁêÉ„ÄÇ', scene: '‚öΩ Áà±Â•Ω' },
                { en: 'Do you like apples?', cn: '‰Ω†ÂñúÊ¨¢ËãπÊûúÂêóÔºü', scene: 'üçé ËØ¢ÈóÆ' }
            ],
            // Âä®‰Ωú
            'play': [
                { en: "Let's play together!", cn: 'Êàë‰ª¨‰∏ÄËµ∑Áé©ÂêßÔºÅ', scene: 'üéÆ ÈÇÄËØ∑' },
                { en: 'Children like to play games.', cn: 'Â≠©Â≠ê‰ª¨ÂñúÊ¨¢Áé©Ê∏∏Êàè„ÄÇ', scene: 'üéØ Â®±‰πê' },
                { en: 'I play football with friends.', cn: 'ÊàëÂíåÊúãÂèã‰∏ÄËµ∑Ë∏¢Ë∂≥ÁêÉ„ÄÇ', scene: '‚öΩ ËøêÂä®' }
            ],
            'run': [
                { en: 'I can run fast!', cn: 'ÊàëËÉΩË∑ëÂæóÂæàÂø´ÔºÅ', scene: 'üèÉ ËÉΩÂäõ' },
                { en: "Let's run to the park!", cn: 'Êàë‰ª¨Ë∑ëÂà∞ÂÖ¨Âõ≠ÂéªÂêßÔºÅ', scene: 'üå≥ Ê¥ªÂä®' },
                { en: 'The dog runs after the ball.', cn: 'ÁãóËøΩÁùÄÁêÉË∑ë„ÄÇ', scene: 'üêï Âä®‰Ωú' }
            ],
            'jump': [
                { en: 'The rabbit can jump high.', cn: 'ÂÖîÂ≠êËÉΩË∑≥ÂæóÂæàÈ´ò„ÄÇ', scene: 'üê∞ Âä®Áâ©' },
                { en: "Don't jump on the bed!", cn: '‰∏çË¶ÅÂú®Â∫ä‰∏äË∑≥ÔºÅ', scene: '‚ö†Ô∏è ÊèêÈÜí' },
                { en: 'I can jump like a frog.', cn: 'ÊàëËÉΩÂÉèÈùíËõô‰∏ÄÊ†∑Ë∑≥„ÄÇ', scene: 'üê∏ Ê∏∏Êàè' }
            ],
            'walk': [
                { en: 'I walk to school every day.', cn: 'ÊàëÊØèÂ§©Ëµ∞Ë∑ØÂéª‰∏äÂ≠¶„ÄÇ', scene: 'üö∂ Êó•Â∏∏' },
                { en: "Let's go for a walk.", cn: 'Êàë‰ª¨ÂéªÊï£Ê≠•Âêß„ÄÇ', scene: 'üå≥ Ê¥ªÂä®' }
            ],
            'eat': [
                { en: 'I eat breakfast at 7 o\'clock.', cn: 'Êàë7ÁÇπÂêÉÊó©È§ê„ÄÇ', scene: 'üïñ Êó∂Èó¥' },
                { en: 'What do you like to eat?', cn: '‰Ω†ÂñúÊ¨¢ÂêÉ‰ªÄ‰πàÔºü', scene: 'üçΩÔ∏è ËØ¢ÈóÆ' }
            ],
            'drink': [
                { en: 'I drink water after sports.', cn: 'ÊàëËøêÂä®ÂêéÂñùÊ∞¥„ÄÇ', scene: 'üíß ÂÅ•Â∫∑' },
                { en: 'Would you like something to drink?', cn: '‰Ω†ÊÉ≥ÂñùÁÇπ‰ªÄ‰πàÔºü', scene: 'ü•§ Á§ºË≤å' }
            ],
            'sleep': [
                { en: 'I sleep at 9 o\'clock.', cn: 'Êàë9ÁÇπÁù°Ëßâ„ÄÇ', scene: 'üï§ ‰ΩúÊÅØ' },
                { en: 'The baby is sleeping.', cn: 'ÂÆùÂÆùÊ≠£Âú®Áù°Ëßâ„ÄÇ', scene: 'üò¥ ÂÆâÈùô' }
            ],
            'watch': [
                { en: 'I watch TV on weekends.', cn: 'ÊàëÂë®Êú´ÁúãÁîµËßÜ„ÄÇ', scene: 'üì∫ Â®±‰πê' },
                { en: 'Watch me do this!', cn: 'ÁúãÊàëÂÅöËøô‰∏™ÔºÅ', scene: 'üëÄ Â±ïÁ§∫' }
            ],
            'listen': [
                { en: 'Listen to the teacher.', cn: 'Âê¨ËÄÅÂ∏àËÆ≤ËØæ„ÄÇ', scene: 'üëÇ ËØæÂ†Ç' },
                { en: 'I like to listen to music.', cn: 'ÊàëÂñúÊ¨¢Âê¨Èü≥‰πê„ÄÇ', scene: 'üéµ Áà±Â•Ω' }
            ],
            'speak': [
                { en: 'Can you speak English?', cn: '‰Ω†‰ºöËØ¥Ëã±ËØ≠ÂêóÔºü', scene: 'üó£Ô∏è ËØ¢ÈóÆ' },
                { en: 'Please speak louder.', cn: 'ËØ∑ËØ¥Â§ßÂ£∞ÁÇπ„ÄÇ', scene: 'üì¢ ËØ∑Ê±Ç' }
            ],
            // È¢úËâ≤
            'red': [
                { en: 'I like the red flower.', cn: 'ÊàëÂñúÊ¨¢ËøôÊúµÁ∫¢Ëä±„ÄÇ', scene: 'üå∏ ÂÅèÂ•Ω' },
                { en: 'The apple is red.', cn: 'Ëøô‰∏™ËãπÊûúÊòØÁ∫¢Ëâ≤ÁöÑ„ÄÇ', scene: 'üçé ÊèèËø∞' },
                { en: 'I wear a red hat.', cn: 'ÊàëÊà¥ÁùÄ‰∏ÄÈ°∂Á∫¢Â∏ΩÂ≠ê„ÄÇ', scene: 'üëí ÊúçË£Ö' }
            ],
            'blue': [
                { en: 'The sky is blue.', cn: 'Â§©Á©∫ÊòØËìùËâ≤ÁöÑ„ÄÇ', scene: '‚òÅÔ∏è Ëá™ÁÑ∂' },
                { en: 'I have a blue bag.', cn: 'ÊàëÊúâ‰∏Ä‰∏™ËìùËâ≤ÁöÑ‰π¶ÂåÖ„ÄÇ', scene: 'üéí Áâ©ÂìÅ' },
                { en: 'I like blue color.', cn: 'ÊàëÂñúÊ¨¢ËìùËâ≤„ÄÇ', scene: 'üíô ÂÅèÂ•Ω' }
            ],
            'green': [
                { en: 'The grass is green.', cn: 'ËçâÊòØÁªøËâ≤ÁöÑ„ÄÇ', scene: 'üåø Ëá™ÁÑ∂' },
                { en: 'I like green trees.', cn: 'ÊàëÂñúÊ¨¢ÁªøËâ≤ÁöÑÊ†ë„ÄÇ', scene: 'üå≤ ÂÅèÂ•Ω' }
            ],
            'yellow': [
                { en: 'The sun is yellow.', cn: 'Â§™Èò≥ÊòØÈªÑËâ≤ÁöÑ„ÄÇ', scene: '‚òÄÔ∏è Ëá™ÁÑ∂' },
                { en: 'I have a yellow pencil.', cn: 'ÊàëÊúâ‰∏ÄÊîØÈªÑËâ≤ÁöÑÈìÖÁ¨î„ÄÇ', scene: '‚úèÔ∏è Áâ©ÂìÅ' }
            ],
            'white': [
                { en: 'The snow is white.', cn: 'Èõ™ÊòØÁôΩËâ≤ÁöÑ„ÄÇ', scene: '‚ùÑÔ∏è Ëá™ÁÑ∂' },
                { en: 'I wear a white shirt.', cn: 'ÊàëÁ©øÁùÄ‰∏Ä‰ª∂ÁôΩË°¨Ë°´„ÄÇ', scene: 'üëï ÊúçË£Ö' }
            ],
            'black': [
                { en: 'My cat is black.', cn: 'ÊàëÁöÑÁå´ÊòØÈªëËâ≤ÁöÑ„ÄÇ', scene: 'üê± ÊèèËø∞' },
                { en: 'I have black hair.', cn: 'ÊàëÊúâÈªëËâ≤ÁöÑÂ§¥Âèë„ÄÇ', scene: 'üíá Â§ñË≤å' }
            ],
            // Êï∞Â≠ó
            'one': [
                { en: 'I have one book.', cn: 'ÊàëÊúâ‰∏ÄÊú¨‰π¶„ÄÇ', scene: 'üìñ Êï∞Èáè' },
                { en: 'Give me one apple.', cn: 'ÁªôÊàë‰∏Ä‰∏™ËãπÊûú„ÄÇ', scene: 'üçé ËØ∑Ê±Ç' }
            ],
            'two': [
                { en: 'I have two hands.', cn: 'ÊàëÊúâ‰∏§Âè™Êâã„ÄÇ', scene: 'üôå Ë∫´‰Ωì' },
                { en: 'I see two birds.', cn: 'ÊàëÁúãÂà∞‰∏§Âè™È∏ü„ÄÇ', scene: 'üêî ËßÇÂØü' }
            ],
            'three': [
                { en: 'I have three pencils.', cn: 'ÊàëÊúâ‰∏âÊîØÈìÖÁ¨î„ÄÇ', scene: '‚úèÔ∏è Êï∞Èáè' },
                { en: 'Count to three.', cn: 'Êï∞Âà∞‰∏â„ÄÇ', scene: 'üî¢ Ê∏∏Êàè' }
            ],
            // Â§©Ê∞î
            'sunny': [
                { en: 'It is sunny today.', cn: '‰ªäÂ§©Èò≥ÂÖâÊòéÂ™ö„ÄÇ', scene: '‚òÄÔ∏è Â§©Ê∞î' },
                { en: 'I like sunny days.', cn: 'ÊàëÂñúÊ¨¢Êô¥Â§©„ÄÇ', scene: 'üòä ÂÅèÂ•Ω' }
            ],
            'rainy': [
                { en: 'It is rainy today.', cn: '‰ªäÂ§©‰∏ãÈõ®„ÄÇ', scene: 'üåßÔ∏è Â§©Ê∞î' },
                { en: "I don't like rainy days.", cn: 'Êàë‰∏çÂñúÊ¨¢‰∏ãÈõ®Â§©„ÄÇ', scene: 'üòî ÂÅèÂ•Ω' }
            ],
            'windy': [
                { en: 'It is windy today.', cn: '‰ªäÂ§©ÊúâÈ£é„ÄÇ', scene: 'üí® Â§©Ê∞î' },
                { en: 'The wind is strong.', cn: 'È£éÂæàÂ§ß„ÄÇ', scene: 'üå¨Ô∏è ÊèèËø∞' }
            ],
            'hot': [
                { en: 'It is very hot today.', cn: '‰ªäÂ§©ÂæàÁÉ≠„ÄÇ', scene: 'üå°Ô∏è Â§©Ê∞î' },
                { en: "I drink cold water when it's hot.", cn: 'ÁÉ≠ÁöÑÊó∂ÂÄôÊàëÂñùÂáâÊ∞¥„ÄÇ', scene: 'üíß Â∫îÂØπ' }
            ],
            'cold': [
                { en: 'It is cold in winter.', cn: 'ÂÜ¨Â§©ÂæàÂÜ∑„ÄÇ', scene: '‚ùÑÔ∏è Â≠£ËäÇ' },
                { en: "I wear a coat when it's cold.", cn: 'ÂÜ∑ÁöÑÊó∂ÂÄôÊàëÁ©øÂ§ñÂ•ó„ÄÇ', scene: 'üß• Á©øË°£' }
            ],
            // Ëá™ÁÑ∂Âú∞ÁêÜ
            'hill': [
                { en: 'There is a small hill near my house.', cn: 'ÊàëÂÆ∂ÈôÑËøëÊúâ‰∏ÄÂ∫ßÂ∞èÂ±±„ÄÇ', scene: 'üè† ‰ΩçÁΩÆ' },
                { en: 'We climbed the hill to see the view.', cn: 'Êàë‰ª¨Áà¨‰∏äÂ∞èÂ±±ÁúãÈ£éÊôØ„ÄÇ', scene: 'üèûÔ∏è Ê¥ªÂä®' },
                { en: 'The hill is covered with green grass.', cn: 'Â±±‰∏äÈïøÊª°‰∫ÜÁªøËçâ„ÄÇ', scene: 'üåø ÊèèËø∞' },
                { en: 'You need to pick up speed to get up the hill.', cn: '‰Ω†ÈúÄË¶ÅÂä†Âø´ÈÄüÂ∫¶ÊâçËÉΩÁà¨‰∏äËøôÂ∫ßÂ±±„ÄÇ', scene: 'üö¥ ËøêÂä®' },
                { en: 'The park is sheltered from the wind by a hill to the east.', cn: 'ÂÖ¨Âõ≠‰∏úËæπÁöÑÂ∞èÂ±±Êå°‰Ωè‰∫ÜÈ£é„ÄÇ', scene: 'üå¨Ô∏è ÁéØÂ¢É' }
            ],
            'mountain': [
                { en: 'The mountain is very high.', cn: 'ËøôÂ∫ßÂ±±ÂæàÈ´ò„ÄÇ', scene: 'üèîÔ∏è ÊèèËø∞' },
                { en: 'We went hiking in the mountains.', cn: 'Êàë‰ª¨ÂéªÂ±±ÈáåÂæíÊ≠•ÊóÖË°å„ÄÇ', scene: 'ü•æ Ê¥ªÂä®' },
                { en: 'There is snow on the mountain top.', cn: 'Â±±È°∂ÊúâÈõ™„ÄÇ', scene: '‚ùÑÔ∏è ÊôØËßÇ' }
            ],
            // Ë∫´‰ΩìÈÉ®‰Ωç
            'eye': [
                { en: 'I have two eyes.', cn: 'ÊàëÊúâ‰∏§Âè™ÁúºÁùõ„ÄÇ', scene: 'üëÄ Ë∫´‰Ωì' },
                { en: 'Open your eyes.', cn: 'ÁùÅÂºÄ‰Ω†ÁöÑÁúºÁùõ„ÄÇ', scene: 'üëÄ Êåá‰ª§' }
            ],
            'ear': [
                { en: 'I have two ears.', cn: 'ÊàëÊúâ‰∏§Âè™ËÄ≥Êúµ„ÄÇ', scene: 'üëÇ Ë∫´‰Ωì' },
                { en: 'The rabbit has long ears.', cn: 'ÂÖîÂ≠êÊúâÈïøËÄ≥Êúµ„ÄÇ', scene: 'üê∞ Âä®Áâ©' }
            ],
            'nose': [
                { en: 'I have a small nose.', cn: 'ÊàëÊúâ‰∏Ä‰∏™Â∞èÈºªÂ≠ê„ÄÇ', scene: 'üëÉ Ë∫´‰Ωì' },
                { en: 'The dog has a wet nose.', cn: 'ÁãóÁöÑÈºªÂ≠êÊòØÊπøÁöÑ„ÄÇ', scene: 'üêï Âä®Áâ©' }
            ],
            'mouth': [
                { en: 'Open your mouth.', cn: 'Âº†ÂºÄ‰Ω†ÁöÑÂò¥„ÄÇ', scene: 'üëÑ Êåá‰ª§' },
                { en: 'I brush my teeth and clean my mouth.', cn: 'ÊàëÂà∑ÁâôÊ∏ÖÊ¥ÅÂè£ËÖî„ÄÇ', scene: 'ü¶∑ Âç´Áîü' }
            ],
            'hand': [
                { en: 'Wash your hands before eating.', cn: 'ÂêÉÈ•≠ÂâçË¶ÅÊ¥óÊâã„ÄÇ', scene: 'üßº Âç´Áîü' },
                { en: 'I raise my hand in class.', cn: 'ÊàëÂú®ËØæ‰∏ä‰∏æÊâã„ÄÇ', scene: 'üôã ËØæÂ†Ç' }
            ],
            'foot': [
                { en: 'I have two feet.', cn: 'ÊàëÊúâ‰∏§Âè™ËÑö„ÄÇ', scene: 'ü¶∂ Ë∫´‰Ωì' },
                { en: 'My foot hurts.', cn: 'ÊàëÁöÑËÑöÁñº„ÄÇ', scene: 'üò£ ÁñºÁóõ' }
            ],
            // Êõ¥Â§öÂü∫Á°ÄËØçÊ±á
            'good': [
                { en: 'You are a good student.', cn: '‰Ω†ÊòØ‰∏™Â•ΩÂ≠¶Áîü„ÄÇ', scene: '‚≠ê Ë°®Êâ¨' },
                { en: 'This is a good book.', cn: 'ËøôÊòØ‰∏ÄÊú¨Â•Ω‰π¶„ÄÇ', scene: 'üìö ËØÑ‰ª∑' },
                { en: 'Good morning!', cn: 'Êó©‰∏äÂ•ΩÔºÅ', scene: 'üåÖ ÈóÆÂÄô' }
            ],
            'bad': [
                { en: 'This is bad weather.', cn: 'ËøôÊòØÂùèÂ§©Ê∞î„ÄÇ', scene: 'üåßÔ∏è Â§©Ê∞î' },
                { en: "Don't feel bad.", cn: 'Âà´ÈöæËøá„ÄÇ', scene: 'üòä ÂÆâÊÖ∞' }
            ],
            'big': [
                { en: 'The elephant is very big.', cn: 'Â§ßË±°ÈùûÂ∏∏Â§ß„ÄÇ', scene: 'üêò ÊèèËø∞' },
                { en: 'I have a big family.', cn: 'ÊàëÊúâ‰∏Ä‰∏™Â§ßÂÆ∂Â∫≠„ÄÇ', scene: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ ÂÆ∂Â∫≠' }
            ],
            'small': [
                { en: 'The bird is small.', cn: 'ËøôÂè™È∏üÂæàÂ∞è„ÄÇ', scene: 'üê¶ ÊèèËø∞' },
                { en: 'I have small hands.', cn: 'ÊàëÁöÑÊâãÂæàÂ∞è„ÄÇ', scene: 'üë∂ Ë∫´‰Ωì' }
            ],
            'new': [
                { en: 'I have a new book.', cn: 'ÊàëÊúâ‰∏ÄÊú¨Êñ∞‰π¶„ÄÇ', scene: 'üìö Áâ©ÂìÅ' },
                { en: 'Happy New Year!', cn: 'Êñ∞Âπ¥Âø´‰πêÔºÅ', scene: 'üéâ Á•ùÁ¶è' }
            ],
            'old': [
                { en: 'My grandfather is old.', cn: 'ÊàëÁà∑Áà∑ËÄÅ‰∫Ü„ÄÇ', scene: 'üë¥ Âπ¥ÈæÑ' },
                { en: 'This is an old book.', cn: 'ËøôÊòØ‰∏ÄÊú¨Êóß‰π¶„ÄÇ', scene: 'üìö Áâ©ÂìÅ' }
            ],
            'yes': [
                { en: 'Yes, I can.', cn: 'ÊòØÁöÑÔºåÊàëÂèØ‰ª•„ÄÇ', scene: '‚úÖ ÂõûÁ≠î' },
                { en: 'Yes, please.', cn: 'Â•ΩÁöÑÔºåË∞¢Ë∞¢„ÄÇ', scene: 'üòä Á§ºË≤å' }
            ],
            'no': [
                { en: 'No, thank you.', cn: '‰∏çÔºåË∞¢Ë∞¢„ÄÇ', scene: 'üôè ÊãíÁªù' },
                { en: 'No smoking.', cn: 'Á¶ÅÊ≠¢Âê∏ÁÉü„ÄÇ', scene: 'üö´ ËßÑÂàô' }
            ],
            // Êó•Â∏∏Ê¥ªÂä®
            'eat': [
                { en: 'I eat breakfast at 7 o\'clock.', cn: 'Êàë7ÁÇπÂêÉÊó©È§ê„ÄÇ', scene: 'üïñ Êó∂Èó¥' },
                { en: 'What do you like to eat?', cn: '‰Ω†ÂñúÊ¨¢ÂêÉ‰ªÄ‰πàÔºü', scene: 'üçΩÔ∏è ËØ¢ÈóÆ' },
                { en: 'Don\'t eat in class.', cn: '‰∏çË¶ÅÂú®ËØæ‰∏äÂêÉ‰∏úË•ø„ÄÇ', scene: 'üö´ ËßÑÂàô' }
            ],
            'drink': [
                { en: 'I drink water after sports.', cn: 'ÊàëËøêÂä®ÂêéÂñùÊ∞¥„ÄÇ', scene: 'üíß ÂÅ•Â∫∑' },
                { en: 'Would you like something to drink?', cn: '‰Ω†ÊÉ≥ÂñùÁÇπ‰ªÄ‰πàÔºü', scene: 'ü•§ Á§ºË≤å' }
            ],
            'sleep': [
                { en: 'I sleep at 9 o\'clock.', cn: 'Êàë9ÁÇπÁù°Ëßâ„ÄÇ', scene: 'üï§ ‰ΩúÊÅØ' },
                { en: 'The baby is sleeping.', cn: 'ÂÆùÂÆùÊ≠£Âú®Áù°Ëßâ„ÄÇ', scene: 'üò¥ ÂÆâÈùô' }
            ],
            'watch': [
                { en: 'I watch TV on weekends.', cn: 'ÊàëÂë®Êú´ÁúãÁîµËßÜ„ÄÇ', scene: 'üì∫ Â®±‰πê' },
                { en: 'Watch me do this!', cn: 'ÁúãÊàëÂÅöËøô‰∏™ÔºÅ', scene: 'üëÄ Â±ïÁ§∫' }
            ],
            'listen': [
                { en: 'Listen to the teacher.', cn: 'Âê¨ËÄÅÂ∏àËÆ≤ËØæ„ÄÇ', scene: 'üëÇ ËØæÂ†Ç' },
                { en: 'I like to listen to music.', cn: 'ÊàëÂñúÊ¨¢Âê¨Èü≥‰πê„ÄÇ', scene: 'üéµ Áà±Â•Ω' }
            ],
            'speak': [
                { en: 'Can you speak English?', cn: '‰Ω†‰ºöËØ¥Ëã±ËØ≠ÂêóÔºü', scene: 'üó£Ô∏è ËØ¢ÈóÆ' },
                { en: 'Please speak louder.', cn: 'ËØ∑ËØ¥Â§ßÂ£∞ÁÇπ„ÄÇ', scene: 'üì¢ ËØ∑Ê±Ç' }
            ],
            'talk': [
                { en: 'Let\'s talk about books.', cn: 'Êàë‰ª¨Ë∞àË∞à‰π¶Âêß„ÄÇ', scene: 'üí¨ ÂØπËØù' },
                { en: 'Don\'t talk in class.', cn: '‰∏çË¶ÅÂú®ËØæ‰∏äËØ¥ËØù„ÄÇ', scene: 'üö´ ËßÑÂàô' }
            ],
            'think': [
                { en: 'Let me think.', cn: 'ËÆ©ÊàëÊÉ≥ÊÉ≥„ÄÇ', scene: 'ü§î ÊÄùËÄÉ' },
                { en: 'I think this is good.', cn: 'ÊàëËßâÂæóËøôÂæàÂ•Ω„ÄÇ', scene: 'üí≠ ÊÑèËßÅ' }
            ],
            'know': [
                { en: 'I know the answer.', cn: 'ÊàëÁü•ÈÅìÁ≠îÊ°à„ÄÇ', scene: '‚úÖ Áü•ËØÜ' },
                { en: 'Do you know this word?', cn: '‰Ω†Áü•ÈÅìËøô‰∏™ËØçÂêóÔºü', scene: '‚ùì ËØ¢ÈóÆ' }
            ],
            'understand': [
                { en: 'I understand now.', cn: 'ÊàëÁé∞Âú®ÊòéÁôΩ‰∫Ü„ÄÇ', scene: 'üí° ÁêÜËß£' },
                { en: 'Do you understand?', cn: '‰Ω†ÊòéÁôΩÂêóÔºü', scene: '‚ùì ËØ¢ÈóÆ' }
            ],
            'help': [
                { en: 'Can you help me?', cn: '‰Ω†ËÉΩÂ∏ÆÊàëÂêóÔºü', scene: 'üôè ËØ∑Ê±Ç' },
                { en: 'I help my mother at home.', cn: 'ÊàëÂú®ÂÆ∂Â∏ÆÂ¶àÂ¶à„ÄÇ', scene: 'üßπ ÂÆ∂Âä°' }
            ],
            'work': [
                { en: 'My father works hard.', cn: 'ÊàëÁà∏Áà∏Â∑•‰ΩúÂæàÂä™Âäõ„ÄÇ', scene: 'üíº Â∑•‰Ωú' },
                { en: 'Let\'s work together.', cn: 'ËÆ©Êàë‰ª¨‰∏ÄËµ∑Â∑•‰ΩúÂêß„ÄÇ', scene: 'ü§ù Âêà‰Ωú' }
            ],
            // Â≠¶‰π†Áõ∏ÂÖ≥
            'learn': [
                { en: 'I learn new words every day.', cn: 'ÊàëÊØèÂ§©Â≠¶Êñ∞ÂçïËØç„ÄÇ', scene: 'üìö Â≠¶‰π†' },
                { en: 'We learn English at school.', cn: 'Êàë‰ª¨Âú®Â≠¶Ê†°Â≠¶Ëã±ËØ≠„ÄÇ', scene: 'üè´ Â≠¶Ê†°' }
            ],
            'study': [
                { en: 'I study English every day.', cn: 'ÊàëÊØèÂ§©ÈÉΩÂ≠¶Ëã±ËØ≠„ÄÇ', scene: 'üìö Â≠¶‰π†' },
                { en: 'Let\'s study together.', cn: 'Êàë‰ª¨‰∏ÄËµ∑Â≠¶‰π†Âêß„ÄÇ', scene: 'ü§ù Âêà‰Ωú' }
            ],
            'test': [
                { en: 'I have a test tomorrow.', cn: 'ÊàëÊòéÂ§©ÊúâËÄÉËØï„ÄÇ', scene: 'üìù ËÄÉËØï' },
                { en: 'Good luck on your test!', cn: 'Á•ù‰Ω†ËÄÉËØïÂ•ΩËøêÔºÅ', scene: 'üçÄ Á•ùÁ¶è' }
            ],
            'homework': [
                { en: 'I do my homework after dinner.', cn: 'ÊàëÊôöÈ•≠ÂêéÂÅö‰Ωú‰∏ö„ÄÇ', scene: 'üìù ‰Ωú‰∏ö' },
                { en: 'This is my homework.', cn: 'ËøôÊòØÊàëÁöÑ‰Ωú‰∏ö„ÄÇ', scene: 'üìö Â≠¶Ê†°' }
            ],
            'class': [
                { en: 'Class begins at 8 o\'clock.', cn: '8ÁÇπÂºÄÂßã‰∏äËØæ„ÄÇ', scene: 'üè´ Êó∂Èó¥' },
                { en: 'Be quiet in class.', cn: 'Âú®ËØæ‰∏ä‰øùÊåÅÂÆâÈùô„ÄÇ', scene: 'ü§´ ËßÑÂàô' }
            ],
            // Êó∂Èó¥Áõ∏ÂÖ≥
            'today': [
                { en: 'What day is today?', cn: '‰ªäÂ§©ÊòØÊòüÊúüÂá†Ôºü', scene: 'üìÖ ËØ¢ÈóÆ' },
                { en: 'I am happy today.', cn: 'Êàë‰ªäÂ§©ÂæàÂºÄÂøÉ„ÄÇ', scene: 'üòä ÊÉÖÁª™' }
            ],
            'tomorrow': [
                { en: 'See you tomorrow!', cn: 'ÊòéÂ§©ËßÅÔºÅ', scene: 'üëã ÂëäÂà´' },
                { en: 'Tomorrow is Monday.', cn: 'ÊòéÂ§©ÊòØÊòüÊúü‰∏Ä„ÄÇ', scene: 'üìÖ ÊòüÊúü' }
            ],
            'yesterday': [
                { en: 'Yesterday was Sunday.', cn: 'Êò®Â§©ÊòØÊòüÊúüÊó•„ÄÇ', scene: 'üìÖ ÊòüÊúü' },
                { en: 'I went to the park yesterday.', cn: 'ÊàëÊò®Â§©Âéª‰∫ÜÂÖ¨Âõ≠„ÄÇ', scene: 'üå≥ ÂõûÂøÜ' }
            ],
            'morning': [
                { en: 'Good morning, Mom!', cn: 'Êó©‰∏äÂ•ΩÔºåÂ¶àÂ¶àÔºÅ', scene: 'üåÖ ÈóÆÂÄô' },
                { en: 'I exercise in the morning.', cn: 'ÊàëÊó©‰∏äÈîªÁÇº„ÄÇ', scene: 'üèÉ ËøêÂä®' }
            ],
            'afternoon': [
                { en: 'Good afternoon!', cn: '‰∏ãÂçàÂ•ΩÔºÅ', scene: 'üåû ÈóÆÂÄô' },
                { en: 'I rest in the afternoon.', cn: 'Êàë‰∏ãÂçà‰ºëÊÅØ„ÄÇ', scene: 'üò¥ ‰ºëÊÅØ' }
            ],
            'evening': [
                { en: 'Good evening!', cn: 'Êôö‰∏äÂ•ΩÔºÅ', scene: 'üåô ÈóÆÂÄô' },
                { en: 'I do homework in the evening.', cn: 'ÊàëÊôö‰∏äÂÅö‰Ωú‰∏ö„ÄÇ', scene: 'üìù Â≠¶‰π†' }
            ],
            'night': [
                { en: 'Good night!', cn: 'ÊôöÂÆâÔºÅ', scene: 'üåô ÈÅìÊôöÂÆâ' },
                { en: 'I sleep at night.', cn: 'ÊàëÊôö‰∏äÁù°Ëßâ„ÄÇ', scene: 'üò¥ ‰ΩúÊÅØ' }
            ],
            // Âú∞ÁÇπÂíåÊñπ‰Ωç
            'here': [
                { en: 'Come here, please.', cn: 'ËØ∑Êù•ËøôÈáå„ÄÇ', scene: 'üëâ ÊåáÁ§∫' },
                { en: 'I live here.', cn: 'Êàë‰ΩèÂú®ËøôÈáå„ÄÇ', scene: 'üè† ‰ΩçÁΩÆ' }
            ],
            'there': [
                { en: 'Look over there!', cn: 'ÁúãÈÇ£ËæπÔºÅ', scene: 'üëÄ ÊåáÁ§∫' },
                { en: 'The cat is over there.', cn: 'Áå´Âú®ÈÇ£Ëæπ„ÄÇ', scene: 'üê± ‰ΩçÁΩÆ' }
            ],
            'where': [
                { en: 'Where is my book?', cn: 'ÊàëÁöÑ‰π¶Âú®Âì™ÈáåÔºü', scene: '‚ùì ËØ¢ÈóÆ' },
                { en: 'Where are you going?', cn: '‰Ω†Ë¶ÅÂéªÂì™ÈáåÔºü', scene: '‚ùì ËØ¢ÈóÆ' }
            ],
            'what': [
                { en: 'What is this?', cn: 'ËøôÊòØ‰ªÄ‰πàÔºü', scene: '‚ùì ËØ¢ÈóÆ' },
                { en: 'What time is it?', cn: 'Âá†ÁÇπ‰∫ÜÔºü', scene: 'üïê ËØ¢ÈóÆ' }
            ],
            'when': [
                { en: 'When do we start?', cn: 'Êàë‰ª¨‰ªÄ‰πàÊó∂ÂÄôÂºÄÂßãÔºü', scene: '‚ùì ËØ¢ÈóÆ' },
                { en: 'When is your birthday?', cn: '‰Ω†ÁöÑÁîüÊó•ÊòØ‰ªÄ‰πàÊó∂ÂÄôÔºü', scene: 'üéÇ ËØ¢ÈóÆ' }
            ],
            'who': [
                { en: 'Who is that?', cn: 'ÈÇ£ÊòØË∞ÅÔºü', scene: '‚ùì ËØ¢ÈóÆ' },
                { en: 'Who is your teacher?', cn: '‰Ω†ÁöÑËÄÅÂ∏àÊòØË∞ÅÔºü', scene: 'üë©‚Äçüè´ ËØ¢ÈóÆ' }
            ],
            'why': [
                { en: 'Why are you late?', cn: '‰Ω†‰∏∫‰ªÄ‰πàËøüÂà∞Ôºü', scene: '‚ùì ËØ¢ÈóÆ' },
                { en: 'Why do you like this?', cn: '‰Ω†‰∏∫‰ªÄ‰πàÂñúÊ¨¢Ëøô‰∏™Ôºü', scene: '‚ùì ËØ¢ÈóÆ' }
            ],
            'how': [
                { en: 'How are you?', cn: '‰Ω†Â•ΩÂêóÔºü', scene: 'üëã ÈóÆÂÄô' },
                { en: 'How do you spell this?', cn: 'Ëøô‰∏™ÊÄé‰πàÊãºÂÜôÔºü', scene: 'üî§ ËØ¢ÈóÆ' }
            ],
            // Ëá™ÁÑ∂
            'sun': [
                { en: 'The sun is bright.', cn: 'Â§™Èò≥ÂæàÊòé‰∫Æ„ÄÇ', scene: '‚òÄÔ∏è ÊèèËø∞' },
                { en: 'The sun rises in the east.', cn: 'Â§™Èò≥‰ªé‰∏úÊñπÂçáËµ∑„ÄÇ', scene: 'üåÖ Ëá™ÁÑ∂' }
            ],
            'moon': [
                { en: 'The moon is round.', cn: 'Êúà‰∫ÆÊòØÂúÜÁöÑ„ÄÇ', scene: 'üåô ÊèèËø∞' },
                { en: 'I can see the moon at night.', cn: 'Êôö‰∏äÊàëÂèØ‰ª•ÁúãÂà∞Êúà‰∫Æ„ÄÇ', scene: 'üåÉ ËßÇÂØü' }
            ],
            'star': [
                { en: 'The stars are beautiful.', cn: 'ÊòüÊòüÂæàÁæé„ÄÇ', scene: '‚ú® Â§úÁ©∫' },
                { en: 'Twinkle, twinkle, little star.', cn: '‰∏ÄÈó™‰∏ÄÈó™‰∫ÆÊô∂Êô∂„ÄÇ', scene: 'üéµ Á´•Ë∞£' }
            ],
            'sky': [
                { en: 'The sky is blue.', cn: 'Â§©Á©∫ÊòØËìùËâ≤ÁöÑ„ÄÇ', scene: '‚òÅÔ∏è Â§©Á©∫' },
                { en: 'Birds fly in the sky.', cn: 'È∏üÂú®Â§©Á©∫‰∏≠È£û„ÄÇ', scene: 'üê¶ Ëá™ÁÑ∂' }
            ],
            'cloud': [
                { en: 'The cloud is white.', cn: '‰∫ëÊòØÁôΩËâ≤ÁöÑ„ÄÇ', scene: '‚òÅÔ∏è ÊèèËø∞' },
                { en: 'There are many clouds today.', cn: '‰ªäÂ§©ÊúâÂæàÂ§ö‰∫ë„ÄÇ', scene: '‚òÅÔ∏è Â§©Ê∞î' }
            ],
            'rain': [
                { en: 'It is raining today.', cn: '‰ªäÂ§©Âú®‰∏ãÈõ®„ÄÇ', scene: 'üåßÔ∏è Â§©Ê∞î' },
                { en: 'I like to walk in the rain.', cn: 'ÊàëÂñúÊ¨¢Âú®Èõ®‰∏≠Êï£Ê≠•„ÄÇ', scene: 'üö∂ ÂñúÂ•Ω' }
            ],
            'snow': [
                { en: 'Look at the snow!', cn: 'ÁúãÈõ™ÔºÅ', scene: '‚ùÑÔ∏è ÂÜ¨Â§©' },
                { en: 'The snow is white.', cn: 'Èõ™ÊòØÁôΩËâ≤ÁöÑ„ÄÇ', scene: '‚õÑ ÊèèËø∞' }
            ],
            'wind': [
                { en: 'The wind is strong.', cn: 'È£éÂæàÂ§ß„ÄÇ', scene: 'üí® Â§©Ê∞î' },
                { en: 'The wind blows my hat.', cn: 'È£éÂêπËµ∞‰∫ÜÊàëÁöÑÂ∏ΩÂ≠ê„ÄÇ', scene: 'üé© ÊÉÖÊôØ' }
            ],
            'tree': [
                { en: 'This is a big tree.', cn: 'ËøôÊòØ‰∏ÄÊ£µÂ§ßÊ†ë„ÄÇ', scene: 'üå≥ ÊèèËø∞' },
                { en: 'Birds live in the tree.', cn: 'È∏ü‰ΩèÂú®Ê†ë‰∏ä„ÄÇ', scene: 'üê¶ Ëá™ÁÑ∂' }
            ],
            'flower': [
                { en: 'The flower is beautiful.', cn: 'Ëä±ÂæàÁæé„ÄÇ', scene: 'üå∏ ÊèèËø∞' },
                { en: 'I like red flowers.', cn: 'ÊàëÂñúÊ¨¢Á∫¢Ëä±„ÄÇ', scene: 'üå∫ ÂÅèÂ•Ω' }
            ],
            'grass': [
                { en: 'The grass is green.', cn: 'ËçâÊòØÁªøËâ≤ÁöÑ„ÄÇ', scene: 'üåø ÊèèËø∞' },
                { en: 'Don\'t walk on the grass.', cn: '‰∏çË¶ÅË∏©ËçâÂù™„ÄÇ', scene: '‚ö†Ô∏è ÊèêÈÜí' }
            ],
            'mountain': [
                { en: 'The mountain is high.', cn: 'Â±±ÂæàÈ´ò„ÄÇ', scene: '‚õ∞Ô∏è ÊèèËø∞' },
                { en: 'We climb the mountain.', cn: 'Êàë‰ª¨Áà¨Â±±„ÄÇ', scene: 'üßó ËøêÂä®' }
            ],
            'river': [
                { en: 'The river is long.', cn: 'Ê≤≥ÂæàÈïø„ÄÇ', scene: 'üåä ÊèèËø∞' },
                { en: 'Fish swim in the river.', cn: 'È±ºÂú®Ê≤≥ÈáåÊ∏∏„ÄÇ', scene: 'üêü Ëá™ÁÑ∂' }
            ],
            'sea': [
                { en: 'The sea is blue.', cn: 'Â§ßÊµ∑ÊòØËìùËâ≤ÁöÑ„ÄÇ', scene: 'üåä Êµ∑Ê¥ã' },
                { en: 'I love the sea.', cn: 'ÊàëÁà±Â§ßÊµ∑„ÄÇ', scene: 'üíï ÂñúÁà±' }
            ],
            // ÂüéÂ∏Ç
            'city': [
                { en: 'I live in a big city.', cn: 'Êàë‰ΩèÂú®Â§ßÂüéÂ∏Ç„ÄÇ', scene: 'üèôÔ∏è Â±Ö‰Ωè' },
                { en: 'The city is busy.', cn: 'ÂüéÂ∏ÇÂæàÁπÅÂøô„ÄÇ', scene: 'üöó ÊèèËø∞' }
            ],
            'street': [
                { en: 'This is my street.', cn: 'ËøôÊòØÊàëÁöÑË°óÈÅì„ÄÇ', scene: 'üõ£Ô∏è ‰ΩçÁΩÆ' },
                { en: 'Cross the street carefully.', cn: 'Â∞èÂøÉËøáÈ©¨Ë∑Ø„ÄÇ', scene: '‚ö†Ô∏è ÂÆâÂÖ®' }
            ],
            'park': [
                { en: 'Let\'s go to the park!', cn: 'Êàë‰ª¨ÂéªÂÖ¨Âõ≠ÂêßÔºÅ', scene: 'üå≥ ÈÇÄËØ∑' },
                { en: 'I play in the park.', cn: 'ÊàëÂú®ÂÖ¨Âõ≠Áé©„ÄÇ', scene: 'üéÆ Ê¥ªÂä®' }
            ],
            'shop': [
                { en: 'I go to the shop.', cn: 'ÊàëÂéªÂïÜÂ∫ó„ÄÇ', scene: 'üè™ Ë¥≠Áâ©' },
                { en: 'This is a book shop.', cn: 'ËøôÊòØ‰∏ÄÂÆ∂‰π¶Â∫ó„ÄÇ', scene: 'üìö Â∫óÈì∫' }
            ],
            // ÊúçË£Ö
            'clothes': [
                { en: 'I wear clean clothes.', cn: 'ÊàëÁ©øÂπ≤ÂáÄÁöÑË°£Êúç„ÄÇ', scene: 'üëî Á©øÁùÄ' },
                { en: 'Put on your clothes.', cn: 'Á©ø‰∏ä‰Ω†ÁöÑË°£Êúç„ÄÇ', scene: 'üëï Êåá‰ª§' }
            ],
            'shirt': [
                { en: 'This is my blue shirt.', cn: 'ËøôÊòØÊàëÁöÑËìùË°¨Ë°´„ÄÇ', scene: 'üëï ÊúçË£Ö' },
                { en: 'I wear a white shirt.', cn: 'ÊàëÁ©øÁùÄÁôΩË°¨Ë°´„ÄÇ', scene: 'üë¥ Á©øÁùÄ' }
            ],
            'shoe': [
                { en: 'These are my shoes.', cn: 'ËøôÊòØÊàëÁöÑÈûãÂ≠ê„ÄÇ', scene: 'üëü Áâ©ÂìÅ' },
                { en: 'Put on your shoes.', cn: 'Á©ø‰∏ä‰Ω†ÁöÑÈûãÂ≠ê„ÄÇ', scene: 'üëû Êåá‰ª§' }
            ],
            'hat': [
                { en: 'I wear a hat in summer.', cn: 'ÊàëÂ§èÂ§©Êà¥Â∏ΩÂ≠ê„ÄÇ', scene: '‚òÄÔ∏è Èò≤Êôí' },
                { en: 'This is a red hat.', cn: 'ËøôÊòØ‰∏ÄÈ°∂Á∫¢Â∏ΩÂ≠ê„ÄÇ', scene: 'üé® ÊèèËø∞' }
            ],
            'coat': [
                { en: 'I wear a coat in winter.', cn: 'ÊàëÂÜ¨Â§©Á©øÂ§ñÂ•ó„ÄÇ', scene: 'üß• ‰øùÊöñ' },
                { en: 'Put on your coat.', cn: 'Á©ø‰∏ä‰Ω†ÁöÑÂ§ñÂ•ó„ÄÇ', scene: 'üëî Êåá‰ª§' }
            ],
            'dress': [
                { en: 'She wears a red dress.', cn: 'Â•πÁ©øÁùÄÁ∫¢Ë£ôÂ≠ê„ÄÇ', scene: 'üëó Á©øÁùÄ' },
                { en: 'This dress is beautiful.', cn: 'ËøôÊù°Ë£ôÂ≠êÂæàÁæé„ÄÇ', scene: '‚ú® ËµûÁæé' }
            ],
            'pants': [
                { en: 'These are my pants.', cn: 'ËøôÊòØÊàëÁöÑË£§Â≠ê„ÄÇ', scene: 'üëñ Áâ©ÂìÅ' },
                { en: 'I wear black pants.', cn: 'ÊàëÁ©øÁùÄÈªëË£§Â≠ê„ÄÇ', scene: 'üëî Á©øÁùÄ' }
            ],
            'skirt': [
                { en: 'She wears a blue skirt.', cn: 'Â•πÁ©øÁùÄËìùË£ôÂ≠ê„ÄÇ', scene: 'üëó Á©øÁùÄ' },
                { en: 'This skirt is short.', cn: 'ËøôÊù°Ë£ôÂ≠êÂæàÁü≠„ÄÇ', scene: 'üëÄ ÊèèËø∞' }
            ],
            // Â≠¶‰π†Áî®ÂìÅ
            'bag': [
                { en: 'This is my school bag.', cn: 'ËøôÊòØÊàëÁöÑ‰π¶ÂåÖ„ÄÇ', scene: 'üéí Áâ©ÂìÅ' },
                { en: 'I carry books in my bag.', cn: 'ÊàëÂú®ÂåÖÈáåË£Ö‰π¶„ÄÇ', scene: 'üìö Áî®ÈÄî' }
            ],
            'desk': [
                { en: 'This is my desk.', cn: 'ËøôÊòØÊàëÁöÑ‰π¶Ê°å„ÄÇ', scene: 'ü™ë Áâ©ÂìÅ' },
                { en: 'I sit at my desk.', cn: 'ÊàëÂùêÂú®‰π¶Ê°åÂâç„ÄÇ', scene: 'üëß ‰ΩçÁΩÆ' }
            ],
            'chair': [
                { en: 'Sit on your chair.', cn: 'ÂùêÂú®‰Ω†ÁöÑÊ§ÖÂ≠ê‰∏ä„ÄÇ', scene: 'ü™ë Êåá‰ª§' },
                { en: 'This is a comfortable chair.', cn: 'ËøôÊòØ‰∏ÄÊääËàíÈÄÇÁöÑÊ§ÖÂ≠ê„ÄÇ', scene: 'ü™ë ÊèèËø∞' }
            ],
            'paper': [
                { en: 'Give me some paper.', cn: 'ÁªôÊàë‰∏Ä‰∫õÁ∫∏„ÄÇ', scene: 'üìÑ ËØ∑Ê±Ç' },
                { en: 'I write on paper.', cn: 'ÊàëÂú®Á∫∏‰∏äÂÜôÂ≠ó„ÄÇ', scene: '‚úçÔ∏è Âä®‰Ωú' }
            ],
            'ruler': [
                { en: 'This is my ruler.', cn: 'ËøôÊòØÊàëÁöÑÂ∞∫Â≠ê„ÄÇ', scene: 'üìè Áâ©ÂìÅ' },
                { en: 'Measure with your ruler.', cn: 'Áî®‰Ω†ÁöÑÂ∞∫Â≠êÊµãÈáè„ÄÇ', scene: 'üìè Êåá‰ª§' }
            ],
            'eraser': [
                { en: 'I use an eraser.', cn: 'ÊàëÁî®Ê©°ÁöÆÊì¶„ÄÇ', scene: '‚úèÔ∏è Â∑•ÂÖ∑' },
                { en: 'Do you have an eraser?', cn: '‰Ω†ÊúâÊ©°ÁöÆÂêóÔºü', scene: '‚ùì ËØ¢ÈóÆ' }
            ],
            // ËøêÂä®
            'sport': [
                { en: 'I like sports.', cn: 'ÊàëÂñúÊ¨¢ËøêÂä®„ÄÇ', scene: '‚öΩ Áà±Â•Ω' },
                { en: 'Football is my favorite sport.', cn: 'Ë∂≥ÁêÉÊòØÊàëÊúÄÂñúÊ¨¢ÁöÑËøêÂä®„ÄÇ', scene: '‚öΩ ÂÅèÂ•Ω' }
            ],
            'ball': [
                { en: 'This is a football.', cn: 'ËøôÊòØ‰∏Ä‰∏™Ë∂≥ÁêÉ„ÄÇ', scene: '‚öΩ Áâ©ÂìÅ' },
                { en: 'Throw the ball to me.', cn: 'ÊääÁêÉÊâîÁªôÊàë„ÄÇ', scene: 'üéæ Êåá‰ª§' }
            ],
            'football': [
                { en: 'I play football.', cn: 'ÊàëË∏¢Ë∂≥ÁêÉ„ÄÇ', scene: '‚öΩ ËøêÂä®' },
                { en: 'This is my football.', cn: 'ËøôÊòØÊàëÁöÑË∂≥ÁêÉ„ÄÇ', scene: '‚öΩ Áâ©ÂìÅ' }
            ],
            'basketball': [
                { en: 'I play basketball.', cn: 'ÊàëÊâìÁØÆÁêÉ„ÄÇ', scene: 'üèÄ ËøêÂä®' },
                { en: 'Basketball is fun.', cn: 'ÁØÆÁêÉÂæàÊúâË∂£„ÄÇ', scene: 'üèÄ ÊÑüÂèó' }
            ],
            'swim': [
                { en: 'I can swim.', cn: 'Êàë‰ºöÊ∏∏Ê≥≥„ÄÇ', scene: 'üèä ËÉΩÂäõ' },
                { en: 'Let\'s go swimming!', cn: 'Êàë‰ª¨ÂéªÊ∏∏Ê≥≥ÂêßÔºÅ', scene: 'üèä ÈÇÄËØ∑' }
            ],
            'dance': [
                { en: 'I like to dance.', cn: 'ÊàëÂñúÊ¨¢Ë∑≥Ëàû„ÄÇ', scene: 'üíÉ Áà±Â•Ω' },
                { en: 'Let\'s dance together!', cn: 'ËÆ©Êàë‰ª¨‰∏ÄËµ∑Ë∑≥ËàûÔºÅ', scene: 'üíÉ ÈÇÄËØ∑' }
            ],
            'sing': [
                { en: 'I like to sing.', cn: 'ÊàëÂñúÊ¨¢Âî±Ê≠å„ÄÇ', scene: 'üé§ Áà±Â•Ω' },
                { en: 'Sing a song for us.', cn: '‰∏∫Êàë‰ª¨Âî±È¶ñÊ≠å„ÄÇ', scene: 'üéµ ËØ∑Ê±Ç' }
            ],
            // ‰∫§ÈÄöÂ∑•ÂÖ∑
            'car': [
                { en: 'This is my father\'s car.', cn: 'ËøôÊòØÊàëÁà∏Áà∏ÁöÑËΩ¶„ÄÇ', scene: 'üöó Áâ©ÂìÅ' },
                { en: 'We go by car.', cn: 'Êàë‰ª¨ÂùêËΩ¶Âéª„ÄÇ', scene: 'üöó ‰∫§ÈÄö' }
            ],
            'bus': [
                { en: 'I go to school by bus.', cn: 'ÊàëÂùêÂÖ¨‰∫§ËΩ¶ÂéªÂ≠¶Ê†°„ÄÇ', scene: 'üöå ‰∫§ÈÄö' },
                { en: 'The bus is coming.', cn: 'ÂÖ¨‰∫§ËΩ¶Êù•‰∫Ü„ÄÇ', scene: 'üöå Á≠âÂæÖ' }
            ],
            'train': [
                { en: 'The train is fast.', cn: 'ÁÅ´ËΩ¶ÂæàÂø´„ÄÇ', scene: 'üöÜ ÊèèËø∞' },
                { en: 'We go there by train.', cn: 'Êàë‰ª¨ÂùêÁÅ´ËΩ¶ÂéªÈÇ£Èáå„ÄÇ', scene: 'üöÜ ‰∫§ÈÄö' }
            ],
            'plane': [
                { en: 'The plane flies high.', cn: 'È£ûÊú∫È£ûÂæóÂæàÈ´ò„ÄÇ', scene: '‚úàÔ∏è ÊèèËø∞' },
                { en: 'We go by plane.', cn: 'Êàë‰ª¨ÂùêÈ£ûÊú∫Âéª„ÄÇ', scene: '‚úàÔ∏è ‰∫§ÈÄö' }
            ],
            'bike': [
                { en: 'This is my bike.', cn: 'ËøôÊòØÊàëÁöÑËá™Ë°åËΩ¶„ÄÇ', scene: 'üö≤ Áâ©ÂìÅ' },
                { en: 'I ride my bike to school.', cn: 'ÊàëÈ™ëËá™Ë°åËΩ¶ÂéªÂ≠¶Ê†°„ÄÇ', scene: 'üö≤ ‰∫§ÈÄö' }
            ],
            'bicycle': [
                { en: 'I have a red bicycle.', cn: 'ÊàëÊúâ‰∏ÄËæÜÁ∫¢Ëâ≤Ëá™Ë°åËΩ¶„ÄÇ', scene: 'üö≤ Áâ©ÂìÅ' },
                { en: 'Ride a bicycle.', cn: 'È™ëËá™Ë°åËΩ¶„ÄÇ', scene: 'üö≤ Âä®‰Ωú' }
            ],
            'boat': [
                { en: 'The boat is on the river.', cn: 'ËàπÂú®Ê≤≥‰∏ä„ÄÇ', scene: '‚õµ ÊèèËø∞' },
                { en: 'We go by boat.', cn: 'Êàë‰ª¨ÂùêËàπÂéª„ÄÇ', scene: '‚õµ ‰∫§ÈÄö' }
            ],
            // ÊàøÈó¥
            'room': [
                { en: 'This is my room.', cn: 'ËøôÊòØÊàëÁöÑÊàøÈó¥„ÄÇ', scene: 'üè† ‰ªãÁªç' },
                { en: 'Clean your room.', cn: 'ÊâìÊâ´‰Ω†ÁöÑÊàøÈó¥„ÄÇ', scene: 'üßπ Ë¶ÅÊ±Ç' }
            ],
            'bedroom': [
                { en: 'This is my bedroom.', cn: 'ËøôÊòØÊàëÁöÑÂçßÂÆ§„ÄÇ', scene: 'üõèÔ∏è ‰ΩçÁΩÆ' },
                { en: 'I sleep in my bedroom.', cn: 'ÊàëÂú®ÂçßÂÆ§Áù°Ëßâ„ÄÇ', scene: 'üò¥ ‰ΩúÊÅØ' }
            ],
            'kitchen': [
                { en: 'Mother cooks in the kitchen.', cn: 'Â¶àÂ¶àÂú®Âé®ÊàøÂÅöÈ•≠„ÄÇ', scene: 'üç≥ Ê¥ªÂä®' },
                { en: 'This is a big kitchen.', cn: 'ËøôÊòØ‰∏Ä‰∏™Â§ßÂé®Êàø„ÄÇ', scene: 'üè† ÊèèËø∞' }
            ],
            'bathroom': [
                { en: 'I wash my hands in the bathroom.', cn: 'ÊàëÂú®Êµ¥ÂÆ§Ê¥óÊâã„ÄÇ', scene: 'üöø Âç´Áîü' },
                { en: 'Clean the bathroom.', cn: 'ÊâìÊâ´Êµ¥ÂÆ§„ÄÇ', scene: 'üßπ ÂÆ∂Âä°' }
            ],
            // ÂÆ∂ÂÖ∑
            'bed': [
                { en: 'This is my bed.', cn: 'ËøôÊòØÊàëÁöÑÂ∫ä„ÄÇ', scene: 'üõèÔ∏è Áâ©ÂìÅ' },
                { en: 'Go to bed early.', cn: 'Êó©ÁÇπÁù°Ëßâ„ÄÇ', scene: 'üò¥ Âª∫ËÆÆ' }
            ],
            'table': [
                { en: 'This is the dinner table.', cn: 'ËøôÊòØÈ§êÊ°å„ÄÇ', scene: 'üçΩÔ∏è Áâ©ÂìÅ' },
                { en: 'Set the table.', cn: 'ÊëÜÂ•ΩÈ§êÊ°å„ÄÇ', scene: 'üçΩÔ∏è ÂÆ∂Âä°' }
            ],
            'sofa': [
                { en: 'I sit on the sofa.', cn: 'ÊàëÂùêÂú®Ê≤ôÂèë‰∏ä„ÄÇ', scene: 'üõãÔ∏è ‰ΩçÁΩÆ' },
                { en: 'The cat is on the sofa.', cn: 'Áå´Âú®Ê≤ôÂèë‰∏ä„ÄÇ', scene: 'üê± Âú∫ÊôØ' }
            ],
            // ËÅå‰∏ö
            'doctor': [
                { en: 'The doctor helps sick people.', cn: 'ÂåªÁîüÂ∏ÆÂä©ÁóÖ‰∫∫„ÄÇ', scene: 'üë®‚Äç‚öïÔ∏è ËÅå‰∏ö' },
                { en: 'I want to be a doctor.', cn: 'ÊàëÊÉ≥ÂΩìÂåªÁîü„ÄÇ', scene: 'üë®‚Äç‚öïÔ∏è ÁêÜÊÉ≥' }
            ],
            'nurse': [
                { en: 'The nurse is kind.', cn: 'Êä§Â£´Âæà‰∫≤Âàá„ÄÇ', scene: 'üë© ËÅå‰∏ö' },
                { en: 'Nurses work in hospitals.', cn: 'Êä§Â£´Âú®ÂåªÈô¢Â∑•‰Ωú„ÄÇ', scene: 'üè• Â∑•‰Ωú' }
            ],
            'driver': [
                { en: 'The bus driver is friendly.', cn: 'ÂÖ¨‰∫§ËΩ¶Âè∏Êú∫ÂæàÂèãÂ•Ω„ÄÇ', scene: 'üöå ËÅå‰∏ö' },
                { en: 'My father is a driver.', cn: 'ÊàëÁà∏Áà∏ÊòØÂè∏Êú∫„ÄÇ', scene: 'üöó ËÅå‰∏ö' }
            ],
            'cook': [
                { en: 'The cook makes delicious food.', cn: 'Âé®Â∏àÂÅöÁöÑÈ•≠ÂæàÂ•ΩÂêÉ„ÄÇ', scene: 'üë®‚Äçüç≥ ËÅå‰∏ö' },
                { en: 'I like to cook.', cn: 'ÊàëÂñúÊ¨¢ÂÅöÈ•≠„ÄÇ', scene: 'üç≥ Áà±Â•Ω' }
            ],
            'police': [
                { en: 'The police officer helps people.', cn: 'Ë≠¶ÂØüÂ∏ÆÂä©‰∫∫‰ª¨„ÄÇ', scene: 'üëÆ ËÅå‰∏ö' },
                { en: 'Police officers protect us.', cn: 'Ë≠¶ÂØü‰øùÊä§Êàë‰ª¨„ÄÇ', scene: 'üëÆ ÂÆâÂÖ®' }
            ],
            'worker': [
                { en: 'Workers build houses.', cn: 'Â∑•‰∫∫ÁõñÊàøÂ≠ê„ÄÇ', scene: 'üèóÔ∏è Â∑•‰Ωú' },
                { en: 'My father is a worker.', cn: 'ÊàëÁà∏Áà∏ÊòØÂ∑•‰∫∫„ÄÇ', scene: 'üë∑ ËÅå‰∏ö' }
            ],
            'farmer': [
                { en: 'Farmers grow food.', cn: 'ÂÜúÊ∞ëÁßçÊ§çÈ£üÁâ©„ÄÇ', scene: 'üåæ ËÅå‰∏ö' },
                { en: 'The farmer has a tractor.', cn: 'ÂÜúÊ∞ëÊúâÊãñÊãâÊú∫„ÄÇ', scene: 'üöúÔ∏è Â∑•ÂÖ∑' }
            ],
            // ÂÖ∂‰ªñÂ∏∏Áî®ËØç
            'friend': [
                { en: 'She is my best friend.', cn: 'Â•πÊòØÊàëÊúÄÂ•ΩÁöÑÊúãÂèã„ÄÇ', scene: 'üíï ÂèãË∞ä' },
                { en: 'We are good friends.', cn: 'Êàë‰ª¨ÊòØÂ•ΩÊúãÂèã„ÄÇ', scene: 'ü§ù ÂÖ≥Á≥ª' }
            ],
            'people': [
                { en: 'Many people are here.', cn: 'ÂæàÂ§ö‰∫∫Âú®ËøôÈáå„ÄÇ', scene: 'üë• ÊèèËø∞' },
                { en: 'People are friendly.', cn: '‰∫∫‰ª¨ÂæàÂèãÂ•Ω„ÄÇ', scene: 'üòä ÊÄßÊ†º' }
            ],
            'name': [
                { en: 'What is your name?', cn: '‰Ω†Âè´‰ªÄ‰πàÂêçÂ≠óÔºü', scene: '‚ùì ËØ¢ÈóÆ' },
                { en: 'My name is Tom.', cn: 'ÊàëÂè´Ê±§ÂßÜ„ÄÇ', scene: 'üìù ‰ªãÁªç' }
            ],
            'thing': [
                { en: 'What is that thing?', cn: 'ÈÇ£‰∏™‰∏úË•øÊòØ‰ªÄ‰πàÔºü', scene: '‚ùì ËØ¢ÈóÆ' },
                { en: 'This thing is heavy.', cn: 'Ëøô‰∏™‰∏úË•øÂæàÈáç„ÄÇ', scene: 'üì¶ ÊèèËø∞' }
            ],
            'something': [
                { en: 'I want something to eat.', cn: 'ÊàëÊÉ≥ÂêÉÁÇπ‰∏úË•ø„ÄÇ', scene: 'üçΩÔ∏è ÊÉ≥Ë¶Å' },
                { en: 'Something is wrong.', cn: 'Êúâ‰∫õ‰∏çÂØπÂä≤„ÄÇ', scene: '‚ùì ÊÑüËßâ' }
            ],
            'everything': [
                { en: 'Everything is okay.', cn: '‰∏ÄÂàáÈÉΩÂ•Ω„ÄÇ', scene: '‚úÖ Áä∂ÊÄÅ' },
                { en: 'I love everything here.', cn: 'ÊàëÂñúÊ¨¢ËøôÈáåÁöÑ‰∏ÄÂàá„ÄÇ', scene: 'üíï ÂñúÁà±' }
            ],
            'nothing': [
                { en: 'There is nothing to do.', cn: 'Ê≤°‰ªÄ‰πàÂèØÂÅöÁöÑ„ÄÇ', scene: 'üò¥ Êó†ËÅä' },
                { en: 'I see nothing.', cn: 'Êàë‰ªÄ‰πà‰πüÊ≤°ÁúãÂà∞„ÄÇ', scene: 'üëÄ ËßÇÂØü' }
            ],
            'very': [
                { en: 'It is very hot today.', cn: '‰ªäÂ§©ÂæàÁÉ≠„ÄÇ', scene: 'üå°Ô∏è Â§©Ê∞î' },
                { en: 'You are very kind.', cn: '‰Ω†Âæà‰∫≤Âàá„ÄÇ', scene: 'üòä ËµûÁæé' }
            ],
            'too': [
                { en: 'It\'s too hot.', cn: 'Â§™ÁÉ≠‰∫Ü„ÄÇ', scene: 'üå°Ô∏è ÊÑüÂèó' },
                { en: 'I want it too.', cn: 'Êàë‰πüÊÉ≥Ë¶Å„ÄÇ', scene: 'üòã ÊÉ≥Ë¶Å' }
            ],
            'all': [
                { en: 'All the students are here.', cn: 'ÊâÄÊúâÂ≠¶ÁîüÈÉΩÂú®ËøôÈáå„ÄÇ', scene: 'üë• ÂÖ®ÈÉ®' },
                { en: 'I like all colors.', cn: 'ÊàëÂñúÊ¨¢ÊâÄÊúâÈ¢úËâ≤„ÄÇ', scene: 'üåà ÂÅèÂ•Ω' }
            ],
            'some': [
                { en: 'I want some water.', cn: 'ÊàëÊÉ≥Ë¶ÅÁÇπÊ∞¥„ÄÇ', scene: 'üíß ËØ∑Ê±Ç' },
                { en: 'Give me some apples.', cn: 'ÁªôÊàë‰∏Ä‰∫õËãπÊûú„ÄÇ', scene: 'üçé ËØ∑Ê±Ç' }
            ],
            'many': [
                { en: 'I have many friends.', cn: 'ÊàëÊúâÂæàÂ§öÊúãÂèã„ÄÇ', scene: 'üë• Êï∞Èáè' },
                { en: 'There are many books.', cn: 'ÊúâÂæàÂ§ö‰π¶„ÄÇ', scene: 'üìö Êï∞Èáè' }
            ],
            'much': [
                { en: 'Thank you very much.', cn: 'ÈùûÂ∏∏ÊÑüË∞¢„ÄÇ', scene: 'üôè ÊÑüË∞¢' },
                { en: 'There is so much food.', cn: 'ÊúâËøô‰πàÂ§öÈ£üÁâ©„ÄÇ', scene: 'üçΩÔ∏è Êï∞Èáè' }
            ],
            // ËÆ°ÁÆóÊú∫Áõ∏ÂÖ≥
            'computer': [
                { en: 'I use a computer for homework.', cn: 'ÊàëÁî®ÁîµËÑëÂÅö‰Ωú‰∏ö„ÄÇ', scene: 'üíª Â≠¶‰π†' },
                { en: 'Computers are smart.', cn: 'ÁîµËÑëÂæàËÅ™Êòé„ÄÇ', scene: 'ü§ñ ÊèèËø∞' },
                { en: 'I play games on the computer.', cn: 'ÊàëÂú®ÁîµËÑë‰∏äÁé©Ê∏∏Êàè„ÄÇ', scene: 'üéÆ Â®±‰πê' }
            ],
            'phone': [
                { en: 'This is my phone.', cn: 'ËøôÊòØÊàëÁöÑÊâãÊú∫„ÄÇ', scene: 'üì± Áâ©ÂìÅ' },
                { en: 'I call my mother on the phone.', cn: 'ÊàëÁªôÂ¶àÂ¶àÊâìÁîµËØù„ÄÇ', scene: 'üìû ÈÄöËÆØ' }
            ],
            'internet': [
                { en: 'I use the internet for study.', cn: 'ÊàëÁî®‰∫íËÅîÁΩëÂ≠¶‰π†„ÄÇ', scene: 'üåê Â≠¶‰π†' },
                { en: 'The internet is fast.', cn: 'ÁΩëÈÄüÂæàÂø´„ÄÇ', scene: 'üåê ÊèèËø∞' }
            ],
            'game': [
                { en: 'I like computer games.', cn: 'ÊàëÂñúÊ¨¢ÁîµËÑëÊ∏∏Êàè„ÄÇ', scene: 'üéÆ Ê∏∏Êàè' },
                { en: 'Let\'s play a game.', cn: 'Êàë‰ª¨Áé©‰∏™Ê∏∏ÊàèÂêß„ÄÇ', scene: 'üéÆ ÈÇÄËØ∑' }
            ],
            'music': [
                { en: 'I like music.', cn: 'ÊàëÂñúÊ¨¢Èü≥‰πê„ÄÇ', scene: 'üéµ Áà±Â•Ω' },
                { en: 'Listen to music.', cn: 'Âê¨Èü≥‰πê„ÄÇ', scene: 'üéµ Ê¥ªÂä®' }
            ],
            'song': [
                { en: 'This is my favorite song.', cn: 'ËøôÊòØÊàëÊúÄÂñúÊ¨¢ÁöÑÊ≠å„ÄÇ', scene: 'üéµ Èü≥‰πê' },
                { en: 'Sing a song.', cn: 'Âî±È¶ñÊ≠å„ÄÇ', scene: 'üé§ Ê¥ªÂä®' }
            ],
            'video': [
                { en: 'I watch videos online.', cn: 'ÊàëÁúãÂú®Á∫øËßÜÈ¢ë„ÄÇ', scene: 'üì∫ Â®±‰πê' },
                { en: 'This video is interesting.', cn: 'Ëøô‰∏™ËßÜÈ¢ëÂæàÊúâË∂£„ÄÇ', scene: 'üé• ËØÑ‰ª∑' }
            ],
            'picture': [
                { en: 'Draw a picture.', cn: 'Áîª‰∏ÄÂπÖÁîª„ÄÇ', scene: 'üé® Ê¥ªÂä®' },
                { en: 'This is a nice picture.', cn: 'ËøôÊòØ‰∏ÄÂπÖÂ•ΩÁúãÁöÑÁîª„ÄÇ', scene: 'üñºÔ∏è ËØÑ‰ª∑' }
            ],
            'photo': [
                { en: 'Take a photo.', cn: 'ÊãçÂº†ÁÖßÁâá„ÄÇ', scene: 'üì∑ Ê¥ªÂä®' },
                { en: 'This is my photo.', cn: 'ËøôÊòØÊàëÁöÑÁÖßÁâá„ÄÇ', scene: 'üì∑ Áâ©ÂìÅ' }
            ],
            // Êï∞Èáè
            'one': [
                { en: 'I have one book.', cn: 'ÊàëÊúâ‰∏ÄÊú¨‰π¶„ÄÇ', scene: 'üìñ Êï∞Èáè' },
                { en: 'Give me one apple.', cn: 'ÁªôÊàë‰∏Ä‰∏™ËãπÊûú„ÄÇ', scene: 'üçé ËØ∑Ê±Ç' }
            ],
            'two': [
                { en: 'I have two hands.', cn: 'ÊàëÊúâ‰∏§Âè™Êâã„ÄÇ', scene: 'üôå Ë∫´‰Ωì' },
                { en: 'I see two birds.', cn: 'ÊàëÁúãÂà∞‰∏§Âè™È∏ü„ÄÇ', scene: 'üêî ËßÇÂØü' }
            ],
            'three': [
                { en: 'I have three pencils.', cn: 'ÊàëÊúâ‰∏âÊîØÈìÖÁ¨î„ÄÇ', scene: '‚úèÔ∏è Êï∞Èáè' },
                { en: 'Count to three.', cn: 'Êï∞Âà∞‰∏â„ÄÇ', scene: 'üî¢ Ê∏∏Êàè' }
            ],
            'four': [
                { en: 'I have four sisters.', cn: 'ÊàëÊúâÂõõ‰∏™ÂßêÂ¶π„ÄÇ', scene: 'üëß ÂÆ∂Â∫≠' },
                { en: 'There are four seasons.', cn: 'ÊúâÂõõ‰∏™Â≠£ËäÇ„ÄÇ', scene: 'üçÇ Áü•ËØÜ' }
            ],
            'five': [
                { en: 'I have five fingers.', cn: 'ÊàëÊúâ‰∫î‰∏™ÊâãÊåá„ÄÇ', scene: '‚úã Ë∫´‰Ωì' },
                { en: 'Give me five!', cn: 'ÂáªÊéåÔºÅ', scene: 'üôå Ê∏∏Êàè' }
            ],
            'six': [
                { en: 'I am six years old.', cn: 'ÊàëÂÖ≠Â≤Å‰∫Ü„ÄÇ', scene: 'üéÇ Âπ¥ÈæÑ' },
                { en: 'Six plus six is twelve.', cn: 'ÂÖ≠Âä†ÂÖ≠Á≠â‰∫éÂçÅ‰∫å„ÄÇ', scene: '‚ûï Êï∞Â≠¶' }
            ],
            'seven': [
                { en: 'There are seven days in a week.', cn: '‰∏ÄÂë®Êúâ‰∏ÉÂ§©„ÄÇ', scene: 'üìÖ Áü•ËØÜ' },
                { en: 'I get up at seven.', cn: 'Êàë7ÁÇπËµ∑Â∫ä„ÄÇ', scene: '‚è∞ Êó∂Èó¥' }
            ],
            'eight': [
                { en: 'I go to school at eight.', cn: 'Êàë8ÁÇπÂéª‰∏äÂ≠¶„ÄÇ', scene: 'üè´ ‰ΩúÊÅØ' },
                { en: 'Eight minus three is five.', cn: 'ÂÖ´Âáè‰∏âÁ≠â‰∫é‰∫î„ÄÇ', scene: '‚ûñ Êï∞Â≠¶' }
            ],
            'nine': [
                { en: 'I go to bed at nine.', cn: 'Êàë9ÁÇπÁù°Ëßâ„ÄÇ', scene: 'üåô ‰ΩúÊÅØ' },
                { en: 'Nine plus one is ten.', cn: '‰πùÂä†‰∏ÄÁ≠â‰∫éÂçÅ„ÄÇ', scene: '‚ûï Êï∞Â≠¶' }
            ],
            'ten': [
                { en: 'I can count to ten.', cn: 'ÊàëËÉΩÊï∞Âà∞ÂçÅ„ÄÇ', scene: 'üî¢ ËÉΩÂäõ' },
                { en: 'Ten minus one is nine.', cn: 'ÂçÅÂáè‰∏ÄÁ≠â‰∫é‰πù„ÄÇ', scene: '‚ûñ Êï∞Â≠¶' }
            ],
            'number': [
                { en: 'What is your phone number?', cn: '‰Ω†ÁöÑÁîµËØùÂè∑Á†ÅÊòØÂ§öÂ∞ëÔºü', scene: 'üìû ËØ¢ÈóÆ' },
                { en: 'I know many numbers.', cn: 'ÊàëËÆ§ËØÜÂæàÂ§öÊï∞Â≠ó„ÄÇ', scene: 'üî¢ Áü•ËØÜ' }
            ],
            // ÂÖ∂‰ªñ
            'morning': [
                { en: 'Good morning!', cn: 'Êó©‰∏äÂ•ΩÔºÅ', scene: 'üåÖ ÈóÆÂÄô' },
                { en: 'I exercise in the morning.', cn: 'ÊàëÊó©‰∏äÈîªÁÇº„ÄÇ', scene: 'üèÉ ËøêÂä®' }
            ],
            'afternoon': [
                { en: 'Good afternoon!', cn: '‰∏ãÂçàÂ•ΩÔºÅ', scene: 'üåû ÈóÆÂÄô' },
                { en: 'I rest in the afternoon.', cn: 'Êàë‰∏ãÂçà‰ºëÊÅØ„ÄÇ', scene: 'üò¥ ‰ºëÊÅØ' }
            ]
        };

        // Ëé∑ÂèñÂú∫ÊôØÂè•Â≠ê
        function getSceneSentences(word) {
            const wordLower = word.toLowerCase();
            const sentences = sceneSentences[wordLower];

            if (sentences && sentences.length > 0) {
                return sentences;
            }

            // Â¶ÇÊûúÊ≤°ÊúâÈ¢ÑËÆæÂú∫ÊôØÔºåËøîÂõûÁ©∫Êï∞ÁªÑ
            return [];
        }

        // È¢ÑËÆæ‰∏≠ÊñáÈáä‰πâÊï∞ÊçÆÂ∫ìÔºàÂ∏∏Áî®ÂçïËØçÁöÑ‰∏≠ÊñáÈáä‰πâÔºâ
        const presetChineseMeanings = {
            // Âü∫Á°ÄËØçÊ±á
            'hello': '‰Ω†Â•Ω',
            'hi': 'Âó®',
            'thank': 'ÊÑüË∞¢',
            'please': 'ËØ∑',
            'sorry': 'ÂØπ‰∏çËµ∑',
            'excuse': 'ÂéüË∞Ö',
            'welcome': 'Ê¨¢Ëøé',

            // Â≠¶Ê†°Â≠¶‰π†
            'school': 'Â≠¶Ê†°',
            'teacher': 'ËÄÅÂ∏à',
            'student': 'Â≠¶Áîü',
            'book': '‰π¶',
            'pencil': 'ÈìÖÁ¨î',
            'pen': 'Èí¢Á¨î',
            'read': 'ËØª„ÄÅÈòÖËØª',
            'write': 'ÂÜô„ÄÅ‰π¶ÂÜô',
            'learn': 'Â≠¶‰π†',
            'study': 'Â≠¶‰π†„ÄÅÁ†îÁ©∂',
            'test': 'ËÄÉËØï„ÄÅÊµãËØï',
            'homework': 'ÂÆ∂Â∫≠‰Ωú‰∏ö',
            'class': 'Áè≠Á∫ß„ÄÅËØæ',
            'lesson': 'ËØæÁ®ã',

            // ÂÆ∂Â∫≠
            'family': 'ÂÆ∂Â∫≠',
            'mother': 'Â¶àÂ¶à„ÄÅÊØç‰∫≤',
            'father': 'Áà∏Áà∏„ÄÅÁà∂‰∫≤',
            'parent': 'Áà∂ÊØç„ÄÅÂÆ∂Èïø',
            'brother': 'ÂÖÑÂºü„ÄÅÂì•Âì•„ÄÅÂºüÂºü',
            'sister': 'ÂßêÂ¶π„ÄÅÂßêÂßê„ÄÅÂ¶πÂ¶π',
            'home': 'ÂÆ∂',
            'house': 'ÊàøÂ≠ê„ÄÅ‰ΩèÂÆÖ',

            // È£üÁâ©
            'apple': 'ËãπÊûú',
            'banana': 'È¶ôËïâ',
            'orange': 'Ê©ôÂ≠ê„ÄÅÊ©òÂ≠ê',
            'food': 'È£üÁâ©',
            'water': 'Ê∞¥',
            'milk': 'ÁâõÂ•∂',
            'bread': 'Èù¢ÂåÖ',
            'egg': 'È∏°Ëõã',
            'rice': 'Á±≥È•≠„ÄÅÂ§ßÁ±≥',
            'meat': 'ËÇâ',
            'fish': 'È±º',
            'chicken': 'È∏°ËÇâ„ÄÅÈ∏°',
            'fruit': 'Ê∞¥Êûú',
            'vegetable': 'Ëî¨Ëèú',

            // Âä®Áâ©
            'dog': 'Áãó',
            'cat': 'Áå´',
            'bird': 'È∏ü',
            'fish': 'È±º',
            'rabbit': 'ÂÖîÂ≠ê',
            'monkey': 'Áå¥Â≠ê',
            'elephant': 'Â§ßË±°',
            'tiger': 'ËÄÅËôé',
            'lion': 'ÁãÆÂ≠ê',
            'panda': 'ÁÜäÁå´',
            'animal': 'Âä®Áâ©',

            // ÊÉÖÁª™
            'happy': 'Âø´‰πêÁöÑ„ÄÅÂπ∏Á¶èÁöÑ',
            'sad': 'ÊÇ≤‰º§ÁöÑ„ÄÅÈöæËøáÁöÑ',
            'angry': 'ÁîüÊ∞îÁöÑ„ÄÅÊÑ§ÊÄíÁöÑ',
            'love': 'Áà±„ÄÅÂñúÁà±',
            'like': 'ÂñúÊ¨¢',
            'hate': 'ËÆ®Âéå„ÄÅÊÅ®',
            'afraid': 'ÂÆ≥ÊÄïÁöÑ',
            'worried': 'ÊãÖÂøÉÁöÑ',
            'excited': 'ÂÖ¥Â•ãÁöÑ',
            'tired': 'Á¥ØÁöÑ„ÄÅÁñ≤ÂÄ¶ÁöÑ',

            // Âä®‰Ωú
            'play': 'Áé©„ÄÅÁé©ËÄç',
            'run': 'Ë∑ë„ÄÅÂ•îË∑ë',
            'walk': 'Ëµ∞„ÄÅËµ∞Ë∑Ø',
            'jump': 'Ë∑≥„ÄÅË∑≥Ë∑É',
            'eat': 'ÂêÉ',
            'drink': 'Âñù',
            'sleep': 'Áù°Ëßâ',
            'watch': 'ËßÇÁúã„ÄÅÁúã',
            'listen': 'Âê¨',
            'speak': 'ËØ¥„ÄÅËÆ≤ËØù',
            'talk': 'Ë∞àËØù„ÄÅËØ¥ËØù',
            'see': 'ÁúãËßÅ',
            'look': 'Áúã„ÄÅÁûß',
            'think': 'ÊÉ≥„ÄÅÊÄùËÄÉ',
            'know': 'Áü•ÈÅì„ÄÅ‰∫ÜËß£',
            'understand': 'ÁêÜËß£„ÄÅÊòéÁôΩ',
            'help': 'Â∏ÆÂä©',
            'work': 'Â∑•‰Ωú',
            'study': 'Â≠¶‰π†',

            // È¢úËâ≤
            'red': 'Á∫¢Ëâ≤ÁöÑ',
            'blue': 'ËìùËâ≤ÁöÑ',
            'green': 'ÁªøËâ≤ÁöÑ',
            'yellow': 'ÈªÑËâ≤ÁöÑ',
            'white': 'ÁôΩËâ≤ÁöÑ',
            'black': 'ÈªëËâ≤ÁöÑ',
            'orange': 'Ê©ôËâ≤ÁöÑ',
            'pink': 'Á≤âËâ≤ÁöÑ',
            'purple': 'Á¥´Ëâ≤ÁöÑ',
            'brown': 'Ê£ïËâ≤ÁöÑ',
            'color': 'È¢úËâ≤',

            // Êï∞Â≠ó
            'one': '‰∏Ä',
            'two': '‰∫å',
            'three': '‰∏â',
            'four': 'Âõõ',
            'five': '‰∫î',
            'six': 'ÂÖ≠',
            'seven': '‰∏É',
            'eight': 'ÂÖ´',
            'nine': '‰πù',
            'ten': 'ÂçÅ',
            'number': 'Êï∞Â≠ó',

            // Â§©Ê∞î
            'sunny': 'Êô¥ÊúóÁöÑ„ÄÅÈò≥ÂÖâÊòéÂ™öÁöÑ',
            'rainy': '‰∏ãÈõ®ÁöÑ„ÄÅÂ§öÈõ®ÁöÑ',
            'windy': 'ÊúâÈ£éÁöÑ',
            'cloudy': 'Â§ö‰∫ëÁöÑ„ÄÅÈò¥Â§©ÁöÑ',
            'hot': 'ÁÉ≠ÁöÑ',
            'cold': 'ÂÜ∑ÁöÑ',
            'warm': 'Ê∏©ÊöñÁöÑ',
            'cool': 'ÂáâÁàΩÁöÑ',
            'weather': 'Â§©Ê∞î',

            // Ë∫´‰ΩìÈÉ®‰Ωç
            'eye': 'ÁúºÁùõ',
            'ear': 'ËÄ≥Êúµ',
            'nose': 'ÈºªÂ≠ê',
            'mouth': 'Âò¥Â∑¥',
            'hand': 'Êâã',
            'foot': 'ËÑö',
            'head': 'Â§¥',
            'hair': 'Â§¥Âèë',
            'face': 'ËÑ∏',
            'body': 'Ë∫´‰Ωì',

            // Êó∂Èó¥
            'today': '‰ªäÂ§©',
            'tomorrow': 'ÊòéÂ§©',
            'yesterday': 'Êò®Â§©',
            'morning': 'Êó©Êô®„ÄÅ‰∏äÂçà',
            'afternoon': '‰∏ãÂçà',
            'evening': 'Êôö‰∏ä',
            'night': 'Â§úÊôö',
            'week': 'Âë®„ÄÅÊòüÊúü',
            'month': 'Êúà',
            'year': 'Âπ¥',
            'time': 'Êó∂Èó¥',

            // Êñπ‰Ωç
            'big': 'Â§ßÁöÑ',
            'small': 'Â∞èÁöÑ',
            'large': 'Â§ßÁöÑ„ÄÅÂ∑®Â§ßÁöÑ',
            'little': 'Â∞èÁöÑ„ÄÅÂ∞ëÈáèÁöÑ',
            'tall': 'È´òÁöÑ',
            'short': 'ÁüÆÁöÑ„ÄÅÁü≠ÁöÑ',
            'long': 'ÈïøÁöÑ',
            'new': 'Êñ∞ÁöÑ',
            'old': 'ÊóßÁöÑ„ÄÅËÄÅÁöÑ',
            'good': 'Â•ΩÁöÑ',
            'bad': 'ÂùèÁöÑ',
            'right': 'ÂØπÁöÑ„ÄÅÊ≠£Á°ÆÁöÑ',
            'wrong': 'ÈîôÁöÑ',
            'yes': 'ÊòØ',
            'no': '‰∏ç„ÄÅ‰∏çÊòØ',

            // ÂÖ∂‰ªñÂ∏∏Áî®ËØç
            'what': '‰ªÄ‰πà',
            'where': 'Âì™Èáå',
            'when': '‰ªÄ‰πàÊó∂ÂÄô',
            'who': 'Ë∞Å',
            'why': '‰∏∫‰ªÄ‰πà',
            'how': 'ÊÄéÊ†∑„ÄÅÂ¶Ç‰Ωï',
            'this': 'Ëøô‰∏™',
            'that': 'ÈÇ£‰∏™',
            'here': 'ËøôÈáå',
            'there': 'ÈÇ£Èáå',
            'very': 'ÈùûÂ∏∏„ÄÅÂæà',
            'too': 'Â§™„ÄÅ‰πü',
            'all': 'ÂÖ®ÈÉ®„ÄÅÊâÄÊúâ',
            'some': '‰∏Ä‰∫õ',
            'many': 'ËÆ∏Â§ö',
            'much': 'ËÆ∏Â§ö',
            'name': 'ÂêçÂ≠ó',
            'friend': 'ÊúãÂèã',
            'people': '‰∫∫„ÄÅ‰∫∫‰ª¨',
            'thing': '‰∫ãÊÉÖ„ÄÅ‰∏úË•ø',
            'something': 'Êüê‰∫ã„ÄÅÊüêÁâ©',
            'nothing': 'Ê≤°Êúâ‰ªÄ‰πà',
            'everything': 'ÊØè‰ª∂‰∫ã„ÄÅ‰∏ÄÂàá',

            // ËÆ°ÁÆóÊú∫ÂíåÁßëÊäÄ
            'computer': 'ÁîµËÑë„ÄÅËÆ°ÁÆóÊú∫',
            'compute': 'ËÆ°ÁÆó„ÄÅ‰º∞ÁÆó',
            'calculator': 'ËÆ°ÁÆóÂô®',
            'internet': '‰∫íËÅîÁΩë„ÄÅÁΩëÁªú',
            'phone': 'ÁîµËØù„ÄÅÊâãÊú∫',
            'mobile': 'ÁßªÂä®ÁöÑ„ÄÅÊâãÊú∫',
            'telephone': 'ÁîµËØù',
            'email': 'ÁîµÂ≠êÈÇÆ‰ª∂',
            'message': 'Ê∂àÊÅØ„ÄÅ‰ø°ÊÅØ',
            'game': 'Ê∏∏Êàè',
            'player': 'Áé©ÂÆ∂„ÄÅÊí≠ÊîæÂô®',
            'music': 'Èü≥‰πê',
            'song': 'Ê≠åÊõ≤',
            'video': 'ËßÜÈ¢ë',
            'picture': 'ÂõæÁâá„ÄÅÁÖßÁâá',
            'photo': 'ÁÖßÁâá',
            'camera': 'ÁÖßÁõ∏Êú∫„ÄÅÁõ∏Êú∫',

            // ËÅå‰∏ö
            'doctor': 'ÂåªÁîü',
            'teacher': 'ÊïôÂ∏à',
            'driver': 'Âè∏Êú∫',
            'cook': 'Âé®Â∏à„ÄÅÁÖÆ',
            'police': 'Ë≠¶ÂØü',
            'worker': 'Â∑•‰∫∫',
            'farmer': 'ÂÜúÊ∞ë',
            'soldier': 'Â£´ÂÖµ„ÄÅÂÜõ‰∫∫',

            // ‰∫§ÈÄöÂ∑•ÂÖ∑
            'car': 'Ê±ΩËΩ¶„ÄÅËΩøËΩ¶',
            'bus': 'ÂÖ¨ÂÖ±Ê±ΩËΩ¶„ÄÅÂ∑¥Â£´',
            'train': 'ÁÅ´ËΩ¶',
            'plane': 'È£ûÊú∫',
            'bike': 'Ëá™Ë°åËΩ¶',
            'bicycle': 'Ëá™Ë°åËΩ¶',
            'boat': 'Ëàπ',
            'ship': 'Â§ßËàπ„ÄÅËΩÆËàπ',

            // Ëá™ÁÑ∂
            'sun': 'Â§™Èò≥',
            'moon': 'Êúà‰∫Æ',
            'star': 'ÊòüÊòü',
            'sky': 'Â§©Á©∫',
            'cloud': '‰∫ë',
            'rain': 'Èõ®„ÄÅ‰∏ãÈõ®',
            'snow': 'Èõ™„ÄÅ‰∏ãÈõ™',
            'wind': 'È£é',
            'tree': 'Ê†ë',
            'flower': 'Ëä±',
            'grass': 'Ëçâ„ÄÅËçâÂú∞',
            'mountain': 'Â±±',
            'river': 'Ê≤≥ÊµÅ',
            'sea': 'Êµ∑„ÄÅÊµ∑Ê¥ã',
            'ocean': 'Êµ∑Ê¥ã',
            'forest': 'Ê£ÆÊûó',

            // ÂüéÂ∏ÇÂª∫Á≠ë
            'city': 'ÂüéÂ∏Ç',
            'town': 'ÂüéÈïá„ÄÅÂ∏ÇÈïá',
            'street': 'Ë°óÈÅì',
            'road': 'ÈÅìË∑Ø„ÄÅÂÖ¨Ë∑Ø',
            'park': 'ÂÖ¨Âõ≠',
            'shop': 'ÂïÜÂ∫ó',
            'store': 'ÂïÜÂ∫ó„ÄÅÂ∫óÈì∫',
            'market': 'Â∏ÇÂú∫',
            'school': 'Â≠¶Ê†°',
            'hospital': 'ÂåªÈô¢',
            'bank': 'Èì∂Ë°å',
            'hotel': 'ÊóÖÈ¶Ü„ÄÅÈÖíÂ∫ó',

            // ÊúçË£Ö
            'clothes': 'Ë°£Êúç',
            'shirt': 'Ë°¨Ë°´',
            'shoe': 'Èûã',
            'hat': 'Â∏ΩÂ≠ê',
            'coat': 'Â§ñÂ•ó„ÄÅÂ§ßË°£',
            'dress': 'ËøûË°£Ë£ô„ÄÅË£ôÂ≠ê',
            'pants': 'Ë£§Â≠ê',
            'skirt': 'Ë£ôÂ≠ê',

            // Â≠¶‰π†Áî®ÂìÅ
            'bag': 'ÂåÖ„ÄÅ‰π¶ÂåÖ',
            'desk': '‰π¶Ê°å',
            'chair': 'Ê§ÖÂ≠ê',
            'paper': 'Á∫∏„ÄÅÁ∫∏Âº†',
            'ruler': 'Â∞∫Â≠ê',
            'eraser': 'Ê©°ÁöÆ',

            // ËøêÂä®
            'sport': 'ËøêÂä®',
            'ball': 'ÁêÉ',
            'football': 'Ë∂≥ÁêÉ',
            'basketball': 'ÁØÆÁêÉ',
            'swim': 'Ê∏∏Ê≥≥',
            'dance': 'Ë∑≥Ëàû',
            'sing': 'Âî±Ê≠å',

            // ÊàøÈó¥
            'room': 'ÊàøÈó¥',
            'bedroom': 'ÂçßÂÆ§',
            'kitchen': 'Âé®Êàø',
            'bathroom': 'Êµ¥ÂÆ§„ÄÅÂç´ÁîüÈó¥',
            'living room': 'ÂÆ¢ÂéÖ',

            // ÂÆ∂ÂÖ∑
            'bed': 'Â∫ä',
            'table': 'Ê°åÂ≠ê',
            'chair': 'Ê§ÖÂ≠ê',
            'sofa': 'Ê≤ôÂèë',
            'desk': '‰π¶Ê°å',

            // Êñ∞Â¢ûËØçÊ±á
            'good': 'Â•ΩÁöÑ',
            'bad': 'ÂùèÁöÑ',
            'speak': 'ËØ¥„ÄÅËÆ≤ËØù',
            'talk': 'Ë∞àËØù„ÄÅËØ¥ËØù',
            'think': 'ÊÉ≥„ÄÅÊÄùËÄÉ',
            'know': 'Áü•ÈÅì„ÄÅ‰∫ÜËß£',
            'understand': 'ÁêÜËß£„ÄÅÊòéÁôΩ',
            'learn': 'Â≠¶‰π†',
            'lunch': 'ÂçàÈ§ê',
            'dinner': 'ÊôöÈ§ê',
            'breakfast': 'Êó©È§ê',
            'supper': 'ÊôöÈ§ê',
            'snack': 'Èõ∂È£ü',
            'candy': 'Á≥ñÊûú',
            'chocolate': 'Â∑ßÂÖãÂäõ',
            'ice cream': 'ÂÜ∞Ê∑áÊ∑ã',
            'cake': 'ËõãÁ≥ï',
            'cookie': 'È•ºÂπ≤',
            'sugar': 'Á≥ñ',
            'salt': 'Áõê',
            'pepper': 'ËÉ°Ê§í',
            'soup': 'Ê±§',
            'salad': 'Ê≤ôÊãâ',
            'sandwich': '‰∏âÊòéÊ≤ª',
            'hamburger': 'Ê±âÂ†°ÂåÖ',
            'pizza': 'ÊØîËê®',
            'noodle': 'Èù¢Êù°',
            'tea': 'Ëå∂',
            'coffee': 'ÂíñÂï°',
            'juice': 'ÊûúÊ±Å',
            'soda': 'ËãèÊâìÊ∞¥',
            'milkshake': 'Â•∂Êòî',
            'yogurt': 'ÈÖ∏Â•∂',
            'cheese': 'Â•∂ÈÖ™',
            'butter': 'ÈªÑÊ≤π',
            'jam': 'ÊûúÈÖ±',
            'honey': 'ËúÇËúú',
            'sugar': 'Á≥ñ',
            'salt': 'Áõê',
            'oil': 'Ê≤π',
            'vinegar': 'ÈÜã',
            'sauce': 'ÈÖ±Ê±Å',
            'spoon': 'Âã∫Â≠ê',
            'fork': 'ÂèâÂ≠ê',
            'knife': 'ÂàÄ',
            'plate': 'ÁõòÂ≠ê',
            'bowl': 'Á¢ó',
            'cup': 'ÊùØÂ≠ê',
            'glass': 'ÁéªÁíÉÊùØ',
            'bottle': 'Áì∂Â≠ê',
            'napkin': 'È§êÂ∑æ',
            'towel': 'ÊØõÂ∑æ',
            'soap': 'ËÇ•ÁöÇ',
            'shampoo': 'Ê¥óÂèëÊ∞¥',
            'toothbrush': 'ÁâôÂà∑',
            'toothpaste': 'ÁâôËÜè',
            'comb': 'Ê¢≥Â≠ê',
            'brush': 'Âà∑Â≠ê',
            'mirror': 'ÈïúÂ≠ê',
            'clock': 'Êó∂Èíü',
            'watch': 'ÊâãË°®',
            'calendar': 'Êó•ÂéÜ',
            'date': 'Êó•Êúü',
            'hour': 'Â∞èÊó∂',
            'minute': 'ÂàÜÈíü',
            'second': 'Áßí',
            'moment': '‰∏Ä‰ºöÂÑø',
            'wait': 'Á≠âÂæÖ',
            'start': 'ÂºÄÂßã',
            'stop': 'ÂÅúÊ≠¢',
            'finish': 'ÂÆåÊàê',
            'begin': 'ÂºÄÂßã',
            'end': 'ÁªìÊùü',
            'finish': 'ÂÆåÊàê',
            'continue': 'ÁªßÁª≠',
            'practice': 'ÁªÉ‰π†',
            'remember': 'ËÆ∞‰Ωè',
            'forget': 'ÂøòËÆ∞',
            'believe': 'Áõ∏‰ø°',
            'hope': 'Â∏åÊúõ',
            'wish': 'Â∏åÊúõ',
            'dream': 'Ê¢¶ÊÉ≥',
            'goal': 'ÁõÆÊ†á',
            'plan': 'ËÆ°Âàí',
            'idea': '‰∏ªÊÑè„ÄÅÊÉ≥Ê≥ï',
            'story': 'ÊïÖ‰∫ã',
            'news': 'Êñ∞Èóª',
            'letter': '‰ø°‰ª∂',
            'email': 'ÁîµÂ≠êÈÇÆ‰ª∂',
            'post': 'ÈÇÆÂØÑ„ÄÅ post',
            'stamp': 'ÈÇÆÁ•®',
            'package': 'ÂåÖË£π',
            'box': 'ÁõíÂ≠ê',
            'bag': 'ÂåÖ„ÄÅ‰π¶ÂåÖ',
            'pocket': 'Âè£Ë¢ã',
            'wallet': 'Èí±ÂåÖ',
            'money': 'Èí±',
            'price': '‰ª∑Ê†º',
            'cost': 'Ëä±Ë¥π„ÄÅÊàêÊú¨',
            'buy': '‰π∞',
            'sell': 'Âçñ',
            'pay': 'ÊîØ‰ªò',
            'cheap': '‰æøÂÆúÁöÑ',
            'expensive': 'ÊòÇË¥µÁöÑ',
            'free': 'ÂÖçË¥πÁöÑ',
            'busy': 'ÂøôÁ¢åÁöÑ',
            'free time': 'Á©∫Èó≤Êó∂Èó¥',
            'weekend': 'Âë®Êú´',
            'holiday': 'ÂÅáÊúü',
            'vacation': 'Â∫¶ÂÅá',
            'trip': 'ÊóÖË°å',
            'journey': 'ÊóÖÁ®ã',
            'adventure': 'ÂÜíÈô©',
            'fun': 'ÊúâË∂£ÁöÑ',
            'funny': 'Â•ΩÁ¨ëÁöÑ',
            'serious': '‰∏•ËÇÉÁöÑ',
            'quiet': 'ÂÆâÈùôÁöÑ',
            'loud': 'Â§ßÂ£∞ÁöÑ',
            'noisy': 'ÂêµÈóπÁöÑ',
            'clean': 'Âπ≤ÂáÄÁöÑ',
            'dirty': 'ËÑèÁöÑ',
            'beautiful': 'Áæé‰∏ΩÁöÑ',
            'ugly': '‰∏ëÈôãÁöÑ',
            'cute': 'ÂèØÁà±ÁöÑ',
            'scary': 'ÂèØÊÄïÁöÑ',
            'brave': 'ÂãáÊï¢ÁöÑ',
            'strong': 'Âº∫Â£ÆÁöÑ',
            'weak': 'ËôöÂº±ÁöÑ',
            'healthy': 'ÂÅ•Â∫∑ÁöÑ',
            'sick': 'ÁîüÁóÖÁöÑ',
            'tired': 'Áñ≤Âä≥ÁöÑ',
            'hungry': 'È•øÁöÑ',
            'thirsty': 'Ê∏¥ÁöÑ',
            'full': 'È•±ÁöÑ',
            'empty': 'Á©∫ÁöÑ',
            'heavy': 'ÈáçÁöÑ',
            'light': 'ËΩªÁöÑ',
            'hard': 'Á°¨ÁöÑ',
            'soft': 'ËΩØÁöÑ',
            'smooth': 'ÂÖâÊªëÁöÑ',
            'rough': 'Á≤óÁ≥ôÁöÑ',
            'hot': 'ÁÉ≠ÁöÑ',
            'cold': 'ÂÜ∑ÁöÑ',
            'warm': 'Ê∏©ÊöñÁöÑ',
            'cool': 'ÂáâÁàΩÁöÑ',
            'dry': 'Âπ≤ÁöÑ',
            'wet': 'ÊπøÁöÑ',
            'sunny': 'Êô¥ÊúóÁöÑ',
            'cloudy': 'Â§ö‰∫ëÁöÑ',
            'windy': 'ÊúâÈ£éÁöÑ',
            'rainy': '‰∏ãÈõ®ÁöÑ',
            'snowy': '‰∏ãÈõ™ÁöÑ',
            'stormy': 'Êö¥È£éÈõ®ÁöÑ',
            'foggy': 'ÊúâÈõæÁöÑ',
            'icy': 'ÁªìÂÜ∞ÁöÑ',
            'spring': 'Êò•Â§©',
            'summer': 'Â§èÂ§©',
            'autumn': 'ÁßãÂ§©',
            'fall': 'ÁßãÂ§©',
            'winter': 'ÂÜ¨Â§©',
            'season': 'Â≠£ËäÇ',
            'month': 'Êúà‰ªΩ',
            'year': 'Âπ¥‰ªΩ',
            'century': '‰∏ñÁ∫™',
            'millennium': 'ÂçÉÂπ¥',
            'world': '‰∏ñÁïå',
            'country': 'ÂõΩÂÆ∂',
            'nation': 'Ê∞ëÊóè„ÄÅÂõΩÂÆ∂',
            'city': 'ÂüéÂ∏Ç',
            'town': 'ÂüéÈïá',
            'village': 'ÊùëÂ∫Ñ',
            'capital': 'È¶ñÈÉΩ',
            'language': 'ËØ≠Ë®Ä',
            'word': 'ÂçïËØç',
            'sentence': 'Âè•Â≠ê',
            'paragraph': 'ÊÆµËêΩ',
            'chapter': 'Á´†ËäÇ',
            'page': 'È°µ',
            'line': 'Ë°å',
            'space': 'Á©∫Èó¥',
            'place': 'Âú∞Êñπ',
            'position': '‰ΩçÁΩÆ',
            'direction': 'ÊñπÂêë',
            'north': 'Âåó',
            'south': 'Âçó',
            'east': '‰∏ú',
            'west': 'Ë•ø',
            'left': 'Â∑¶',
            'right': 'Âè≥',
            'up': '‰∏ä',
            'down': '‰∏ã',
            'between': '‰πãÈó¥',
            'beside': 'ÊóÅËæπ',
            'near': 'Èù†Ëøë',
            'far': 'ËøúÁöÑ',
            'close': 'ËøëÁöÑ',
            'open': 'ÊâìÂºÄ',
            'close': 'ÂÖ≥Èó≠',
            'shut': 'ÂÖ≥Èó≠',
            'lock': 'ÈîÅ',
            'key': 'Èí•Âåô',
            'door': 'Èó®',
            'window': 'Á™óÊà∑',
            'wall': 'Â¢ô',
            'floor': 'Âú∞Êùø',
            'ceiling': 'Â§©Ëä±Êùø',
            'roof': 'Â±ãÈ°∂',
            'garden': 'Ëä±Âõ≠',
            'yard': 'Èô¢Â≠ê',
            'garage': 'ËΩ¶Â∫ì',
            'basement': 'Âú∞‰∏ãÂÆ§',
            'attic': 'ÈòÅÊ•º',
            'balcony': 'Èò≥Âè∞',
            'porch': 'Èó®Âªä',
            'fence': 'Ê†ÖÊ†è',
            'gate': 'Â§ßÈó®',
            'path': 'Â∞èË∑Ø',
            'road': 'ÈÅìË∑Ø',
            'street': 'Ë°óÈÅì',
            'highway': 'È´òÈÄüÂÖ¨Ë∑Ø',
            'bridge': 'Ê°•',
            'tunnel': 'ÈößÈÅì',
            'station': 'ËΩ¶Á´ô',
            'airport': 'Êú∫Âú∫',
            'port': 'Ê∏ØÂè£',
            'harbor': 'Ê∏ØÂè£',
            'island': 'Â≤õÂ±ø',
            'continent': 'Â§ßÈôÜ',
            'ocean': 'Êµ∑Ê¥ã',
            'sea': 'Êµ∑',
            'beach': 'Êµ∑Êª©',
            'coast': 'Êµ∑Â≤∏',
            'mountain': 'Â±±',
            'hill': 'Â∞èÂ±±',
            'valley': 'Â±±Ë∞∑',
            'canyon': 'Â≥°Ë∞∑',
            'cave': 'Ê¥ûÁ©¥',
            'forest': 'Ê£ÆÊûó',
            'woods': 'Ê†ëÊûó',
            'jungle': '‰∏õÊûó',
            'desert': 'Ê≤ôÊº†',
            'plain': 'Âπ≥Âéü',
            'field': 'Áî∞Èáé',
            'farm': 'ÂÜúÂú∫',
            'garden': 'Ëä±Âõ≠',
            'park': 'ÂÖ¨Âõ≠',
            'zoo': 'Âä®Áâ©Âõ≠',
            'museum': 'ÂçöÁâ©È¶Ü',
            'library': 'Âõæ‰π¶È¶Ü',
            'school': 'Â≠¶Ê†°',
            'university': 'Â§ßÂ≠¶',
            'college': 'Â≠¶Èô¢',
            'hospital': 'ÂåªÈô¢',
            'bank': 'Èì∂Ë°å',
            'store': 'ÂïÜÂ∫ó',
            'market': 'Â∏ÇÂú∫',
            'restaurant': 'È§êÂéÖ',
            'hotel': 'ÈÖíÂ∫ó',
            'office': 'ÂäûÂÖ¨ÂÆ§',
            'factory': 'Â∑•ÂéÇ',
            'company': 'ÂÖ¨Âè∏',
            'business': 'ÁîüÊÑè',
            'industry': 'Â∑•‰∏ö',
            'agriculture': 'ÂÜú‰∏ö',
            'science': 'ÁßëÂ≠¶',
            'technology': 'ÊäÄÊúØ',
            'art': 'Ëâ∫ÊúØ',
            'music': 'Èü≥‰πê',
            'literature': 'ÊñáÂ≠¶',
            'history': 'ÂéÜÂè≤',
            'geography': 'Âú∞ÁêÜ',
            'math': 'Êï∞Â≠¶',
            'physics': 'Áâ©ÁêÜ',
            'chemistry': 'ÂåñÂ≠¶',
            'biology': 'ÁîüÁâ©',
            'language': 'ËØ≠Ë®Ä',
            'grammar': 'ËØ≠Ê≥ï',
            'vocabulary': 'ËØçÊ±á',
            'pronunciation': 'ÂèëÈü≥',
            'spelling': 'ÊãºÂÜô',
            'listening': 'Âê¨Âäõ',
            'speaking': 'Âè£ËØ≠',
            'reading': 'ÈòÖËØª',
            'writing': 'ÂÜô‰Ωú',
            'test': 'ËÄÉËØï',
            'exam': 'ËÄÉËØï',
            'quiz': 'ÊµãÈ™å',
            'homework': '‰Ωú‰∏ö',
            'project': 'È°πÁõÆ',
            'report': 'Êä•Âëä',
            'grade': 'ÊàêÁª©',
            'score': 'ÂàÜÊï∞',
            'mark': 'ÂàÜÊï∞',
            'pass': 'ÈÄöËøá',
            'fail': 'Â§±Ë¥•',
            'win': 'Ëµ¢',
            'lose': 'Ëæì',
            'draw': 'Âπ≥Â±Ä',
            'competition': 'ÊØîËµõ',
            'game': 'Ê∏∏Êàè',
            'sport': 'ËøêÂä®',
            'team': 'Âõ¢Èòü',
            'player': 'ÈÄâÊâã',
            'coach': 'ÊïôÁªÉ',
            'fan': 'Á≤â‰∏ù',
            'audience': 'ËßÇ‰ºó',
            'winner': 'Ëµ¢ÂÆ∂',
            'loser': 'ËæìÂÆ∂',
            'champion': 'ÂÜ†ÂÜõ',
            'medal': 'Â•ñÁâå',
            'trophy': 'Â•ñÊùØ',
            'prize': 'Â•ñÂìÅ',
            'award': 'Â•ñÂä±',
            'record': 'ËÆ∞ÂΩï',
            'best': 'ÊúÄÂ•ΩÁöÑ',
            'better': 'Êõ¥Â•ΩÁöÑ',
            'worse': 'Êõ¥Â∑ÆÁöÑ',
            'worsest': 'ÊúÄÂ∑ÆÁöÑ',
            'worst': 'ÊúÄÂ∑ÆÁöÑ',
            'more': 'Êõ¥Â§ö',
            'less': 'Êõ¥Â∞ë',
            'most': 'ÊúÄÂ§öÁöÑ',
            'least': 'ÊúÄÂ∞ëÁöÑ',
            'some': '‰∏Ä‰∫õ',
            'any': '‰ªª‰Ωï',
            'every': 'ÊØè‰∏™',
            'each': 'ÂêÑ‰∏™',
            'all': 'ÂÖ®ÈÉ®',
            'none': 'Ê≤°Êúâ',
            'both': '‰∏§ËÄÖ',
            'either': '‰ªª‰∏Ä',
            'neither': '‰∏§ËÄÖÈÉΩ‰∏ç',
            'also': '‰πü',
            'too': '‰πü„ÄÅÂ§™',
            'very': 'ÈùûÂ∏∏',
            'quite': 'Áõ∏ÂΩì',
            'rather': 'ÂÆÅÊÑø„ÄÅÁõ∏ÂΩì',
            'just': 'ÂàöÂàö„ÄÅ‰ªÖ‰ªÖ',
            'only': 'Âè™Êúâ',
            'even': 'ÁîöËá≥',
            'still': '‰ªçÁÑ∂',
            'already': 'Â∑≤Áªè',
            'yet': 'Ëøò„ÄÅÂ∞öÊú™',
            'already': 'Â∑≤Áªè',
            'always': 'ÊÄªÊòØ',
            'never': '‰ªé‰∏ç',
            'sometimes': 'ÊúâÊó∂',
            'often': 'ÁªèÂ∏∏',
            'usually': 'ÈÄöÂ∏∏',
            'rarely': 'ÂæàÂ∞ë',
            'seldom': 'ÂæàÂ∞ë',
            'ever': 'ÊõæÁªè',
            'once': '‰∏ÄÊ¨°',
            'twice': '‰∏§Ê¨°',
            'three times': '‰∏âÊ¨°',
            'many times': 'ÂæàÂ§öÊ¨°',
            'again': 'ÂÜçÊ¨°',
            'once more': 'ÂÜç‰∏ÄÊ¨°',
            'repeat': 'ÈáçÂ§ç',
            'continue': 'ÁªßÁª≠',
            'go on': 'ÁªßÁª≠',
            'stop': 'ÂÅúÊ≠¢',
            'pause': 'ÊöÇÂÅú',
            'break': '‰ºëÊÅØ„ÄÅ‰∏≠Êñ≠',
            'wait': 'Á≠âÂæÖ',
            'hurry': 'Ëµ∂Âø´',
            'slow': 'ÊÖ¢',
            'fast': 'Âø´',
            'quick': 'Âø´ÁöÑ',
            'rapid': 'ËøÖÈÄüÁöÑ',
            'sudden': 'Á™ÅÁÑ∂',
            'gradual': 'ÈÄêÊ∏êÁöÑ',
            'steady': 'Á®≥ÂÆöÁöÑ',
            'stable': 'Á®≥ÂÆöÁöÑ',
            'ready': 'ÂáÜÂ§áÂ•ΩÁöÑ',
            'prepared': 'ÂáÜÂ§áÂ•ΩÁöÑ',
            'done': 'ÂÆåÊàê',
            'finished': 'ÂÆåÊàê',
            'complete': 'ÂÆåÊï¥ÁöÑ',
            'incomplete': '‰∏çÂÆåÊï¥ÁöÑ',
            'perfect': 'ÂÆåÁæéÁöÑ',
            'excellent': '‰ºòÁßÄÁöÑ',
            'great': '‰ºüÂ§ßÁöÑ',
            'good': 'Â•ΩÁöÑ',
            'fine': 'Â•ΩÁöÑ',
            'okay': 'Â•ΩÁöÑ',
            'alright': 'Â•ΩÁöÑ',
            'bad': 'ÂùèÁöÑ',
            'terrible': 'Á≥üÁ≥ïÁöÑ',
            'awful': 'ÂèØÊÄïÁöÑ',
            'horrible': 'ÊÅêÊÄñÁöÑ',
            'nice': 'Â•ΩÁöÑ„ÄÅÂèãÂñÑÁöÑ',
            'kind': 'ÂñÑËâØÁöÑ',
            'mean': 'ÂàªËñÑÁöÑ',
            'rude': 'Á≤óÈ≤ÅÁöÑ',
            'polite': 'Á§ºË≤åÁöÑ',
            'friendly': 'ÂèãÂ•ΩÁöÑ',
            'helpful': 'ÊúâÂ∏ÆÂä©ÁöÑ',
            'useful': 'ÊúâÁî®ÁöÑ',
            'useless': 'Êó†Áî®ÁöÑ',
            'important': 'ÈáçË¶ÅÁöÑ',
            'necessary': 'ÂøÖË¶ÅÁöÑ',
            'possible': 'ÂèØËÉΩÁöÑ',
            'impossible': '‰∏çÂèØËÉΩÁöÑ',
            'easy': 'ÂÆπÊòìÁöÑ',
            'difficult': 'Âõ∞ÈöæÁöÑ',
            'simple': 'ÁÆÄÂçïÁöÑ',
            'complex': 'Â§çÊùÇÁöÑ',
            'complicated': 'Â§çÊùÇÁöÑ',
            'confused': 'Âõ∞ÊÉëÁöÑ',
            'clear': 'Ê∏ÖÊ•öÁöÑ',
            'obvious': 'ÊòéÊòæÁöÑ',
            'certain': 'Á°ÆÂÆöÁöÑ',
            'sure': 'Á°ÆÂÆöÁöÑ',
            'maybe': '‰πüËÆ∏',
            'perhaps': 'ÊàñËÆ∏',
            'possibly': 'ÂèØËÉΩ',
            'probably': 'ÂèØËÉΩ',
            'certainly': 'ÂΩìÁÑ∂',
            'definitely': 'ËÇØÂÆö',
            'absolutely': 'ÁªùÂØπ',
            'exactly': 'Á°ÆÂàáÂú∞',
            'correct': 'Ê≠£Á°ÆÁöÑ',
            'wrong': 'ÈîôËØØÁöÑ',
            'true': 'ÁúüÁöÑ',
            'false': 'ÂÅáÁöÑ',
            'real': 'ÁúüÂÆûÁöÑ',
            'fake': 'ÂÅáÁöÑ',
            'honest': 'ËØöÂÆûÁöÑ',
            'dishonest': '‰∏çËØöÂÆûÁöÑ',
            'truthful': 'ËØöÂÆûÁöÑ',
            'lying': 'ËØ¥Ë∞éÁöÑ',
            'honest': 'ËØöÂÆûÁöÑ'
        };

        // Ëé∑ÂèñÈ¢ÑËÆæ‰∏≠ÊñáÈáä‰πâÔºàÊîØÊåÅËØçÂΩ¢ËøòÂéüÔºâ
        function getPresetChineseMeaning(word) {
            const wordLower = word.toLowerCase();

            // Áõ¥Êé•ÂåπÈÖç
            if (presetChineseMeanings[wordLower]) {
                return presetChineseMeanings[wordLower];
            }

            // Â∞ùËØïÂéªÈô§Â§çÊï∞ -s
            if (wordLower.endsWith('s')) {
                const singular = wordLower.slice(0, -1);
                if (presetChineseMeanings[singular]) {
                    return presetChineseMeanings[singular];
                }
            }

            // Â∞ùËØïÂéªÈô§Â§çÊï∞ -es
            if (wordLower.endsWith('es')) {
                const singular = wordLower.slice(0, -2);
                if (presetChineseMeanings[singular]) {
                    return presetChineseMeanings[singular];
                }
            }

            // Â∞ùËØïÂéªÈô§ -ies (‰æãÂ¶Ç: cities -> city)
            if (wordLower.endsWith('ies')) {
                const singular = wordLower.slice(0, -3) + 'y';
                if (presetChineseMeanings[singular]) {
                    return presetChineseMeanings[singular];
                }
            }

            // Â∞ùËØïÂéªÈô§ -ing
            if (wordLower.endsWith('ing')) {
                const base = wordLower.slice(0, -3);
                if (presetChineseMeanings[base]) {
                    return presetChineseMeanings[base];
                }
            }

            // Â∞ùËØïÂéªÈô§ -ed
            if (wordLower.endsWith('ed')) {
                const base = wordLower.slice(0, -2);
                if (presetChineseMeanings[base]) {
                    return presetChineseMeanings[base];
                }
            }

            // Â∞ùËØïÂéªÈô§ -ly (ÂâØËØçÂΩ¢Âºè)
            if (wordLower.endsWith('ly')) {
                const base = wordLower.slice(0, -2);
                if (presetChineseMeanings[base]) {
                    return presetChineseMeanings[base] + 'Âú∞';
                }
            }

            // Â∞ùËØïÂéªÈô§ -er (‰∫∫/Â∑•ÂÖ∑)
            if (wordLower.endsWith('er')) {
                const base = wordLower.slice(0, -2);
                if (presetChineseMeanings[base]) {
                    return presetChineseMeanings[base] + 'ÁöÑ‰∫∫';
                }
            }

            // Êú™ÊâæÂà∞
            return null;
        }

        // Ê†ºÂºèÂåñËØçÂÖ∏APIËøîÂõûÁöÑÊï∞ÊçÆÔºàÂ¢ûÂº∫ÁâàÔºåÂåÖÂê´‰æãÂè•„ÄÅÂêå‰πâËØç„ÄÅÂõæÁâá„ÄÅÂú∫ÊôØÂè•Â≠êÁ≠âÔºâ
        async function formatDictData(apiData, queryWord) {
            if (!apiData || !Array.isArray(apiData) || apiData.length === 0) {
                return null;
            }

            console.log('üìñ ÂºÄÂßãÊ†ºÂºèÂåñËØçÂÖ∏Êï∞ÊçÆ:', queryWord);

            const entry = apiData[0];
            const word = entry.word || queryWord;
            const phonetic = entry.phonetic || entry.phonetics?.find(p => p.text)?.text || '';
            const phoneticAudio = entry.phonetics?.find(p => p.audio && p.audio.length > 0)?.audio || '';

            // ‰∏çÂÜç‰ΩøÁî®Â§ñÈÉ®ÂõæÁâáÊúçÂä°ÔºåÊîπÁî® emoji ÊñπÊ°à
            // ÂõæÁâáÂ∞ÜÂú®ÊòæÁ§∫Êó∂ÈÄöËøá CSS emoji Âç†‰ΩçÁ¨¶ÂÆûÁé∞
            console.log('üñºÔ∏è ‰ΩøÁî® emoji Âç†‰ΩçÁ¨¶ÊñπÊ°à');

            // Ëé∑ÂèñÂú∫ÊôØÂè•Â≠ê
            const sceneExamples = getSceneSentences(word);
            console.log(`üìú Âú∫ÊôØÂè•Â≠ê: ${sceneExamples.length} Êù°`);

            // ÊèêÂèñÊâÄÊúâËØçÊÄßÂíåÈáä‰πâ
            const meanings = [];
            const chineseMeanings = [];
            const simpleChineseMeanings = []; // ÁÆÄÂåñÁöÑ‰∏≠ÊñáËß£ÈáäÔºàÈÄÇÂêàÂ∞èÂ≠¶ÁîüÔºâ
            const allExamples = []; // Êî∂ÈõÜÊâÄÊúâ‰æãÂè•

            // ÂÖàÂ∞ùËØïËé∑ÂèñÈ¢ÑËÆæÁöÑ‰∏≠ÊñáÈáä‰πâÔºàÊï¥‰∏™ÂçïËØçÁöÑÈÄöÁî®Èáä‰πâÔºâ
            const presetChinese = getPresetChineseMeaning(word);
            console.log('üîç Êü•ËØ¢È¢ÑËÆæ‰∏≠Êñá:', word, '‚Üí', presetChinese || '(Êú™ÊâæÂà∞)');
            let hasUsedPreset = false;

            // ÊåâÂÆö‰πâÊï∞ÈáèÊéíÂ∫èËØçÊÄßÔºå‰ºòÂÖàÂ§ÑÁêÜ‰∏ªË¶ÅËØçÊÄßÔºàÂÆö‰πâÊúÄÂ§öÁöÑÔºâ
            const sortedMeanings = (entry.meanings || [])
                .map(m => ({
                    ...m,
                    definitionCount: (m.definitions || []).length
                }))
                .sort((a, b) => b.definitionCount - a.definitionCount);

            console.log('üìä ËØçÊÄßÊéíÂ∫è:', sortedMeanings.map(m => `${m.partOfSpeech}(${m.definitionCount})`).join(', '));

            // Âè™ÁøªËØëÂâç2‰∏™‰∏ªË¶ÅËØçÊÄßÔºàÈÅøÂÖçÊòæÁ§∫‰∏çÂ∏∏ËßÅËØçÊÄßÔºâ
            const maxPOSToTranslate = 2;

            for (let meaningIndex = 0; meaningIndex < sortedMeanings.length && meaningIndex < maxPOSToTranslate; meaningIndex++) {
                const meaning = sortedMeanings[meaningIndex];
                const partOfSpeech = meaning.partOfSpeech || '';
                const definitions = [];

                for (const def of meaning.definitions || []) {
                    const definitionText = def.definition || '';
                    const exampleText = def.example || '';

                    const definitionObj = {
                        definition: definitionText,
                        example: exampleText,
                        exampleTranslation: '' // Â∞ÜÂú®ÂêéÈù¢ÁøªËØë
                    };
                    definitions.push(definitionObj);

                    // Êî∂ÈõÜ‰æãÂè•ÔºàÂ¶ÇÊûúÊúâÔºâ
                    if (exampleText) {
                        allExamples.push({
                            english: exampleText,
                            partOfSpeech: partOfSpeech
                        });
                    }
                }

                meanings.push({
                    partOfSpeech: partOfSpeech,
                    definitions: definitions,
                    synonyms: meaning.synonyms || [], // Âêå‰πâËØç
                    antonyms: meaning.antonyms || [] // Âèç‰πâËØç
                });

                // Ê∑ªÂä†È¢ÑËÆæ‰∏≠ÊñáÔºà‰Ωú‰∏∫Â∏∏Áî®Èáä‰πâÔºâ
                if (presetChinese && !hasUsedPreset) {
                    console.log('‚úÖ ‰ΩøÁî®È¢ÑËÆæ‰∏≠ÊñáÈáä‰πâ:', presetChinese);
                    // È¢ÑËÆæÈáä‰πâÂèØËÉΩÂåÖÂê´Â§ö‰∏™ÊÑèÊÄùÔºåÁî®ÂàÜÂè∑ÊàñÊñúÊù†ÂàÜÈöî
                    const presetMeaningList = presetChinese.split(/[;Ôºõ/]/).map(m => m.trim()).filter(m => m);
                    console.log('   ÂàÜÂâ≤Âêé:', presetMeaningList);
                    presetMeaningList.forEach(meaning => {
                        chineseMeanings.push(meaning); // ‰∏çÊ∑ªÂä†ËØçÊÄßÂâçÁºÄ
                    });
                    simpleChineseMeanings.push(presetChinese);
                    hasUsedPreset = true;
                    console.log('   chineseMeanings Áé∞Âú®Êúâ:', chineseMeanings.length, 'Êù°');
                    // ‰∏çË¶Å breakÔºåÁªßÁª≠ÁøªËØëÊõ¥Â§öÂÆö‰πâ‰ª•Â±ïÁ§∫Â§öÊ†∑ÊÄß
                }

                // Êó†ËÆ∫ÊòØÂê¶ÊúâÈ¢ÑËÆæ‰∏≠ÊñáÔºåÈÉΩÁøªËØëÂâç3‰∏™ÂÆö‰πâÔºàÂ±ïÁ§∫Êõ¥Â§öÈáä‰πâÔºâ
                const maxDefinitionsToTranslate = 3;
                const definitionsToTranslate = definitions.slice(0, maxDefinitionsToTranslate);

                if (definitionsToTranslate.length > 0) {
                    console.log(`üåê ÁøªËØë ${partOfSpeech || 'Êú™Áü•ËØçÊÄß'} ÁöÑ ${definitionsToTranslate.length} ‰∏™ÂÆö‰πâÔºàÂ±ïÁ§∫Êõ¥Â§öÈáä‰πâÔºâ`);

                    // ÁøªËØëÈÄâ‰∏≠ÁöÑÂÆö‰πâ
                    for (let i = 0; i < definitionsToTranslate.length; i++) {
                        const definitionText = definitionsToTranslate[i].definition;

                        // ÁÆÄÂåñÂÆö‰πâÊñáÊú¨
                        let simplifiedDefinition = definitionText
                            .replace(/especially|particularly|specifically/gi, '')
                            .replace(/\s+/g, ' ')
                            .trim();

                        console.log(`üåê ÁøªËØë ${partOfSpeech || ''} ÂÆö‰πâ ${i + 1}/${definitionsToTranslate.length}:`, simplifiedDefinition.substring(0, 50) + '...');

                        // ÁøªËØëÊØè‰∏™ÂÆö‰πâ
                        const chinese = await translateToChinese(simplifiedDefinition);

                        if (chinese) {
                            // ÁÆÄÂåñÁøªËØëÁªìÊûú
                            const simpleChinese = chinese
                                .replace(/ÁâπÂà´ÊòØ|Â∞§ÂÖ∂ÊòØ|ÁâπÂà´ÊòØ/g, '')
                                .replace(/ÊàñËÄÖ|Êàñ/g, '„ÄÅ')
                                .replace(/Á≠â$/g, '')
                                .trim();

                            console.log(`‚úÖ ÂÆö‰πâ ${i + 1} ÁøªËØëÊàêÂäü:`, chinese);
                            // Â¶ÇÊûúÊúâËØçÊÄßÔºåÊ∑ªÂä†ËØçÊÄßÂâçÁºÄÔºõÂê¶ÂàôÁõ¥Êé•Ê∑ªÂä†
                            if (partOfSpeech) {
                                chineseMeanings.push(`${partOfSpeech} ${simpleChinese}`);
                            } else {
                                chineseMeanings.push(simpleChinese);
                            }
                        } else {
                            console.warn(`‚ö†Ô∏è ÂÆö‰πâ ${i + 1} ÁøªËØëÂ§±Ë¥•ÔºåË∑≥ËøáÊ≠§ÂÆö‰πâ`);
                            // ÁøªËØëÂ§±Ë¥•Êó∂ÔºåË∑≥ËøáÊ≠§ÂÆö‰πâÔºå‰∏çÊòæÁ§∫Ëã±ÊñáÂéüÊñá
                        }
                    }
                }

                // ÁøªËØëÂÆåÁ¨¨‰∏Ä‰∏™‰∏ªË¶ÅËØçÊÄßÂêéÔºåÂÅúÊ≠¢ÔºàÈÅøÂÖçÊòæÁ§∫Â§™Â§ö‰∏çÂ∏∏ËßÅÁöÑËØçÊÄßÔºâ
                break;
            }

            // ÁøªËØëÊâÄÊúâ‰æãÂè•Âà∞‰∏≠Êñá
            console.log(`üåê Ê≠£Âú®ÁøªËØë ${allExamples.length} ‰∏™‰æãÂè•...`);
            for (const item of allExamples) {
                try {
                    const translation = await translateToChinese(item.english);
                    if (translation) {
                        item.chinese = translation;
                    }
                } catch (e) {
                    console.warn('‰æãÂè•ÁøªËØëÂ§±Ë¥•:', e);
                }
            }

            // Â∞ÜÁøªËØëÂêéÁöÑ‰æãÂè•Ê∑ªÂä†Âà∞ÂØπÂ∫îÁöÑÂÆö‰πâ‰∏≠
            let exampleIndex = 0;
            for (const meaning of meanings) {
                for (const def of meaning.definitions) {
                    if (def.example && exampleIndex < allExamples.length) {
                        def.exampleTranslation = allExamples[exampleIndex].chinese || '';
                        exampleIndex++;
                    }
                }
            }

            console.log('‚úÖ ËØçÂÖ∏Êï∞ÊçÆÊ†ºÂºèÂåñÂÆåÊàê');
            console.log(`   - ËØçÊÄßÊï∞Èáè: ${meanings.length}`);
            console.log(`   - ‰∏≠ÊñáÈáä‰πâ: ${chineseMeanings.length}`, chineseMeanings);
            console.log(`   - ÁÆÄÂåñÈáä‰πâ: ${simpleChineseMeanings.length}`);
            console.log(`   - ‰æãÂè•Êï∞Èáè: ${allExamples.length}`);
            console.log(`   - Âú∫ÊôØÂè•Â≠ê: ${sceneExamples.length}`);

            return {
                word: word,
                phonetic: phonetic,
                phoneticAudio: phoneticAudio,
                meanings: meanings,
                chineseMeanings: chineseMeanings,
                simpleChineseMeanings: simpleChineseMeanings,
                sceneExamples: sceneExamples,
                allExamples: allExamples
            };
        }

        // Êü•ËØ¢ËØçÂÖ∏APIÔºà‰ºòÂÖàÁ∫ßÔºöMCP > ÊúâÈÅì > ÂÖçË¥πAPIÔºâ
        // ÊîØÊåÅËã±ÊñáÂçïËØçÊü•ËØ¢Âíå‰∏≠ÊñáËØçËØ≠Êü•ËØ¢ÔºàËá™Âä®ÁøªËØëÂêéÊü•ËØ¢Ôºâ
        async function queryDictionary(word) {
            console.log('üîç ÂºÄÂßãÊü•ËØ¢ËØçÂÖ∏:', word);
            let wordTrimmed = word.trim();
            let originalWord = wordTrimmed; // ‰øùÂ≠òÂéüÂßãËæìÂÖ•
            let isChineseInput = false;

            if (!wordTrimmed) {
                console.error('‚ùå Êü•ËØ¢ËØç‰∏∫Á©∫');
                return { error: 'Êü•ËØ¢ËØç‰∏çËÉΩ‰∏∫Á©∫', word: word };
            }

            // Ê£ÄÊµãÊòØÂê¶‰∏∫‰∏≠ÊñáËæìÂÖ•
            let englishWords = null; // ‰øùÂ≠òËã±ÊñáÁøªËØëÁªìÊûúÔºåÁî®‰∫éÂêéÁª≠‰ΩøÁî®
            if (isChinese(wordTrimmed)) {
                isChineseInput = true;
                console.log('üîç Ê£ÄÊµãÂà∞‰∏≠ÊñáËæìÂÖ•ÔºåËé∑ÂèñÂ§ö‰∏™Ëã±ÊñáÂØπÂ∫îËØç:', wordTrimmed);

                // Ëé∑ÂèñÂ§ö‰∏™Ëã±ÊñáÂØπÂ∫îËØçÔºàÂêå‰πâËØç„ÄÅËøë‰πâËØçÁ≠âÔºâ
                englishWords = await getMultipleEnglishWords(wordTrimmed);

                if (!englishWords || englishWords.length === 0) {
                    return {
                        error: 'ÁøªËØëÂ§±Ë¥•ÔºåÊó†Ê≥ïÂ∞Ü‰∏≠ÊñáÁøªËØëÊàêËã±Êñá',
                        word: wordTrimmed,
                        isChinese: true
                    };
                }

                console.log('‚úÖ ‰∏≠ÊñáÁøªËØëÁªìÊûúÔºàÂ§ö‰∏™Ôºâ:', wordTrimmed, '->', englishWords);

                // ‰øùÂ≠òÂéüÂßã‰∏≠Êñá
                originalWord = wordTrimmed;

                // ‰ΩøÁî®Á¨¨‰∏Ä‰∏™Ëã±ÊñáÂçïËØçËøõË°åÊü•ËØ¢Ôºà‰ΩÜ‰øùÂ≠òÊâÄÊúâÂØπÂ∫îËØçÁî®‰∫éÊòæÁ§∫Ôºâ
                wordTrimmed = englishWords[0];
            }

            // ÁîüÊàêÂ§ö‰∏™ÂèØËÉΩÁöÑÊü•ËØ¢Ê†ºÂºèÔºà‰øùÊåÅÂéüÂßãÂ§ßÂ∞èÂÜô„ÄÅÂ∞èÂÜô„ÄÅÈ¶ñÂ≠óÊØçÂ§ßÂÜôÔºâ
            const wordLower = wordTrimmed.toLowerCase();
            const wordCapitalized = wordLower.charAt(0).toUpperCase() + wordLower.slice(1);
            const queryVariants = [
                wordTrimmed,        // ‰øùÊåÅÂéüÂßãÂ§ßÂ∞èÂÜôÔºà‰ºòÂÖàÔºåÈÄÇÁî®‰∫é‰∏ìÊúâÂêçËØç„ÄÅÊòüÊúü„ÄÅÊúà‰ªΩÁ≠âÔºâ
                wordLower,          // Â∞èÂÜô
                wordCapitalized     // È¶ñÂ≠óÊØçÂ§ßÂÜô
            ];

            // ÂéªÈáç
            const uniqueVariants = [...new Set(queryVariants)];

            // Ê£ÄÊü•ÁºìÂ≠òÔºà‰ΩøÁî®ÊâÄÊúâÂèØËÉΩÁöÑÊ†ºÂºèÔºâ
            for (const variant of uniqueVariants) {
                const variantLower = variant.toLowerCase();
                if (dictCache[variantLower]) {
                    const cached = dictCache[variantLower];
                    // ÁºìÂ≠ò7Â§©ÊúâÊïà
                    if (Date.now() - cached.timestamp < 7 * 24 * 60 * 60 * 1000) {
                        console.log('‚úÖ ‰ΩøÁî®ÁºìÂ≠ò:', variantLower);

                        // Â¶ÇÊûúÂéüÂßãËæìÂÖ•ÊòØ‰∏≠ÊñáÔºåÊ∑ªÂä†Ê†áÂøó‰ª•‰æøÊòæÁ§∫Êó∂ÈöêËóè‰∏≠ÊñáÈáä‰πâ
                        if (isChineseInput) {
                            const resultWithFlag = { ...cached.data };
                            resultWithFlag.originalWord = originalWord;
                            resultWithFlag.isChineseInput = true;
                            resultWithFlag.englishWords = englishWords || [];
                            return resultWithFlag;
                        }

                        return cached.data;
                    }
                }
            }

            // ‰ºòÂÖà‰ΩøÁî®MCPËØçÂÖ∏APIÔºàÂ∞ùËØïÊâÄÊúâÊ†ºÂºèÔºâ
            if (mcpConfig.enabled && mcpConfig.serverUrl) {
                for (const variant of uniqueVariants) {
                    console.log('üîç ‰ΩøÁî®MCPËØçÂÖ∏Êü•ËØ¢:', variant);
                    const mcpResult = await queryMcpDictionary(variant);
                    if (mcpResult && !mcpResult.error) {
                        // Â¶ÇÊûúÂéüÂßãËæìÂÖ•ÊòØ‰∏≠ÊñáÔºåÊ∑ªÂä†Ê†áÂøó
                        if (isChineseInput) {
                            mcpResult.originalWord = originalWord;
                            mcpResult.isChineseInput = true;
                            mcpResult.englishWords = englishWords || [];
                        }
                        // ‰øùÂ≠òÂà∞ÁºìÂ≠òÔºà‰ΩøÁî®Â∞èÂÜô‰Ωú‰∏∫keyÔºâ
                        dictCache[wordLower] = {
                            data: mcpResult,
                            timestamp: Date.now()
                        };
                        saveDictCache();
                        return mcpResult;
                    }
                }
                console.log('‚ö†Ô∏è MCPËØçÂÖ∏Êü•ËØ¢Â§±Ë¥•ÔºåÂàáÊç¢Âà∞ÂÖçË¥πAPI');
            }

            // ‰ΩøÁî®Free Dictionary APIÊü•ËØ¢ÔºàÂ∞ùËØïÊâÄÊúâÊ†ºÂºèÔºâ
            const apiTimeoutPromise = new Promise((_, reject) => {
                setTimeout(() => reject(new Error('APIÊü•ËØ¢Ë∂ÖÊó∂ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•')), 8000);
            });

            let lastError = null;

            // ‰æùÊ¨°Â∞ùËØïÊâÄÊúâÊ†ºÂºè
            for (const queryWord of uniqueVariants) {
                try {
                    console.log('üîç ‰ΩøÁî®Free Dictionary APIÊü•ËØ¢:', queryWord);

                    const response = await Promise.race([
                        fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${encodeURIComponent(queryWord)}`, {
                            method: 'GET',
                            headers: {
                                'Accept': 'application/json'
                            }
                        }),
                        apiTimeoutPromise
                    ]);

                    console.log('üì° APIÂìçÂ∫îÁä∂ÊÄÅ:', response.status, response.statusText);

                    if (response.ok) {
                        const data = await response.json();
                        console.log('‚úÖ APIËøîÂõûÊï∞ÊçÆ:', data);

                        // Áªü‰∏ÄÊï∞ÊçÆÊ†ºÂºèÔºàÂåÖÂê´‰∏≠ÊñáÁøªËØëÔºâ
                        const formatted = await formatDictData(data, queryWord);

                        // Â¶ÇÊûúÂéüÂßãËæìÂÖ•ÊòØ‰∏≠ÊñáÔºå‰øùÂ≠òÂéüÂßãËæìÂÖ•‰ø°ÊÅØÂíåÊâÄÊúâËã±ÊñáÂØπÂ∫îËØç
                        if (isChineseInput) {
                            formatted.originalWord = originalWord;
                            formatted.isChineseInput = true;
                            formatted.englishWords = englishWords || [];
                        }

                        // ‰øùÂ≠òÂà∞ÁºìÂ≠òÔºà‰ΩøÁî®Â∞èÂÜô‰Ωú‰∏∫keyÔºåÊñπ‰æøÂêéÁª≠Êü•ÊâæÔºâ
                        dictCache[wordLower] = {
                            data: formatted,
                            timestamp: Date.now()
                        };
                        saveDictCache();

                        return formatted;
                    } else if (response.status === 404) {
                        // 404ÈîôËØØÔºåÁªßÁª≠Â∞ùËØï‰∏ã‰∏Ä‰∏™Ê†ºÂºè
                        console.warn('‚ö†Ô∏è ÂçïËØçÊú™ÊâæÂà∞ÔºåÂ∞ùËØï‰∏ã‰∏Ä‰∏™Ê†ºÂºè:', queryWord);
                        lastError = { error: 'Êú™ÊâæÂà∞ËØ•ÂçïËØçÔºåËØ∑Ê£ÄÊü•ÊãºÂÜô', word: wordTrimmed };
                        continue;
                    } else {
                        // ÂÖ∂‰ªñHTTPÈîôËØØÔºåÊäõÂá∫ÂºÇÂ∏∏
                        throw new Error(`APIÈîôËØØ: ${response.status} ${response.statusText}`);
                    }
                } catch (error) {
                    // Â¶ÇÊûúÊòØË∂ÖÊó∂ÈîôËØØÔºåÁªßÁª≠Â∞ùËØï‰∏ã‰∏Ä‰∏™Ê†ºÂºè
                    if (error.message && error.message.includes('Ë∂ÖÊó∂')) {
                        console.warn('‚ö†Ô∏è Êü•ËØ¢Ë∂ÖÊó∂ÔºåÂ∞ùËØï‰∏ã‰∏Ä‰∏™Ê†ºÂºè:', queryWord);
                        lastError = { error: 'Êü•ËØ¢Ë∂ÖÊó∂ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•ÊàñÁ®çÂêéÈáçËØï', word: wordTrimmed };
                        continue;
                    }
                    // ÂÖ∂‰ªñÈîôËØØÔºåÁªßÁª≠Â∞ùËØï
                    console.warn('‚ö†Ô∏è Êü•ËØ¢Âá∫ÈîôÔºåÂ∞ùËØï‰∏ã‰∏Ä‰∏™Ê†ºÂºè:', error.message);
                    lastError = { error: error.message || 'Êü•ËØ¢Â§±Ë¥•', word: wordTrimmed };
                    continue;
                }
            }

            // Â¶ÇÊûúÊâÄÊúâAPIÊü•ËØ¢ÈÉΩÂ§±Ë¥•ÔºåÂ∞ùËØï‰ªéÊú¨Âú∞ÂçïËØçÂ∫ìÊü•Êâæ
            if (data.vocab && data.vocab.length > 0) {
                console.log('üîç Â∞ùËØï‰ªéÊú¨Âú∞ÂçïËØçÂ∫ìÊü•Êâæ:', wordLower);
                // Â∞ùËØïÊâÄÊúâÊ†ºÂºèÂú®Êú¨Âú∞ÂçïËØçÂ∫ì‰∏≠Êü•Êâæ
                for (const variant of uniqueVariants) {
                    const variantLower = variant.toLowerCase();
                    const localWord = data.vocab.find(w =>
                        w.word && w.word.toLowerCase() === variantLower
                    );

                    if (localWord) {
                        console.log('‚úÖ Âú®Êú¨Âú∞ÂçïËØçÂ∫ì‰∏≠ÊâæÂà∞:', localWord.word);
                        // ÊûÑÈÄ†‰∏Ä‰∏™ÁÆÄÂçïÁöÑËØçÂÖ∏ÁªìÊûú
                        const localResult = {
                            word: localWord.word,
                            phonetic: '',
                            meanings: [{
                                partOfSpeech: 'n.',
                                definitions: [{
                                    definition: localWord.meaning,
                                    example: localWord.example || ''
                                }]
                            }],
                            chineseMeanings: [localWord.meaning]
                        };

                        // ‰øùÂ≠òÂà∞ÁºìÂ≠ò
                        dictCache[wordLower] = {
                            data: localResult,
                            timestamp: Date.now()
                        };
                        saveDictCache();

                        return localResult;
                    }
                }
            }

            // ÊâÄÊúâÊü•ËØ¢ÊñπÂºèÈÉΩÂ§±Ë¥•ÔºåËøîÂõûÈîôËØØ
            return lastError || { error: 'Êü•ËØ¢Â§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•', word: wordTrimmed };
        }

        // Ê£ÄÊµãÊñáÊú¨ÊòØÂê¶‰∏∫‰∏≠Êñá
        function isChinese(text) {
            if (!text || text.trim() === '') return false;
            // Ê£ÄÊü•ÊòØÂê¶ÂåÖÂê´‰∏≠ÊñáÂ≠óÁ¨¶ÔºàUnicodeËåÉÂõ¥Ôºö\u4e00-\u9fa5Ôºâ
            return /[\u4e00-\u9fa5]/.test(text);
        }

        // Ëé∑ÂèñÂ§ö‰∏™Ëã±ÊñáÂØπÂ∫îËØçÔºà‰∏Ä‰∏™‰∏≠ÊñáËØçÂØπÂ∫îÂ§ö‰∏™Ëã±ÊñáËØçÔºâ
        async function getMultipleEnglishWords(chineseWord) {
            if (!chineseWord || chineseWord.trim() === '') return [];

            const wordTrimmed = chineseWord.trim();
            const englishWordsSet = new Set();

            // Â∏∏Áî®‰∏≠Ëã±ÊñáÊò†Â∞ÑË°®ÔºàÊú¨Âú∞ËØçÂ∫ìÔºâ
            const commonTranslations = {
                'ÁîµËÑë': 'computer',
                'ÊâãÊú∫': 'phone', 'ÁßªÂä®ÁîµËØù': 'mobile',
                'Ê°åÂ≠ê': 'desk',
                'Ê§ÖÂ≠ê': 'chair',
                '‰π¶': 'book',
                'Á¨î': 'pen',
                'ËÄÅÂ∏à': 'teacher',
                'Â≠¶Áîü': 'student',
                'Â≠¶Ê†°': 'school',
                'ÂÆ∂': 'home',
                'ËãπÊûú': 'apple',
                'È¶ôËïâ': 'banana',
                'Ê∞¥': 'water',
                'È•≠': 'rice',
                'ÂêÉ': 'eat',
                'Âñù': 'drink',
                'Áé©': 'play',
                'Â≠¶‰π†': 'study',
                'Â∑•‰Ωú': 'work',
                'Áà±': 'love',
                'ÂñúÊ¨¢': 'like',
                'Âø´‰πê': 'happy',
                'ÊÇ≤‰º§': 'sad',
                'Â§ß': 'big',
                'Â∞è': 'small',
                'Â•Ω': 'good',
                'Âùè': 'bad',
                'Â§ö': 'many',
                'Â∞ë': 'few',
                'È´ò': 'tall',
                'ÁüÆ': 'short',
                'Èïø': 'long',
                'Áü≠': 'short',
                'Êñ∞': 'new',
                'Êóß': 'old',
                'ÊúãÂèã': 'friend',
                'ÂÆ∂‰∫∫': 'family',
                'Áå´': 'cat',
                'Áãó': 'dog',
                'È∏ü': 'bird',
                'È±º': 'fish',
                'Ëä±': 'flower',
                'Ê†ë': 'tree',
                'Â§©': 'sky',
                'Â§™Èò≥': 'sun',
                'Êúà‰∫Æ': 'moon',
                'ÊòüÊòü': 'star',
                '‰ªäÂ§©': 'today',
                'ÊòéÂ§©': 'tomorrow',
                'Êò®Â§©': 'yesterday',
                'Áé∞Âú®': 'now',
                '‰ª•Âêé': 'later',
                '‰πãÂâç': 'before'
            };

            // ‰∏∫ÊØè‰∏™APIË∞ÉÁî®Ê∑ªÂä†Ë∂ÖÊó∂
            const createTimeoutPromise = (ms) => {
                return new Promise((_, reject) => {
                    setTimeout(() => reject(new Error('ÁøªËØëË∂ÖÊó∂')), ms);
                });
            };

            // üéØ ‰ºòÂÖà‰ΩøÁî®Êú¨Âú∞ËØçÂ∫ìÔºàÊõ¥ÂáÜÁ°ÆÔºâ
            if (commonTranslations[wordTrimmed]) {
                const localWord = commonTranslations[wordTrimmed];
                console.log(`‚úÖ ‰ΩøÁî®Êú¨Âú∞ËØçÂ∫ìÔºà‰ºòÂÖàÔºâ: ${wordTrimmed} ‚Üí ${localWord}`);
                englishWordsSet.add(localWord);
                // ÁªßÁª≠Â∞ùËØïAPI‰ª•Ëé∑ÂèñÊõ¥Â§öÁøªËØëÈÄâÈ°πÔºå‰ΩÜÊú¨Âú∞ËØçÂ∫ìÁöÑÁªìÊûú‰ºöÊéíÂú®Á¨¨‰∏Ä‰Ωç
            }

            // Â∞ùËØïÂ§ö‰∏™ÁøªËØëAPIËé∑Âèñ‰∏çÂêåÁöÑÁøªËØëÁªìÊûúÔºàÊåâÈ°∫Â∫èÂ∞ùËØïÔºå‰∏çÂπ∂Ë°åÔºâ
            const apis = [
                // API 1: Google Translate (sl=zh)
                async () => {
                    try {
                        const response = await Promise.race([
                            fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=zh&tl=en&dt=t&q=${encodeURIComponent(wordTrimmed)}`),
                            createTimeoutPromise(2000)
                        ]);
                        if (response.ok) {
                            const data = await response.json();
                            if (data && data[0]) {
                                const translated = data[0].map(item => item[0]).filter(t => t).join('');
                                if (translated) {
                                    console.log(`‚úÖ Google Translate (zh‚Üíen): ${translated}`);
                                    return translated;
                                }
                            }
                        }
                    } catch (e) {
                        console.warn('Google Translate (zh‚Üíen) Â§±Ë¥•');
                    }
                    return null;
                },

                // API 2: Google Translate (sl=zh-CN)
                async () => {
                    try {
                        const response = await Promise.race([
                            fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=zh-CN&tl=en&dt=t&q=${encodeURIComponent(wordTrimmed)}`),
                            createTimeoutPromise(2000)
                        ]);
                        if (response.ok) {
                            const data = await response.json();
                            if (data && data[0]) {
                                const translated = data[0].map(item => item[0]).filter(t => t).join('');
                                if (translated) {
                                    console.log(`‚úÖ Google Translate (zh-CN‚Üíen): ${translated}`);
                                    return translated;
                                }
                            }
                        }
                    } catch (e) {
                        console.warn('Google Translate (zh-CN‚Üíen) Â§±Ë¥•');
                    }
                    return null;
                },

                // API 3: MyMemory
                async () => {
                    try {
                        const response = await Promise.race([
                            fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(wordTrimmed)}&langpair=zh|en`),
                            createTimeoutPromise(3000)
                        ]);
                        if (response.ok) {
                            const data = await response.json();
                            if (data.responseData && data.responseData.translatedText) {
                                console.log(`‚úÖ MyMemory (zh‚Üíen): ${data.responseData.translatedText}`);
                                return data.responseData.translatedText;
                            }
                        }
                    } catch (e) {
                        console.warn('MyMemory (zh‚Üíen) Â§±Ë¥•');
                    }
                    return null;
                }
            ];

            // ‰æùÊ¨°Â∞ùËØïÂêÑ‰∏™API
            for (const api of apis) {
                try {
                    const translated = await api();
                    if (translated && translated.trim()) {
                        // ÂàÜÂâ≤ÁøªËØëÁªìÊûúÔºåÊèêÂèñÊâÄÊúâÂèØËÉΩÁöÑËã±ÊñáÂçïËØç
                        const words = translated.split(/[\s,Ôºå„ÄÅÔºõ;„ÄÅ\n\r]+/).map(w => w.trim()).filter(w => w);
                        words.forEach(word => {
                            // Âè™‰øùÁïôÁúãËµ∑Êù•ÂÉèËã±ÊñáÂçïËØçÁöÑÔºàÂ≠óÊØçÁªÑÊàêÔºåÈïøÂ∫¶ÂêàÁêÜÔºâ
                            if (/^[a-zA-Z]+$/.test(word) && word.length >= 2 && word.length <= 20) {
                                englishWordsSet.add(word.toLowerCase());
                            }
                        });

                        if (englishWordsSet.size > 0) {
                            break; // ÊâæÂà∞ÁªìÊûúÂêéÂÅúÊ≠¢Â∞ùËØïÂÖ∂‰ªñAPI
                        }
                    }
                } catch (error) {
                    console.warn('ÁøªËØëAPIÂ§±Ë¥•ÔºåÂ∞ùËØï‰∏ã‰∏Ä‰∏™');
                }
            }

            // Â¶ÇÊûúÊú¨Âú∞ËØçÂ∫ìÂíåAPIÈÉΩÊ≤°ÊúâÁªìÊûúÔºåÂõûÈÄÄÂà∞Êú¨Âú∞ËØçÂ∫ì
            if (englishWordsSet.size === 0 && commonTranslations[wordTrimmed]) {
                const localWord = commonTranslations[wordTrimmed];
                console.log(`‚úÖ ‰ΩøÁî®Êú¨Âú∞ËØçÂ∫ìÔºàÂõûÈÄÄÔºâ: ${wordTrimmed} ‚Üí ${localWord}`);
                englishWordsSet.add(localWord);
            }

            // ËΩ¨Êç¢‰∏∫Êï∞ÁªÑÂπ∂ÂéªÈáç
            let englishWords = Array.from(englishWordsSet);

            // Â¶ÇÊûúÁªìÊûúÂ§™Â∞ëÔºåÂ∞ùËØï‰ΩøÁî®Free Dictionary APIÊü•ÊâæÂêå‰πâËØç
            if (englishWords.length < 3 && englishWords.length > 0) {
                try {
                    const firstWord = englishWords[0];
                    const dictResponse = await Promise.race([
                        fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${encodeURIComponent(firstWord)}`),
                        createTimeoutPromise(3000)
                    ]);

                    if (dictResponse.ok) {
                        const dictData = await dictResponse.json();
                        if (dictData && dictData[0] && dictData[0].meanings) {
                            dictData[0].meanings.forEach(meaning => {
                                // Ê∑ªÂä†Âêå‰πâËØç
                                if (meaning.synonyms && Array.isArray(meaning.synonyms)) {
                                    meaning.synonyms.slice(0, 5).forEach(syn => {
                                        if (/^[a-zA-Z]+$/.test(syn) && syn.length >= 2 && syn.length <= 20) {
                                            englishWordsSet.add(syn.toLowerCase());
                                        }
                                    });
                                }
                            });
                        }
                    }
                } catch (e) {
                    console.warn('Ëé∑ÂèñÂêå‰πâËØçÂ§±Ë¥•:', e);
                }
            }

            // ÈáçÊñ∞ËΩ¨Êç¢‰∏∫Êï∞ÁªÑÔºåÂéªÈáçÔºåÂπ∂‰øùÊåÅÁ¨¨‰∏Ä‰∏™ÂçïËØçÂú®È¶ñ‰Ωç
            englishWords = Array.from(englishWordsSet);
            if (englishWords.length > 0) {
                // Á°Æ‰øùÁ¨¨‰∏Ä‰∏™ÂçïËØçÂú®È¶ñ‰Ωç
                const firstWord = englishWords[0];
                englishWords = [firstWord, ...englishWords.filter(w => w !== firstWord)];
            }

            if (englishWords.length === 0) {
                console.warn(`‚ö†Ô∏è Êú™ËÉΩËé∑ÂèñÂà∞ "${wordTrimmed}" ÁöÑËã±ÊñáÁøªËØë`);
            }

            console.log(`‚úÖ Ëé∑ÂèñÂà∞ ${englishWords.length} ‰∏™Ëã±ÊñáÂØπÂ∫îËØç:`, englishWords);
            return englishWords;
        }

        // ÁøªËØë‰∏≠ÊñáÂà∞Ëã±ÊñáÔºà‰ΩøÁî®Â§ö‰∏™ÂÖçË¥πÁøªËØëAPIÔºåÊèêÈ´òÊàêÂäüÁéáÔºå‰ºòÂåñË∂ÖÊó∂Ôºâ
        async function translateToEnglish(text) {
            if (!text || text.trim() === '') return '';

            // ÈôêÂà∂ÁøªËØëÊñáÊú¨ÈïøÂ∫¶
            const textToTranslate = text.length > 500 ? text.substring(0, 500) : text;

            // ‰∏∫ÊØè‰∏™APIË∞ÉÁî®Ê∑ªÂä†Ë∂ÖÊó∂
            const createTimeoutPromise = (ms) => {
                return new Promise((_, reject) => {
                    setTimeout(() => reject(new Error('ÁøªËØëË∂ÖÊó∂')), ms);
                });
            };

            // Â∏∏Áî®‰∏≠Ëã±ÊñáÊò†Â∞ÑË°®Ôºà‰Ωú‰∏∫ÊúÄÂêéÁöÑÂõûÈÄÄÊñπÊ°àÔºâ
            const commonTranslations = {
                'ÁîµËÑë': 'computer',
                'ÊâãÊú∫': 'phone',
                'Ê°åÂ≠ê': 'desk',
                'Ê§ÖÂ≠ê': 'chair',
                '‰π¶': 'book',
                'Á¨î': 'pen',
                'ËÄÅÂ∏à': 'teacher',
                'Â≠¶Áîü': 'student',
                'Â≠¶Ê†°': 'school',
                'ÂÆ∂': 'home',
                'ËãπÊûú': 'apple',
                'È¶ôËïâ': 'banana',
                'Ê∞¥': 'water',
                'È•≠': 'rice',
                'ÂêÉ': 'eat',
                'Âñù': 'drink',
                'Áé©': 'play',
                'Â≠¶‰π†': 'study',
                'Â∑•‰Ωú': 'work',
                'Áà±': 'love',
                'ÂñúÊ¨¢': 'like',
                'Âø´‰πê': 'happy',
                'ÊÇ≤‰º§': 'sad',
                'Â§ß': 'big',
                'Â∞è': 'small',
                'Â•Ω': 'good',
                'Âùè': 'bad',
                'Â§ö': 'many',
                'Â∞ë': 'few',
                'È´ò': 'tall',
                'ÁüÆ': 'short',
                'Èïø': 'long',
                'Áü≠': 'short',
                'Êñ∞': 'new',
                'Êóß': 'old',
                'ÊúãÂèã': 'friend',
                'ÂÆ∂‰∫∫': 'family',
                'Áå´': 'cat',
                'Áãó': 'dog',
                'È∏ü': 'bird',
                'È±º': 'fish',
                'Ëä±': 'flower',
                'Ê†ë': 'tree',
                'Â§©': 'sky',
                'Â§™Èò≥': 'sun',
                'Êúà‰∫Æ': 'moon',
                'ÊòüÊòü': 'star',
                '‰ªäÂ§©': 'today',
                'ÊòéÂ§©': 'tomorrow',
                'Êò®Â§©': 'yesterday',
                'Áé∞Âú®': 'now',
                '‰ª•Âêé': 'later',
                '‰πãÂâç': 'before'
            };

            // Â∞ùËØïÂ§ö‰∏™ÁøªËØëAPIÔºàÊåâ‰ºòÂÖàÁ∫ßÔºâ
            const apis = [
                // API 1: Google Translate (‰ΩøÁî® sl=zh)
                async () => {
                    try {
                        const response = await Promise.race([
                            fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=zh&tl=en&dt=t&q=${encodeURIComponent(textToTranslate)}`),
                            createTimeoutPromise(2000)
                        ]);
                        if (response.ok) {
                            const data = await response.json();
                            if (data && data[0]) {
                                const translated = data[0].map(item => item[0]).filter(t => t).join('');
                                if (translated) {
                                    console.log('‚úÖ Google Translate (zh‚Üíen) ÊàêÂäü:', translated);
                                    return translated;
                                }
                            }
                        }
                    } catch (e) {
                        console.warn('Google Translate (zh‚Üíen) Â§±Ë¥•');
                    }
                    return null;
                },

                // API 2: Google Translate (Â∞ùËØï sl=zh-CN)
                async () => {
                    try {
                        const response = await Promise.race([
                            fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=zh-CN&tl=en&dt=t&q=${encodeURIComponent(textToTranslate)}`),
                            createTimeoutPromise(2000)
                        ]);
                        if (response.ok) {
                            const data = await response.json();
                            if (data && data[0]) {
                                const translated = data[0].map(item => item[0]).filter(t => t).join('');
                                if (translated) {
                                    console.log('‚úÖ Google Translate (zh-CN‚Üíen) ÊàêÂäü:', translated);
                                    return translated;
                                }
                            }
                        }
                    } catch (e) {
                        console.warn('Google Translate (zh-CN‚Üíen) Â§±Ë¥•');
                    }
                    return null;
                },

                // API 3: MyMemory
                async () => {
                    try {
                        const response = await Promise.race([
                            fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(textToTranslate)}&langpair=zh|en`),
                            createTimeoutPromise(3000)
                        ]);
                        if (response.ok) {
                            const data = await response.json();
                            if (data.responseData && data.responseData.translatedText) {
                                console.log('‚úÖ MyMemory (zh‚Üíen) ÊàêÂäü:', data.responseData.translatedText);
                                return data.responseData.translatedText;
                            }
                        }
                    } catch (e) {
                        console.warn('MyMemory (zh‚Üíen) Â§±Ë¥•');
                    }
                    return null;
                },

                // API 4: LibreTranslate
                async () => {
                    try {
                        const response = await Promise.race([
                            fetch('https://libretranslate.de/translate', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    q: textToTranslate,
                                    source: 'zh',
                                    target: 'en',
                                    format: 'text'
                                })
                            }),
                            createTimeoutPromise(3000)
                        ]);
                        if (response.ok) {
                            const data = await response.json();
                            if (data.translatedText) {
                                console.log('‚úÖ LibreTranslate (zh‚Üíen) ÊàêÂäü:', data.translatedText);
                                return data.translatedText;
                            }
                        }
                    } catch (e) {
                        console.warn('LibreTranslate (zh‚Üíen) Â§±Ë¥•');
                    }
                    return null;
                },

                // API 5: Â∞ùËØï‰ΩøÁî® translate.googleapis.com ÁöÑÂè¶‰∏Ä‰∏™Á´ØÁÇπ
                async () => {
                    try {
                        const response = await Promise.race([
                            fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=zh-CN&tl=en&q=${encodeURIComponent(textToTranslate)}`),
                            createTimeoutPromise(2000)
                        ]);
                        if (response.ok) {
                            const data = await response.json();
                            if (data && data[0]) {
                                const translated = data[0].map(item => item[0]).filter(t => t).join('');
                                if (translated) {
                                    console.log('‚úÖ Google Translate alt (zh‚Üíen) ÊàêÂäü:', translated);
                                    return translated;
                                }
                            }
                        }
                    } catch (e) {
                        console.warn('Google Translate alt (zh‚Üíen) Â§±Ë¥•');
                    }
                    return null;
                }
            ];

            // ‰æùÊ¨°Â∞ùËØïÂêÑ‰∏™API
            const apiNames = ['Google Translate (zh)', 'Google Translate (zh-CN)', 'MyMemory', 'LibreTranslate', 'Google Translate alt'];
            for (let i = 0; i < apis.length; i++) {
                try {
                    const result = await apis[i]();
                    if (result && result.trim()) {
                        return result.trim();
                    }
                } catch (error) {
                    console.warn(`ÁøªËØëAPI ${apiNames[i]}Â§±Ë¥•ÔºåÂ∞ùËØï‰∏ã‰∏Ä‰∏™`);
                }
            }

            // ÊúÄÂêéÂ∞ùËØïÔºöÊ£ÄÊü•Êú¨Âú∞Êò†Â∞ÑË°®
            if (commonTranslations[textToTranslate]) {
                console.log(`‚úÖ ‰ΩøÁî®Êú¨Âú∞Êò†Â∞Ñ: ${textToTranslate} ‚Üí ${commonTranslations[textToTranslate]}`);
                return commonTranslations[textToTranslate];
            }

            console.warn('‚ö†Ô∏è ÊâÄÊúâÁøªËØëAPIÂùáÂ§±Ë¥•Ôºå‰∏≠ÁøªËã±ËøîÂõûÁ©∫Â≠óÁ¨¶‰∏≤');
            return '';
        }

        // ÁøªËØëËã±ÊñáÂà∞‰∏≠ÊñáÔºà‰ΩøÁî®Â§ö‰∏™ÂÖçË¥πÁøªËØëAPIÔºåÊèêÈ´òÊàêÂäüÁéáÔºå‰ºòÂåñË∂ÖÊó∂Ôºâ
        async function translateToChinese(text) {
            if (!text || text.trim() === '') return '';

            // ÈôêÂà∂ÁøªËØëÊñáÊú¨ÈïøÂ∫¶
            const textToTranslate = text.length > 500 ? text.substring(0, 500) : text;

            // ‰∏∫ÊØè‰∏™APIË∞ÉÁî®Ê∑ªÂä†Ë∂ÖÊó∂Ôºà3ÁßíÔºâ
            const createTimeoutPromise = (ms) => {
                return new Promise((_, reject) => {
                    setTimeout(() => reject(new Error('ÁøªËØëË∂ÖÊó∂')), ms);
                });
            };

            // Â∞ùËØïÂ§ö‰∏™ÁøªËØëAPIÔºàGoogle Translate ‰ºòÂÖàÔºâ
            const apis = [
                // API 1: Google Translate (‰ºòÂÖà‰ΩøÁî®ÔºåÂÖçË¥πÁâà)
                async () => {
                    try {
                        const response = await Promise.race([
                            fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=zh-CN&dt=t&q=${encodeURIComponent(textToTranslate)}`),
                            createTimeoutPromise(2000) // 2ÁßíË∂ÖÊó∂
                        ]);
                        if (response.ok) {
                            const data = await response.json();
                            // Google Translate API ËøîÂõûÊ†ºÂºè: [[["ÁøªËØëÊñáÊú¨", "ÂéüÂßãÊñáÊú¨"]]]
                            if (data && data[0]) {
                                // ÊèêÂèñÊâÄÊúâÁøªËØëÁâáÊÆµÂπ∂ÊãºÊé•
                                const translated = data[0].map(item => item[0]).filter(t => t).join('');
                                if (translated) {
                                    console.log('‚úÖ Google Translate ÁøªËØëÊàêÂäü:', translated);
                                    return translated;
                                }
                            }
                        }
                    } catch (e) {
                        // ÈùôÈªòÂ§±Ë¥•
                    }
                    return null;
                },

                // API 2: MyMemory (Â§áÁî®)
                async () => {
                    try {
                        const response = await Promise.race([
                            fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(textToTranslate)}&langpair=en|zh`),
                            createTimeoutPromise(3000)
                        ]);
                        if (response.ok) {
                            const data = await response.json();
                            if (data.responseData && data.responseData.translatedText) {
                                console.log('‚úÖ MyMemory ÁøªËØëÊàêÂäü:', data.responseData.translatedText);
                                return data.responseData.translatedText;
                            }
                        }
                    } catch (e) {
                        // ÈùôÈªòÂ§±Ë¥•
                    }
                    return null;
                },

                // API 3: LibreTranslate (ÊúÄÂêéÂ§áÈÄâ)
                async () => {
                    try {
                        const response = await Promise.race([
                            fetch('https://libretranslate.de/translate', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    q: textToTranslate,
                                    source: 'en',
                                    target: 'zh',
                                    format: 'text'
                                })
                            }),
                            createTimeoutPromise(3000)
                        ]);
                        if (response.ok) {
                            const data = await response.json();
                            return data.translatedText || '';
                        }
                    } catch (e) { }
                    return null;
                }
            ];

            // ‰æùÊ¨°Â∞ùËØïÂêÑ‰∏™API
            const apiNames = ['Google Translate', 'MyMemory', 'LibreTranslate'];
            for (let i = 0; i < apis.length; i++) {
                try {
                    const result = await apis[i]();
                    if (result && result.trim()) {
                        currentTranslationSource = apiNames[i];
                        console.log(`‚úÖ ‰ΩøÁî®ÁøªËØëÊ∫ê: ${apiNames[i]}`);
                        return result.trim();
                    }
                } catch (error) {
                    // ÈùôÈªòÂ§±Ë¥•Ôºå‰∏çËæìÂá∫Ë≠¶Âëä
                }
            }

            currentTranslationSource = '';
            return '';
        }

        // ÊóßÁâàÁøªËØëÂáΩÊï∞Ôºà‰øùÊåÅÂÖºÂÆπÊÄßÔºå‰ΩÜÂ∑≤Â∫üÂºÉÔºâ
        async function translateToChineseOld(text) {
            if (!text || text.trim() === '') return '';

            try {
                // ÈôêÂà∂ÁøªËØëÊñáÊú¨ÈïøÂ∫¶ÔºàAPIÈôêÂà∂Ôºâ
                const textToTranslate = text.length > 500 ? text.substring(0, 500) : text;

                // ‰ΩøÁî®MyMemoryÂÖçË¥πÁøªËØëAPI
                const response = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(textToTranslate)}&langpair=en|zh`);

                if (!response.ok) {
                    console.warn('ÁøªËØëAPIÂìçÂ∫îÈîôËØØ:', response.status);
                    return '';
                }

                const data = await response.json();

                if (data.responseData && data.responseData.translatedText) {
                    const translated = data.responseData.translatedText.trim();
                    // Ê£ÄÊü•ÁøªËØëÊòØÂê¶ÊúâÊïàÔºà‰∏çÊòØÂéüÂßãÊñáÊú¨Ôºâ
                    if (translated && translated !== textToTranslate) {
                        return translated;
                    }
                }
                return '';
            } catch (error) {
                console.error('ÁøªËØëÂ§±Ë¥•:', error);
                return '';
            }
        }

        // ÂàáÊç¢Ê†áÁ≠æÈ°µ
        function switchDictTab(tab) {
            document.querySelectorAll('.dict-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.dict-tab-content').forEach(c => c.classList.remove('active'));

            if (tab === 'meanings') {
                document.querySelectorAll('.dict-tab')[0].classList.add('active');
                document.getElementById('dictMeanings').classList.add('active');
            } else {
                document.querySelectorAll('.dict-tab')[1].classList.add('active');
                document.getElementById('dictExamples').classList.add('active');
            }
        }

        // ÂèëÈü≥ÂäüËÉΩ
        function pronounceWord(word) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = 'en-US';
                utterance.rate = 0.9;
                speechSynthesis.speak(utterance);
            } else {
                alert('ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅËØ≠Èü≥ÂäüËÉΩ');
            }
        }

        // ‰øùÂ≠òÁîüËØçÊú¨Âà∞localStorageÔºàÂ¢ûÂº∫ÁâàÔºåËá™Âä®Â§á‰ªΩÔºåÂ∏¶È™åËØÅÔºâ
        function saveWordbook() {
            try {
                const jsonString = JSON.stringify(wordbookData);
                const dataLength = wordbookData.length;

                // ÂÖà‰øùÂ≠òÂà∞Â§á‰ªΩÔºåÂÜç‰øùÂ≠òÂà∞‰∏ªkeyÔºàÂèåÈáç‰øùÈô©Ôºâ
                const saveKeys = ['petWordbook_backup', 'petWordbook', 'petWordbook_old'];
                let saveSuccess = false;

                saveKeys.forEach(key => {
                    try {
                        localStorage.setItem(key, jsonString);
                        console.log(`‚úÖ ÁîüËØçÊú¨Â∑≤‰øùÂ≠òÂà∞ ${key}:`, dataLength, '‰∏™ÂçïËØç');
                        saveSuccess = true;
                    } catch (e) {
                        console.warn(`‚ö†Ô∏è ‰øùÂ≠òÂà∞ ${key} Â§±Ë¥•:`, e);
                    }
                });

                if (!saveSuccess) {
                    throw new Error('ÊâÄÊúâ‰øùÂ≠ò‰ΩçÁΩÆÈÉΩÂ§±Ë¥•');
                }

                // Âª∂ËøüÈ™åËØÅ‰øùÂ≠òÊòØÂê¶ÊàêÂäüÔºà100msÂêéÔºâ
                setTimeout(() => {
                    const verifySaved = localStorage.getItem('petWordbook');
                    if (verifySaved) {
                        try {
                            const verifyParsed = JSON.parse(verifySaved);
                            if (verifyParsed.length === dataLength) {
                                console.log('‚úÖ ÁîüËØçÊú¨‰øùÂ≠òÈ™åËØÅÊàêÂäü:', verifyParsed.length, '‰∏™ÂçïËØç');
                            } else {
                                console.warn('‚ö†Ô∏è ‰øùÂ≠òÈ™åËØÅÂ§±Ë¥•ÔºåÊï∞ÊçÆÊï∞Èáè‰∏çÂåπÈÖç:', verifyParsed.length, 'vs', dataLength);
                                // ÈáçÊñ∞‰øùÂ≠ò
                                try {
                                    localStorage.setItem('petWordbook', jsonString);
                                    console.log('üîÑ Â∑≤ÈáçÊñ∞‰øùÂ≠òÁîüËØçÊú¨');
                                } catch (e) {
                                    console.error('‚ùå ÈáçÊñ∞‰øùÂ≠òÂ§±Ë¥•:', e);
                                }
                            }
                        } catch (e) {
                            console.error('‚ùå È™åËØÅÊó∂Ëß£ÊûêÂ§±Ë¥•:', e);
                        }
                    } else {
                        console.error('‚ùå ‰øùÂ≠òÈ™åËØÅÂ§±Ë¥•ÔºålocalStorage‰∏≠Ê≤°ÊúâÊï∞ÊçÆ');
                        // Â∞ùËØïÈáçÊñ∞‰øùÂ≠ò
                        try {
                            localStorage.setItem('petWordbook', jsonString);
                            console.log('üîÑ Â∑≤ÈáçÊñ∞‰øùÂ≠òÁîüËØçÊú¨');
                        } catch (e) {
                            console.error('‚ùå ÈáçÊñ∞‰øùÂ≠òÂ§±Ë¥•:', e);
                        }
                    }
                }, 100);

                return true;
            } catch (error) {
                console.error('‚ùå ‰øùÂ≠òÁîüËØçÊú¨Â§±Ë¥•:', error);
                // Â∞ùËØï‰øùÂ≠òÂà∞Â§áÁî®key
                try {
                    localStorage.setItem('petWordbook_backup', JSON.stringify(wordbookData));
                    console.log('‚úÖ Â∑≤‰øùÂ≠òÂà∞Â§áÁî®‰ΩçÁΩÆ');
                    return true;
                } catch (backupError) {
                    console.error('‚ùå Â§áÁî®‰øùÂ≠ò‰πüÂ§±Ë¥•:', backupError);
                    return false;
                }
            }
        }

        // ‰ªélocalStorageÂä†ËΩΩÁîüËØçÊú¨ÔºàÂ¢ûÂº∫ÁâàÔºåÊîØÊåÅÂ§öÂ§á‰ªΩÊÅ¢Â§çÔºâ
        function loadWordbook() {
            try {
                // Â∞ùËØï‰ªéÂ§ö‰∏™ÂèØËÉΩÁöÑkeyÂä†ËΩΩÔºàÊåâ‰ºòÂÖàÁ∫ßÔºâ
                const loadKeys = ['petWordbook', 'petWordbook_backup', 'petWordbook_old'];
                let saved = null;
                let loadedFrom = null;

                for (const key of loadKeys) {
                    const data = localStorage.getItem(key);
                    if (data) {
                        try {
                            const parsed = JSON.parse(data);
                            if (Array.isArray(parsed) && parsed.length > 0) {
                                saved = data;
                                loadedFrom = key;
                                console.log(`üì• ‰ªé ${key} Âä†ËΩΩÁîüËØçÊú¨:`, parsed.length, '‰∏™ÂçïËØç');
                                break;
                            }
                        } catch (e) {
                            console.warn(`‚ö†Ô∏è ${key} Êï∞ÊçÆÊ†ºÂºèÈîôËØØÔºåË∑≥Ëøá:`, e);
                        }
                    }
                }

                // Â¶ÇÊûú‰∏ªkeyÊ≤°ÊúâÊï∞ÊçÆÔºå‰ΩÜÂ§á‰ªΩÊúâÊï∞ÊçÆÔºåÊÅ¢Â§çÂêé‰øùÂ≠òÂà∞‰∏ªkey
                if (saved && loadedFrom !== 'petWordbook') {
                    console.log(`‚ö†Ô∏è ‰ªéÂ§áÁî®‰ΩçÁΩÆ ${loadedFrom} ÊÅ¢Â§çÁîüËØçÊú¨Ôºå‰øùÂ≠òÂà∞‰∏ªkey`);
                    try {
                        localStorage.setItem('petWordbook', saved);
                        localStorage.setItem('petWordbook_backup', saved);
                        console.log('‚úÖ Â∑≤ÂêåÊ≠•Âà∞ÊâÄÊúâÂ§á‰ªΩ‰ΩçÁΩÆ');
                    } catch (e) {
                        console.warn('‚ö†Ô∏è ÂêåÊ≠•Âà∞‰∏ªkeyÂ§±Ë¥•:', e);
                    }
                }

                if (saved) {
                    wordbookData = JSON.parse(saved);
                    if (!Array.isArray(wordbookData)) {
                        console.warn('‚ö†Ô∏è ÁîüËØçÊú¨Êï∞ÊçÆ‰∏çÊòØÊï∞ÁªÑÔºåÈáçÁΩÆ‰∏∫Á©∫Êï∞ÁªÑ');
                        wordbookData = [];
                    } else {
                        console.log('‚úÖ ÁîüËØçÊú¨Â∑≤Âä†ËΩΩ:', wordbookData.length, '‰∏™ÂçïËØç');
                    }
                } else {
                    wordbookData = [];
                    console.log('üìù È¶ñÊ¨°‰ΩøÁî®ÁîüËØçÊú¨ÊàñÊ≤°ÊúâÊâæÂà∞‰øùÂ≠òÁöÑÊï∞ÊçÆ');
                }
            } catch (error) {
                console.error('‚ùå Âä†ËΩΩÁîüËØçÊú¨Â§±Ë¥•:', error);
                // Â∞ùËØï‰ªéÊâÄÊúâÂ§á‰ªΩÊÅ¢Â§ç
                const backupKeys = ['petWordbook_backup', 'petWordbook_old'];
                for (const key of backupKeys) {
                    try {
                        const backup = localStorage.getItem(key);
                        if (backup) {
                            wordbookData = JSON.parse(backup);
                            if (Array.isArray(wordbookData)) {
                                // ÊÅ¢Â§çÂêé‰øùÂ≠òÂà∞‰∏ªkeyÂíåÊâÄÊúâÂ§á‰ªΩ
                                const jsonString = JSON.stringify(wordbookData);
                                localStorage.setItem('petWordbook', jsonString);
                                localStorage.setItem('petWordbook_backup', jsonString);
                                console.log(`‚úÖ Â∑≤‰ªé ${key} ÊÅ¢Â§çÁîüËØçÊú¨Âπ∂ÂêåÊ≠•:`, wordbookData.length, '‰∏™ÂçïËØç');
                                return;
                            }
                        }
                    } catch (backupError) {
                        console.warn(`‚ö†Ô∏è ‰ªé ${key} ÊÅ¢Â§çÂ§±Ë¥•:`, backupError);
                    }
                }
                wordbookData = [];
                console.log('‚ùå ÊâÄÊúâÊÅ¢Â§çÂ∞ùËØïÈÉΩÂ§±Ë¥•Ôºå‰ΩøÁî®Á©∫ÁîüËØçÊú¨');
            }
        }

        // Ê∑ªÂä†Âà∞ÁîüËØçÊú¨ÔºàÁã¨Á´ãÂ≠òÂÇ®Ôºå‰∏çÊ∑ªÂä†Âà∞ÂçïËØçËÉåËØµÊ®°ÂùóÔºâ
        function addWordToVocab(word, dictDataStr) {
            try {
                // Ëß£ÊûêÊï∞ÊçÆÔºàÂ§ÑÁêÜËΩ¨‰πâÂ≠óÁ¨¶Ôºâ
                let dictData;
                try {
                    dictData = JSON.parse(dictDataStr);
                } catch (e) {
                    // Â¶ÇÊûúËß£ÊûêÂ§±Ë¥•ÔºåÂ∞ùËØïÁõ¥Êé•‰ΩøÁî®ÔºàÂèØËÉΩÊòØÂ∑≤ÁªèËß£ÊûêÁöÑÂØπË±°Ôºâ
                    dictData = typeof dictDataStr === 'string' ? JSON.parse(dictDataStr) : dictDataStr;
                }

                // Ê£ÄÊü•ÊòØÂê¶Â∑≤Âú®ÁîüËØçÊú¨‰∏≠Â≠òÂú®
                const existingIndex = wordbookData.findIndex(v => v.word.toLowerCase() === word.toLowerCase());

                if (existingIndex >= 0) {
                    alert('ËØ•ÂçïËØçÂ∑≤Âú®ÁîüËØçÊú¨‰∏≠ÔºÅ');
                    return;
                }

                // Ëé∑ÂèñÁ¨¨‰∏Ä‰∏™Ëã±ÊñáÈáä‰πâ‰Ωú‰∏∫meaning
                let meaning = 'Êú™ÊâæÂà∞Èáä‰πâ';
                // ‰ΩøÁî®ÂçïËØçÁöÑ‰∏≠ÊñáÈáä‰πâÔºàÂÖºÂÆπÊñ∞ÊóßÊ†ºÂºèÔºâ
                let chinese = '';
                if (dictData.chineseMeanings && Array.isArray(dictData.chineseMeanings) && dictData.chineseMeanings.length > 0) {
                    chinese = dictData.chineseMeanings.join('Ôºõ');
                } else if (dictData.chineseMeaning) {
                    chinese = dictData.chineseMeaning;
                }

                if (dictData.meanings && dictData.meanings.length > 0) {
                    const firstDef = dictData.meanings[0].definitions[0];
                    if (firstDef) {
                        meaning = firstDef.definition || '';
                    }
                }

                // Ëé∑ÂèñÁ¨¨‰∏Ä‰∏™‰æãÂè•‰Ωú‰∏∫example
                let example = '';
                for (const meaningItem of dictData.meanings || []) {
                    for (const def of meaningItem.definitions || []) {
                        if (def.example) {
                            example = def.example;
                            break;
                        }
                    }
                    if (example) break;
                }

                // Ê∑ªÂä†Âà∞Áã¨Á´ãÁöÑÁîüËØçÊú¨ÔºàÂåÖÂê´‰∏≠ÊñáÁøªËØëÂíåÊ∑ªÂä†Êó•ÊúüÔºâ
                const newWord = {
                    word: word,
                    meaning: meaning,
                    chinese: chinese,
                    example: example || `${word} is a useful word.`,
                    addedDate: new Date().toISOString().split('T')[0] // YYYY-MM-DD
                };

                wordbookData.push(newWord);
                saveWordbook();

                // È¶ñÊ¨°Ê∑ªÂä†ÁîüËØçÊú¨ÔºåÂ•ñÂä±ÁßØÂàÜ
                if (!hasAddedToVocab) {
                    hasAddedToVocab = true;
                    addReward(5, "È¶ñÊ¨°Ê∑ªÂä†ÁîüËØçÊú¨");
                } else {
                    addReward(2, "Ê∑ªÂä†ÁîüËØçÊú¨");
                }

                alert(`‚úÖ "${word}" Â∑≤Ê∑ªÂä†Âà∞ÁîüËØçÊú¨ÔºÅ`);

                // Â¶ÇÊûúÁîüËØçÊú¨Ê®°ÂùóÂèØËßÅÔºåÂà∑Êñ∞ÊòæÁ§∫
                const wordbookCard = document.getElementById('wordbook');
                if (wordbookCard && !wordbookCard.hidden) {
                    renderWordbook();
                }
            } catch (error) {
                console.error('‚ùå Ê∑ªÂä†ÁîüËØçÊú¨Â§±Ë¥•:', error);
                console.error('ÈîôËØØËØ¶ÊÉÖ:', {
                    word: word,
                    dictDataStr: dictDataStr,
                    error: error.message
                });
                alert('Ê∑ªÂä†Â§±Ë¥•ÔºåËØ∑ÈáçËØï„ÄÇÈîôËØØÔºö' + error.message);
            }
        }

        // ============ Ëá™ÂÆö‰πâAlertÂäüËÉΩ ============

        // ÊòæÁ§∫Ëá™ÂÆö‰πâAlertÔºàÂ∏¶ÂÖ≥Èó≠ÊåâÈíÆÔºâ
        function showCustomAlert(message, title = 'ÊèêÁ§∫') {
            const modal = document.getElementById('customAlertModal');
            const titleEl = document.getElementById('customAlertTitle');
            const bodyEl = document.getElementById('customAlertBody');

            if (!modal || !titleEl || !bodyEl) {
                // Â¶ÇÊûúÂÖÉÁ¥†‰∏çÂ≠òÂú®ÔºåÂõûÈÄÄÂà∞ÂéüÁîüalert
                alert(message);
                return;
            }

            titleEl.textContent = title;
            bodyEl.textContent = message;
            modal.classList.add('show');

            // ÁÇπÂáªËÉåÊôØÂÖ≥Èó≠
            modal.addEventListener('click', function closeOnBackground(e) {
                if (e.target === modal) {
                    closeCustomAlert();
                    modal.removeEventListener('click', closeOnBackground);
                }
            });

            // ESCÈîÆÂÖ≥Èó≠
            const escHandler = function (e) {
                if (e.key === 'Escape') {
                    closeCustomAlert();
                    document.removeEventListener('keydown', escHandler);
                }
            };
            document.addEventListener('keydown', escHandler);
        }

        // ÂÖ≥Èó≠Ëá™ÂÆö‰πâAlert
        function closeCustomAlert() {
            const modal = document.getElementById('customAlertModal');
            if (modal) {
                modal.classList.remove('show');
            }
        }

        // Á°Æ‰øùÂáΩÊï∞ÂÖ®Â±ÄÂèØËÆøÈóÆ
        window.showCustomAlert = showCustomAlert;
        window.closeCustomAlert = closeCustomAlert;

        // ============ üìö ÁîüËØçÊú¨Ê®°ÂùóÂäüËÉΩ ============

        // Ê∏≤ÊüìÁîüËØçÊú¨ÂàóË°®Ôºà‰ΩøÁî®Áã¨Á´ãÁöÑÁîüËØçÊú¨Êï∞ÊçÆÔºâ
        function renderWordbook(searchTerm = '') {
            const wordbookList = document.getElementById('wordbookList');
            const wordbookEmpty = document.getElementById('wordbookEmpty');
            const wordbookCount = document.getElementById('wordbookCount');
            const wordbookSearch = document.getElementById('wordbookSearch');

            if (!wordbookList || !wordbookEmpty || !wordbookCount) return;

            // ‰ΩøÁî®Áã¨Á´ãÁöÑÁîüËØçÊú¨Êï∞ÊçÆÔºåËÄå‰∏çÊòØdata.vocab
            let filteredVocab = wordbookData || [];
            if (searchTerm) {
                const term = searchTerm.toLowerCase();
                filteredVocab = filteredVocab.filter(item =>
                    item.word.toLowerCase().includes(term) ||
                    (item.meaning && item.meaning.toLowerCase().includes(term)) ||
                    (item.chinese && item.chinese.includes(term))
                );
            }

            wordbookCount.textContent = filteredVocab.length;

            if (filteredVocab.length === 0) {
                wordbookList.innerHTML = '';
                wordbookEmpty.style.display = 'block';
                return;
            }

            wordbookEmpty.style.display = 'none';
            wordbookList.innerHTML = '';

            filteredVocab.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'wordbook-item';
                // ËΩ¨‰πâHTMLÔºåÈò≤Ê≠¢XSSÊîªÂáª
                const word = escapeHtml(item.word);
                const meaning = escapeHtml(item.meaning || 'Êó†Èáä‰πâ');
                const chinese = item.chinese ? escapeHtml(item.chinese) : '';
                const example = item.example ? escapeHtml(item.example) : '';

                itemDiv.innerHTML = `
                <div class="wordbook-item-header">
                    <div class="wordbook-word">${word}</div>
                    <div class="wordbook-actions">
                        <button class="wordbook-btn" onclick="queryWordFromWordbook('${word.replace(/'/g, "\\'")}')" title="Êü•ËØ¢">üîç</button>
                        <button class="wordbook-btn danger" onclick="deleteWordFromWordbook(${index})" title="Âà†Èô§">üóëÔ∏è</button>
                    </div>
                </div>
                <div class="wordbook-meaning">${meaning}</div>
                ${chinese ? `<div class="wordbook-chinese">${chinese}</div>` : ''}
                ${example ? `<div class="wordbook-example">${example}</div>` : ''}
            `;
                wordbookList.appendChild(itemDiv);
            });
        }

        // ‰ªéÁîüËØçÊú¨Êü•ËØ¢ÂçïËØç
        function queryWordFromWordbook(word) {
            showDictModal(word);
        }

        // ‰ªéÁîüËØçÊú¨Âà†Èô§ÂçïËØçÔºà‰ΩøÁî®Áã¨Á´ãÁöÑÁîüËØçÊú¨Êï∞ÊçÆÔºâ
        function deleteWordFromWordbook(index) {
            const wordbookSearch = document.getElementById('wordbookSearch');
            const searchTerm = wordbookSearch ? wordbookSearch.value : '';

            // Â¶ÇÊûúÊúâÊêúÁ¥¢ÔºåÈúÄË¶ÅÊâæÂà∞ÂÆûÈôÖÁ¥¢Âºï
            let actualIndex = index;
            if (searchTerm) {
                const term = searchTerm.toLowerCase();
                const filteredVocab = (wordbookData || []).filter(item =>
                    item.word.toLowerCase().includes(term) ||
                    (item.meaning && item.meaning.toLowerCase().includes(term)) ||
                    (item.chinese && item.chinese.includes(term))
                );
                if (filteredVocab[index]) {
                    const wordToDelete = filteredVocab[index].word;
                    actualIndex = wordbookData.findIndex(v => v.word.toLowerCase() === wordToDelete.toLowerCase());
                }
            }

            if (actualIndex >= 0 && actualIndex < wordbookData.length) {
                const word = wordbookData[actualIndex].word;
                if (confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§ÂçïËØç "${word}" ÂêóÔºü`)) {
                    wordbookData.splice(actualIndex, 1);
                    saveWordbook();
                    renderWordbook(searchTerm);
                    alert(`‚úÖ "${word}" Â∑≤‰ªéÁîüËØçÊú¨Âà†Èô§`);
                }
            }
        }

        // ÂØºÂá∫ÁîüËØçÊú¨Ôºà‰ΩøÁî®Áã¨Á´ãÁöÑÁîüËØçÊú¨Êï∞ÊçÆÔºâ
        function exportWordbook() {
            try {
                const exportData = {
                    vocab: wordbookData || [],
                    exportDate: new Date().toISOString(),
                    count: (wordbookData || []).length
                };

                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `ÁîüËØçÊú¨_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                alert('‚úÖ ÁîüËØçÊú¨ÂØºÂá∫ÊàêÂäüÔºÅ');
            } catch (error) {
                console.error('ÂØºÂá∫Â§±Ë¥•:', error);
                alert('‚ùå ÂØºÂá∫Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
            }
        }

        // ÂØºÂá∫ÊâÄÊúâÊï∞ÊçÆ
        function exportAllData() {
            try {
                // Êî∂ÈõÜÊâÄÊúâÊï∞ÊçÆ
                const exportData = {
                    exportDate: new Date().toISOString(),
                    version: '1.0',
                    data: {
                        // ÂçïËØçÊï∞ÊçÆ
                        vocab: data.vocab || [],

                        // ÈòÖËØªÁêÜËß£Êï∞ÊçÆ
                        readingSets: data.readingSets || [],

                        // Âõ∫ÂÆöÊê≠ÈÖçÊï∞ÊçÆ
                        collocationSets: data.collocationSets || [],

                        // ÂÆåÂΩ¢Â°´Á©∫Êï∞ÊçÆ
                        clozeSets: data.clozeSets || [],

                        // ÊâìÂç°ËÆ∞ÂΩï
                        checkinRecords: JSON.parse(localStorage.getItem('pet_checkin_records') || '[]') || [],

                        // ÁîüËØçÊú¨Êï∞ÊçÆ
                        wordbook: wordbookData || [],

                        // Â≠¶‰π†ÁªüËÆ°
                        stats: {
                            vocabCount: (data.vocab || []).length,
                            readingCount: (data.readingSets || []).length,
                            collocationCount: (data.collocationSets || []).length,
                            clozeCount: (data.clozeSets || []).length,
                            wordbookCount: (wordbookData || []).length,
                            checkinCount: (JSON.parse(localStorage.getItem('pet_checkin_records') || '[]') || []).length
                        }
                    }
                };

                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `PETËã±ËØ≠Â±ã_ÂÖ®ÈÉ®Êï∞ÊçÆ_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                alert(`‚úÖ Êï∞ÊçÆÂØºÂá∫ÊàêÂäüÔºÅ\n\nÂåÖÂê´Ôºö\n- ÂçïËØç: ${exportData.data.stats.vocabCount} ‰∏™\n- ÈòÖËØª: ${exportData.data.stats.readingCount} È¢ò\n- Êê≠ÈÖç: ${exportData.data.stats.collocationCount} È¢ò\n- ÂÆåÂΩ¢: ${exportData.data.stats.clozeCount} È¢ò\n- ÁîüËØçÊú¨: ${exportData.data.stats.wordbookCount} ‰∏™\n- ÊâìÂç°: ${exportData.data.stats.checkinCount} Êù°`);
            } catch (error) {
                console.error('‚ùå ÂØºÂá∫Â§±Ë¥•:', error);
                alert('‚ùå ÂØºÂá∫Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
            }
        }

        // ÂØºÂÖ•ÁîüËØçÊú¨ÔºàËß¶ÂèëÊñá‰ª∂ÈÄâÊã©Ôºâ
        function importWordbook() {
            const input = document.getElementById('wordbookFileInput');
            if (input) {
                input.click();
            }
        }

        // ÂÖ≥Èó≠ÊâÄÊúâÊ®°ÊÄÅÊ°Ü
        function closeAllModals() {
            console.log('üîÑ ÂÖ≥Èó≠ÊâÄÊúâÊ®°ÊÄÅÊ°Ü');
            // ÂÖ≥Èó≠ÊâÄÊúâÊ®°ÊÄÅÊ°Ü
            document.querySelectorAll('.dict-modal.show').forEach(modal => {
                modal.classList.remove('show');
                console.log('‚úÖ Â∑≤ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü:', modal.id);
            });
        }

        // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°ÜÔºà‰øùÊåÅÂÖºÂÆπÊÄßÔºâ
        function closeDictModal() {
            console.log('üîÑ ÂÖ≥Èó≠ËØçÂÖ∏Ê®°ÊÄÅÊ°Ü');
            closeAllModals();
        }

        // Á°Æ‰øùÂáΩÊï∞ÂÖ®Â±ÄÂèØËÆøÈóÆ
        window.closeDictModal = closeDictModal;
        window.closeAllModals = closeAllModals;

        // ËΩ¨‰πâHTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ÊñáÊú¨È´ò‰∫ÆÂíåÂèåÂáªÊü•ËØ¢Ôºà‰ºòÂåñÁâàÔºåÈò≤Ê≠¢Êó†ÈôêÂæ™ÁéØÔºâ
        let isHighlighting = false; // Èò≤Ê≠¢ÈáçÂ§çÈ´ò‰∫ÆÁöÑÊ†áÂøó

        // ‰∏∫Âçï‰∏™ÂÖÉÁ¥†Ê∑ªÂä†ÂèåÂáªÊü•ËØ¢ÂäüËÉΩ
        function addDoubleClickQuery(element) {
            if (!element) {
                console.warn('‚ö†Ô∏è addDoubleClickQuery: element ‰∏∫Á©∫');
                return;
            }

            // Ê£ÄÊü•ÂÖÉÁ¥†ÊòØÂê¶ËøòÂú®DOM‰∏≠
            if (!element.isConnected) {
                console.warn('‚ö†Ô∏è addDoubleClickQuery: element ‰∏çÂú®DOM‰∏≠ÔºåË∑≥Ëøá');
                return;
            }

            // ÁßªÈô§ÊóßÁöÑ‰∫ã‰ª∂ÁõëÂê¨Âô®ÔºàÈÄöËøáÂÖãÈöÜËäÇÁÇπÔºâ
            let newElement = element;

            // Âè™Âú®ÂÖÉÁ¥†ÊúâÁà∂ËäÇÁÇπÊó∂ÊâçÂ∞ùËØïÊõøÊç¢
            if (element.parentNode) {
                try {
                    newElement = element.cloneNode(true);
                    element.parentNode.replaceChild(newElement, element);
                } catch (error) {
                    console.error('‚ùå addDoubleClickQuery ÊõøÊç¢ÂÖÉÁ¥†Â§±Ë¥•:', error);
                    // Â¶ÇÊûúÊõøÊç¢Â§±Ë¥•ÔºåÁõ¥Êé•‰ΩøÁî®ÂéüÂÖÉÁ¥†
                    newElement = element;
                }
            } else {
                console.warn('‚ö†Ô∏è addDoubleClickQuery: element Ê≤°ÊúâÁà∂ËäÇÁÇπÔºåÁõ¥Êé•‰ΩøÁî®ÂéüÂÖÉÁ¥†');
                newElement = element;
            }

            // ÂèåÂáªÊü•ËØ¢
            newElement.addEventListener('dblclick', (e) => {
                e.stopPropagation();
                const selection = window.getSelection();
                const text = selection.toString().trim();

                if (text && /^[a-zA-Z]+$/.test(text)) {
                    showWordPopup(e, text);
                } else {
                    // Â¶ÇÊûúÊ≤°ÊúâÈÄâ‰∏≠ÊñáÊú¨ÔºåÂ∞ùËØï‰ªéÁÇπÂáªÁöÑÂÖÉÁ¥†Ëé∑Âèñ
                    const clickedText = e.target.textContent.trim();
                    const words = clickedText.match(/\b[a-zA-Z]{3,}\b/g);
                    if (words && words.length > 0) {
                        showWordPopup(e, words[0]);
                    }
                }
            });

            // ÈïøÊåâÊü•ËØ¢ÔºàÁßªÂä®Á´ØÔºâ
            let longPressTimer;
            newElement.addEventListener('touchstart', (e) => {
                const target = e.target;
                const text = target.textContent.trim();
                const words = text.match(/\b[a-zA-Z]{3,}\b/g);
                if (words && words.length > 0) {
                    longPressTimer = setTimeout(() => {
                        showWordPopup(e, words[0]);
                    }, 500);
                }
            });

            newElement.addEventListener('touchend', () => {
                clearTimeout(longPressTimer);
            });

            return newElement;
        }

        function enableTextQuery() {
            // Âª∂ËøüÊâßË°åÔºåÁ°Æ‰øùÊï∞ÊçÆÂä†ËΩΩÂÆåÊàê
            setTimeout(() => {
                // ‰∏∫ÊâÄÊúâÊ®°ÂùóÁöÑÊñáÊú¨Ê∑ªÂä†ÂèåÂáªÊü•ËØ¢
                const queryableElements = [
                    { id: 'wordCard', selector: '.word-card' },
                    { id: 'wordText', selector: '#wordText' },
                    { id: 'wordExample', selector: '#wordExample' },
                    { id: 'readingStory', selector: '#readingStory' },
                    { id: 'collocationSentence', selector: '#collocationSentence' },
                    { id: 'clozeContainer', selector: '#clozeContainer' }
                ];

                queryableElements.forEach(({ id, selector }) => {
                    let element = document.querySelector(selector);
                    if (element) {
                        // ‰∏∫ÂÖÉÁ¥†Ê∑ªÂä†ÂèåÂáªÊü•ËØ¢
                        addDoubleClickQuery(element);

                        // È´ò‰∫ÆÂçïËØçÔºà‰ªÖÂØπÊñáÊú¨ÂÖÉÁ¥†Ôºâ
                        if (id === 'readingStory' || id === 'collocationSentence' || id === 'clozeContainer') {
                            if (element.textContent.trim()) {
                                highlightWords(element);
                            }
                        }
                    }
                });
            }, 500); // Âª∂Ëøü500msÁ°Æ‰øùDOMÂíåÊï∞ÊçÆÈÉΩÂä†ËΩΩÂÆåÊàê
        }

        // È´ò‰∫ÆÂçïËØçÔºà‰ºòÂåñÁâàÔºåÈò≤Ê≠¢Êó†ÈôêÂæ™ÁéØÔºâ
        function highlightWords(element) {
            if (!element || isHighlighting) return; // Â¶ÇÊûúÊ≠£Âú®È´ò‰∫ÆÔºåÁõ¥Êé•ËøîÂõû

            // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÈ´ò‰∫ÆËøá
            if (element.querySelector('.word-highlight')) {
                return; // Â∑≤ÁªèÈ´ò‰∫ÆËøáÔºå‰∏çÂÜçÂ§ÑÁêÜ
            }

            isHighlighting = true; // ËÆæÁΩÆÊ†áÂøó

            try {
                const walker = document.createTreeWalker(
                    element,
                    NodeFilter.SHOW_TEXT,
                    {
                        acceptNode: function (node) {
                            // Ë∑≥ËøáÂ∑≤ÁªèÊòØÈ´ò‰∫ÆËäÇÁÇπÁöÑÂ≠êËäÇÁÇπ
                            if (node.parentElement && node.parentElement.classList.contains('word-highlight')) {
                                return NodeFilter.FILTER_REJECT;
                            }
                            return NodeFilter.FILTER_ACCEPT;
                        }
                    },
                    false
                );

                const textNodes = [];
                let node;
                while (node = walker.nextNode()) {
                    if (node.textContent.trim()) {
                        textNodes.push(node);
                    }
                }

                textNodes.forEach(textNode => {
                    const text = textNode.textContent;
                    // Âè™Â§ÑÁêÜÂåÖÂê´Ëã±ÊñáÂçïËØçÁöÑÊñáÊú¨ËäÇÁÇπ
                    if (!/^[a-zA-Z]+$/.test(text.trim()) && text.includes(' ')) {
                        const words = text.split(/(\s+|[.,!?;:])/);

                        if (words.length > 1) {
                            const fragment = document.createDocumentFragment();
                            words.forEach(word => {
                                if (/^[a-zA-Z]+$/.test(word) && word.length > 2) {
                                    const span = document.createElement('span');
                                    span.className = 'word-highlight';
                                    span.textContent = word;
                                    span.title = 'ÂèåÂáªÊü•ËØ¢';
                                    span.addEventListener('dblclick', (e) => {
                                        e.stopPropagation();
                                        showWordPopup(e, word);
                                    });
                                    fragment.appendChild(span);
                                } else {
                                    fragment.appendChild(document.createTextNode(word));
                                }
                            });
                            if (textNode.parentNode) {
                                textNode.parentNode.replaceChild(fragment, textNode);
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('È´ò‰∫ÆÂçïËØçÊó∂Âá∫Èîô:', error);
            } finally {
                isHighlighting = false; // ÈáçÁΩÆÊ†áÂøó
            }
        }

        // ÊòæÁ§∫Êü•ËØ¢Ê∞îÊ≥°
        function showWordPopup(event, word) {
            const popup = wordPopup;

            // Á´ãÂç≥ÊòæÁ§∫ÂºπÁ™óÔºà‰∏çÁ≠âÂæÖÊü•ËØ¢Ôºâ
            popup.innerHTML = `
            <div class="popup-word">${word}</div>
            <div class="popup-meaning">
                <span class="popup-loading">‚è≥ Ê≠£Âú®Êü•ËØ¢...</span>
            </div>
            <div class="popup-action">
                <button class="popup-btn" onclick="queryWordFromPopup('${word}')">üìñ ËØ¶ÁªÜÊü•ËØ¢</button>
            </div>
        `;

            const rect = event.target.getBoundingClientRect();
            popup.style.left = `${rect.left + rect.width / 2}px`;
            popup.style.top = `${rect.top - 10}px`;
            popup.style.transform = 'translate(-50%, -100%)';
            popup.classList.add('show');

            // ÂºÇÊ≠•Êü•ËØ¢Ôºà‰∏çÈòªÂ°ûÂºπÁ™óÊòæÁ§∫Ôºâ
            queryDictionary(word).then(result => {
                const meaningEl = popup.querySelector('.popup-meaning');
                if (!meaningEl) return; // ÂºπÁ™óÂèØËÉΩÂ∑≤ÂÖ≥Èó≠

                if (!result.error) {
                    // ‰ºòÂÖàÊòæÁ§∫‰∏≠ÊñáÈáä‰πâ
                    if (result.chineseMeanings && result.chineseMeanings.length > 0) {
                        meaningEl.textContent = result.chineseMeanings.slice(0, 2).join('Ôºõ');
                    }
                    // Â¶ÇÊûúÊ≤°Êúâ‰∏≠ÊñáÈáä‰πâÔºåÊòæÁ§∫Ëã±ÊñáÈáä‰πâ
                    else if (result.meanings && result.meanings.length > 0 && result.meanings[0].definitions && result.meanings[0].definitions.length > 0) {
                        const firstDef = result.meanings[0].definitions[0].definition;
                        meaningEl.textContent = firstDef ? firstDef.substring(0, 60) + '...' : 'Êú™ÊâæÂà∞Èáä‰πâ';
                    } else {
                        meaningEl.textContent = 'Êú™ÊâæÂà∞Èáä‰πâ';
                    }
                } else {
                    meaningEl.textContent = '‚ùå Êü•ËØ¢Â§±Ë¥•';
                }
            }).catch(err => {
                const meaningEl = popup.querySelector('.popup-meaning');
                if (meaningEl) {
                    meaningEl.textContent = '‚ùå Êü•ËØ¢Âá∫Èîô';
                }
            });

            // ÁÇπÂáªÂ§ñÈÉ®ÂÖ≥Èó≠
            setTimeout(() => {
                document.addEventListener('click', function closePopup(e) {
                    if (!popup.contains(e.target) && e.target !== event.target) {
                        popup.classList.remove('show');
                        document.removeEventListener('click', closePopup);
                    }
                });
            }, 100);
        }

        // ‰ªéÊ∞îÊ≥°Êü•ËØ¢ÂçïËØç
        function queryWordFromPopup(word) {
            wordPopup.classList.remove('show');
            showDictModal(word);
        }

        // ÂØºÂÖ•Ê®°ÊÄÅÊ°ÜÂäüËÉΩ
        function showImportModal() {
            importModal.classList.add("active");
            selectedFiles.innerHTML = "";
        }

        function hideImportModal() {
            importModal.classList.remove("active");
            modalImportInput.value = "";
            selectedFiles.innerHTML = "";
        }

        // ÊòæÁ§∫ÈÄâÊã©ÁöÑÊñá‰ª∂
        function displaySelectedFiles(files) {
            selectedFiles.innerHTML = "";
            Array.from(files).forEach(file => {
                const fileDiv = document.createElement("div");
                fileDiv.className = "selected-file";
                fileDiv.innerHTML = `
                <span class="file-name">üìÑ ${file.name}</span>
                <span class="file-size">${formatBytes(file.size)}</span>
            `;
                selectedFiles.appendChild(fileDiv);
            });
        }

        // Ëé∑ÂèñÈÄâÊã©ÁöÑÂØºÂÖ•Á±ªÂûã
        function getSelectedImportType() {
            return document.querySelector('input[name="importType"]:checked').value;
        }

        // Ê†πÊçÆÁ±ªÂûãÂØºÂÖ•Êñá‰ª∂
        function importXlsxBankFileByType(file, importType) {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const xlsx_data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(xlsx_data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);

                    // Ê†πÊçÆÂØºÂÖ•Á±ªÂûãÊõ¥Êñ∞Áõ∏Â∫îÊï∞ÊçÆÔºåÂπ∂ÈáçÊñ∞Âä†ËΩΩÂΩìÂâçÊòæÁ§∫ÁöÑÂÜÖÂÆπ
                    switch (importType) {
                        case 'vocab':
                            if (Array.isArray(jsonData)) {
                                data.vocab = [...(data.vocab || []), ...jsonData];
                                loadWord();
                            }
                            break;
                        case 'reading':
                            if (Array.isArray(jsonData)) {
                                data.readingSets = [...(data.readingSets || []), ...jsonData];
                                loadReading();
                            }
                            break;
                        case 'collocation':
                            if (Array.isArray(jsonData)) {
                                data.collocationSets = [...(data.collocationSets || []), ...jsonData];
                                loadCollocation();
                            }
                            break;
                        case 'cloze':
                            if (Array.isArray(jsonData)) {
                                data.clozeSets = [...(data.clozeSets || []), ...jsonData];
                                loadCloze();
                            }
                            break;
                    }

                    // Êõ¥Êñ∞ÂÜÖÂÆπÁªüËÆ°
                    updateWordCountBadge();
                    updateBankStatistics();

                    // üíæ ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®Ôºà‰ΩøÁî®Áªü‰∏Ä‰øùÂ≠òÂáΩÊï∞Ôºâ
                    if (saveDataToLocalStorage()) {
                        const verifyData = localStorage.getItem('petEnglishData');
                        if (verifyData) {
                            const verifyParsed = JSON.parse(verifyData);
                            console.log('‚úÖ Êï∞ÊçÆÂ∑≤‰øùÂ≠òÂà∞localStorage');
                            console.log('üìä ‰øùÂ≠òÈ™åËØÅ:', {
                                ÂçïËØç: verifyParsed.vocab?.length || 0,
                                ÈòÖËØª: verifyParsed.readingSets?.length || 0,
                                Âõ∫ÂÆöÊê≠ÈÖç: verifyParsed.collocationSets?.length || 0,
                                ÂÆåÂΩ¢: verifyParsed.clozeSets?.length || 0
                            });
                        }
                    } else {
                        alert('‰øùÂ≠òÊï∞ÊçÆÂ§±Ë¥•ÔºÅ\n\nËØ∑Ê£ÄÊü•ÊµèËßàÂô®ÊòØÂê¶ÂÖÅËÆ∏‰ΩøÁî®localStorageÔºåÊàñÂ∞ùËØïÊ∏ÖÈô§ÊµèËßàÂô®ÁºìÂ≠òÂêéÈáçËØï„ÄÇ');
                    }

                    // ÊòæÁ§∫ÂØºÂÖ•ÁªìÊûú
                    let importedCount = jsonData.length || 0;
                    let typeName = '';
                    switch (importType) {
                        case 'vocab':
                            typeName = 'üçé ÂçïËØç';
                            break;
                        case 'reading':
                            typeName = 'üìñ ÈòÖËØªÁêÜËß£';
                            break;
                        case 'collocation':
                            typeName = 'üîó Âõ∫ÂÆöÊê≠ÈÖç';
                            break;
                        case 'cloze':
                            typeName = 'üß© ÂÆåÂΩ¢Â°´Á©∫';
                            break;
                    }

                    if (pointsLog) {
                        pointsLog.innerHTML = `
                <div style="line-height: 1.6;">
                    üéâ <strong>È¢òÂ∫ìÂØºÂÖ•ÊàêÂäüÔºÅ</strong><br>
                    üìä Â∑≤ÂØºÂÖ• ${importedCount} ‰∏™ ${typeName}<br>
                    üíæ <strong>Êï∞ÊçÆÂ∑≤‰øùÂ≠òÂà∞Êú¨Âú∞</strong>
                </div>
            `;

                        // 5ÁßíÂêéÊÅ¢Â§çÊôÆÈÄöÊó•Âøó
                        setTimeout(() => {
                            if (pointsLog) {
                                pointsLog.textContent = "‚ú® È¢òÂ∫ìÂ∑≤Êõ¥Êñ∞Âπ∂‰øùÂ≠òÔºåÂèØ‰ª•ÂºÄÂßãÁªÉ‰π†‰∫ÜÔºÅ";
                            }
                        }, 5000);
                    }

                } catch (err) {
                    console.error(err);
                    alert(`ÂØºÂÖ•Â§±Ë¥•ÔºöËØ∑Ê£ÄÊü• Excel Êñá‰ª∂ÊòØÂê¶‰∏∫ÊúâÊïàÊ†ºÂºè„ÄÇ${err}`);
                }
            };
            reader.readAsArrayBuffer(file);
        }


        // ------------ Import Modal Event Handlers ------------
        importBtn.addEventListener("click", showImportModal);
        importCloseBtn.addEventListener("click", hideImportModal);
        cancelImportBtn.addEventListener("click", hideImportModal);

        // Ê∏ÖÈô§ÁºìÂ≠òÊåâÈíÆ
        document.getElementById("clearStorageBtn").addEventListener("click", () => {
            if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÈô§Êú¨Âú∞‰øùÂ≠òÁöÑÈ¢òÂ∫ìÊï∞ÊçÆÂêóÔºü\n\nËøôÂ∞ÜÂà†Èô§ÊâÄÊúâÂØºÂÖ•ÁöÑÈ¢òÁõÆÂíåÊâìÂç°ËÆ∞ÂΩï„ÄÇ\nÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºÅ')) {
                localStorage.removeItem('petEnglishData');
                localStorage.removeItem('petCheckinRecords');
                localStorage.removeItem('petCheckinRecords_backup'); // Ê∏ÖÈô§Â§áÁî®Êï∞ÊçÆ
                checkinRecords = []; // Ê∏ÖÁ©∫ÂÜÖÂ≠ò‰∏≠ÁöÑÊï∞ÊçÆ
                stars = 0;
                points = 0;
                alert('Êï∞ÊçÆÂ∑≤Ê∏ÖÈô§ÔºÅÈ°µÈù¢Â∞ÜÂà∑Êñ∞„ÄÇ');
                window.location.reload();
            }
        });

        // ‰ªéÂ§á‰ªΩÊÅ¢Â§çÊï∞ÊçÆ
        function restoreFromBackup(backup) {
            try {
                console.log('üîÑ ÂºÄÂßãÊÅ¢Â§çÂ§á‰ªΩÊï∞ÊçÆ:', backup.name);

                // ÂÖà‰øùÂ≠òÂΩìÂâçÊï∞ÊçÆ‰Ωú‰∏∫Â§á‰ªΩÔºà‰ª•Èò≤‰∏á‰∏ÄÔºâ
                try {
                    const currentData = {
                        vocab: data.vocab || [],
                        readingSets: data.readingSets || [],
                        collocationSets: data.collocationSets || [],
                        clozeSets: data.clozeSets || []
                    };
                    localStorage.setItem('petEnglishData_before_restore', JSON.stringify(currentData));
                    console.log('‚úÖ ÂΩìÂâçÊï∞ÊçÆÂ∑≤‰øùÂ≠ò‰∏∫Â§á‰ªΩ');
                } catch (e) {
                    console.warn('‚ö†Ô∏è ‰øùÂ≠òÂΩìÂâçÊï∞ÊçÆÂ§±Ë¥•:', e);
                }

                // ÊÅ¢Â§çÊï∞ÊçÆ
                data.vocab = Array.isArray(backup.data.vocab) ? backup.data.vocab : [];
                data.readingSets = Array.isArray(backup.data.readingSets) ? backup.data.readingSets : [];
                data.collocationSets = Array.isArray(backup.data.collocationSets) ? backup.data.collocationSets : [];
                data.clozeSets = Array.isArray(backup.data.clozeSets) ? backup.data.clozeSets : [];

                console.log('üìä ÊÅ¢Â§çÂêéÁöÑÊï∞ÊçÆ:', {
                    ÂçïËØç: data.vocab.length,
                    ÈòÖËØª: data.readingSets.length,
                    Âõ∫ÂÆöÊê≠ÈÖç: data.collocationSets.length,
                    ÂÆåÂΩ¢: data.clozeSets.length
                });

                // ‰øùÂ≠òÂà∞‰∏ªkeyÂíåÊâÄÊúâÂ§á‰ªΩ‰ΩçÁΩÆÔºàÂ§öÈáç‰øùÈöúÔºâ
                const dataToSave = {
                    vocab: data.vocab,
                    readingSets: data.readingSets,
                    collocationSets: data.collocationSets,
                    clozeSets: data.clozeSets
                };

                // È™åËØÅÊï∞ÊçÆÂÆåÊï¥ÊÄß
                if (!Array.isArray(dataToSave.vocab) || !Array.isArray(dataToSave.readingSets) ||
                    !Array.isArray(dataToSave.collocationSets) || !Array.isArray(dataToSave.clozeSets)) {
                    throw new Error('ÊÅ¢Â§çÁöÑÊï∞ÊçÆÊ†ºÂºè‰∏çÊ≠£Á°Æ');
                }

                const jsonString = JSON.stringify(dataToSave);
                if (!jsonString || jsonString === '{}') {
                    throw new Error('Êï∞ÊçÆÂ∫èÂàóÂåñÂêé‰∏∫Á©∫');
                }

                // ‰øùÂ≠òÂà∞ÊâÄÊúâ‰ΩçÁΩÆÔºà‰∏ªkey + ÊâÄÊúâÂ§á‰ªΩ‰ΩçÁΩÆÔºâ
                const saveKeys = ['petEnglishData', 'petEnglishData_backup', 'petEnglishData_old', 'petData'];
                let saveSuccess = false;
                const saveErrors = [];

                saveKeys.forEach(key => {
                    try {
                        localStorage.setItem(key, jsonString);

                        // Á´ãÂç≥È™åËØÅ‰øùÂ≠òÊòØÂê¶ÊàêÂäü
                        const verify = localStorage.getItem(key);
                        if (!verify || verify !== jsonString) {
                            throw new Error('‰øùÂ≠òÂêéÈ™åËØÅÂ§±Ë¥•');
                        }

                        console.log(`‚úÖ Â∑≤‰øùÂ≠òÂπ∂È™åËØÅ ${key}:`, {
                            ÂçïËØç: dataToSave.vocab.length,
                            ÈòÖËØª: dataToSave.readingSets.length,
                            Âõ∫ÂÆöÊê≠ÈÖç: dataToSave.collocationSets.length,
                            ÂÆåÂΩ¢: dataToSave.clozeSets.length
                        });
                        saveSuccess = true;
                    } catch (e) {
                        const errorMsg = `‰øùÂ≠òÂà∞ ${key} Â§±Ë¥•: ${e.message}`;
                        console.error(`‚ùå ${errorMsg}`);
                        saveErrors.push(errorMsg);
                    }
                });

                if (!saveSuccess) {
                    throw new Error('ÊâÄÊúâ‰øùÂ≠ò‰ΩçÁΩÆÈÉΩÂ§±Ë¥•:\n' + saveErrors.join('\n'));
                }

                // ÂÜçÊ¨°Á°ÆËÆ§‰øùÂ≠òÔºàÂª∂ËøüÈ™åËØÅÔºåÁ°Æ‰øùlocalStorageÂ∑≤ÂÆåÂÖ®ÂÜôÂÖ•Ôºâ
                setTimeout(() => {
                    const finalVerify = localStorage.getItem('petEnglishData');
                    if (finalVerify) {
                        try {
                            const parsed = JSON.parse(finalVerify);
                            console.log('‚úÖ ÊúÄÁªàÈ™åËØÅ - Êï∞ÊçÆÂ∑≤ÊàêÂäü‰øùÂ≠ò:', {
                                ÂçïËØç: parsed.vocab?.length || 0,
                                ÈòÖËØª: parsed.readingSets?.length || 0,
                                Âõ∫ÂÆöÊê≠ÈÖç: parsed.collocationSets?.length || 0,
                                ÂÆåÂΩ¢: parsed.clozeSets?.length || 0
                            });
                        } catch (e) {
                            console.error('‚ùå ÊúÄÁªàÈ™åËØÅÂ§±Ë¥•:', e);
                        }
                    } else {
                        console.error('‚ùå ÊúÄÁªàÈ™åËØÅÂ§±Ë¥•ÔºöÊó†Ê≥ïËØªÂèñ‰øùÂ≠òÁöÑÊï∞ÊçÆ');
                    }
                }, 100);

                // Êõ¥Êñ∞ÁªüËÆ°
                updateBankStatistics();

                // ÈáçÊñ∞Âä†ËΩΩÂΩìÂâçÊ®°Âùó
                if (data.vocab && data.vocab.length > 0) loadWord();
                if (data.readingSets && data.readingSets.length > 0) loadReading();
                if (data.collocationSets && data.collocationSets.length > 0) loadCollocation();
                if (data.clozeSets && data.clozeSets.length > 0) loadCloze();

                alert(`‚úÖ Êï∞ÊçÆÊÅ¢Â§çÊàêÂäüÔºÅ\n\nÂ∑≤ÊÅ¢Â§çÔºö${backup.name}\n- ÂçïËØç: ${backup.vocab} ‰∏™\n- ÈòÖËØª: ${backup.reading} È¢ò\n- Âõ∫ÂÆöÊê≠ÈÖç: ${backup.collocation} È¢ò\n- ÂÆåÂΩ¢Â°´Á©∫: ${backup.cloze} È¢ò\n\nÊï∞ÊçÆÂ∑≤‰øùÂ≠òÂà∞ÊâÄÊúâÂ§á‰ªΩ‰ΩçÁΩÆÔºà‰∏ªkey + 3‰∏™Â§á‰ªΩÔºâ„ÄÇ\nÂª∫ËÆÆÂà∑Êñ∞È°µÈù¢‰ª•Á°Æ‰øùÊï∞ÊçÆÂÆåÂÖ®Âä†ËΩΩ„ÄÇ`);

                console.log('‚úÖ Êï∞ÊçÆÊÅ¢Â§çÂÆåÊàê');
            } catch (error) {
                console.error('‚ùå ÊÅ¢Â§çÊï∞ÊçÆÂ§±Ë¥•:', error);
                alert('‚ùå ÊÅ¢Â§çÂ§±Ë¥•: ' + (error.message || 'Êú™Áü•ÈîôËØØ'));
            }
        }

        // È°µÈù¢ÂÖ≥Èó≠Ââç‰øùÂ≠òÊâìÂç°ËÆ∞ÂΩïÔºàÂèåÈáç‰øùÈô©Ôºâ
        window.addEventListener('beforeunload', () => {
            if (checkinRecords && checkinRecords.length > 0) {
                try {
                    localStorage.setItem('petCheckinRecords', JSON.stringify(checkinRecords));
                    console.log('‚úÖ È°µÈù¢ÂÖ≥Èó≠ÂâçÂ∑≤‰øùÂ≠òÊâìÂç°ËÆ∞ÂΩï');
                } catch (error) {
                    console.error('‚ùå È°µÈù¢ÂÖ≥Èó≠Ââç‰øùÂ≠òÂ§±Ë¥•:', error);
                }
            }
        });

        // ÂÆöÊúüËá™Âä®‰øùÂ≠òÔºàÊØè30Áßí‰øùÂ≠ò‰∏ÄÊ¨°ÔºåÈò≤Ê≠¢ÊÑèÂ§ñ‰∏¢Â§±Ôºâ
        setInterval(() => {
            if (checkinRecords && checkinRecords.length > 0) {
                saveCheckinRecords();
            }
        }, 30000); // 30Áßí

        // Modal file input handler
        modalImportInput.addEventListener("change", (event) => {
            const files = Array.from(event.target.files ?? []);
            if (files.length) {
                displaySelectedFiles(files);
            }
        });

        // Confirm import button
        confirmImportBtn.addEventListener("click", () => {
            const files = Array.from(modalImportInput.files ?? []);
            if (!files.length) {
                alert("ËØ∑ÈÄâÊã©Ë¶ÅÂØºÂÖ•ÁöÑÊñá‰ª∂");
                return;
            }

            const importType = getSelectedImportType();
            const validFiles = files.filter(file => file.name?.toLowerCase().endsWith(".xlsx"));

            if (validFiles.length === 0) {
                alert("ËØ∑ÈÄâÊã© .xlsx Ê†ºÂºèÁöÑÊñá‰ª∂");
                return;
            }

            // ‰ΩøÁî®PromiseÁ°Æ‰øùÊâÄÊúâÊñá‰ª∂ÂØºÂÖ•ÂÆåÊàêÂêéÂÜç‰øùÂ≠ò
            const importPromises = validFiles.map(file => {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const xlsx_data = new Uint8Array(e.target.result);
                            const workbook = XLSX.read(xlsx_data, { type: 'array' });
                            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                            const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                            resolve({ file, jsonData, importType });
                        } catch (error) {
                            reject({ file, error });
                        }
                    };
                    reader.onerror = () => reject({ file, error: new Error('Êñá‰ª∂ËØªÂèñÂ§±Ë¥•') });
                    reader.readAsArrayBuffer(file);
                });
            });

            // Á≠âÂæÖÊâÄÊúâÊñá‰ª∂ÂØºÂÖ•ÂÆåÊàê
            Promise.all(importPromises).then(results => {
                let totalImported = 0;
                let typeName = '';

                // Â§ÑÁêÜÊâÄÊúâÂØºÂÖ•ÁöÑÊï∞ÊçÆ
                results.forEach(({ file, jsonData, importType }) => {
                    if (!Array.isArray(jsonData) || jsonData.length === 0) {
                        console.warn(`‚ö†Ô∏è Êñá‰ª∂ ${file.name} Ê≤°ÊúâÊúâÊïàÊï∞ÊçÆ`);
                        return;
                    }

                    // Ê†πÊçÆÂØºÂÖ•Á±ªÂûãÊõ¥Êñ∞Áõ∏Â∫îÊï∞ÊçÆ
                    switch (importType) {
                        case 'vocab':
                            data.vocab = [...(data.vocab || []), ...jsonData];
                            typeName = 'üçé ÂçïËØç';
                            break;
                        case 'reading':
                            data.readingSets = [...(data.readingSets || []), ...jsonData];
                            typeName = 'üìñ ÈòÖËØªÁêÜËß£';
                            break;
                        case 'collocation':
                            data.collocationSets = [...(data.collocationSets || []), ...jsonData];
                            typeName = 'üîó Âõ∫ÂÆöÊê≠ÈÖç';
                            break;
                        case 'cloze':
                            data.clozeSets = [...(data.clozeSets || []), ...jsonData];
                            typeName = 'üß© ÂÆåÂΩ¢Â°´Á©∫';
                            break;
                    }

                    totalImported += jsonData.length;
                });

                // ÈáçÊñ∞Âä†ËΩΩÂΩìÂâçÊòæÁ§∫ÁöÑÂÜÖÂÆπ
                switch (importType) {
                    case 'vocab':
                        if (data.vocab && data.vocab.length > 0) loadWord();
                        break;
                    case 'reading':
                        if (data.readingSets && data.readingSets.length > 0) loadReading();
                        break;
                    case 'collocation':
                        if (data.collocationSets && data.collocationSets.length > 0) loadCollocation();
                        break;
                    case 'cloze':
                        if (data.clozeSets && data.clozeSets.length > 0) loadCloze();
                        break;
                }

                // Êõ¥Êñ∞ÂÜÖÂÆπÁªüËÆ°
                updateWordCountBadge();
                updateBankStatistics();

                // üíæ ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®ÔºàÊâÄÊúâÊñá‰ª∂ÂØºÂÖ•ÂÆåÊàêÂêéÁªü‰∏Ä‰øùÂ≠òÔºâ
                if (saveDataToLocalStorage()) {
                    const verifyData = localStorage.getItem('petEnglishData');
                    if (verifyData) {
                        const verifyParsed = JSON.parse(verifyData);
                        console.log('‚úÖ Êï∞ÊçÆÂ∑≤‰øùÂ≠òÂà∞localStorage');
                        console.log('üìä ‰øùÂ≠òÈ™åËØÅ:', {
                            ÂçïËØç: verifyParsed.vocab?.length || 0,
                            ÈòÖËØª: verifyParsed.readingSets?.length || 0,
                            Âõ∫ÂÆöÊê≠ÈÖç: verifyParsed.collocationSets?.length || 0,
                            ÂÆåÂΩ¢: verifyParsed.clozeSets?.length || 0
                        });

                        // ÂÜçÊ¨°È™åËØÅ‰øùÂ≠òÁöÑÊï∞ÊçÆÊòØÂê¶ÂåÖÂê´ÂØºÂÖ•ÁöÑÊï∞ÊçÆ
                        const savedVocab = verifyParsed.vocab?.length || 0;
                        const savedReading = verifyParsed.readingSets?.length || 0;
                        const savedCollocation = verifyParsed.collocationSets?.length || 0;
                        const savedCloze = verifyParsed.clozeSets?.length || 0;

                        const currentVocab = data.vocab?.length || 0;
                        const currentReading = data.readingSets?.length || 0;
                        const currentCollocation = data.collocationSets?.length || 0;
                        const currentCloze = data.clozeSets?.length || 0;

                        if (importType === 'vocab' && savedVocab !== currentVocab) {
                            console.error('‚ùå ‰øùÂ≠òÈ™åËØÅÂ§±Ë¥•ÔºöÂçïËØçÊï∞Èáè‰∏çÂåπÈÖç', { saved: savedVocab, current: currentVocab });
                            // ÂÜçÊ¨°Â∞ùËØï‰øùÂ≠ò
                            saveDataToLocalStorage();
                        } else if (importType === 'reading' && savedReading !== currentReading) {
                            console.error('‚ùå ‰øùÂ≠òÈ™åËØÅÂ§±Ë¥•ÔºöÈòÖËØªÊï∞Èáè‰∏çÂåπÈÖç', { saved: savedReading, current: currentReading });
                            saveDataToLocalStorage();
                        } else if (importType === 'collocation' && savedCollocation !== currentCollocation) {
                            console.error('‚ùå ‰øùÂ≠òÈ™åËØÅÂ§±Ë¥•ÔºöÂõ∫ÂÆöÊê≠ÈÖçÊï∞Èáè‰∏çÂåπÈÖç', { saved: savedCollocation, current: currentCollocation });
                            saveDataToLocalStorage();
                        } else if (importType === 'cloze' && savedCloze !== currentCloze) {
                            console.error('‚ùå ‰øùÂ≠òÈ™åËØÅÂ§±Ë¥•ÔºöÂÆåÂΩ¢Â°´Á©∫Êï∞Èáè‰∏çÂåπÈÖç', { saved: savedCloze, current: currentCloze });
                            saveDataToLocalStorage();
                        } else {
                            console.log('‚úÖ ‰øùÂ≠òÈ™åËØÅÈÄöËøá');
                        }
                    } else {
                        console.error('‚ùå ‰øùÂ≠òÂêéÈ™åËØÅÂ§±Ë¥•ÔºöÊó†Ê≥ïËØªÂèñ‰øùÂ≠òÁöÑÊï∞ÊçÆ');
                        alert('‚ö†Ô∏è Êï∞ÊçÆ‰øùÂ≠òÂèØËÉΩÂ§±Ë¥•ÔºåËØ∑Âà∑Êñ∞È°µÈù¢Ê£ÄÊü•Êï∞ÊçÆÊòØÂê¶ËøòÂú®');
                    }
                } else {
                    alert('‚ùå ‰øùÂ≠òÊï∞ÊçÆÂ§±Ë¥•ÔºÅ\n\nËØ∑Ê£ÄÊü•ÊµèËßàÂô®ÊòØÂê¶ÂÖÅËÆ∏‰ΩøÁî®localStorageÔºåÊàñÂ∞ùËØïÊ∏ÖÈô§ÊµèËßàÂô®ÁºìÂ≠òÂêéÈáçËØï„ÄÇ');
                }

                // ÊòæÁ§∫ÂØºÂÖ•ÁªìÊûú
                if (totalImported > 0 && pointsLog) {
                    pointsLog.innerHTML = `
                <div style="line-height: 1.6;">
                    üéâ <strong>È¢òÂ∫ìÂØºÂÖ•ÊàêÂäüÔºÅ</strong><br>
                    <span style="font-size: 0.9rem; color: #51627a;">Â∑≤ÂØºÂÖ• ${totalImported} ÈÅì${typeName}È¢òÁõÆÔºåÊï∞ÊçÆÂ∑≤‰øùÂ≠òÂà∞Êú¨Âú∞</span>
                </div>
                `;
                }

                hideImportModal();
            }).catch(errors => {
                console.error('ÂØºÂÖ•Â§±Ë¥•:', errors);
                alert(`ÂØºÂÖ•Â§±Ë¥•Ôºö${errors.error?.message || 'Êú™Áü•ÈîôËØØ'}\n\nÊñá‰ª∂Ôºö${errors.file?.name || 'Êú™Áü•Êñá‰ª∂'}`);
            });
        });

        // Drag and drop functionality
        const uploadArea = document.querySelector(".file-upload-label");
        if (uploadArea) {
            uploadArea.addEventListener("dragover", (e) => {
                e.preventDefault();
                uploadArea.style.background = "#f0f7ff";
            });

            uploadArea.addEventListener("dragleave", (e) => {
                e.preventDefault();
                uploadArea.style.background = "";
            });

            uploadArea.addEventListener("drop", (e) => {
                e.preventDefault();
                uploadArea.style.background = "";
                const files = Array.from(e.dataTransfer.files ?? []);
                if (files.length) {
                    modalImportInput.files = e.dataTransfer.files;
                    displaySelectedFiles(files);
                }
            });
        }

        // Click outside to close
        importModal.addEventListener("click", (e) => {
            if (e.target === importModal) {
                hideImportModal();
            }
        });

        // ESC key to close
        document.addEventListener("keydown", (e) => {
            if (e.key === "Escape" && importModal.classList.contains("active")) {
                hideImportModal();
            }
        });

        // ------------ ÊâìÂç°ËÆ∞ÂΩïÁªüËÆ°ÂäüËÉΩ ------------
        function getWeekRecords() {
            const now = new Date();
            const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
            return checkinRecords.filter(record => {
                const recordDate = new Date(record.timestamp);
                return recordDate >= weekAgo;
            });
        }

        function getMonthRecords() {
            const now = new Date();
            const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
            return checkinRecords.filter(record => {
                const recordDate = new Date(record.timestamp);
                return recordDate >= monthStart;
            });
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const weekdays = ['Êó•', '‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠'];
            const weekday = weekdays[date.getDay()];
            return `${month}/${day} Âë®${weekday}`;
        }

        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${hours}:${minutes}`;
        }

        function renderWeekView() {
            const weekRecords = getWeekRecords();
            const weekStars = weekRecords.reduce((sum, r) => sum + r.stars, 0);
            const weekDays = new Set(weekRecords.map(r => r.date)).size;
            const weekRecordsCount = weekRecords.length;

            document.getElementById('weekStars').textContent = weekStars;
            document.getElementById('weekDays').textContent = weekDays;
            document.getElementById('weekRecords').textContent = weekRecordsCount;

            const listContainer = document.getElementById('weekRecordsList');
            if (weekRecords.length === 0) {
                listContainer.innerHTML = '<div style="text-align: center; padding: 40px; color: #6d7897;">üì≠ Êú¨Âë®ËøòÊ≤°ÊúâÊâìÂç°ËÆ∞ÂΩïÔºåÂø´ÂéªÁªÉ‰π†ÂêßÔºÅ</div>';
                return;
            }

            // ÊåâÊó•ÊúüÂàÜÁªÑ
            const grouped = {};
            weekRecords.forEach(record => {
                if (!grouped[record.date]) {
                    grouped[record.date] = [];
                }
                grouped[record.date].push(record);
            });

            // ÊåâÊó•ÊúüÊéíÂ∫èÔºàÊúÄÊñ∞ÁöÑÂú®ÂâçÔºâ
            const sortedDates = Object.keys(grouped).sort((a, b) => new Date(b) - new Date(a));

            let html = '';
            sortedDates.forEach(date => {
                const dayRecords = grouped[date];
                const dayStars = dayRecords.reduce((sum, r) => sum + r.stars, 0);
                html += `
                <div style="background: #fff; border-radius: 12px; padding: 16px; margin-bottom: 12px; border-left: 4px solid #ff9800;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <div style="font-weight: 600; color: #2f3f68;">${formatDate(date)}</div>
                        <div style="font-size: 1.2rem; font-weight: bold; color: #ff9800;">+${dayStars} ‚≠ê</div>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
            `;
                dayRecords.forEach(record => {
                    // Â¶ÇÊûúÊòØÂçïËØçÊâìÂç°ÔºåÊòæÁ§∫ÂÖ∑‰ΩìÊâìÂç°ÁöÑÂçïËØç
                    let reasonText = record.reason;
                    if (record.words && Array.isArray(record.words) && record.words.length > 0) {
                        const wordsText = record.words.join('„ÄÅ');
                        reasonText = `${record.reason}Ôºö${wordsText}`;
                    } else if (record.words && typeof record.words === 'string') {
                        reasonText = `${record.reason}Ôºö${record.words}`;
                    }

                    html += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: #f9fbff; border-radius: 8px;">
                        <span style="color: #51627a;">${reasonText}</span>
                        <span style="color: #6d7897; font-size: 0.9rem;">${formatTime(record.timestamp)} +${record.stars}‚≠ê</span>
                    </div>
                `;
                });
                html += '</div></div>';
            });

            listContainer.innerHTML = html;
        }

        function renderMonthView() {
            const monthRecords = getMonthRecords();
            const monthStars = monthRecords.reduce((sum, r) => sum + r.stars, 0);
            const monthDays = new Set(monthRecords.map(r => r.date)).size;
            const monthRecordsCount = monthRecords.length;
            const monthAvg = monthDays > 0 ? (monthStars / monthDays).toFixed(1) : 0;

            document.getElementById('monthStars').textContent = monthStars;
            document.getElementById('monthDays').textContent = monthDays;
            document.getElementById('monthRecords').textContent = monthRecordsCount;
            document.getElementById('monthAvg').textContent = monthAvg;

            // ÁîüÊàêÊØèÊó•ÁªüËÆ°ÂõæË°®
            const chartContainer = document.getElementById('monthChart');
            const now = new Date();
            const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());

            // ÊåâÊó•ÊúüÁªüËÆ°ÊòüÊòüÊï∞
            const dailyStats = {};
            monthRecords.forEach(record => {
                if (!dailyStats[record.date]) {
                    dailyStats[record.date] = 0;
                }
                dailyStats[record.date] += record.stars;
            });

            // ÁîüÊàêÊú¨ÊúàÊâÄÊúâÊó•Êúü
            const daysInMonth = [];
            for (let d = new Date(monthStart); d <= today; d.setDate(d.getDate() + 1)) {
                const dateStr = d.toISOString().split('T')[0];
                daysInMonth.push({
                    date: dateStr,
                    stars: dailyStats[dateStr] || 0
                });
            }

            // ÊâæÂà∞ÊúÄÂ§ßÂÄºÁî®‰∫éËÆ°ÁÆóÈ´òÂ∫¶
            const maxStars = Math.max(...daysInMonth.map(d => d.stars), 1);

            let chartHtml = '';
            daysInMonth.forEach(day => {
                const height = day.stars > 0 ? (day.stars / maxStars * 100) : 2;
                const date = new Date(day.date);
                const dayNum = date.getDate();
                chartHtml += `
                <div style="display: flex; flex-direction: column; align-items: center; flex: 1; max-width: 40px;">
                    <div style="width: 100%; background: ${day.stars > 0 ? '#ff9800' : '#e0e0e0'}; border-radius: 4px 4px 0 0; min-height: ${height}%; transition: all 0.3s;" title="${day.date}: ${day.stars}‚≠ê"></div>
                    <div style="font-size: 0.75rem; color: #6d7897; margin-top: 4px; text-align: center;">${dayNum}</div>
                </div>
            `;
            });
            chartContainer.innerHTML = chartHtml;

            // Ê∏≤ÊüìËÆ∞ÂΩïÂàóË°®
            const listContainer = document.getElementById('monthRecordsList');
            if (monthRecords.length === 0) {
                listContainer.innerHTML = '<div style="text-align: center; padding: 40px; color: #6d7897;">üì≠ Êú¨ÊúàËøòÊ≤°ÊúâÊâìÂç°ËÆ∞ÂΩïÔºåÂø´ÂéªÁªÉ‰π†ÂêßÔºÅ</div>';
                return;
            }

            // ÊåâÊó•ÊúüÂàÜÁªÑ
            const grouped = {};
            monthRecords.forEach(record => {
                if (!grouped[record.date]) {
                    grouped[record.date] = [];
                }
                grouped[record.date].push(record);
            });

            // ÊåâÊó•ÊúüÊéíÂ∫èÔºàÊúÄÊñ∞ÁöÑÂú®ÂâçÔºâ
            const sortedDates = Object.keys(grouped).sort((a, b) => new Date(b) - new Date(a));

            let html = '';
            sortedDates.forEach(date => {
                const dayRecords = grouped[date];
                const dayStars = dayRecords.reduce((sum, r) => sum + r.stars, 0);
                html += `
                <div style="background: #fff; border-radius: 12px; padding: 16px; margin-bottom: 12px; border-left: 4px solid #9c27b0;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <div style="font-weight: 600; color: #2f3f68;">${formatDate(date)}</div>
                        <div style="font-size: 1.2rem; font-weight: bold; color: #9c27b0;">+${dayStars} ‚≠ê</div>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
            `;
                dayRecords.forEach(record => {
                    // Â¶ÇÊûúÊòØÂçïËØçÊâìÂç°ÔºåÊòæÁ§∫ÂÖ∑‰ΩìÊâìÂç°ÁöÑÂçïËØç
                    let reasonText = record.reason;
                    if (record.words && Array.isArray(record.words) && record.words.length > 0) {
                        const wordsText = record.words.join('„ÄÅ');
                        reasonText = `${record.reason}Ôºö${wordsText}`;
                    } else if (record.words && typeof record.words === 'string') {
                        reasonText = `${record.reason}Ôºö${record.words}`;
                    }

                    html += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: #f9fbff; border-radius: 8px;">
                        <span style="color: #51627a;">${reasonText}</span>
                        <span style="color: #6d7897; font-size: 0.9rem;">${formatTime(record.timestamp)} +${record.stars}‚≠ê</span>
                    </div>
                `;
                });
                html += '</div></div>';
            });

            listContainer.innerHTML = html;
        }

        function showCheckinModal() {
            const modal = document.getElementById('checkinModal');
            modal.classList.add('active');
            // ÈáçÁΩÆÊåâÈíÆÁä∂ÊÄÅ
            document.getElementById("weekViewBtn").classList.add("primary-btn");
            document.getElementById("weekViewBtn").classList.remove("secondary-btn");
            document.getElementById("monthViewBtn").classList.add("secondary-btn");
            document.getElementById("monthViewBtn").classList.remove("primary-btn");
            // ÊòæÁ§∫Êú¨Âë®ÁªüËÆ°
            document.getElementById("weekView").style.display = "block";
            document.getElementById("monthView").style.display = "none";
            renderWeekView(); // ÈªòËÆ§ÊòæÁ§∫Êú¨Âë®ÁªüËÆ°
        }

        function hideCheckinModal() {
            const modal = document.getElementById('checkinModal');
            modal.classList.remove('active');
        }

        // üíæ ÂØºÂá∫ÊâìÂç°ËÆ∞ÂΩï‰∏∫JSONÊñá‰ª∂
        function exportCheckinRecords() {
            try {
                if (!checkinRecords || checkinRecords.length === 0) {
                    alert('üì≠ ÂΩìÂâçÊ≤°ÊúâÊâìÂç°ËÆ∞ÂΩïÂèØ‰ª•ÂØºÂá∫');
                    return;
                }

                const dataStr = JSON.stringify(checkinRecords, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `PETÊâìÂç°ËÆ∞ÂΩï_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                console.log('‚úÖ ÊâìÂç°ËÆ∞ÂΩïÂ∑≤ÂØºÂá∫:', checkinRecords.length, 'Êù°');
                alert(`‚úÖ ÊâìÂç°ËÆ∞ÂΩïÂØºÂá∫ÊàêÂäüÔºÅ\nÂÖ±ÂØºÂá∫ ${checkinRecords.length} Êù°ËÆ∞ÂΩï`);
            } catch (error) {
                console.error('‚ùå ÂØºÂá∫ÊâìÂç°ËÆ∞ÂΩïÂ§±Ë¥•:', error);
                alert('‚ùå ÂØºÂá∫Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
            }
        }

        // üì• ÂØºÂÖ•ÊâìÂç°ËÆ∞ÂΩï‰ªéJSONÊñá‰ª∂
        function importCheckinRecords(event) {
            const file = event.target.files[0];
            if (!file) {
                return;
            }

            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const imported = JSON.parse(e.target.result);

                    if (!Array.isArray(imported)) {
                        throw new Error('Êñá‰ª∂Ê†ºÂºèÈîôËØØÔºö‰∏çÊòØÊï∞ÁªÑÊ†ºÂºè');
                    }

                    // È™åËØÅÊï∞ÊçÆÊ†ºÂºè
                    const validRecords = imported.filter(record => {
                        return record &&
                            typeof record.date === 'string' &&
                            typeof record.stars === 'number' &&
                            typeof record.timestamp === 'number';
                    });

                    if (validRecords.length === 0) {
                        alert('‚ùå Êñá‰ª∂‰∏≠Ê≤°ÊúâÊúâÊïàÁöÑÊâìÂç°ËÆ∞ÂΩï');
                        return;
                    }

                    if (validRecords.length !== imported.length) {
                        console.warn('‚ö†Ô∏è ÂèëÁé∞Êó†ÊïàËÆ∞ÂΩïÔºåÂ∑≤ËøáÊª§:', imported.length - validRecords.length, 'Êù°');
                    }

                    // ÂêàÂπ∂Êï∞ÊçÆÔºàÂéªÈáçÔºåÂü∫‰∫étimestampÔºâ
                    const existingTimestamps = new Set(checkinRecords.map(r => r.timestamp));
                    const newRecords = validRecords.filter(r => !existingTimestamps.has(r.timestamp));

                    if (newRecords.length === 0) {
                        alert('üìù ÂØºÂÖ•ÁöÑËÆ∞ÂΩïÈÉΩÂ∑≤Â≠òÂú®ÔºåÊ≤°ÊúâÊñ∞ËÆ∞ÂΩï');
                        return;
                    }

                    checkinRecords = [...checkinRecords, ...newRecords];
                    checkinRecords.sort((a, b) => a.timestamp - b.timestamp);

                    // ÈáçÊñ∞ËÆ°ÁÆóÊòüÊòüÂíåÁßØÂàÜ
                    stars = checkinRecords.reduce((sum, r) => sum + r.stars, 0);
                    points = stars;

                    // ‰øùÂ≠òÊï∞ÊçÆ
                    saveCheckinRecords();
                    updateBadges();
                    updateCheckinDisplay();

                    console.log('‚úÖ ÊâìÂç°ËÆ∞ÂΩïÂØºÂÖ•ÊàêÂäü:', newRecords.length, 'Êù°Êñ∞ËÆ∞ÂΩï');
                    alert(`‚úÖ ÊâìÂç°ËÆ∞ÂΩïÂØºÂÖ•ÊàêÂäüÔºÅ\nÊñ∞Â¢û ${newRecords.length} Êù°ËÆ∞ÂΩï\nÂΩìÂâçÂÖ±Êúâ ${checkinRecords.length} Êù°ËÆ∞ÂΩï`);
                } catch (error) {
                    console.error('‚ùå ÂØºÂÖ•ÊâìÂç°ËÆ∞ÂΩïÂ§±Ë¥•:', error);
                    alert('‚ùå ÂØºÂÖ•Â§±Ë¥•Ôºö' + error.message);
                }
            };

            reader.onerror = function () {
                console.error('‚ùå ËØªÂèñÊñá‰ª∂Â§±Ë¥•');
                alert('‚ùå ËØªÂèñÊñá‰ª∂Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
            };

            reader.readAsText(file);

            // Ê∏ÖÁ©∫inputÔºå‰ª•‰æøÂèØ‰ª•ÈáçÂ§çÈÄâÊã©Âêå‰∏ÄÊñá‰ª∂
            event.target.value = '';
        }

        // ------------ Event bindings ------------
        // Âª∂ËøüÁªëÂÆö‰∫ã‰ª∂ÔºåÁ°Æ‰øùDOMÂ∑≤ÂÆåÂÖ®Âä†ËΩΩ
        function bindEvents() {
            const nextWordBtn = document.getElementById("nextWordBtn");
            const quizWordBtn = document.getElementById("quizWordBtn");

            console.log('üîó ÂºÄÂßãÁªëÂÆö‰∫ã‰ª∂...');
            console.log('nextWordBtn:', nextWordBtn ? 'ÊâæÂà∞' : 'Êú™ÊâæÂà∞');
            console.log('quizWordBtn:', quizWordBtn ? 'ÊâæÂà∞' : 'Êú™ÊâæÂà∞');

            if (nextWordBtn) {
                // ÂÖàÁßªÈô§ÊóßÁöÑÁõëÂê¨Âô®ÔºàÈÄöËøáÂÖãÈöÜÂÖÉÁ¥†Ôºâ
                const newNextWordBtn = nextWordBtn.cloneNode(true);
                nextWordBtn.parentNode.replaceChild(newNextWordBtn, nextWordBtn);

                // Âú®Êñ∞ÂÖÉÁ¥†‰∏äÊ∑ªÂä†‰∫ã‰ª∂ÁõëÂê¨Âô®
                newNextWordBtn.addEventListener("click", function (e) {
                    console.log('üñ±Ô∏è ÊåâÈíÆË¢´ÁÇπÂáª');
                    e.preventDefault();
                    e.stopPropagation();
                    nextWord();
                });
                console.log('‚úÖ nextWordBtn ‰∫ã‰ª∂Â∑≤ÁªëÂÆöÔºàÂ∑≤ÁßªÈô§ÊóßÁõëÂê¨Âô®Ôºâ');
            } else {
                console.error('‚ùå Êâæ‰∏çÂà∞ nextWordBtn ÂÖÉÁ¥†');
            }

            if (quizWordBtn) {
                quizWordBtn.addEventListener("click", startWordQuiz);
                console.log('‚úÖ quizWordBtn ‰∫ã‰ª∂Â∑≤ÁªëÂÆö');
            } else {
                console.error('‚ùå Êâæ‰∏çÂà∞ quizWordBtn ÂÖÉÁ¥†');
            }

            // ÁªëÂÆöÁâàÊú¨ÂéÜÂè≤ÊåâÈíÆ
            bindVersionHistoryButton();
        }

        // Á´ãÂç≥Â∞ùËØïÁªëÂÆöÔºåÂ¶ÇÊûúDOMÊú™ÂáÜÂ§áÂ•ΩÂàôÂª∂Ëøü
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                init();  // ÂÖàÂàùÂßãÂåñÊï∞ÊçÆÔºà‰ªélocalStorageÂä†ËΩΩÔºâ
                bindEvents();  // ÂÜçÁªëÂÆö‰∫ã‰ª∂
            });
        } else {
            init();  // ÂÖàÂàùÂßãÂåñÊï∞ÊçÆÔºà‰ªélocalStorageÂä†ËΩΩÔºâ
            bindEvents();  // ÂÜçÁªëÂÆö‰∫ã‰ª∂
        }

        // Âª∂ËøüÂÜçÊ¨°ÁªëÂÆöÔºåÁ°Æ‰øù‰∏áÊó†‰∏ÄÂ§±
        setTimeout(bindEvents, 1000);
        document.getElementById("checkReadingBtn").addEventListener("click", checkReading);
        document.getElementById("checkCollocationBtn").addEventListener("click", checkCollocation);
        document.getElementById("checkClozeBtn").addEventListener("click", checkCloze);

        // ÂÆåÂΩ¢Â°´Á©∫ÁîüÊàêÊñ∞È¢òÁõÆÂäüËÉΩ
        const generateClozeBtn = document.getElementById("generateClozeBtn");
        if (generateClozeBtn) {
            generateClozeBtn.addEventListener("click", generateNewClozeQuestions);
        }

        // ÁîüÊàêÊñ∞ÁöÑÂÆåÂΩ¢Â°´Á©∫È¢òÁõÆÔºàÁ¨¶ÂêàPETÈöæÂ∫¶ÔºåÁ°Æ‰øùÊó†ÈáçÂ§çÔºâ
        function generateNewClozeQuestions() {
            const btn = document.getElementById("generateClozeBtn");
            if (btn) {
                btn.disabled = true;
                btn.textContent = '‚è≥ ÁîüÊàê‰∏≠...';
            }

            console.log('‚ú® ÂºÄÂßãÁîüÊàêÊñ∞ÁöÑÂÆåÂΩ¢Â°´Á©∫È¢òÁõÆ...');

            // Ëé∑ÂèñÁé∞ÊúâÈ¢òÁõÆÁöÑÂÜÖÂÆπÂìàÂ∏åÔºåÁî®‰∫éÂéªÈáç
            const existingHashes = new Set();
            if (data.clozeSets && data.clozeSets.length > 0) {
                data.clozeSets.forEach(item => {
                    if (item.text) {
                        try {
                            const textStr = typeof item.text === 'string' ? item.text : JSON.stringify(item.text);
                            const hash = textStr.substring(0, 150).replace(/\s+/g, '').toLowerCase();
                            existingHashes.add(hash);
                        } catch (e) {
                            // ÂøΩÁï•ÈîôËØØ
                        }
                    }
                });
            }

            console.log(`üìä Áé∞ÊúâÈ¢òÁõÆ: ${data.clozeSets?.length || 0} ÈÅìÔºåÂ∑≤ÊúâÂìàÂ∏å: ${existingHashes.size} ‰∏™`);

            // ÁîüÊàêÊñ∞ÁöÑÂÆåÂΩ¢Â°´Á©∫È¢òÁõÆÊ®°ÊùøÔºàÁ¨¶ÂêàPETÈöæÂ∫¶ÔºåË¶ÜÁõñ1-5ÊòüÔºâ
            const newClozeTemplates = [
                // ÈöæÂ∫¶1ÔºàÂàùÁ∫ßÔºâÔºöÁÆÄÂçïÊó∂ÊÄÅ„ÄÅÊó•Â∏∏Ê¥ªÂä®
                {
                    text: [
                        "I usually ",
                        { answer: "wake", options: ["wake", "woke", "waking", "wakes"] },
                        " up at seven o'clock. Then I ",
                        { answer: "brush", options: ["brush", "brushed", "brushing", "brushes"] },
                        " my teeth and ",
                        { answer: "have", options: ["have", "has", "had", "having"] },
                        " breakfast. After that, I ",
                        { answer: "go", options: ["go", "went", "going", "goes"] },
                        " to school."
                    ],
                    difficulty: 1,
                    tip: "Ê≥®ÊÑè‰∏ÄËà¨Áé∞Âú®Êó∂"
                },
                {
                    text: [
                        "Last weekend, we ",
                        { answer: "visited", options: ["visit", "visited", "visiting", "visits"] },
                        " the zoo. We ",
                        { answer: "saw", options: ["see", "saw", "seeing", "sees"] },
                        " many animals. The elephants ",
                        { answer: "were", options: ["are", "were", "is", "was"] },
                        " very big. We ",
                        { answer: "took", options: ["take", "took", "taking", "takes"] },
                        " lots of photos."
                    ],
                    difficulty: 1,
                    tip: "Ê≥®ÊÑèËøáÂéªÊó∂ÊÄÅ"
                },
                {
                    text: [
                        "My friend ",
                        { answer: "likes", options: ["like", "likes", "liked", "liking"] },
                        " playing football. He ",
                        { answer: "plays", options: ["play", "plays", "played", "playing"] },
                        " every Saturday. I ",
                        { answer: "watch", options: ["watch", "watches", "watched", "watching"] },
                        " him play sometimes."
                    ],
                    difficulty: 1,
                    tip: "Ê≥®ÊÑèÁ¨¨‰∏â‰∫∫Áß∞ÂçïÊï∞"
                },
                {
                    text: [
                        "She ",
                        { answer: "has", options: ["have", "has", "had", "having"] },
                        " a pet dog. It ",
                        { answer: "is", options: ["is", "are", "was", "were"] },
                        " very friendly. They ",
                        { answer: "play", options: ["play", "plays", "played", "playing"] },
                        " together every day."
                    ],
                    difficulty: 1,
                    tip: "Ê≥®ÊÑè‰∏ªË∞ì‰∏ÄËá¥"
                },
                {
                    text: [
                        "We ",
                        { answer: "went", options: ["go", "went", "going", "goes"] },
                        " to the cinema yesterday. The film ",
                        { answer: "was", options: ["is", "was", "are", "were"] },
                        " very exciting. We ",
                        { answer: "enjoyed", options: ["enjoy", "enjoys", "enjoyed", "enjoying"] },
                        " it a lot."
                    ],
                    difficulty: 1,
                    tip: "Ê≥®ÊÑèËøáÂéªÊó∂ÊÄÅ"
                },
                // ÈöæÂ∫¶2ÔºàÂàùÁ∫ß+ÔºâÔºöÂ∞ÜÊù•Êó∂„ÄÅÂõ∫ÂÆöÊê≠ÈÖç
                {
                    text: [
                        "Tomorrow, I ",
                        { answer: "will go", options: ["go", "went", "will go", "going"] },
                        " to the library. I ",
                        { answer: "will borrow", options: ["borrow", "borrowed", "will borrow", "borrowing"] },
                        " some books. I ",
                        { answer: "am looking", options: ["look", "looked", "am looking", "looks"] },
                        " forward to it."
                    ],
                    difficulty: 2,
                    tip: "Ê≥®ÊÑèÂ∞ÜÊù•Êó∂ÂíåÂõ∫ÂÆöÊê≠ÈÖç"
                },
                {
                    text: [
                        "Next week, we ",
                        { answer: "are going", options: ["go", "went", "are going", "goes"] },
                        " on holiday. We ",
                        { answer: "will visit", options: ["visit", "visited", "will visit", "visiting"] },
                        " many places. It ",
                        { answer: "will be", options: ["is", "was", "will be", "be"] },
                        " a great trip."
                    ],
                    difficulty: 2,
                    tip: "Ê≥®ÊÑèÂ∞ÜÊù•Êó∂"
                },
                {
                    text: [
                        "If it ",
                        { answer: "rains", options: ["rain", "rains", "rained", "raining"] },
                        " tomorrow, we ",
                        { answer: "will stay", options: ["stay", "stayed", "will stay", "staying"] },
                        " at home. We ",
                        { answer: "will watch", options: ["watch", "watched", "will watch", "watching"] },
                        " a movie instead."
                    ],
                    difficulty: 2,
                    tip: "Ê≥®ÊÑèifÊù°‰ª∂Âè•ÁöÑÊó∂ÊÄÅ"
                },
                {
                    text: [
                        "I ",
                        { answer: "am going", options: ["go", "went", "am going", "goes"] },
                        " to study harder this year. I ",
                        { answer: "want", options: ["want", "wants", "wanted", "wanting"] },
                        " to get better grades. I ",
                        { answer: "will try", options: ["try", "tried", "will try", "trying"] },
                        " my best."
                    ],
                    difficulty: 2,
                    tip: "Ê≥®ÊÑèbe going toÂíåwill"
                },
                {
                    text: [
                        "She ",
                        { answer: "is planning", options: ["plan", "plans", "is planning", "planned"] },
                        " to learn Spanish. She ",
                        { answer: "will start", options: ["start", "starts", "will start", "started"] },
                        " next month. She ",
                        { answer: "hopes", options: ["hope", "hopes", "hoped", "hoping"] },
                        " to speak it well soon."
                    ],
                    difficulty: 2,
                    tip: "Ê≥®ÊÑèÁé∞Âú®ËøõË°åÊó∂Ë°®Â∞ÜÊù•"
                },
                // ÈöæÂ∫¶3Ôºà‰∏≠Á∫ßÔºâÔºöÁé∞Âú®ÂÆåÊàêÊó∂„ÄÅÂ§çÂêàÂè•
                {
                    text: [
                        "I ",
                        { answer: "have been", options: ["am", "was", "have been", "will be"] },
                        " learning English for five years. I ",
                        { answer: "can", options: ["can", "could", "will", "must"] },
                        " speak it quite well. My teacher ",
                        { answer: "is", options: ["is", "was", "are", "were"] },
                        " very patient and helpful."
                    ],
                    difficulty: 3,
                    tip: "Ê≥®ÊÑèÁé∞Âú®ÂÆåÊàêÊó∂ÂíåÊÉÖÊÄÅÂä®ËØç"
                },
                {
                    text: [
                        "When I ",
                        { answer: "was", options: ["am", "was", "is", "are"] },
                        " young, I ",
                        { answer: "wanted", options: ["want", "wanted", "wants", "wanting"] },
                        " to be a doctor. Now I ",
                        { answer: "study", options: ["study", "studies", "studied", "studying"] },
                        " medicine at university. I ",
                        { answer: "hope", options: ["hope", "hopes", "hoped", "hoping"] },
                        " my dream will come true."
                    ],
                    difficulty: 3,
                    tip: "Ê≥®ÊÑèÊó∂ÊÄÅÂèòÂåñÂíåÂõ∫ÂÆöÊê≠ÈÖç"
                },
                {
                    text: [
                        "The book ",
                        { answer: "that", options: ["that", "which", "who", "where"] },
                        " I read last week ",
                        { answer: "was", options: ["is", "was", "are", "were"] },
                        " very interesting. It ",
                        { answer: "tells", options: ["tell", "tells", "told", "telling"] },
                        " a story about adventure."
                    ],
                    difficulty: 3,
                    tip: "Ê≥®ÊÑèÂÆöËØ≠‰ªéÂè•"
                },
                {
                    text: [
                        "She ",
                        { answer: "has been", options: ["is", "was", "has been", "will be"] },
                        " working here for three years. She ",
                        { answer: "knows", options: ["know", "knows", "knew", "knowing"] },
                        " the job very well. Everyone ",
                        { answer: "likes", options: ["like", "likes", "liked", "liking"] },
                        " working with her."
                    ],
                    difficulty: 3,
                    tip: "Ê≥®ÊÑèÁé∞Âú®ÂÆåÊàêËøõË°åÊó∂"
                },
                {
                    text: [
                        "I ",
                        { answer: "would like", options: ["like", "likes", "would like", "liked"] },
                        " to visit Japan one day. I ",
                        { answer: "have", options: ["have", "has", "had", "having"] },
                        " been saving money for the trip. I ",
                        { answer: "hope", options: ["hope", "hopes", "hoped", "hoping"] },
                        " to go next year."
                    ],
                    difficulty: 3,
                    tip: "Ê≥®ÊÑèwould likeÂíåÁé∞Âú®ÂÆåÊàêÊó∂"
                },
                {
                    text: [
                        "Although he ",
                        { answer: "was", options: ["is", "was", "are", "were"] },
                        " tired, he ",
                        { answer: "continued", options: ["continue", "continues", "continued", "continuing"] },
                        " working. He ",
                        { answer: "wanted", options: ["want", "wants", "wanted", "wanting"] },
                        " to finish the project on time."
                    ],
                    difficulty: 3,
                    tip: "Ê≥®ÊÑèËÆ©Ê≠•Áä∂ËØ≠‰ªéÂè•"
                },
                // ÈöæÂ∫¶4Ôºà‰∏≠Á∫ß+ÔºâÔºöË¢´Âä®ËØ≠ÊÄÅ„ÄÅÂ§çÊùÇËØ≠Ê≥ï
                {
                    text: [
                        "The house ",
                        { answer: "was built", options: ["build", "built", "was built", "is built"] },
                        " fifty years ago. It ",
                        { answer: "has been", options: ["is", "was", "has been", "will be"] },
                        " renovated recently. Now it ",
                        { answer: "looks", options: ["look", "looks", "looked", "looking"] },
                        " very modern."
                    ],
                    difficulty: 4,
                    tip: "Ê≥®ÊÑèË¢´Âä®ËØ≠ÊÄÅÂíåÁé∞Âú®ÂÆåÊàêÊó∂"
                },
                {
                    text: [
                        "The students ",
                        { answer: "were asked", options: ["ask", "asked", "were asked", "are asked"] },
                        " to write an essay. They ",
                        { answer: "had", options: ["have", "has", "had", "having"] },
                        " two hours to complete it. Most of them ",
                        { answer: "finished", options: ["finish", "finishes", "finished", "finishing"] },
                        " on time."
                    ],
                    difficulty: 4,
                    tip: "Ê≥®ÊÑèË¢´Âä®ËØ≠ÊÄÅÂíåËøáÂéªÂÆåÊàêÊó∂"
                },
                {
                    text: [
                        "While I ",
                        { answer: "was walking", options: ["walk", "walked", "was walking", "walks"] },
                        " in the park, I ",
                        { answer: "met", options: ["meet", "meets", "met", "meeting"] },
                        " an old friend. We ",
                        { answer: "hadn't seen", options: ["don't see", "didn't see", "hadn't seen", "won't see"] },
                        " each other for years."
                    ],
                    difficulty: 4,
                    tip: "Ê≥®ÊÑèËøáÂéªËøõË°åÊó∂ÂíåËøáÂéªÂÆåÊàêÊó∂"
                },
                {
                    text: [
                        "The project ",
                        { answer: "which", options: ["which", "that", "who", "where"] },
                        " we started last month ",
                        { answer: "is", options: ["is", "was", "are", "were"] },
                        " almost finished. We ",
                        { answer: "have been", options: ["are", "were", "have been", "will be"] },
                        " working very hard on it."
                    ],
                    difficulty: 4,
                    tip: "Ê≥®ÊÑèÂÆöËØ≠‰ªéÂè•ÂíåÁé∞Âú®ÂÆåÊàêËøõË°åÊó∂"
                },
                {
                    text: [
                        "She ",
                        { answer: "has been", options: ["is", "was", "has been", "will be"] },
                        " studying French since she ",
                        { answer: "was", options: ["is", "was", "are", "were"] },
                        " ten years old. She ",
                        { answer: "can", options: ["can", "could", "will", "must"] },
                        " speak it fluently now."
                    ],
                    difficulty: 4,
                    tip: "Ê≥®ÊÑèÁé∞Âú®ÂÆåÊàêËøõË°åÊó∂ÂíåsinceÂºïÂØºÁöÑÊó∂Èó¥Áä∂ËØ≠"
                },
                // ÈöæÂ∫¶5ÔºàÈ´òÁ∫ßÔºâÔºöËôöÊãüËØ≠Ê∞î„ÄÅÂ§çÊùÇÁªìÊûÑ
                {
                    text: [
                        "If I ",
                        { answer: "had known", options: ["know", "knew", "had known", "will know"] },
                        " about the problem earlier, I ",
                        { answer: "would have", options: ["will", "would", "would have", "should"] },
                        " helped you. I ",
                        { answer: "am", options: ["am", "was", "are", "were"] },
                        " sorry I couldn't."
                    ],
                    difficulty: 5,
                    tip: "Ê≥®ÊÑèËôöÊãüËØ≠Ê∞î"
                },
                {
                    text: [
                        "The book ",
                        { answer: "that", options: ["that", "which", "who", "where"] },
                        " was recommended by my teacher ",
                        { answer: "turned out", options: ["turn", "turns", "turned out", "turning"] },
                        " to be excellent. I ",
                        { answer: "enjoyed", options: ["enjoy", "enjoys", "enjoyed", "enjoying"] },
                        " reading it very much."
                    ],
                    difficulty: 5,
                    tip: "Ê≥®ÊÑèÂÆöËØ≠‰ªéÂè•ÂíåÂõ∫ÂÆöÊê≠ÈÖç"
                },
                {
                    text: [
                        "The problem ",
                        { answer: "that", options: ["that", "which", "who", "where"] },
                        " we discussed yesterday ",
                        { answer: "has been", options: ["is", "was", "has been", "will be"] },
                        " solved. Everyone ",
                        { answer: "is", options: ["is", "was", "are", "were"] },
                        " happy with the solution."
                    ],
                    difficulty: 5,
                    tip: "Ê≥®ÊÑèÂÆöËØ≠‰ªéÂè•ÂíåÁé∞Âú®ÂÆåÊàêÊó∂Ë¢´Âä®ËØ≠ÊÄÅ"
                },
                // Êâ©Â±ïÊ®°ÊùøÔºöÊõ¥Â§öÈöæÂ∫¶1È¢òÁõÆ
                {
                    text: [
                        "Every day, I ",
                        { answer: "eat", options: ["eat", "eats", "ate", "eating"] },
                        " breakfast at eight. Then I ",
                        { answer: "walk", options: ["walk", "walks", "walked", "walking"] },
                        " to school. I ",
                        { answer: "arrive", options: ["arrive", "arrives", "arrived", "arriving"] },
                        " at nine o'clock."
                    ],
                    difficulty: 1,
                    tip: "Ê≥®ÊÑè‰∏ÄËà¨Áé∞Âú®Êó∂"
                },
                {
                    text: [
                        "Last night, I ",
                        { answer: "watched", options: ["watch", "watches", "watched", "watching"] },
                        " a film on TV. It ",
                        { answer: "was", options: ["is", "was", "are", "were"] },
                        " very funny. I ",
                        { answer: "laughed", options: ["laugh", "laughs", "laughed", "laughing"] },
                        " a lot."
                    ],
                    difficulty: 1,
                    tip: "Ê≥®ÊÑèËøáÂéªÊó∂ÊÄÅ"
                },
                {
                    text: [
                        "My brother ",
                        { answer: "loves", options: ["love", "loves", "loved", "loving"] },
                        " music. He ",
                        { answer: "listens", options: ["listen", "listens", "listened", "listening"] },
                        " to songs every day. He ",
                        { answer: "can", options: ["can", "could", "will", "must"] },
                        " play the guitar."
                    ],
                    difficulty: 1,
                    tip: "Ê≥®ÊÑèÁ¨¨‰∏â‰∫∫Áß∞ÂçïÊï∞ÂíåÊÉÖÊÄÅÂä®ËØç"
                },
                {
                    text: [
                        "The cat ",
                        { answer: "is", options: ["is", "are", "was", "were"] },
                        " sleeping on the sofa. It ",
                        { answer: "looks", options: ["look", "looks", "looked", "looking"] },
                        " very comfortable. I ",
                        { answer: "don't", options: ["don't", "doesn't", "didn't", "won't"] },
                        " want to wake it up."
                    ],
                    difficulty: 1,
                    tip: "Ê≥®ÊÑèÁé∞Âú®ËøõË°åÊó∂ÂíåÂê¶ÂÆöÂΩ¢Âºè"
                },
                {
                    text: [
                        "On Sundays, we ",
                        { answer: "visit", options: ["visit", "visits", "visited", "visiting"] },
                        " our grandparents. They ",
                        { answer: "live", options: ["live", "lives", "lived", "living"] },
                        " in the countryside. We ",
                        { answer: "have", options: ["have", "has", "had", "having"] },
                        " lunch together."
                    ],
                    difficulty: 1,
                    tip: "Ê≥®ÊÑè‰∏ÄËà¨Áé∞Âú®Êó∂"
                },
                // Êâ©Â±ïÊ®°ÊùøÔºöÊõ¥Â§öÈöæÂ∫¶2È¢òÁõÆ
                {
                    text: [
                        "This evening, I ",
                        { answer: "am meeting", options: ["meet", "meets", "am meeting", "met"] },
                        " my friends. We ",
                        { answer: "will go", options: ["go", "went", "will go", "going"] },
                        " to a restaurant. I ",
                        { answer: "am excited", options: ["excite", "excites", "am excited", "excited"] },
                        " about it."
                    ],
                    difficulty: 2,
                    tip: "Ê≥®ÊÑèÁé∞Âú®ËøõË°åÊó∂Ë°®Â∞ÜÊù•ÂíåÂ∞ÜÊù•Êó∂"
                },
                {
                    text: [
                        "In the future, I ",
                        { answer: "want", options: ["want", "wants", "wanted", "wanting"] },
                        " to travel around the world. I ",
                        { answer: "will save", options: ["save", "saves", "will save", "saved"] },
                        " money for this. I ",
                        { answer: "hope", options: ["hope", "hopes", "hoped", "hoping"] },
                        " to start next year."
                    ],
                    difficulty: 2,
                    tip: "Ê≥®ÊÑèÂ∞ÜÊù•Êó∂ÂíåÂõ∫ÂÆöÊê≠ÈÖç"
                },
                {
                    text: [
                        "When I ",
                        { answer: "grow", options: ["grow", "grows", "grew", "growing"] },
                        " up, I ",
                        { answer: "will become", options: ["become", "becomes", "will become", "became"] },
                        " a teacher. I ",
                        { answer: "love", options: ["love", "loves", "loved", "loving"] },
                        " working with children."
                    ],
                    difficulty: 2,
                    tip: "Ê≥®ÊÑèwhenÂºïÂØºÁöÑÊó∂Èó¥Áä∂ËØ≠‰ªéÂè•"
                },
                {
                    text: [
                        "Next month, they ",
                        { answer: "are moving", options: ["move", "moves", "are moving", "moved"] },
                        " to a new house. It ",
                        { answer: "will be", options: ["is", "was", "will be", "be"] },
                        " bigger than their current one. They ",
                        { answer: "are looking", options: ["look", "looks", "are looking", "looked"] },
                        " forward to it."
                    ],
                    difficulty: 2,
                    tip: "Ê≥®ÊÑèÁé∞Âú®ËøõË°åÊó∂Ë°®Â∞ÜÊù•"
                },
                {
                    text: [
                        "If you ",
                        { answer: "study", options: ["study", "studies", "studied", "studying"] },
                        " hard, you ",
                        { answer: "will pass", options: ["pass", "passes", "will pass", "passed"] },
                        " the exam. You ",
                        { answer: "need", options: ["need", "needs", "needed", "needing"] },
                        " to practice every day."
                    ],
                    difficulty: 2,
                    tip: "Ê≥®ÊÑèifÊù°‰ª∂Âè•"
                },
                // Êâ©Â±ïÊ®°ÊùøÔºöÊõ¥Â§öÈöæÂ∫¶3È¢òÁõÆ
                {
                    text: [
                        "I ",
                        { answer: "have lived", options: ["live", "lives", "have lived", "lived"] },
                        " in this city for ten years. I ",
                        { answer: "know", options: ["know", "knows", "knew", "knowing"] },
                        " it very well. I ",
                        { answer: "like", options: ["like", "likes", "liked", "liking"] },
                        " living here."
                    ],
                    difficulty: 3,
                    tip: "Ê≥®ÊÑèÁé∞Âú®ÂÆåÊàêÊó∂"
                },
                {
                    text: [
                        "She ",
                        { answer: "has finished", options: ["finish", "finishes", "has finished", "finished"] },
                        " her homework already. She ",
                        { answer: "can", options: ["can", "could", "will", "must"] },
                        " go out now. She ",
                        { answer: "is", options: ["is", "was", "are", "were"] },
                        " very happy."
                    ],
                    difficulty: 3,
                    tip: "Ê≥®ÊÑèÁé∞Âú®ÂÆåÊàêÊó∂ÂíåÊÉÖÊÄÅÂä®ËØç"
                },
                {
                    text: [
                        "The man ",
                        { answer: "who", options: ["who", "which", "that", "where"] },
                        " lives next door ",
                        { answer: "is", options: ["is", "was", "are", "were"] },
                        " very friendly. He ",
                        { answer: "always", options: ["always", "never", "sometimes", "often"] },
                        " helps us when we need it."
                    ],
                    difficulty: 3,
                    tip: "Ê≥®ÊÑèÂÆöËØ≠‰ªéÂè•"
                },
                {
                    text: [
                        "I ",
                        { answer: "have never", options: ["never", "have never", "never have", "had never"] },
                        " been to Japan. I ",
                        { answer: "would like", options: ["like", "likes", "would like", "liked"] },
                        " to visit it one day. I ",
                        { answer: "am", options: ["am", "was", "are", "were"] },
                        " saving money for the trip."
                    ],
                    difficulty: 3,
                    tip: "Ê≥®ÊÑèÁé∞Âú®ÂÆåÊàêÊó∂Âíåwould like"
                },
                {
                    text: [
                        "Since I ",
                        { answer: "started", options: ["start", "starts", "started", "starting"] },
                        " learning English, I ",
                        { answer: "have made", options: ["make", "makes", "have made", "made"] },
                        " many friends. They ",
                        { answer: "help", options: ["help", "helps", "helped", "helping"] },
                        " me practice speaking."
                    ],
                    difficulty: 3,
                    tip: "Ê≥®ÊÑèsinceÂºïÂØºÁöÑÊó∂Èó¥Áä∂ËØ≠ÂíåÁé∞Âú®ÂÆåÊàêÊó∂"
                },
                // Êâ©Â±ïÊ®°ÊùøÔºöÊõ¥Â§öÈöæÂ∫¶4È¢òÁõÆ
                {
                    text: [
                        "The letter ",
                        { answer: "was written", options: ["write", "wrote", "was written", "is written"] },
                        " by my friend. It ",
                        { answer: "arrived", options: ["arrive", "arrives", "arrived", "arriving"] },
                        " yesterday. I ",
                        { answer: "was", options: ["am", "was", "are", "were"] },
                        " very surprised to receive it."
                    ],
                    difficulty: 4,
                    tip: "Ê≥®ÊÑèË¢´Âä®ËØ≠ÊÄÅ"
                },
                {
                    text: [
                        "By the time we ",
                        { answer: "arrived", options: ["arrive", "arrives", "arrived", "arriving"] },
                        ", the film ",
                        { answer: "had already", options: ["already", "had already", "already had", "has already"] },
                        " started. We ",
                        { answer: "missed", options: ["miss", "misses", "missed", "missing"] },
                        " the beginning."
                    ],
                    difficulty: 4,
                    tip: "Ê≥®ÊÑèËøáÂéªÂÆåÊàêÊó∂"
                },
                {
                    text: [
                        "The car ",
                        { answer: "that", options: ["that", "which", "who", "where"] },
                        " was parked outside ",
                        { answer: "belongs", options: ["belong", "belongs", "belonged", "belonging"] },
                        " to my neighbour. It ",
                        { answer: "has been", options: ["is", "was", "has been", "will be"] },
                        " there for hours."
                    ],
                    difficulty: 4,
                    tip: "Ê≥®ÊÑèÂÆöËØ≠‰ªéÂè•ÂíåÁé∞Âú®ÂÆåÊàêÊó∂"
                },
                {
                    text: [
                        "I ",
                        { answer: "was reading", options: ["read", "reads", "was reading", "reading"] },
                        " a book when the phone ",
                        { answer: "rang", options: ["ring", "rings", "rang", "ringing"] },
                        ". I ",
                        { answer: "answered", options: ["answer", "answers", "answered", "answering"] },
                        " it immediately."
                    ],
                    difficulty: 4,
                    tip: "Ê≥®ÊÑèËøáÂéªËøõË°åÊó∂ÂíåwhenÂºïÂØºÁöÑÊó∂Èó¥Áä∂ËØ≠"
                },
                {
                    text: [
                        "The building ",
                        { answer: "which", options: ["which", "that", "who", "where"] },
                        " was constructed last year ",
                        { answer: "is", options: ["is", "was", "are", "were"] },
                        " now open. Many people ",
                        { answer: "have visited", options: ["visit", "visits", "have visited", "visited"] },
                        " it already."
                    ],
                    difficulty: 4,
                    tip: "Ê≥®ÊÑèÂÆöËØ≠‰ªéÂè•ÂíåÁé∞Âú®ÂÆåÊàêÊó∂"
                },
                // Êâ©Â±ïÊ®°ÊùøÔºöÊõ¥Â§öÈöæÂ∫¶5È¢òÁõÆ
                {
                    text: [
                        "Had I ",
                        { answer: "known", options: ["know", "knew", "known", "knowing"] },
                        " about the accident earlier, I ",
                        { answer: "would have", options: ["will", "would", "would have", "should"] },
                        " come to help. I ",
                        { answer: "feel", options: ["feel", "feels", "felt", "feeling"] },
                        " sorry about it."
                    ],
                    difficulty: 5,
                    tip: "Ê≥®ÊÑèÂÄíË£ÖËôöÊãüËØ≠Ê∞î"
                },
                {
                    text: [
                        "The research ",
                        { answer: "that", options: ["that", "which", "who", "where"] },
                        " was conducted by scientists ",
                        { answer: "has shown", options: ["show", "shows", "has shown", "showed"] },
                        " interesting results. It ",
                        { answer: "will be", options: ["is", "was", "will be", "be"] },
                        " published next month."
                    ],
                    difficulty: 5,
                    tip: "Ê≥®ÊÑèÂÆöËØ≠‰ªéÂè•„ÄÅË¢´Âä®ËØ≠ÊÄÅÂíåÁé∞Âú®ÂÆåÊàêÊó∂"
                },
                {
                    text: [
                        "Not only ",
                        { answer: "did", options: ["do", "does", "did", "will"] },
                        " she finish the project, but she ",
                        { answer: "also", options: ["also", "too", "either", "as well"] },
                        " helped others. She ",
                        { answer: "is", options: ["is", "was", "are", "were"] },
                        " very kind."
                    ],
                    difficulty: 5,
                    tip: "Ê≥®ÊÑèÂÄíË£ÖÂè•Âíånot only...but alsoÁªìÊûÑ"
                },
                {
                    text: [
                        "The decision ",
                        { answer: "which", options: ["which", "that", "who", "where"] },
                        " was made yesterday ",
                        { answer: "will affect", options: ["affect", "affects", "will affect", "affected"] },
                        " many people. We ",
                        { answer: "must", options: ["must", "should", "can", "will"] },
                        " prepare for the changes."
                    ],
                    difficulty: 5,
                    tip: "Ê≥®ÊÑèÂÆöËØ≠‰ªéÂè•ÂíåÊÉÖÊÄÅÂä®ËØç"
                },
                {
                    text: [
                        "Were I ",
                        { answer: "to", options: ["to", "for", "with", "at"] },
                        " you, I ",
                        { answer: "would", options: ["will", "would", "should", "could"] },
                        " accept the offer. It ",
                        { answer: "is", options: ["is", "was", "are", "were"] },
                        " a great opportunity."
                    ],
                    difficulty: 5,
                    tip: "Ê≥®ÊÑèËôöÊãüËØ≠Ê∞îÁöÑÂÄíË£ÖÂΩ¢Âºè"
                },
                {
                    text: [
                        "Had I ",
                        { answer: "known", options: ["know", "knew", "known", "knowing"] },
                        " about the meeting, I ",
                        { answer: "would have", options: ["will", "would", "would have", "should"] },
                        " attended it. Unfortunately, I ",
                        { answer: "missed", options: ["miss", "misses", "missed", "missing"] },
                        " it."
                    ],
                    difficulty: 5,
                    tip: "Ê≥®ÊÑèÂÄíË£ÖËôöÊãüËØ≠Ê∞î"
                },
                {
                    text: [
                        "The report ",
                        { answer: "which", options: ["which", "that", "who", "where"] },
                        " was written by the team ",
                        { answer: "has been", options: ["is", "was", "has been", "will be"] },
                        " approved. It ",
                        { answer: "contains", options: ["contain", "contains", "contained", "containing"] },
                        " all the necessary information."
                    ],
                    difficulty: 5,
                    tip: "Ê≥®ÊÑèÂÆöËØ≠‰ªéÂè•ÂíåÁé∞Âú®ÂÆåÊàêÊó∂Ë¢´Âä®ËØ≠ÊÄÅ"
                }
            ];

            // ÁîüÊàêÊñ∞È¢òÁõÆÔºåÁ°Æ‰øùÊó†ÈáçÂ§ç
            const newQuestions = [];
            let generatedCount = 0;
            const currentCount = data.clozeSets?.length || 0;
            const targetCount = Math.max(100, currentCount + 65); // Ëá≥Â∞ë100ÈÅìÔºåÊàñÂΩìÂâçÊï∞Èáè+65

            console.log(`üéØ ÁõÆÊ†áÊï∞Èáè: ${targetCount} ÈÅìÔºàÂΩìÂâç: ${currentCount} ÈÅìÔºâ`);
            console.log(`üìã ÂèØÁî®Ê®°ÊùøÊï∞Èáè: ${newClozeTemplates.length} ‰∏™`);

            // ÊîπËøõÂéªÈáçÈÄªËæëÔºö‰ΩøÁî®Êõ¥ÂÆåÊï¥ÁöÑÂìàÂ∏åÔºå‰ΩÜÂÖÅËÆ∏‰∏Ä‰∫õÂèòÂåñ
            let attempts = 0;
            const maxAttempts = newClozeTemplates.length * 5; // ÊúÄÂ§öÂ∞ùËØïÊ®°ÊùøÊï∞ÈáèÁöÑ5ÂÄç

            while (data.clozeSets.length < targetCount && attempts < maxAttempts) {
                // ÈöèÊú∫ÈÄâÊã©Ê®°ÊùøÔºåÂ¢ûÂä†Â§öÊ†∑ÊÄß
                const templateIndex = Math.floor(Math.random() * newClozeTemplates.length);
                const template = newClozeTemplates[templateIndex];

                // ÁîüÊàêÂÜÖÂÆπÂìàÂ∏åÊ£ÄÊü•ÊòØÂê¶ÈáçÂ§çÔºà‰ΩøÁî®Êõ¥ÂÆåÊï¥ÁöÑÊñáÊú¨Ôºâ
                const textStr = JSON.stringify(template.text);
                // ‰ΩøÁî®Êõ¥ÈïøÁöÑÂìàÂ∏åÔºå‰ΩÜÂè™Ê£ÄÊü•Ââç200‰∏™Â≠óÁ¨¶ÔºåÂ¢ûÂä†ÂåπÈÖçÁ≤æÂ∫¶
                const hash = textStr.substring(0, 200).replace(/\s+/g, '').toLowerCase();

                // Ê£ÄÊü•ÊòØÂê¶ÈáçÂ§ç
                let isDuplicate = false;
                if (existingHashes.has(hash)) {
                    // Ëøõ‰∏ÄÊ≠•Ê£ÄÊü•ÔºöÂ¶ÇÊûúÂìàÂ∏åÁõ∏ÂêåÔºåÊ£ÄÊü•ÂÆåÊï¥ÂÜÖÂÆπ
                    isDuplicate = data.clozeSets.some(item => {
                        if (!item.text) return false;
                        try {
                            const itemTextStr = typeof item.text === 'string' ? item.text : JSON.stringify(item.text);
                            const itemHash = itemTextStr.substring(0, 200).replace(/\s+/g, '').toLowerCase();
                            // Â¶ÇÊûúÂâç200Â≠óÁ¨¶ÁöÑÂìàÂ∏åÁõ∏ÂêåÔºå‰∏îÊï¥‰ΩìÁõ∏‰ººÂ∫¶Ë∂ÖËøá90%ÔºåËÆ§‰∏∫ÊòØÈáçÂ§ç
                            if (itemHash === hash) {
                                const similarity = calculateSimilarity(textStr, itemTextStr);
                                return similarity > 0.9;
                            }
                        } catch (e) {
                            return false;
                        }
                        return false;
                    });
                }

                if (!isDuplicate) {
                    // ÁîüÊàêÂîØ‰∏ÄID
                    const newId = `cloze_gen_${Date.now()}_${generatedCount}_${Math.random().toString(36).substr(2, 9)}`;

                    const newQuestion = {
                        id: newId,
                        text: JSON.parse(JSON.stringify(template.text)), // Ê∑±Êã∑Ë¥ù
                        tip: template.tip,
                        difficulty: template.difficulty || 3,
                        feedbackCorrect: "ÂæàÂ•ΩÔºÅËØ≠Ê≥ïÂíåÊó∂ÊÄÅÈÉΩÊ≠£Á°ÆÔºÅ",
                        feedbackWrong: "ÂÜç‰ªîÁªÜÊ£ÄÊü•‰∏Ä‰∏ãËØ≠Ê≥ïÂíåÊó∂ÊÄÅ„ÄÇ"
                    };

                    newQuestions.push(newQuestion);
                    existingHashes.add(hash);
                    data.clozeSets.push(newQuestion);
                    generatedCount++;
                    console.log(`‚úÖ ÁîüÊàêÁ¨¨ ${generatedCount} ÈÅìÊñ∞È¢òÁõÆ (ÈöæÂ∫¶ ${template.difficulty})`);
                }

                attempts++;
            }

            // Â¶ÇÊûúËøòÊ≤°ËææÂà∞ÁõÆÊ†áÔºåÂ∞ùËØïÁîüÊàêÂèò‰ΩìÈ¢òÁõÆ
            if (data.clozeSets.length < targetCount && newQuestions.length > 0) {
                console.log('üîÑ Â∞ùËØïÁîüÊàêÂèò‰ΩìÈ¢òÁõÆ‰ª•Â¢ûÂä†Êï∞Èáè...');
                const variantCount = Math.min(targetCount - data.clozeSets.length, 20);
                for (let i = 0; i < variantCount; i++) {
                    const baseTemplate = newClozeTemplates[i % newClozeTemplates.length];
                    // ÂàõÂª∫Âèò‰ΩìÔºöÁ®çÂæÆ‰øÆÊîπÊñáÊú¨‰ΩÜ‰øùÊåÅÈöæÂ∫¶ÂíåËØ≠Ê≥ïÁÇπ
                    const variant = createVariant(baseTemplate, i);
                    const variantHash = JSON.stringify(variant.text).substring(0, 200).replace(/\s+/g, '').toLowerCase();

                    if (!existingHashes.has(variantHash)) {
                        const newId = `cloze_gen_variant_${Date.now()}_${i}_${Math.random().toString(36).substr(2, 9)}`;
                        const newQuestion = {
                            id: newId,
                            text: variant.text,
                            tip: variant.tip,
                            difficulty: variant.difficulty,
                            feedbackCorrect: "ÂæàÂ•ΩÔºÅËØ≠Ê≥ïÂíåÊó∂ÊÄÅÈÉΩÊ≠£Á°ÆÔºÅ",
                            feedbackWrong: "ÂÜç‰ªîÁªÜÊ£ÄÊü•‰∏Ä‰∏ãËØ≠Ê≥ïÂíåÊó∂ÊÄÅ„ÄÇ"
                        };
                        newQuestions.push(newQuestion);
                        existingHashes.add(variantHash);
                        data.clozeSets.push(newQuestion);
                        generatedCount++;
                    }
                }
            }

            // ËæÖÂä©ÂáΩÊï∞ÔºöËÆ°ÁÆóÊñáÊú¨Áõ∏‰ººÂ∫¶
            function calculateSimilarity(str1, str2) {
                const longer = str1.length > str2.length ? str1 : str2;
                const shorter = str1.length > str2.length ? str2 : str1;
                if (longer.length === 0) return 1.0;
                const distance = levenshteinDistance(longer, shorter);
                return (longer.length - distance) / longer.length;
            }

            // ËæÖÂä©ÂáΩÊï∞ÔºöËÆ°ÁÆóÁºñËæëË∑ùÁ¶ª
            function levenshteinDistance(str1, str2) {
                const matrix = [];
                for (let i = 0; i <= str2.length; i++) {
                    matrix[i] = [i];
                }
                for (let j = 0; j <= str1.length; j++) {
                    matrix[0][j] = j;
                }
                for (let i = 1; i <= str2.length; i++) {
                    for (let j = 1; j <= str1.length; j++) {
                        if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                            matrix[i][j] = matrix[i - 1][j - 1];
                        } else {
                            matrix[i][j] = Math.min(
                                matrix[i - 1][j - 1] + 1,
                                matrix[i][j - 1] + 1,
                                matrix[i - 1][j] + 1
                            );
                        }
                    }
                }
                return matrix[str2.length][str1.length];
            }

            // ËæÖÂä©ÂáΩÊï∞ÔºöÂàõÂª∫Âèò‰ΩìÈ¢òÁõÆ
            function createVariant(template, index) {
                // ÂàõÂª∫ËΩªÂæÆÂèò‰ΩìÔºöÊîπÂèò‰∏Ä‰∫õËØçÊ±á‰ΩÜ‰øùÊåÅËØ≠Ê≥ïÁªìÊûÑ
                const variants = [
                    { word: "usually", replace: "often" },
                    { word: "yesterday", replace: "last week" },
                    { word: "tomorrow", replace: "next week" },
                    { word: "friend", replace: "classmate" },
                    { word: "school", replace: "university" }
                ];

                const variant = JSON.parse(JSON.stringify(template));
                const variantIndex = index % variants.length;
                const variantRule = variants[variantIndex];

                // Âú®ÊñáÊú¨‰∏≠ÊõøÊç¢ËØçÊ±áÔºàÂè™ÊõøÊç¢Â≠óÁ¨¶‰∏≤ÈÉ®ÂàÜÔºå‰∏çÊõøÊç¢ÈÄâÈ°πÂØπË±°Ôºâ
                if (Array.isArray(variant.text)) {
                    variant.text = variant.text.map(item => {
                        if (typeof item === 'string' && item.includes(variantRule.word)) {
                            return item.replace(new RegExp(variantRule.word, 'gi'), variantRule.replace);
                        }
                        return item;
                    });
                }

                return variant;
            }

            if (newQuestions.length > 0) {
                console.log(`‚úÖ ÊàêÂäüÁîüÊàê ${newQuestions.length} ÈÅìÊñ∞ÁöÑÂÆåÂΩ¢Â°´Á©∫È¢òÁõÆ`);
                console.log(`üìä ÂΩìÂâçÊÄªÊï∞: ${data.clozeSets.length} ÈÅì`);

                // ÈáçÊñ∞ÂàÜÈÖçÈöæÂ∫¶ÔºåÁ°Æ‰øùÂùáÂåÄÂàÜÂ∏É
                const totalItems = data.clozeSets.length;
                const itemsPerLevel = Math.ceil(totalItems / 5);
                const difficultyGroups = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 };

                data.clozeSets.forEach((item, index) => {
                    // Â¶ÇÊûúÂ∑≤ÊúâÈöæÂ∫¶‰∏îÂêàÁêÜÔºå‰øùÁïôÔºõÂê¶ÂàôÈáçÊñ∞ÂàÜÈÖç
                    if (!item.difficulty || item.difficulty < 1 || item.difficulty > 5) {
                        const targetLevel = Math.min(5, Math.max(1, Math.ceil((index + 1) / itemsPerLevel)));
                        let assignedLevel = targetLevel;
                        let attempts = 0;
                        while (difficultyGroups[assignedLevel] >= itemsPerLevel && attempts < 5) {
                            assignedLevel = (assignedLevel % 5) + 1;
                            attempts++;
                        }
                        item.difficulty = assignedLevel;
                    }
                    difficultyGroups[item.difficulty || 1]++;
                });

                console.log('‚úÖ ÈöæÂ∫¶Â∑≤ÈáçÊñ∞ËßÑÂàí:', difficultyGroups);

                // ÊåâÈöæÂ∫¶ÊéíÂ∫è
                data.clozeSets.sort((a, b) => {
                    const diffA = a.difficulty || 1;
                    const diffB = b.difficulty || 1;
                    if (diffA !== diffB) {
                        return diffA - diffB;
                    }
                    return 0;
                });

                // ‰øùÂ≠òÊï∞ÊçÆ
                if (saveDataToLocalStorage()) {
                    console.log('‚úÖ Êñ∞È¢òÁõÆÂ∑≤‰øùÂ≠ò');
                    updateBankStatistics();
                    showCustomAlert(`‚úÖ ÊàêÂäüÁîüÊàê ${newQuestions.length} ÈÅìÊñ∞È¢òÁõÆÔºÅ\n\nÂΩìÂâçÂÆåÂΩ¢Â°´Á©∫ÊÄªÊï∞: ${data.clozeSets.length} ÈÅì\n\nÈöæÂ∫¶ÂàÜÂ∏É:\n1Êòü: ${difficultyGroups[1]} ÈÅì\n2Êòü: ${difficultyGroups[2]} ÈÅì\n3Êòü: ${difficultyGroups[3]} ÈÅì\n4Êòü: ${difficultyGroups[4]} ÈÅì\n5Êòü: ${difficultyGroups[5]} ÈÅì`, 'ÁîüÊàêÊàêÂäü');
                } else {
                    alert('‚ö†Ô∏è ÁîüÊàêÊàêÂäü‰ΩÜ‰øùÂ≠òÂ§±Ë¥•ÔºåËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï');
                }
            } else {
                alert('‚ö†Ô∏è Êú™ËÉΩÁîüÊàêÊñ∞È¢òÁõÆÔºåÂèØËÉΩÊâÄÊúâÊ®°ÊùøÈÉΩÂ∑≤Â≠òÂú®ÊàñÂ∑≤ËææÂà∞ÁõÆÊ†áÊï∞Èáè');
            }

            if (btn) {
                btn.disabled = false;
                const currentTotal = data.clozeSets?.length || 0;
                if (currentTotal >= 100) {
                    btn.textContent = `‚ú® ÁîüÊàêÊñ∞È¢òÁõÆÔºàÂΩìÂâç${currentTotal}ÈÅìÔºâ`;
                } else {
                    btn.textContent = '‚ú® ÁîüÊàêÊñ∞È¢òÁõÆÔºàÂ¢ûÂä†Ëá≥100+Ôºâ';
                }
            }
        }



        // ÊâìÂç°ËÆ∞ÂΩïÁõ∏ÂÖ≥‰∫ã‰ª∂
        document.getElementById("checkinBtn").addEventListener("click", showCheckinModal);
        document.getElementById("checkinCloseBtn").addEventListener("click", hideCheckinModal);
        document.getElementById("checkinCloseBtn2").addEventListener("click", hideCheckinModal);
        document.getElementById("exportCheckinBtn").addEventListener("click", exportCheckinRecords);
        document.getElementById("importCheckinBtn").addEventListener("click", () => {
            document.getElementById("checkinFileInput").click();
        });
        document.getElementById("checkinFileInput").addEventListener("change", importCheckinRecords);
        document.getElementById("weekViewBtn").addEventListener("click", () => {
            document.getElementById("weekView").style.display = "block";
            document.getElementById("monthView").style.display = "none";
            document.getElementById("weekViewBtn").classList.add("primary-btn");
            document.getElementById("weekViewBtn").classList.remove("secondary-btn");
            document.getElementById("monthViewBtn").classList.add("secondary-btn");
            document.getElementById("monthViewBtn").classList.remove("primary-btn");
            renderWeekView();
        });
        document.getElementById("monthViewBtn").addEventListener("click", () => {
            document.getElementById("weekView").style.display = "none";
            document.getElementById("monthView").style.display = "block";
            document.getElementById("monthViewBtn").classList.add("primary-btn");
            document.getElementById("monthViewBtn").classList.remove("secondary-btn");
            document.getElementById("weekViewBtn").classList.add("secondary-btn");
            document.getElementById("weekViewBtn").classList.remove("primary-btn");
            renderMonthView();
        });

        // ÁÇπÂáªËÉåÊôØÂÖ≥Èó≠ÊâìÂç°ËÆ∞ÂΩïÊ®°ÊÄÅÊ°Ü
        document.getElementById('checkinModal').addEventListener("click", (e) => {
            if (e.target === document.getElementById('checkinModal')) {
                hideCheckinModal();
            }
        });


        // ------------ Event Handlers ------------
        nextReadingBtn.addEventListener("click", nextReading);
        nextCollocationBtn.addEventListener("click", nextCollocation);
        nextClozeBtn.addEventListener("click", nextCloze);


        // ------------ Modal Close Handler (ÂÖ®Â±ÄÁªü‰∏Ä) ------------
        const previewModal = document.getElementById("previewModal");
        const previewCloseBtn = document.getElementById("previewCloseBtn");

        function closePreviewModal() {
            if (previewModal) {
                previewModal.classList.remove("active");
                const body = document.getElementById("previewBody");
                if (body) body.innerHTML = "";
            }
        }

        // ÁªëÂÆöÂÖ≥Èó≠ÊåâÈíÆÔºàÂè™ÁªëÂÆö‰∏ÄÊ¨°Ôºâ
        if (previewCloseBtn) {
            previewCloseBtn.addEventListener("click", (e) => {
                e.preventDefault();
                e.stopPropagation();
                closePreviewModal();
            });
        }

        // ÁÇπÂáªËÉåÊôØÂÖ≥Èó≠
        if (previewModal) {
            previewModal.addEventListener("click", (e) => {
                if (e.target === previewModal) {
                    closePreviewModal();
                }
            });

            // Èò≤Ê≠¢ÁÇπÂáªÂÜÖÂÆπÂå∫ÂüüÊó∂ÂÖ≥Èó≠
            const previewContent = previewModal.querySelector(".preview-content");
            if (previewContent) {
                previewContent.addEventListener("click", (e) => {
                    e.stopPropagation();
                });
            }
        }

        // ESC ÈîÆÂÖ≥Èó≠
        document.addEventListener("keydown", (e) => {
            if (e.key === "Escape" && previewModal && previewModal.classList.contains("active")) {
                closePreviewModal();
            }
        });

        // ------------ Init ------------
        function init() {
            console.log('üöÄ ÂºÄÂßãÂàùÂßãÂåñ...');
            console.log('üì¶ ÂΩìÂâçdataÁä∂ÊÄÅ:', {
                vocab: data?.vocab?.length || 0,
                reading: data?.readingSets?.length || 0,
                collocation: data?.collocationSets?.length || 0,
                cloze: data?.clozeSets?.length || 0
            });

            // Âä†ËΩΩÈòÖËØªÁêÜËß£APIÈÖçÁΩÆ


            // üíæ ‰ªélocalStorageÂä†ËΩΩÊï∞ÊçÆÔºàÂ¢ûÂº∫ÁâàÔºåÊîØÊåÅÂ§öÂ§á‰ªΩÊÅ¢Â§çÔºâ
            try {
                // Â∞ùËØï‰ªéÂ§ö‰∏™ÂèØËÉΩÁöÑkeyÊÅ¢Â§çÊï∞ÊçÆ
                let savedData = localStorage.getItem('petEnglishData');

                // Â¶ÇÊûú‰∏ªkeyÊ≤°ÊúâÊï∞ÊçÆÔºåÂ∞ùËØï‰ªéÂ§á‰ªΩÊÅ¢Â§ç
                if (!savedData) {
                    const backupKeys = ['petEnglishData_backup', 'petEnglishData_old', 'petData'];
                    for (const key of backupKeys) {
                        const backup = localStorage.getItem(key);
                        if (backup) {
                            try {
                                // È™åËØÅÂ§á‰ªΩÊï∞ÊçÆÊ†ºÂºè
                                const parsed = JSON.parse(backup);
                                if (parsed.vocab || parsed.readingSets || parsed.collocationSets || parsed.clozeSets) {
                                    console.log(`‚ö†Ô∏è ‰ªéÂ§á‰ªΩ‰ΩçÁΩÆÊÅ¢Â§çÊï∞ÊçÆ: ${key}`);
                                    savedData = backup;
                                    // ÊÅ¢Â§çÂêéÁ´ãÂç≥‰øùÂ≠òÂà∞‰∏ªkeyÂíåÊâÄÊúâÂ§á‰ªΩ‰ΩçÁΩÆÔºàÂ§öÈáç‰øùÈöúÔºâ
                                    const saveKeys = ['petEnglishData', 'petEnglishData_backup', 'petEnglishData_old', 'petData'];
                                    saveKeys.forEach(saveKey => {
                                        try {
                                            localStorage.setItem(saveKey, backup);
                                            console.log(`‚úÖ Â∑≤‰øùÂ≠òÂà∞ ${saveKey}`);
                                        } catch (e) {
                                            console.error(`‚ùå ‰øùÂ≠òÂà∞ ${saveKey} Â§±Ë¥•:`, e);
                                        }
                                    });
                                    break;
                                }
                            } catch (e) {
                                console.warn(`‚ö†Ô∏è Â§á‰ªΩ ${key} Êï∞ÊçÆÊ†ºÂºèÈîôËØØÔºåË∑≥Ëøá:`, e);
                            }
                        }
                    }
                }

                if (savedData) {
                    console.log('üì• ÂèëÁé∞localStorageÊï∞ÊçÆÔºåÂºÄÂßãËß£Êûê...');
                    const parsed = JSON.parse(savedData);

                    // Ê£ÄÊü•ÊòØÂê¶ÂåÖÂê´Â∑≤Âà†Èô§ÁöÑÂê¨ÂäõÊ®°ÂùóÊï∞ÊçÆÔºàÊóßÁâàÊú¨Ôºâ
                    if (parsed.listeningSets) {
                        console.log('‚ö†Ô∏è Ê£ÄÊµãÂà∞ÊóßÁâàÊú¨Êï∞ÊçÆÔºåÂ∑≤Ëá™Âä®Ê∏ÖÁêÜ');
                        delete parsed.listeningSets;
                    }

                    // üîí ÂÖ≥ÈîÆ‰øÆÂ§çÔºöÁõ¥Êé•‰ΩøÁî®localStorage‰∏≠ÁöÑÊâÄÊúâÊï∞ÊçÆÔºåÂÆåÂÖ®‰ø°‰ªªÁî®Êà∑Êï∞ÊçÆ
                    console.log('üìä localStorageÊï∞ÊçÆÁªüËÆ°:', {
                        ÂçïËØç: parsed.vocab?.length || 0,
                        ÈòÖËØª: parsed.readingSets?.length || 0,
                        Âõ∫ÂÆöÊê≠ÈÖç: parsed.collocationSets?.length || 0,
                        ÂÆåÂΩ¢: parsed.clozeSets?.length || 0
                    });

                    // üîí ÂÖ≥ÈîÆ‰øÆÂ§çÔºöÁõ¥Êé•‰ΩøÁî®localStorage‰∏≠ÁöÑÊï∞ÊçÆÔºåÂç≥‰Ωø‰∏∫Á©∫Êï∞ÁªÑ‰πüË¶Å‰øùÁïôÔºàÁî®Êà∑ÂèØËÉΩÊïÖÊÑèÊ∏ÖÁ©∫‰∫ÜÊüê‰∫õÊ®°ÂùóÔºâ
                    // Âè™ÊúâÂú®Â≠óÊÆµ‰∏çÂ≠òÂú®Êó∂Êâç‰ΩøÁî®ÈªòËÆ§ÂÄº
                    if (parsed.hasOwnProperty('vocab')) {
                        data.vocab = Array.isArray(parsed.vocab) ? parsed.vocab : [];
                        console.log('‚úÖ Â∑≤ÊÅ¢Â§çÂçïËØçÊï∞ÊçÆ:', data.vocab.length, '‰∏™');
                    } else {
                        // Â≠óÊÆµ‰∏çÂ≠òÂú®Êó∂Êâç‰ΩøÁî®Á©∫Êï∞ÁªÑ
                        data.vocab = [];
                        console.log('‚ö†Ô∏è vocabÂ≠óÊÆµ‰∏çÂ≠òÂú®Ôºå‰ΩøÁî®Á©∫Êï∞ÁªÑ');
                    }

                    if (parsed.hasOwnProperty('readingSets')) {
                        data.readingSets = Array.isArray(parsed.readingSets) ? parsed.readingSets : [];
                        console.log('‚úÖ Â∑≤ÊÅ¢Â§çÈòÖËØªÊï∞ÊçÆ:', data.readingSets.length, 'ÈÅì');
                    } else {
                        data.readingSets = [];
                        console.log('‚ö†Ô∏è readingSetsÂ≠óÊÆµ‰∏çÂ≠òÂú®Ôºå‰ΩøÁî®Á©∫Êï∞ÁªÑ');
                    }

                    if (parsed.hasOwnProperty('collocationSets')) {
                        data.collocationSets = Array.isArray(parsed.collocationSets) ? parsed.collocationSets : [];
                        console.log('‚úÖ Â∑≤ÊÅ¢Â§çÂõ∫ÂÆöÊê≠ÈÖçÊï∞ÊçÆ:', data.collocationSets.length, 'ÈÅì');
                    } else {
                        data.collocationSets = [];
                        console.log('‚ö†Ô∏è collocationSetsÂ≠óÊÆµ‰∏çÂ≠òÂú®Ôºå‰ΩøÁî®Á©∫Êï∞ÁªÑ');
                    }

                    if (parsed.hasOwnProperty('clozeSets')) {
                        data.clozeSets = Array.isArray(parsed.clozeSets) ? parsed.clozeSets : [];
                        console.log('‚úÖ Â∑≤ÊÅ¢Â§çÂÆåÂΩ¢Â°´Á©∫Êï∞ÊçÆ:', data.clozeSets.length, 'ÈÅì');
                    } else {
                        data.clozeSets = [];
                        console.log('‚ö†Ô∏è clozeSetsÂ≠óÊÆµ‰∏çÂ≠òÂú®Ôºå‰ΩøÁî®Á©∫Êï∞ÁªÑ');
                    }

                    console.log('‚úÖ localStorageÊï∞ÊçÆÂä†ËΩΩÂÆåÊàê');
                    console.log('üìä ÊÅ¢Â§çÂêéÁªüËÆ°:', {
                        ÂçïËØç: data.vocab?.length || 0,
                        ÈòÖËØª: data.readingSets?.length || 0,
                        Âõ∫ÂÆöÊê≠ÈÖç: data.collocationSets?.length || 0,
                        ÂÆåÂΩ¢: data.clozeSets?.length || 0
                    });
                } else {
                    // Â¶ÇÊûúlocalStorage‰∏≠Ê≤°ÊúâÊï∞ÊçÆÔºåÂº∫Âà∂‰ΩøÁî®ÂÜÖÁΩÆÊï∞ÊçÆ
                    console.log('üìù localStorage‰∏≠Ê≤°ÊúâÊï∞ÊçÆÔºåÂº∫Âà∂‰ΩøÁî®ÂÜÖÁΩÆÊï∞ÊçÆ');

                    // Âº∫Âà∂‰ΩøÁî®window.petContentÁöÑÂÜÖÁΩÆÊï∞ÊçÆ
                    if (window.petContent) {
                        data.vocab = window.petContent.vocab || [];
                        data.readingSets = window.petContent.readingSets || [];
                        data.collocationSets = window.petContent.collocationSets || [];
                        data.clozeSets = window.petContent.clozeSets || [];
                        console.log('‚úÖ Â∑≤Âº∫Âà∂Âä†ËΩΩÂÜÖÁΩÆÊï∞ÊçÆ');
                    } else {
                        console.error('‚ùå window.petContent‰∏çÂ≠òÂú®ÔºÅ');
                    }

                    console.log('üìä ÂÜÖÁΩÆÊï∞ÊçÆÁªüËÆ°:', {
                        ÂçïËØç: data.vocab?.length || 0,
                        ÈòÖËØª: data.readingSets?.length || 0,
                        Âõ∫ÂÆöÊê≠ÈÖç: data.collocationSets?.length || 0,
                        ÂÆåÂΩ¢: data.clozeSets?.length || 0
                    });

                    // Á´ãÂç≥‰øùÂ≠òÂÜÖÁΩÆÊï∞ÊçÆÂà∞localStorage
                    if (saveDataToLocalStorage()) {
                        console.log('‚úÖ ÂÜÖÁΩÆÊï∞ÊçÆÂ∑≤‰øùÂ≠òÂà∞localStorage');
                    } else {
                        console.error('‚ùå ‰øùÂ≠òÈªòËÆ§Êï∞ÊçÆÂ§±Ë¥•');
                    }
                }

                // üîí ÊúÄÁªà‰øùÈöúÔºöÂè™ÊúâÂú®localStorageÂÆåÂÖ®Ê≤°ÊúâËØ•Â≠óÊÆµÊï∞ÊçÆÊó∂ÔºåÊâç‰ΩøÁî®ÂÜÖÁΩÆÊï∞ÊçÆÂ°´ÂÖÖ
                // ‰∏çË¶ÅË¶ÜÁõñÁî®Êà∑ÂèØËÉΩÊïÖÊÑèÊ∏ÖÁ©∫ÁöÑÊï∞ÊçÆ
                let needFix = false;
                const savedDataForFix = localStorage.getItem('petEnglishData') ||
                    localStorage.getItem('petEnglishData_backup') ||
                    localStorage.getItem('petEnglishData_old') ||
                    localStorage.getItem('petData');

                if (savedDataForFix) {
                    try {
                        const parsed = JSON.parse(savedDataForFix);
                        // Âè™ÊúâÂú®localStorage‰∏≠ËØ•Â≠óÊÆµ‰∏çÂ≠òÂú®Êó∂ÔºåÊâç‰ΩøÁî®ÂÜÖÁΩÆÊï∞ÊçÆ
                        if ((!data.vocab || data.vocab.length === 0) && !parsed.hasOwnProperty('vocab')) {
                            console.warn('‚ö†Ô∏è ÂçïËØçÊï∞ÊçÆ‰∏∫Á©∫‰∏îlocalStorage‰∏≠Ê≤°ÊúâËØ•Â≠óÊÆµÔºå‰ΩøÁî®ÂÜÖÁΩÆÊï∞ÊçÆ');
                            if (window.petContent && window.petContent.vocab) {
                                data.vocab = window.petContent.vocab;
                                needFix = true;
                            }
                        }
                        if ((!data.readingSets || data.readingSets.length === 0) && !parsed.hasOwnProperty('readingSets')) {
                            console.warn('‚ö†Ô∏è ÈòÖËØªÊï∞ÊçÆ‰∏∫Á©∫‰∏îlocalStorage‰∏≠Ê≤°ÊúâËØ•Â≠óÊÆµÔºå‰ΩøÁî®ÂÜÖÁΩÆÊï∞ÊçÆ');
                            if (window.petContent && window.petContent.readingSets) {
                                data.readingSets = window.petContent.readingSets;
                                needFix = true;
                            }
                        }
                        if ((!data.collocationSets || data.collocationSets.length === 0) && !parsed.hasOwnProperty('collocationSets')) {
                            console.warn('‚ö†Ô∏è Âõ∫ÂÆöÊê≠ÈÖçÊï∞ÊçÆ‰∏∫Á©∫‰∏îlocalStorage‰∏≠Ê≤°ÊúâËØ•Â≠óÊÆµÔºå‰ΩøÁî®ÂÜÖÁΩÆÊï∞ÊçÆ');
                            if (window.petContent && window.petContent.collocationSets) {
                                data.collocationSets = window.petContent.collocationSets;
                                needFix = true;
                            }
                        }
                        if ((!data.clozeSets || data.clozeSets.length === 0) && !parsed.hasOwnProperty('clozeSets')) {
                            console.warn('‚ö†Ô∏è ÂÆåÂΩ¢Â°´Á©∫Êï∞ÊçÆ‰∏∫Á©∫‰∏îlocalStorage‰∏≠Ê≤°ÊúâËØ•Â≠óÊÆµÔºå‰ΩøÁî®ÂÜÖÁΩÆÊï∞ÊçÆ');
                            if (window.petContent && window.petContent.clozeSets) {
                                data.clozeSets = window.petContent.clozeSets;
                                needFix = true;
                            }
                        }
                    } catch (e) {
                        console.error('‚ùå Ëß£ÊûêlocalStorageÊï∞ÊçÆÂ§±Ë¥•:', e);
                    }
                }

                if (needFix) {
                    console.log('‚úÖ Â∑≤‰øÆÂ§çÈÉ®ÂàÜÊï∞ÊçÆÔºå‰øùÂ≠òÂà∞localStorage');
                    saveDataToLocalStorage();
                    // ‰øÆÂ§çÂêéÈáçÊñ∞ÊòæÁ§∫ÁªüËÆ°
                    updateBankStatistics();
                }

                // üö® Á¥ßÊÄ•ÊÅ¢Â§çÊú∫Âà∂ÔºöÂ¶ÇÊûúÊï∞ÊçÆÂÖ®ÈÉ®‰∏¢Â§±ÔºåËá™Âä®‰ªéÂ§á‰ªΩÊÅ¢Â§ç
                const totalCount = (data.vocab?.length || 0) +
                    (data.readingSets?.length || 0) +
                    (data.collocationSets?.length || 0) +
                    (data.clozeSets?.length || 0);

                if (totalCount === 0) {
                    console.warn('üö® Ê£ÄÊµãÂà∞Êï∞ÊçÆÂÖ®ÈÉ®‰∏¢Â§±ÔºåÂ∞ùËØïËá™Âä®ÊÅ¢Â§ç...');

                    // Ê£ÄÊü•ÊâÄÊúâÂ§á‰ªΩ‰ΩçÁΩÆ
                    const emergencyBackupKeys = [
                        'petEnglishData_backup',
                        'petEnglishData_old',
                        'petData',
                        'petEnglishData_before_restore'
                    ];

                    // Ê£ÄÊü•Êó∂Èó¥Êà≥Â§á‰ªΩ
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        if (key && key.startsWith('petEnglishData_before_save_')) {
                            emergencyBackupKeys.push(key);
                        }
                    }

                    let recovered = false;
                    for (const backupKey of emergencyBackupKeys) {
                        const backup = localStorage.getItem(backupKey);
                        if (backup) {
                            try {
                                const parsed = JSON.parse(backup);
                                const backupCount = (parsed.vocab?.length || 0) +
                                    (parsed.readingSets?.length || 0) +
                                    (parsed.collocationSets?.length || 0) +
                                    (parsed.clozeSets?.length || 0);

                                if (backupCount > 0) {
                                    console.log(`‚úÖ ‰ªé ${backupKey} Ëá™Âä®ÊÅ¢Â§çÊï∞ÊçÆ...`);
                                    data.vocab = Array.isArray(parsed.vocab) ? parsed.vocab : [];
                                    data.readingSets = Array.isArray(parsed.readingSets) ? parsed.readingSets : [];
                                    data.collocationSets = Array.isArray(parsed.collocationSets) ? parsed.collocationSets : [];
                                    data.clozeSets = Array.isArray(parsed.clozeSets) ? parsed.clozeSets : [];

                                    // Á´ãÂç≥‰øùÂ≠òÂà∞ÊâÄÊúâ‰ΩçÁΩÆ
                                    const dataToSave = {
                                        vocab: data.vocab,
                                        readingSets: data.readingSets,
                                        collocationSets: data.collocationSets,
                                        clozeSets: data.clozeSets
                                    };
                                    const jsonString = JSON.stringify(dataToSave);

                                    ['petEnglishData', 'petEnglishData_backup', 'petEnglishData_old', 'petData'].forEach(key => {
                                        try {
                                            localStorage.setItem(key, jsonString);
                                            console.log(`‚úÖ Â∑≤‰øùÂ≠òÂà∞ ${key}`);
                                        } catch (e) {
                                            console.error(`‚ùå ‰øùÂ≠òÂà∞ ${key} Â§±Ë¥•:`, e);
                                        }
                                    });

                                    updateBankStatistics();
                                    recovered = true;
                                    console.log('‚úÖ Ëá™Âä®ÊÅ¢Â§çÊàêÂäüÔºÅ');
                                    alert(`üö® Ê£ÄÊµãÂà∞Êï∞ÊçÆ‰∏¢Â§±ÔºåÂ∑≤Ëá™Âä®‰ªéÂ§á‰ªΩÊÅ¢Â§çÔºÅ\n\nÊÅ¢Â§çÊù•Ê∫êÔºö${backupKey}\n- ÂçïËØç: ${data.vocab.length} ‰∏™\n- ÈòÖËØª: ${data.readingSets.length} È¢ò\n- Âõ∫ÂÆöÊê≠ÈÖç: ${data.collocationSets.length} È¢ò\n- ÂÆåÂΩ¢Â°´Á©∫: ${data.clozeSets.length} È¢ò`);
                                    break;
                                }
                            } catch (e) {
                                console.warn(`‚ö†Ô∏è Â§á‰ªΩ ${backupKey} Ëß£ÊûêÂ§±Ë¥•:`, e);
                            }
                        }
                    }

                    if (!recovered && window.petContent) {
                        const builtinCount = (window.petContent.vocab?.length || 0) +
                            (window.petContent.readingSets?.length || 0) +
                            (window.petContent.collocationSets?.length || 0) +
                            (window.petContent.clozeSets?.length || 0);
                        if (builtinCount > 0) {
                            console.log('‚úÖ ‰ªéÂÜÖÁΩÆÊï∞ÊçÆËá™Âä®ÊÅ¢Â§ç...');
                            data.vocab = window.petContent.vocab || [];
                            data.readingSets = window.petContent.readingSets || [];
                            data.collocationSets = window.petContent.collocationSets || [];
                            data.clozeSets = window.petContent.clozeSets || [];
                            saveDataToLocalStorage();
                            updateBankStatistics();
                            alert(`üö® Ê£ÄÊµãÂà∞Êï∞ÊçÆ‰∏¢Â§±ÔºåÂ∑≤‰ªéÂÜÖÁΩÆÊï∞ÊçÆËá™Âä®ÊÅ¢Â§çÔºÅ\n\n- ÂçïËØç: ${data.vocab.length} ‰∏™\n- ÈòÖËØª: ${data.readingSets.length} È¢ò\n- Âõ∫ÂÆöÊê≠ÈÖç: ${data.collocationSets.length} È¢ò\n- ÂÆåÂΩ¢Â°´Á©∫: ${data.clozeSets.length} È¢ò`);
                        }
                    }
                }
            } catch (error) {
                console.error('‚ùå Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•:', error);
                // Â¶ÇÊûúÂä†ËΩΩÂ§±Ë¥•ÔºåÂ∞ùËØï‰ªéÂ§á‰ªΩÊÅ¢Â§ç
                try {
                    const backup = localStorage.getItem('petEnglishData_backup');
                    if (backup) {
                        console.log('üîÑ Â∞ùËØï‰ªéÂ§á‰ªΩÊÅ¢Â§çÊï∞ÊçÆ...');
                        const parsed = JSON.parse(backup);
                        if (parsed.vocab) data.vocab = parsed.vocab;
                        if (parsed.readingSets) data.readingSets = parsed.readingSets;
                        if (parsed.collocationSets) data.collocationSets = parsed.collocationSets;
                        if (parsed.clozeSets) data.clozeSets = parsed.clozeSets;
                        localStorage.setItem('petEnglishData', backup);
                        console.log('‚úÖ Â∑≤‰ªéÂ§á‰ªΩÊÅ¢Â§çÊï∞ÊçÆ');
                    }
                } catch (backupError) {
                    console.error('‚ùå Â§á‰ªΩÊÅ¢Â§ç‰πüÂ§±Ë¥•:', backupError);
                }

                // ÊúÄÂêéÂ∞ùËØï‰øùÂ≠òÂΩìÂâçÊï∞ÊçÆ
                if (saveDataToLocalStorage()) {
                    console.log('‚úÖ Â∑≤ÈáçÊñ∞‰øùÂ≠òÊï∞ÊçÆÂà∞localStorage');
                } else {
                    console.error('‚ùå ÈáçÊñ∞‰øùÂ≠òÂ§±Ë¥•');
                }
            }

            // üîí ÊúÄÁªà‰øùÈöúÔºöÁ°Æ‰øùÊâÄÊúâÊ®°ÂùóÈÉΩÊúâÊï∞ÊçÆÔºàÂ¶ÇÊûú‰∏∫Á©∫ÔºåÂº∫Âà∂‰ΩøÁî®ÂÜÖÁΩÆÊï∞ÊçÆÔºâ
            let finalFix = false;
            console.log('üîç ÊúÄÁªàÊ£ÄÊü•Êï∞ÊçÆÁä∂ÊÄÅ:', {
                vocab: data.vocab?.length || 0,
                reading: data.readingSets?.length || 0,
                collocation: data.collocationSets?.length || 0,
                cloze: data.clozeSets?.length || 0,
                windowPetContent: window.petContent ? 'Â≠òÂú®' : '‰∏çÂ≠òÂú®'
            });

            if ((!data.vocab || data.vocab.length === 0) && window.petContent && window.petContent.vocab) {
                console.warn('üîß ÊúÄÁªà‰øÆÂ§çÔºöÂçïËØçÊï∞ÊçÆ‰∏∫Á©∫ÔºåÂº∫Âà∂‰ΩøÁî®ÂÜÖÁΩÆÊï∞ÊçÆ');
                data.vocab = window.petContent.vocab;
                finalFix = true;
            }
            if ((!data.readingSets || data.readingSets.length === 0) && window.petContent && window.petContent.readingSets) {
                console.warn('üîß ÊúÄÁªà‰øÆÂ§çÔºöÈòÖËØªÊï∞ÊçÆ‰∏∫Á©∫ÔºåÂº∫Âà∂‰ΩøÁî®ÂÜÖÁΩÆÊï∞ÊçÆ');
                data.readingSets = window.petContent.readingSets;
                finalFix = true;
            }
            if ((!data.collocationSets || data.collocationSets.length === 0) && window.petContent && window.petContent.collocationSets) {
                console.warn('üîß ÊúÄÁªà‰øÆÂ§çÔºöÂõ∫ÂÆöÊê≠ÈÖçÊï∞ÊçÆ‰∏∫Á©∫ÔºåÂº∫Âà∂‰ΩøÁî®ÂÜÖÁΩÆÊï∞ÊçÆ');
                data.collocationSets = window.petContent.collocationSets;
                finalFix = true;
            }
            if ((!data.clozeSets || data.clozeSets.length === 0) && window.petContent && window.petContent.clozeSets) {
                console.warn('üîß ÊúÄÁªà‰øÆÂ§çÔºöÂÆåÂΩ¢Â°´Á©∫Êï∞ÊçÆ‰∏∫Á©∫ÔºåÂº∫Âà∂‰ΩøÁî®ÂÜÖÁΩÆÊï∞ÊçÆ');
                data.clozeSets = window.petContent.clozeSets;
                finalFix = true;
            }

            if (finalFix) {
                console.log('‚úÖ ÊúÄÁªà‰øÆÂ§çÂÆåÊàêÔºåÂ∑≤‰ΩøÁî®ÂÜÖÁΩÆÊï∞ÊçÆ');
                saveDataToLocalStorage();
                // ‰øÆÂ§çÂêéÁ´ãÂç≥Êõ¥Êñ∞ÁªüËÆ°
                updateBankStatistics();
            }

            // ÊúÄÁªàÈ™åËØÅÔºöÁ°Æ‰øùÊï∞ÊçÆ‰∏ç‰∏∫Á©∫
            console.log('üìä ÊúÄÁªàÊï∞ÊçÆÈ™åËØÅ:', {
                ÂçïËØç: data.vocab?.length || 0,
                ÈòÖËØª: data.readingSets?.length || 0,
                Âõ∫ÂÆöÊê≠ÈÖç: data.collocationSets?.length || 0,
                ÂÆåÂΩ¢Â°´Á©∫: data.clozeSets?.length || 0
            });

            // üîÑ ÂéªÈáçÂäüËÉΩÔºöÂà†Èô§ÈáçÂ§çÁöÑÂçïËØç
            if (data.vocab && data.vocab.length > 0) {
                const originalCount = data.vocab.length;
                const uniqueWords = new Map();

                // ‰ΩøÁî®MapÂéªÈáçÔºå‰øùÁïôÁ¨¨‰∏ÄÊ¨°Âá∫Áé∞ÁöÑÂçïËØç
                data.vocab.forEach(item => {
                    if (item.word && !uniqueWords.has(item.word.toLowerCase())) {
                        uniqueWords.set(item.word.toLowerCase(), item);
                    }
                });

                data.vocab = Array.from(uniqueWords.values());
                const newCount = data.vocab.length;
                const removed = originalCount - newCount;

                if (removed > 0) {
                    console.log(`üîÑ ÂçïËØçÂéªÈáçÂÆåÊàêÔºöÂà†Èô§‰∫Ü ${removed} ‰∏™ÈáçÂ§çÂçïËØç`);
                    console.log(`   ÂéüÊï∞ÈáèÔºö${originalCount} ‚Üí Êñ∞Êï∞ÈáèÔºö${newCount}`);

                    // ‰øùÂ≠òÂéªÈáçÂêéÁöÑÊï∞ÊçÆ
                    if (saveDataToLocalStorage()) {
                        console.log('‚úÖ ÂéªÈáçÂêéÁöÑÊï∞ÊçÆÂ∑≤‰øùÂ≠ò');
                    } else {
                        console.error('‚ùå ÂéªÈáçÂêé‰øùÂ≠òÂ§±Ë¥•');
                    }
                }
            }

            // üîÑ ÈòÖËØªÁêÜËß£Êô∫ËÉΩÂéªÈáçÔºàÂü∫‰∫éidÂíåÂÜÖÂÆπÔºâ
            if (data.readingSets && data.readingSets.length > 0) {
                const originalCount = data.readingSets.length;
                const uniqueItems = new Map();
                const contentHashSet = new Set();
                let duplicateCount = 0;
                let contentDuplicateCount = 0;
                let itemsWithoutId = 0;

                data.readingSets.forEach((item, index) => {
                    // ÊèêÂèñÂÜÖÂÆπÁî®‰∫éÂéªÈáçÂà§Êñ≠Ôºà‰ºòÂÖà‰ΩøÁî® content Êàñ text Â≠óÊÆµÔºâ
                    let contentText = '';
                    if (item.content) {
                        contentText = typeof item.content === 'string' ? item.content : JSON.stringify(item.content);
                    } else if (item.text) {
                        contentText = typeof item.text === 'string' ? item.text : JSON.stringify(item.text);
                    } else if (item.article) {
                        contentText = typeof item.article === 'string' ? item.article : JSON.stringify(item.article);
                    }

                    // ÁîüÊàêÂÜÖÂÆπÂìàÂ∏åÔºàÂâç500Â≠óÁ¨¶ÔºåÂéªÈô§Á©∫Ê†ºÂíåÊ†áÁÇπÔºåËΩ¨Â∞èÂÜôÔºâ
                    const contentHash = contentText
                        .substring(0, 500)
                        .replace(/\s+/g, '')
                        .replace(/[.,!?;:'"()]/g, '')
                        .toLowerCase();

                    let shouldAdd = false;
                    let duplicateReason = '';
                    let isDuplicate = false;

                    if (item.id) {
                        // ÊúâidÁöÑÔºå‰ºòÂÖàÂü∫‰∫éidÂéªÈáç
                        if (uniqueItems.has(item.id)) {
                            duplicateCount++;
                            duplicateReason = `idÈáçÂ§ç: ${item.id}`;
                            isDuplicate = true;
                        } else if (contentHashSet.has(contentHash)) {
                            // Ê£ÄÊü•ÂÜÖÂÆπÊòØÂê¶ÈáçÂ§çÔºà‰ΩøÁî®Áõ∏‰ººÂ∫¶ÁÆóÊ≥ïËøõ‰∏ÄÊ≠•È™åËØÅÔºâ
                            isDuplicate = Array.from(uniqueItems.values()).some(existingItem => {
                                const existingText = existingItem.content || existingItem.text || existingItem.article || '';
                                if (!existingText) return false;
                                try {
                                    const existingTextStr = typeof existingText === 'string'
                                        ? existingText
                                        : JSON.stringify(existingText);
                                    const existingHash = existingTextStr.substring(0, 500).replace(/\s+/g, '').replace(/[.,!?;:'"()]/g, '').toLowerCase();

                                    // Â¶ÇÊûúÂìàÂ∏åÁõ∏ÂêåÔºåËÆ°ÁÆóÁõ∏‰ººÂ∫¶
                                    if (existingHash === contentHash) {
                                        const similarity = calculateTextSimilarity(contentText, existingTextStr);
                                        return similarity > 0.85; // Áõ∏‰ººÂ∫¶Ë∂ÖËøá85%ËÆ§‰∏∫ÊòØÈáçÂ§ç
                                    }
                                } catch (e) {
                                    return false;
                                }
                                return false;
                            });

                            if (isDuplicate) {
                                duplicateCount++;
                                contentDuplicateCount++;
                                duplicateReason = `ÂÜÖÂÆπÈáçÂ§çÔºàid: ${item.id}Ôºâ`;
                            }
                        }

                        if (!isDuplicate) {
                            uniqueItems.set(item.id, item);
                            contentHashSet.add(contentHash);
                            shouldAdd = true;
                        }
                    } else {
                        // Ê≤°ÊúâidÁöÑÔºåÂü∫‰∫éÂÜÖÂÆπÂéªÈáç
                        if (contentHashSet.has(contentHash)) {
                            // Ëøõ‰∏ÄÊ≠•Ê£ÄÊü•Áõ∏‰ººÂ∫¶
                            isDuplicate = Array.from(uniqueItems.values()).some(existingItem => {
                                const existingText = existingItem.content || existingItem.text || existingItem.article || '';
                                if (!existingText) return false;
                                try {
                                    const existingTextStr = typeof existingText === 'string'
                                        ? existingText
                                        : JSON.stringify(existingText);
                                    const existingHash = existingTextStr.substring(0, 500).replace(/\s+/g, '').replace(/[.,!?;:'"()]/g, '').toLowerCase();

                                    if (existingHash === contentHash) {
                                        const similarity = calculateTextSimilarity(contentText, existingTextStr);
                                        return similarity > 0.85;
                                    }
                                } catch (e) {
                                    return false;
                                }
                                return false;
                            });

                            if (isDuplicate) {
                                contentDuplicateCount++;
                                duplicateReason = `ÂÜÖÂÆπÈáçÂ§çÔºàÊó†idÔºåÁ¥¢Âºï: ${index}Ôºâ`;
                            }
                        }

                        if (!isDuplicate) {
                            // ‰∏∫Ê≤°ÊúâidÁöÑÈ¢òÁõÆÁîüÊàêÂîØ‰∏Äid
                            const generatedId = `reading_${Date.now()}_${index}_${Math.random().toString(36).substr(2, 9)}`;
                            item.id = generatedId;
                            uniqueItems.set(generatedId, item);
                            contentHashSet.add(contentHash);
                            itemsWithoutId++;
                            shouldAdd = true;
                        }
                    }

                    if (duplicateReason) {
                        console.log(`‚ö†Ô∏è ÂèëÁé∞ÈáçÂ§çÁöÑÈòÖËØªÁêÜËß£È¢òÁõÆ: ${duplicateReason}`);
                    }
                });

                // ËæÖÂä©ÂáΩÊï∞ÔºöËÆ°ÁÆóÊñáÊú¨Áõ∏‰ººÂ∫¶Ôºà‰ΩøÁî®ÁºñËæëË∑ùÁ¶ªÔºâ
                function calculateTextSimilarity(str1, str2) {
                    const longer = str1.length > str2.length ? str1 : str2;
                    const shorter = str1.length > str2.length ? str2 : str1;
                    if (longer.length === 0) return 1.0;
                    const distance = levenshteinDistance(longer, shorter);
                    return (longer.length - distance) / longer.length;
                }

                // ËæÖÂä©ÂáΩÊï∞ÔºöËÆ°ÁÆóÁºñËæëË∑ùÁ¶ª
                function levenshteinDistance(str1, str2) {
                    const matrix = [];
                    for (let i = 0; i <= str2.length; i++) {
                        matrix[i] = [i];
                    }
                    for (let j = 0; j <= str1.length; j++) {
                        matrix[0][j] = j;
                    }
                    for (let i = 1; i <= str2.length; i++) {
                        for (let j = 1; j <= str1.length; j++) {
                            if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                                matrix[i][j] = matrix[i - 1][j - 1];
                            } else {
                                matrix[i][j] = Math.min(
                                    matrix[i - 1][j - 1] + 1,
                                    matrix[i][j - 1] + 1,
                                    matrix[i - 1][j] + 1
                                );
                            }
                        }
                    }
                    return matrix[str2.length][str1.length];
                }

                data.readingSets = Array.from(uniqueItems.values());
                const removed = originalCount - data.readingSets.length;

                if (removed > 0) {
                    console.log(`üîÑ ÈòÖËØªÁêÜËß£ÂéªÈáçÂÆåÊàêÔºöÂà†Èô§‰∫Ü ${removed} ‰∏™ÈáçÂ§çÈ°π`);
                    console.log(`   ÂéüÊï∞ÈáèÔºö${originalCount} ‚Üí Êñ∞Êï∞ÈáèÔºö${data.readingSets.length}`);
                    console.log(`   - idÈáçÂ§ç: ${duplicateCount} ‰∏™`);
                    console.log(`   - ÂÜÖÂÆπÈáçÂ§ç: ${contentDuplicateCount} ‰∏™`);
                    console.log(`   - Êó†idÈ¢òÁõÆÔºàÂ∑≤ÁîüÊàêidÔºâ: ${itemsWithoutId} ‰∏™`);

                    // ÂéªÈáçÂêéÁ´ãÂç≥Êõ¥Êñ∞ÁªüËÆ°
                    updateBankStatistics();

                    // ÂéªÈáçÂêéÁ´ãÂç≥‰øùÂ≠òÔºåÁ°Æ‰øùÊï∞ÊçÆ‰∏ç‰∏¢Â§±
                    saveDataToLocalStorage();
                }
            }

            // üîÑ ÂÖ∂‰ªñÊ®°ÂùóÂéªÈáçÔºàÂü∫‰∫éidÔºâ
            let totalRemoved = 0;

            if (data.collocationSets && data.collocationSets.length > 0) {
                const originalCount = data.collocationSets.length;
                const uniqueItems = new Map();
                data.collocationSets.forEach(item => {
                    if (item.id && !uniqueItems.has(item.id)) {
                        uniqueItems.set(item.id, item);
                    }
                });
                data.collocationSets = Array.from(uniqueItems.values());
                totalRemoved += originalCount - data.collocationSets.length;
            }

            if (data.collocationSets && data.collocationSets.length > 0) {
                const originalCount = data.collocationSets.length;
                const uniqueItems = new Map();
                data.collocationSets.forEach(item => {
                    if (item.id && !uniqueItems.has(item.id)) {
                        uniqueItems.set(item.id, item);
                    }
                });
                data.collocationSets = Array.from(uniqueItems.values());
                totalRemoved += originalCount - data.collocationSets.length;
            }

            // ‰ºòÂåñÂÆåÂΩ¢Â°´Á©∫ÈöæÂ∫¶ÂàÜÈÖçÂáΩÊï∞ÔºàÊèêÂâçÂÆö‰πâÔºå‰æõÂéªÈáçÂêéË∞ÉÁî®Ôºâ
            function optimizeClozeDifficulty() {
                if (!data.clozeSets || data.clozeSets.length === 0) return;

                console.log('üîç ÂºÄÂßã‰ºòÂåñÂÆåÂΩ¢Â°´Á©∫ÈöæÂ∫¶ÂàÜÈÖç...');

                // ÂÖàÊåâÈöæÂ∫¶ÂàÜÁªÑÁªüËÆ°
                const difficultyGroups = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 };
                data.clozeSets.forEach(item => {
                    const diff = item.difficulty || 0;
                    if (diff >= 1 && diff <= 5) {
                        difficultyGroups[diff]++;
                    }
                });

                // ‰∏∫Ê≤°ÊúâÈöæÂ∫¶ÁöÑÈ¢òÁõÆËØÑ‰º∞Âπ∂ÂàÜÈÖçÈöæÂ∫¶
                const itemsWithoutDifficulty = data.clozeSets.filter(item => !item.difficulty || item.difficulty < 1 || item.difficulty > 5);

                itemsWithoutDifficulty.forEach((item, index) => {
                    // Ê†πÊçÆÊñáÊú¨ÁâπÂæÅËØÑ‰º∞ÈöæÂ∫¶
                    let textContent = '';
                    let blanks = 0;

                    if (typeof item.text === 'string') {
                        try {
                            const parsed = JSON.parse(item.text);
                            if (Array.isArray(parsed)) {
                                parsed.forEach(piece => {
                                    if (typeof piece === 'string') {
                                        textContent += piece + ' ';
                                    } else if (piece && typeof piece === 'object') {
                                        blanks++;
                                        if (piece.options && piece.options.length > 0) {
                                            textContent += piece.options[0] + ' ';
                                        }
                                    }
                                });
                            } else {
                                textContent = item.text;
                            }
                        } catch (e) {
                            textContent = item.text;
                        }
                    } else if (Array.isArray(item.text)) {
                        item.text.forEach(piece => {
                            if (typeof piece === 'string') {
                                textContent += piece + ' ';
                            } else if (piece && typeof piece === 'object') {
                                blanks++;
                                if (piece.options && piece.options.length > 0) {
                                    textContent += piece.options[0] + ' ';
                                }
                            }
                        });
                    } else {
                        textContent = String(item.text || '');
                    }

                    const wordCount = textContent.split(/\s+/).filter(w => w && !w.match(/^___+$/)).length;
                    let difficultyScore = 1;

                    // Âõ†Á¥†1ÔºöÊñáÊú¨ÈïøÂ∫¶
                    if (wordCount < 80) {
                        difficultyScore += 0.3;
                    } else if (wordCount < 120) {
                        difficultyScore += 0.6;
                    } else if (wordCount < 180) {
                        difficultyScore += 1.2;
                    } else {
                        difficultyScore += 1.8;
                    }

                    // Âõ†Á¥†2ÔºöÁ©∫ÁôΩÊï∞Èáè
                    if (blanks <= 4) {
                        difficultyScore += 0.2;
                    } else if (blanks <= 6) {
                        difficultyScore += 0.5;
                    } else if (blanks <= 8) {
                        difficultyScore += 1.0;
                    } else {
                        difficultyScore += 1.5;
                    }

                    // Âõ†Á¥†3ÔºöÁ©∫ÁôΩÂØÜÂ∫¶
                    const blankDensity = blanks / Math.max(wordCount, 1);
                    if (blankDensity < 0.05) {
                        difficultyScore += 0.2;
                    } else if (blankDensity < 0.08) {
                        difficultyScore += 0.5;
                    } else if (blankDensity < 0.12) {
                        difficultyScore += 1.0;
                    } else {
                        difficultyScore += 1.5;
                    }

                    // Âõ†Á¥†4ÔºöËØ≠Ê≥ïÂ§çÊùÇÂ∫¶
                    const complexPatterns = [
                        /\b(which|that|who|whom|whose|where|when|why)\b/gi,
                        /\b(if|unless|although|though|while|as|since|because)\b/gi,
                        /\b(be|been|being)\s+\w+ed\b/gi,
                        /\b(to|ing)\s+\w+/gi,
                        /\b(have|has|had)\s+\w+ed\b/gi,
                        /\b(would|could|should|might|may)\s+\w+/gi
                    ];

                    let complexCount = 0;
                    complexPatterns.forEach(pattern => {
                        const matches = textContent.match(pattern);
                        if (matches) complexCount += matches.length;
                    });

                    const complexityRatio = complexCount / Math.max(wordCount, 1);
                    if (complexityRatio < 0.1) {
                        difficultyScore += 0.2;
                    } else if (complexityRatio < 0.2) {
                        difficultyScore += 0.6;
                    } else {
                        difficultyScore += 1.2;
                    }

                    let assignedLevel = Math.min(5, Math.max(1, Math.round(difficultyScore)));
                    const itemsPerLevel = Math.ceil(data.clozeSets.length / 5);
                    let attempts = 0;
                    while (difficultyGroups[assignedLevel] >= itemsPerLevel && attempts < 5) {
                        if (attempts % 2 === 0) {
                            assignedLevel = Math.min(5, assignedLevel + 1);
                        } else {
                            assignedLevel = Math.max(1, assignedLevel - 1);
                        }
                        attempts++;
                    }

                    item.difficulty = assignedLevel;
                    difficultyGroups[assignedLevel]++;
                });

                // ÊåâÈöæÂ∫¶ÊéíÂ∫è
                data.clozeSets.sort((a, b) => {
                    const diffA = a.difficulty || 1;
                    const diffB = b.difficulty || 1;
                    if (diffA !== diffB) {
                        return diffA - diffB;
                    }
                    return 0;
                });

                // ÈáçÊñ∞Âπ≥Ë°°ÈöæÂ∫¶ÂàÜÂ∏É
                const totalItems = data.clozeSets.length;
                if (totalItems > 0) {
                    const itemsPerLevel = Math.ceil(totalItems / 5);
                    const newDifficultyGroups = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 };

                    data.clozeSets.forEach((item, index) => {
                        if (!item.difficulty || item.difficulty < 1 || item.difficulty > 5) {
                            const targetLevel = Math.min(5, Math.max(1, Math.ceil((index + 1) / itemsPerLevel)));
                            let assignedLevel = targetLevel;
                            let attempts = 0;
                            while (newDifficultyGroups[assignedLevel] >= itemsPerLevel && attempts < 5) {
                                assignedLevel = (assignedLevel % 5) + 1;
                                attempts++;
                            }
                            item.difficulty = assignedLevel;
                            newDifficultyGroups[assignedLevel]++;
                        } else {
                            newDifficultyGroups[item.difficulty]++;
                        }
                    });

                    const maxCount = Math.max(...Object.values(newDifficultyGroups));
                    const minCount = Math.min(...Object.values(newDifficultyGroups));
                    if (maxCount - minCount > itemsPerLevel * 0.3) {
                        console.log('üîÑ ÈöæÂ∫¶ÂàÜÂ∏É‰∏çÂùáÂåÄÔºåÈáçÊñ∞Âπ≥Ë°°...');
                        data.clozeSets.forEach((item, index) => {
                            const targetLevel = Math.min(5, Math.max(1, Math.ceil((index + 1) / itemsPerLevel)));
                            item.difficulty = targetLevel;
                        });

                        const balancedGroups = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 };
                        data.clozeSets.forEach(item => {
                            balancedGroups[item.difficulty || 1]++;
                        });
                        console.log('‚úÖ ÈöæÂ∫¶Â∑≤ÈáçÊñ∞Âπ≥Ë°°:', balancedGroups);
                    } else {
                        console.log('‚úÖ ÈöæÂ∫¶ÂàÜÂ∏ÉÂùáÂåÄ:', newDifficultyGroups);
                    }
                }

                const finalGroups = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 };
                data.clozeSets.forEach(item => {
                    const diff = item.difficulty || 1;
                    if (diff >= 1 && diff <= 5) {
                        finalGroups[diff]++;
                    }
                });

                console.log('‚úÖ ÂÆåÂΩ¢Â°´Á©∫ÈöæÂ∫¶‰ºòÂåñÂÆåÊàêÔºåÊúÄÁªàÂàÜÂ∏É:', finalGroups);
                saveDataToLocalStorage();
                updateBankStatistics();
            }

            if (data.clozeSets && data.clozeSets.length > 0) {
                const originalCount = data.clozeSets.length;
                const uniqueItems = new Map();
                const contentHashSet = new Set(); // Áî®‰∫éÂü∫‰∫éÂÜÖÂÆπÂéªÈáç
                let itemsWithoutId = 0;
                let duplicateCount = 0;
                let contentDuplicateCount = 0;

                // ÊîπËøõÁöÑÂéªÈáçÈÄªËæëÔºö‰ΩøÁî®Êõ¥ÂÆåÊï¥ÁöÑÂìàÂ∏åÂíåÁõ∏‰ººÂ∫¶Ê£ÄÊü•
                data.clozeSets.forEach((item, index) => {
                    // ÁîüÊàêÂÆåÊï¥ÁöÑÂÜÖÂÆπÂìàÂ∏åÔºàÂü∫‰∫étextÂ≠óÊÆµÁöÑÂÆåÊï¥ÂÜÖÂÆπÔºâ
                    let contentHash = '';
                    let fullTextStr = '';

                    if (item.text) {
                        try {
                            fullTextStr = typeof item.text === 'string' ? item.text : JSON.stringify(item.text);
                            // ‰ΩøÁî®Êõ¥ÈïøÁöÑÂìàÂ∏åÔºàÂâç300Â≠óÁ¨¶ÔºâÔºåÂéªÈô§Á©∫ÁôΩÂíåÂ§ßÂ∞èÂÜô
                            contentHash = fullTextStr.substring(0, 300).replace(/\s+/g, '').toLowerCase();
                        } catch (e) {
                            contentHash = `item-${index}`;
                            fullTextStr = String(item.text || '');
                        }
                    } else {
                        contentHash = `no-text-${index}`;
                    }

                    let shouldAdd = false;
                    let duplicateReason = '';
                    let isDuplicate = false;

                    if (item.id) {
                        // ÊúâidÁöÑÔºå‰ºòÂÖàÂü∫‰∫éidÂéªÈáç
                        if (uniqueItems.has(item.id)) {
                            duplicateCount++;
                            duplicateReason = `idÈáçÂ§ç: ${item.id}`;
                            isDuplicate = true;
                        } else if (contentHashSet.has(contentHash)) {
                            // Ê£ÄÊü•ÂÜÖÂÆπÊòØÂê¶ÈáçÂ§çÔºà‰ΩøÁî®Áõ∏‰ººÂ∫¶ÁÆóÊ≥ïËøõ‰∏ÄÊ≠•È™åËØÅÔºâ
                            isDuplicate = Array.from(uniqueItems.values()).some(existingItem => {
                                if (!existingItem.text) return false;
                                try {
                                    const existingTextStr = typeof existingItem.text === 'string'
                                        ? existingItem.text
                                        : JSON.stringify(existingItem.text);
                                    const existingHash = existingTextStr.substring(0, 300).replace(/\s+/g, '').toLowerCase();

                                    // Â¶ÇÊûúÂìàÂ∏åÁõ∏ÂêåÔºåËÆ°ÁÆóÁõ∏‰ººÂ∫¶
                                    if (existingHash === contentHash) {
                                        const similarity = calculateTextSimilarity(fullTextStr, existingTextStr);
                                        return similarity > 0.85; // Áõ∏‰ººÂ∫¶Ë∂ÖËøá85%ËÆ§‰∏∫ÊòØÈáçÂ§ç
                                    }
                                } catch (e) {
                                    return false;
                                }
                                return false;
                            });

                            if (isDuplicate) {
                                duplicateCount++;
                                contentDuplicateCount++;
                                duplicateReason = `ÂÜÖÂÆπÈáçÂ§çÔºàid: ${item.id}Ôºâ`;
                            }
                        }

                        if (!isDuplicate) {
                            uniqueItems.set(item.id, item);
                            contentHashSet.add(contentHash);
                            shouldAdd = true;
                        }
                    } else {
                        // Ê≤°ÊúâidÁöÑÔºåÂü∫‰∫éÂÜÖÂÆπÂéªÈáç
                        if (contentHashSet.has(contentHash)) {
                            // Ëøõ‰∏ÄÊ≠•Ê£ÄÊü•Áõ∏‰ººÂ∫¶
                            isDuplicate = Array.from(uniqueItems.values()).some(existingItem => {
                                if (!existingItem.text) return false;
                                try {
                                    const existingTextStr = typeof existingItem.text === 'string'
                                        ? existingItem.text
                                        : JSON.stringify(existingItem.text);
                                    const existingHash = existingTextStr.substring(0, 300).replace(/\s+/g, '').toLowerCase();

                                    if (existingHash === contentHash) {
                                        const similarity = calculateTextSimilarity(fullTextStr, existingTextStr);
                                        return similarity > 0.85;
                                    }
                                } catch (e) {
                                    return false;
                                }
                                return false;
                            });

                            if (isDuplicate) {
                                contentDuplicateCount++;
                                duplicateReason = `ÂÜÖÂÆπÈáçÂ§çÔºàÊó†idÔºåÁ¥¢Âºï: ${index}Ôºâ`;
                            }
                        }

                        if (!isDuplicate) {
                            // ‰∏∫Ê≤°ÊúâidÁöÑÈ¢òÁõÆÁîüÊàêÂîØ‰∏Äid
                            const generatedId = `cloze_${Date.now()}_${index}_${Math.random().toString(36).substr(2, 9)}`;
                            item.id = generatedId;
                            uniqueItems.set(generatedId, item);
                            contentHashSet.add(contentHash);
                            itemsWithoutId++;
                            shouldAdd = true;
                        }
                    }

                    if (duplicateReason) {
                        console.log(`‚ö†Ô∏è ÂèëÁé∞ÈáçÂ§çÁöÑÂÆåÂΩ¢Â°´Á©∫È¢òÁõÆ: ${duplicateReason}`);
                    }
                });

                // ËæÖÂä©ÂáΩÊï∞ÔºöËÆ°ÁÆóÊñáÊú¨Áõ∏‰ººÂ∫¶Ôºà‰ΩøÁî®ÁºñËæëË∑ùÁ¶ªÔºâ
                function calculateTextSimilarity(str1, str2) {
                    const longer = str1.length > str2.length ? str1 : str2;
                    const shorter = str1.length > str2.length ? str2 : str1;
                    if (longer.length === 0) return 1.0;
                    const distance = levenshteinDistance(longer, shorter);
                    return (longer.length - distance) / longer.length;
                }

                // ËæÖÂä©ÂáΩÊï∞ÔºöËÆ°ÁÆóÁºñËæëË∑ùÁ¶ª
                function levenshteinDistance(str1, str2) {
                    const matrix = [];
                    for (let i = 0; i <= str2.length; i++) {
                        matrix[i] = [i];
                    }
                    for (let j = 0; j <= str1.length; j++) {
                        matrix[0][j] = j;
                    }
                    for (let i = 1; i <= str2.length; i++) {
                        for (let j = 1; j <= str1.length; j++) {
                            if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                                matrix[i][j] = matrix[i - 1][j - 1];
                            } else {
                                matrix[i][j] = Math.min(
                                    matrix[i - 1][j - 1] + 1,
                                    matrix[i][j - 1] + 1,
                                    matrix[i - 1][j] + 1
                                );
                            }
                        }
                    }
                    return matrix[str2.length][str1.length];
                }

                data.clozeSets = Array.from(uniqueItems.values());
                const removed = originalCount - data.clozeSets.length;
                totalRemoved += removed;

                if (removed > 0) {
                    console.log(`üîÑ ÂÆåÂΩ¢Â°´Á©∫ÂéªÈáçÂÆåÊàêÔºöÂà†Èô§‰∫Ü ${removed} ‰∏™ÈáçÂ§çÈ°π`);
                    console.log(`   ÂéüÊï∞ÈáèÔºö${originalCount} ‚Üí Êñ∞Êï∞ÈáèÔºö${data.clozeSets.length}`);
                    console.log(`   - idÈáçÂ§ç: ${duplicateCount} ‰∏™`);
                    console.log(`   - ÂÜÖÂÆπÈáçÂ§ç: ${contentDuplicateCount} ‰∏™`);
                    console.log(`   - Êó†idÈ¢òÁõÆÔºàÂ∑≤ÁîüÊàêidÔºâ: ${itemsWithoutId} ‰∏™`);
                }

                // ÂéªÈáçÂêéÁ´ãÂç≥ËøõË°åÈöæÂ∫¶ËØÑ‰º∞Âíå‰ºòÂåñ
                if (data.clozeSets.length > 0) {
                    console.log('üìä ÂºÄÂßãÈáçÊñ∞ËØÑ‰º∞ÂÆåÂΩ¢Â°´Á©∫ÈöæÂ∫¶...');
                    optimizeClozeDifficulty();
                }

                // ÂéªÈáçÂêéÁ´ãÂç≥Êõ¥Êñ∞ÁªüËÆ°
                updateBankStatistics();

                // ÂéªÈáçÂêéÁ´ãÂç≥‰øùÂ≠òÔºåÁ°Æ‰øùÊï∞ÊçÆ‰∏ç‰∏¢Â§±
                if (removed > 0) {
                    saveDataToLocalStorage();
                }
            }

            if (totalRemoved > 0) {
                console.log(`üîÑ ÂÖ∂‰ªñÊ®°ÂùóÂéªÈáçÔºöÂà†Èô§‰∫Ü ${totalRemoved} ‰∏™ÈáçÂ§çÈ°π`);

                // ‰øùÂ≠òÂéªÈáçÂêéÁöÑÂÆåÊï¥Êï∞ÊçÆ
                if (saveDataToLocalStorage()) {
                    console.log('‚úÖ ÂÆåÊï¥ÂéªÈáçÊï∞ÊçÆÂ∑≤‰øùÂ≠ò');
                    console.log('üìä ‰øùÂ≠òÁªüËÆ°:', {
                        ÂçïËØç: data.vocab?.length || 0,
                        ÈòÖËØª: data.readingSets?.length || 0,
                        Âõ∫ÂÆöÊê≠ÈÖç: data.collocationSets?.length || 0,
                        ÂÆåÂΩ¢: data.clozeSets?.length || 0
                    });

                    // ÂÜçÊ¨°Êõ¥Êñ∞ÁªüËÆ°ÔºåÁ°Æ‰øùÊòæÁ§∫Ê≠£Á°Æ
                    updateBankStatistics();
                } else {
                    console.error('‚ùå ÂÆåÊï¥ÂéªÈáçÊï∞ÊçÆ‰øùÂ≠òÂ§±Ë¥•');
                }
            }

            // üìÖ Âä†ËΩΩÊâìÂç°ËÆ∞ÂΩï
            loadCheckinRecords();

            // üìö Âä†ËΩΩÁîüËØçÊú¨ÔºàÁã¨Á´ã‰∫éÂçïËØçËÉåËØµÊ®°ÂùóÔºâ
            loadWordbook();

            // üîç Âä†ËΩΩËØçÂÖ∏ÁºìÂ≠ò
            loadDictCache();

            // ‚öôÔ∏è Âä†ËΩΩMCPËØçÂÖ∏ÈÖçÁΩÆ
            loadMcpConfig();

            // ËÆ°ÁÆóÊÄªÊòüÊòüÊï∞Ôºà‰ªéÊâìÂç°ËÆ∞ÂΩï‰∏≠Á¥ØËÆ°Ôºâ
            if (checkinRecords.length > 0) {
                stars = checkinRecords.reduce((sum, r) => sum + r.stars, 0);
                points = stars; // ÁßØÂàÜÁ≠â‰∫éÊòüÊòüÊï∞
            }

            // üîí Âº∫Âà∂Êï∞ÊçÆÊÅ¢Â§çÔºöÁ°Æ‰øùÊï∞ÊçÆÂÆåÊï¥ÊÄß
            const totalCount = (data.vocab?.length || 0) +
                (data.readingSets?.length || 0) +
                (data.collocationSets?.length || 0) +
                (data.clozeSets?.length || 0);

            // Ê£ÄÊü•localStorage‰∏≠ÊòØÂê¶Êúâ‰ªª‰ΩïÊï∞ÊçÆÔºàÂåÖÊã¨Á©∫Êï∞ÁªÑÔºâ
            const hasLocalStorageData = localStorage.getItem('petEnglishData') ||
                localStorage.getItem('petEnglishData_backup') ||
                localStorage.getItem('petEnglishData_old') ||
                localStorage.getItem('petData');

            // Âà§Êñ≠ÊòØÂê¶ÈúÄË¶ÅÊÅ¢Â§çÂÜÖÁΩÆÊï∞ÊçÆÁöÑÊù°‰ª∂
            const needsRecovery = totalCount === 0 ||
                (data.vocab && data.vocab.length === 0) ||
                (data.readingSets && data.readingSets.length === 0) ||
                (data.collocationSets && data.collocationSets.length === 0) ||
                (data.clozeSets && data.clozeSets.length === 0);

            // ÂÆö‰πâÂÜÖÁΩÆÊï∞ÊçÆÂä†ËΩΩÂáΩÊï∞
            const tryLoadBuiltInData = () => {
                if (window.petContent) {
                    console.log('üì¶ window.petContentÂÜÖÂÆπ:', {
                        ÂçïËØç: window.petContent.vocab?.length || 0,
                        ÈòÖËØª: window.petContent.readingSets?.length || 0,
                        Âõ∫ÂÆöÊê≠ÈÖç: window.petContent.collocationSets?.length || 0,
                        ÂÆåÂΩ¢: window.petContent.clozeSets?.length || 0
                    });

                    data.vocab = window.petContent.vocab || [];
                    data.readingSets = window.petContent.readingSets || [];
                    data.collocationSets = window.petContent.collocationSets || [];
                    data.clozeSets = window.petContent.clozeSets || [];

                    console.log('‚úÖ Â∑≤Âº∫Âà∂Âä†ËΩΩÂÜÖÁΩÆÊï∞ÊçÆ');
                    console.log('üìä Âä†ËΩΩÂêéÁªüËÆ°:', {
                        ÂçïËØç: data.vocab.length,
                        ÈòÖËØª: data.readingSets.length,
                        Âõ∫ÂÆöÊê≠ÈÖç: data.collocationSets.length,
                        ÂÆåÂΩ¢: data.clozeSets.length
                    });

                    // Á´ãÂç≥‰øùÂ≠ò
                    if (saveDataToLocalStorage()) {
                        console.log('‚úÖ ÂÜÖÁΩÆÊï∞ÊçÆÂ∑≤‰øùÂ≠òÂà∞localStorage');
                    } else {
                        console.error('‚ùå ‰øùÂ≠òÂÜÖÁΩÆÊï∞ÊçÆÂ§±Ë¥•');
                    }
                } else {
                    console.error('‚ùå window.petContent‰∏çÂ≠òÂú®ÔºÅÊó†Ê≥ïÊÅ¢Â§çÊï∞ÊçÆÔºÅ');
                    // Â∞ùËØïÈáçÊñ∞Âä†ËΩΩÂÜÖÁΩÆÊï∞ÊçÆËÑöÊú¨
                    const script = document.createElement('script');
                    script.src = 'pet-content.js';
                    script.onload = () => {
                        console.log('‚úÖ Â∑≤ÈáçÊñ∞Âä†ËΩΩpet-content.js');
                        setTimeout(tryLoadBuiltInData, 100);
                    };
                    script.onerror = () => {
                        console.error('‚ùå Êó†Ê≥ïÂä†ËΩΩpet-content.jsÊñá‰ª∂');
                    };
                    document.head.appendChild(script);
                }
            };

            // Âº∫Âà∂ÊÅ¢Â§çÂÜÖÁΩÆÊï∞ÊçÆÔºàÊó†ËÆ∫localStorageÊòØÂê¶ÊúâÊï∞ÊçÆÔºâ
            if (needsRecovery) {
                console.warn('üö® Ê£ÄÊµãÂà∞Êï∞ÊçÆÁº∫Â§±ÔºåËá™Âä®ÊÅ¢Â§çÂÜÖÁΩÆÊï∞ÊçÆÔºÅ');
                console.log('üìä ÂΩìÂâçÊï∞ÊçÆÁªüËÆ°:', {
                    ÂçïËØç: data.vocab?.length || 0,
                    ÈòÖËØª: data.readingSets?.length || 0,
                    Âõ∫ÂÆöÊê≠ÈÖç: data.collocationSets?.length || 0,
                    ÂÆåÂΩ¢: data.clozeSets?.length || 0
                });

                tryLoadBuiltInData();
            } else if (hasLocalStorageData) {
                // Â¶ÇÊûúÊúâlocalStorageÊï∞ÊçÆÔºåÂ∞ùËØïÂä†ËΩΩ
                console.log('üìÇ Ê£ÄÊµãÂà∞localStorageÊï∞ÊçÆÔºåÂ∞ùËØïÂä†ËΩΩ...');
                const savedData = localStorage.getItem('petEnglishData') ||
                    localStorage.getItem('petEnglishData_backup') ||
                    localStorage.getItem('petEnglishData_old') ||
                    localStorage.getItem('petData');
                if (savedData) {
                    try {
                        const parsed = JSON.parse(savedData);
                        // È™åËØÅÊï∞ÊçÆÂÆåÊï¥ÊÄß
                        const isValidData = parsed &&
                            (parsed.vocab?.length > 0 || parsed.readingSets?.length > 0 ||
                                parsed.collocationSets?.length > 0 || parsed.clozeSets?.length > 0);

                        if (isValidData) {
                            if (parsed.vocab !== undefined) data.vocab = Array.isArray(parsed.vocab) ? parsed.vocab : [];
                            if (parsed.readingSets !== undefined) data.readingSets = Array.isArray(parsed.readingSets) ? parsed.readingSets : [];
                            if (parsed.collocationSets !== undefined) data.collocationSets = Array.isArray(parsed.collocationSets) ? parsed.collocationSets : [];
                            if (parsed.clozeSets !== undefined) data.clozeSets = Array.isArray(parsed.clozeSets) ? parsed.clozeSets : [];
                            console.log('‚úÖ Â∑≤Âä†ËΩΩlocalStorageÊï∞ÊçÆ');
                        } else {
                            console.warn('‚ö†Ô∏è localStorageÊï∞ÊçÆ‰∏çÂÆåÊï¥Ôºå‰ΩøÁî®ÂÜÖÁΩÆÊï∞ÊçÆ');
                            // Ëß¶ÂèëÂÜÖÁΩÆÊï∞ÊçÆÊÅ¢Â§ç
                            tryLoadBuiltInData();
                        }
                    } catch (e) {
                        console.error('‚ùå Âä†ËΩΩlocalStorageÊï∞ÊçÆÂ§±Ë¥•:', e);
                        console.warn('‚ö†Ô∏è localStorageÊï∞ÊçÆÊçüÂùèÔºå‰ΩøÁî®ÂÜÖÁΩÆÊï∞ÊçÆ');
                        // Ëß¶ÂèëÂÜÖÁΩÆÊï∞ÊçÆÊÅ¢Â§ç
                        tryLoadBuiltInData();
                    }
                }
            }

            // Á°Æ‰øùdataÂØπË±°Â≠òÂú®‰∏îÂåÖÂê´ÊâÄÊúâÂøÖË¶ÅÂ≠óÊÆµ
            if (!data) data = {};
            if (!data.vocab) data.vocab = [];
            if (!data.readingSets) data.readingSets = [];
            if (!data.collocationSets) data.collocationSets = [];
            if (!data.clozeSets) data.clozeSets = [];

            // ‰∏∫ÈòÖËØªÁêÜËß£È¢òÁõÆÊ∑ªÂä†ÈöæÂ∫¶Á≠âÁ∫ßÔºàÂ¶ÇÊûúÊ≤°ÊúâÁöÑËØùÔºâÔºåÂπ∂ÊåâÈöæÂ∫¶ÊéíÂ∫è
            if (data.readingSets && data.readingSets.length > 0) {
                // ÂÖàÊåâÈöæÂ∫¶ÂàÜÁªÑÁªüËÆ°
                const difficultyGroups = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 };
                data.readingSets.forEach(item => {
                    const diff = item.difficulty || 0;
                    if (diff >= 1 && diff <= 5) {
                        difficultyGroups[diff]++;
                    }
                });

                // ‰∏∫Ê≤°ÊúâÈöæÂ∫¶ÁöÑÈ¢òÁõÆÂàÜÈÖçÈöæÂ∫¶ÔºàÂùáÂåÄÂàÜÂ∏ÉÔºâ
                const itemsWithoutDifficulty = data.readingSets.filter(item => !item.difficulty || item.difficulty < 1 || item.difficulty > 5);
                const totalItems = data.readingSets.length;
                const itemsPerLevel = Math.ceil(totalItems / 5);

                itemsWithoutDifficulty.forEach((item, index) => {
                    // ËÆ°ÁÆóÂ∫îËØ•ÂàÜÈÖçÁöÑÈöæÂ∫¶Á≠âÁ∫ßÔºà1-5ÔºåÂùáÂåÄÂàÜÂ∏ÉÔºâ
                    const targetLevel = Math.min(5, Math.max(1, Math.ceil((index + 1) / itemsPerLevel)));

                    // Ê£ÄÊü•ËØ•ÈöæÂ∫¶Á≠âÁ∫ßÁöÑÈ¢òÁõÆÊï∞ÈáèÔºåÂ¶ÇÊûúÂ§™Â§öÂ∞±ÂàÜÈÖçÂà∞‰∏ã‰∏Ä‰∏™Á≠âÁ∫ß
                    let assignedLevel = targetLevel;
                    let attempts = 0;
                    while (difficultyGroups[assignedLevel] >= itemsPerLevel && attempts < 5) {
                        assignedLevel = (assignedLevel % 5) + 1;
                        attempts++;
                    }

                    item.difficulty = assignedLevel;
                    difficultyGroups[assignedLevel]++;
                });

                // ÊåâÈöæÂ∫¶ÊéíÂ∫èÔºà‰ªéÁÆÄÂçïÂà∞ÈöæÔºâÔºåÁõ∏ÂêåÈöæÂ∫¶ÂÜÖ‰øùÊåÅÂéüÊúâÈ°∫Â∫è
                data.readingSets.sort((a, b) => {
                    const diffA = a.difficulty || 1;
                    const diffB = b.difficulty || 1;
                    if (diffA !== diffB) {
                        return diffA - diffB;
                    }
                    // Áõ∏ÂêåÈöæÂ∫¶‰øùÊåÅÂéüÊúâÈ°∫Â∫è
                    return 0;
                });

                // È™åËØÅÈöæÂ∫¶ÂàÜÈÖç
                const finalGroups = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 };
                data.readingSets.forEach(item => {
                    const diff = item.difficulty || 1;
                    if (diff >= 1 && diff <= 5) {
                        finalGroups[diff]++;
                    }
                });

                console.log('‚úÖ ÈòÖËØªÁêÜËß£È¢òÁõÆÂ∑≤ÊåâÈöæÂ∫¶ÊéíÂ∫èÂíåÂàÜÈÖç:', finalGroups);
            }

            // ‰∏∫ÂÆåÂΩ¢Â°´Á©∫È¢òÁõÆÊ∑ªÂä†ÈöæÂ∫¶Á≠âÁ∫ßÔºàÊ†πÊçÆPETÁúüÂÆûÈöæÂ∫¶Ê†áÂáÜÔºâ- Â∑≤Âú®ÂâçÈù¢ÂÆö‰πâoptimizeClozeDifficultyÂáΩÊï∞
            if (data.clozeSets && data.clozeSets.length > 0) {
                optimizeClozeDifficulty();
            }

            // ÂàùÂßãÂåñÂêÑÊ®°ÂùóÔºàÂ¶ÇÊûúÊúâÊï∞ÊçÆÔºâ
            if (data.vocab && data.vocab.length > 0) loadWord();
            if (data.readingSets && data.readingSets.length > 0) loadReading();
            if (data.collocationSets && data.collocationSets.length > 0) loadCollocation();
            if (data.clozeSets && data.clozeSets.length > 0) loadCloze();

            // üîÑ Á´ãÂç≥Êõ¥Êñ∞ÁªüËÆ°ÔºàÁ°Æ‰øùÊòæÁ§∫Ê≠£Á°ÆÔºâ
            updateBadges();
            updateWordCountBadge();
            updateBankStatistics();

            console.log('üéØ ÊúÄÁªàÊï∞ÊçÆÁªüËÆ°:', {
                ÂçïËØç: data.vocab?.length || 0,
                ÈòÖËØª: data.readingSets?.length || 0,
                Âõ∫ÂÆöÊê≠ÈÖç: data.collocationSets?.length || 0,
                ÂÆåÂΩ¢: data.clozeSets?.length || 0
            });

            // Âª∂ËøüÂêØÁî®ÊñáÊú¨Êü•ËØ¢ÔºåÁ°Æ‰øùDOMÂ∑≤Ê∏≤Êüì
            setTimeout(() => {
                enableTextQuery();

                // ÂÜçÊ¨°Âº∫Âà∂Ê£ÄÊü•ÁªüËÆ°ÊòæÁ§∫
                const statVocabCount = document.getElementById("statVocabCount");
                const statReadingCount = document.getElementById("statReadingCount");
                const statCollocationCount = document.getElementById("statCollocationCount");
                const statClozeCount = document.getElementById("statClozeCount");

                // Â¶ÇÊûúÊòæÁ§∫‰∏∫0‰ΩÜÊï∞ÊçÆ‰∏ç‰∏∫0ÔºåÂº∫Âà∂Êõ¥Êñ∞
                if (statVocabCount && statVocabCount.textContent === '0' && data.vocab && data.vocab.length > 0) {
                    console.warn('‚ö†Ô∏è Ê£ÄÊµãÂà∞ÊòæÁ§∫‰∏∫0‰ΩÜÊï∞ÊçÆ‰∏ç‰∏∫0ÔºåÂº∫Âà∂Êõ¥Êñ∞ÁªüËÆ°');
                    updateBankStatistics();
                }
                if (statReadingCount && statReadingCount.textContent === '0' && data.readingSets && data.readingSets.length > 0) {
                    updateBankStatistics();
                }
                if (statCollocationCount && statCollocationCount.textContent === '0' && data.collocationSets && data.collocationSets.length > 0) {
                    updateBankStatistics();
                }
                if (statClozeCount && statClozeCount.textContent === '0' && data.clozeSets && data.clozeSets.length > 0) {
                    updateBankStatistics();
                }
            }, 1000);

            // ÁªëÂÆöÈ¢òÂ∫ìÁªüËÆ°ÁÇπÂáª‰∫ã‰ª∂
            bindBankStatisticsClickEvents();
        }

        // ============ ËØçÂÖ∏Êü•ËØ¢‰∫ã‰ª∂ÁõëÂê¨Âô® ============

        // ÊêúÁ¥¢Ê°ÜËæìÂÖ•‰∫ã‰ª∂
        if (dictSearchInput) {
            dictSearchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const word = dictSearchInput.value.trim();
                    if (word) {
                        showDictModal(word);
                    }
                }
            });

            // ÊêúÁ¥¢ÂõæÊ†áÁÇπÂáª
            document.querySelector('.search-icon')?.addEventListener('click', () => {
                const word = dictSearchInput.value.trim();
                if (word) {
                    showDictModal(word);
                }
            });
        }

        // ‰ΩøÁî®ÂÖ®Â±Ä‰∫ã‰ª∂ÂßîÊâòÂ§ÑÁêÜÂÖ≥Èó≠ÊåâÈíÆÔºàÊúÄÂèØÈù†ÁöÑÊñπÊ≥ïÔºå‰∏ç‰ºöË¢´Ë¶ÜÁõñÔºâ
        document.addEventListener('click', function (e) {
            // Ê£ÄÊü•ÊòØÂê¶ÁÇπÂáª‰∫ÜÂÖ≥Èó≠ÊåâÈíÆÔºàÊîØÊåÅÂ§öÁßçÈÄâÊã©Âô®Ôºâ
            const isCloseButton = e.target && (
                e.target.id === 'dictModalClose' ||
                e.target.classList.contains('dict-modal-close') ||
                (e.target.closest && e.target.closest('#dictModalClose')) ||
                (e.target.closest && e.target.closest('.dict-modal-close'))
            );

            if (isCloseButton) {
                console.log('üñ±Ô∏è ÂÖ≥Èó≠ÊåâÈíÆË¢´ÁÇπÂáªÔºàÂÖ®Â±Ä‰∫ã‰ª∂ÂßîÊâòÔºâ', e.target.id || e.target.className);
                closeDictModal();
                // ‰∏çË¶ÅÈòªÊ≠¢‰∫ã‰ª∂‰º†Êí≠ÔºåËÆ©ÊåâÈíÆÁöÑ onclick ‰πüËÉΩÊâßË°å
                return;
            }

            // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
            const dictModalElement = document.getElementById("dictModal");
            if (dictModalElement && e.target === dictModalElement) {
                console.log('üñ±Ô∏è ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÔºåÂÖ≥Èó≠');
                closeDictModal();
            }
        }, false); // ‰ΩøÁî®ÂÜíÊ≥°Èò∂ÊÆµÔºåËÆ©ÊåâÈíÆÁöÑ onclick ‰∫ã‰ª∂ÂÖàÊâßË°å

        console.log('‚úÖ ËØçÂÖ∏Ê®°ÊÄÅÊ°ÜÂÖ≥Èó≠‰∫ã‰ª∂Â∑≤ÁªëÂÆöÔºàÂÖ®Â±Ä‰∫ã‰ª∂ÂßîÊâòÔºâ');

        // ============ ËØçÂÖ∏ËÆæÁΩÆÂäüËÉΩ ============
        const dictSettingsBtn = document.getElementById('dictSettingsBtn');
        const dictSettingsModal = document.getElementById('dictSettingsModal');
        const dictSettingsClose = document.getElementById('dictSettingsClose');

        // MCPÈÖçÁΩÆÂÖÉÁ¥†
        const mcpEnabledCheckbox = document.getElementById('mcpEnabled');
        const mcpServerUrlInput = document.getElementById('mcpServerUrl');
        const mcpToolNameInput = document.getElementById('mcpToolName');
        const testMcpConnectionBtn = document.getElementById('testMcpConnection');
        const mcpTestResult = document.getElementById('mcpTestResult');

        // ÈòÖËØªÁêÜËß£APIÈÖçÁΩÆÁõ∏ÂÖ≥ÂÖÉÁ¥†
        const openaiEnabledCheckbox = document.getElementById('openaiEnabled');
        const openaiApiKeyInput = document.getElementById('openaiApiKey');
        const openaiModelSelect = document.getElementById('openaiModel');
        const perplexityEnabledCheckbox = document.getElementById('perplexityEnabled');
        const perplexityApiKeyInput = document.getElementById('perplexityApiKey');
        const anthropicEnabledCheckbox = document.getElementById('anthropicEnabled');
        const anthropicApiKeyInput = document.getElementById('anthropicApiKey');
        const useFreeGenerationCheckbox = document.getElementById('useFreeGeneration');
        const saveReadingApiConfigBtn = document.getElementById('saveReadingApiConfig');
        const testReadingApiBtn = document.getElementById('testReadingApi');
        const readingApiTestResult = document.getElementById('readingApiTestResult');

        // ÊâìÂºÄËÆæÁΩÆÊ®°ÊÄÅÊ°Ü
        if (dictSettingsBtn) {
            dictSettingsBtn.addEventListener('click', () => {
                // Âä†ËΩΩÂΩìÂâçÈÖçÁΩÆ
                if (mcpEnabledCheckbox) mcpEnabledCheckbox.checked = mcpConfig.enabled || false;
                if (mcpServerUrlInput) mcpServerUrlInput.value = mcpConfig.serverUrl || '';
                if (mcpToolNameInput) mcpToolNameInput.value = mcpConfig.toolName || 'dictionary';

                // Âä†ËΩΩÈòÖËØªÁêÜËß£APIÈÖçÁΩÆ
                if (openaiEnabledCheckbox) openaiEnabledCheckbox.checked = readingApiConfig.openai?.enabled || false;
                if (openaiApiKeyInput) openaiApiKeyInput.value = readingApiConfig.openai?.apiKey || '';
                if (openaiModelSelect) openaiModelSelect.value = readingApiConfig.openai?.model || 'gpt-3.5-turbo';

                if (perplexityEnabledCheckbox) perplexityEnabledCheckbox.checked = readingApiConfig.perplexity?.enabled || false;
                if (perplexityApiKeyInput) perplexityApiKeyInput.value = readingApiConfig.perplexity?.apiKey || '';

                if (anthropicEnabledCheckbox) anthropicEnabledCheckbox.checked = readingApiConfig.anthropic?.enabled || false;
                if (anthropicApiKeyInput) anthropicApiKeyInput.value = readingApiConfig.anthropic?.apiKey || '';

                if (useFreeGenerationCheckbox) useFreeGenerationCheckbox.checked = readingApiConfig.useFreeGeneration || false;

                // ÊòæÁ§∫ËÆæÁΩÆÊ®°ÊÄÅÊ°Ü
                if (dictSettingsModal) {
                    dictSettingsModal.classList.add('show');
                }
            });
        }

        // ÂÖ≥Èó≠ËÆæÁΩÆÊ®°ÊÄÅÊ°Ü
        if (dictSettingsClose) {
            dictSettingsClose.addEventListener('click', () => {
                if (dictSettingsModal) {
                    dictSettingsModal.classList.remove('show');
                }
            });
        }

        // ÊµãËØïMCPËøûÊé•
        if (testMcpConnectionBtn) {
            testMcpConnectionBtn.addEventListener('click', async () => {
                try {
                    const enabled = mcpEnabledCheckbox.checked;
                    const serverUrl = mcpServerUrlInput.value.trim();
                    const toolName = mcpToolNameInput.value.trim() || 'dictionary';

                    if (!enabled || !serverUrl) {
                        if (mcpTestResult) {
                            mcpTestResult.textContent = 'ËØ∑ÂÖàÂêØÁî®MCPÂπ∂ËæìÂÖ•ÊúçÂä°Âô®Âú∞ÂùÄ';
                            mcpTestResult.className = 'test-error';
                        }
                        return;
                    }

                    // ‰∏¥Êó∂ÈÖçÁΩÆÊµãËØï
                    const originalConfig = { ...mcpConfig };
                    mcpConfig.enabled = true;
                    mcpConfig.serverUrl = serverUrl;
                    mcpConfig.toolName = toolName;

                    // ÊµãËØïÊü•ËØ¢
                    const testResult = await queryMcpDictionary('hello');

                    if (testResult && !testResult.error) {
                        if (mcpTestResult) {
                            mcpTestResult.textContent = '‚úÖ MCPËøûÊé•ÊàêÂäüÔºÅ';
                            mcpTestResult.className = 'test-success';
                        }
                    } else {
                        if (mcpTestResult) {
                            mcpTestResult.textContent = '‚ùå MCPËøûÊé•Â§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÊúçÂä°Âô®ÈÖçÁΩÆ';
                            mcpTestResult.className = 'test-error';
                        }
                    }

                    // ÊÅ¢Â§çÂéüÂßãÈÖçÁΩÆ
                    mcpConfig = originalConfig;

                } catch (error) {
                    if (mcpTestResult) {
                        mcpTestResult.textContent = `‚ùå ÊµãËØïÂ§±Ë¥•: ${error.message}`;
                        mcpTestResult.className = 'test-error';
                    }
                }
            });
        }

        // ÊµãËØïÈòÖËØªAPI
        if (testReadingApiBtn) {
            testReadingApiBtn.addEventListener('click', async () => {
                try {
                    if (readingApiTestResult) {
                        readingApiTestResult.textContent = 'ÊµãËØïÂäüËÉΩÂºÄÂèë‰∏≠...';
                        readingApiTestResult.className = 'test-info';
                    }
                } catch (error) {
                    if (readingApiTestResult) {
                        readingApiTestResult.textContent = `‚ùå ÊµãËØïÂ§±Ë¥•: ${error.message}`;
                        readingApiTestResult.className = 'test-error';
                    }
                }
            });
        }

        // ‰øùÂ≠òÈòÖËØªAPIÈÖçÁΩÆ
        if (saveReadingApiConfigBtn) {
            saveReadingApiConfigBtn.addEventListener('click', () => {
                try {
                    // ‰øùÂ≠òÈÖçÁΩÆÂà∞localStorage
                    const config = {
                        openai: {
                            enabled: openaiEnabledCheckbox.checked,
                            apiKey: openaiApiKeyInput.value.trim(),
                            model: openaiModelSelect.value
                        },
                        perplexity: {
                            enabled: perplexityEnabledCheckbox.checked,
                            apiKey: perplexityApiKeyInput.value.trim()
                        },
                        anthropic: {
                            enabled: anthropicEnabledCheckbox.checked,
                            apiKey: anthropicApiKeyInput.value.trim()
                        },
                        useFreeGeneration: useFreeGenerationCheckbox.checked
                    };

                    localStorage.setItem('petReadingApiConfig', JSON.stringify(config));
                    readingApiConfig = config;

                    alert('‚úÖ ÈòÖËØªAPIÈÖçÁΩÆÂ∑≤‰øùÂ≠ò');
                } catch (error) {
                    alert(`‚ùå ‰øùÂ≠òÂ§±Ë¥•: ${error.message}`);
                }
            });
        }

        // ============ ÊòæÁ§∫ËØçÂÖ∏Ê®°ÊÄÅÊ°Ü ============
        async function showDictModal(word) {
            console.log('üîç ÊòæÁ§∫ËØçÂÖ∏Êü•ËØ¢:', word);

            // ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
            const dictModal = document.getElementById("dictModal");
            if (dictModal) {
                dictModal.classList.add('show');
            }

            // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
            const dictModalBody = document.getElementById("dictModalBody");
            if (dictModalBody) {
                dictModalBody.innerHTML = '<div class="dict-loading">Ê≠£Âú®Êü•ËØ¢...</div>';
            }

            try {
                // Êü•ËØ¢ËØçÂÖ∏
                const result = await queryDictionary(word);

                if (result && result.error) {
                    // ÈîôËØØÂ§ÑÁêÜ
                    if (dictModalBody) {
                        dictModalBody.innerHTML = `
                            <div class="dict-error">
                                <h3>‚ùå Êü•ËØ¢Â§±Ë¥•</h3>
                                <p>${result.error}</p>
                                ${result.word ? `<p>Êü•ËØ¢ËØç: ${result.word}</p>` : ''}
                                <button class="dict-action-btn" onclick="closeDictModal()">ÂÖ≥Èó≠</button>
                            </div>
                        `;
                    }
                    return;
                }

                // ÁÆÄÂåñÁâàÁªìÊûúÊòæÁ§∫ÔºàÂ∞èÂ≠¶ÁîüÂèãÂ•ΩÁâàÔºâ
                if (dictModalBody && result) {
                    let html = '<div class="dict-result">';

                    // ÂçïËØçÂíåÈü≥Ê†á
                    html += '<div class="dict-header">';

                    // Â¶ÇÊûúÊòØ‰∏≠ÊñáËæìÂÖ•ÔºåÊòæÁ§∫ "‰∏≠Êñá ‚Üí Ëã±Êñá" ÁöÑÊ†ºÂºè
                    if (result.isChineseInput && result.originalWord) {
                        html += `<div class="dict-translation-hint">`;
                        html += `<span class="dict-chinese-word">${result.originalWord}</span>`;
                        html += `<span class="dict-arrow">‚Üí</span>`;
                        html += `<h2 class="dict-word">${result.word || word}</h2>`;
                        html += `</div>`;
                    } else {
                        html += `<h2 class="dict-word">${result.word || word}</h2>`;
                    }

                    if (result.phonetic) {
                        html += `<span class="dict-phonetic">[${result.phonetic}]</span>`;
                    }
                    html += '</div>';

                    // üá¨üáß Ëã±ÊñáÈáä‰πâÔºà‰∏≠ÊñáËæìÂÖ•Êó∂‰ºòÂÖàÊòæÁ§∫Ôºâ
                    if (result.meanings && result.meanings.length > 0) {
                        html += '<div class="dict-section dict-english-section">';
                        html += '<h3 class="dict-section-title">üá¨üáß Ëã±ÊñáÈáä‰πâ</h3>';

                        // Âè™ÊòæÁ§∫Á¨¨‰∏Ä‰∏™‰∏ªË¶ÅËØçÊÄßÁöÑÂâç2‰∏™ÁÆÄÊ¥ÅÂÆö‰πâ
                        const primaryMeaning = result.meanings[0];
                        if (primaryMeaning) {
                            html += `<div class="dict-part-of-speech">${primaryMeaning.partOfSpeech || ''}</div>`;

                            if (primaryMeaning.definitions && primaryMeaning.definitions.length > 0) {
                                // Âè™ÂèñÂâç2‰∏™ÂÆö‰πâÔºåÂπ∂ËøáÊª§ÊéâÂ§™ÈïøÁöÑÂÆö‰πâÔºàË∂ÖËøá100Â≠óÁ¨¶Ôºâ
                                const definitionsToShow = primaryMeaning.definitions
                                    .slice(0, 2)
                                    .filter(def => def.definition && def.definition.length < 100);

                                definitionsToShow.forEach((def, defIdx) => {
                                    // ÁÆÄÂåñÂÆö‰πâÊñáÊú¨ÔºåÁßªÈô§Êã¨Âè∑‰∏≠ÁöÑÈ¢ùÂ§ñËØ¥Êòé
                                    let simplifiedDef = def.definition
                                        .replace(/\([^)]*\)/g, '') // ÁßªÈô§Êã¨Âè∑ÂÜÖÂÆπ
                                        .replace(/\s+/g, ' ')  // ËßÑËåÉÂåñÁ©∫Ê†º
                                        .trim();

                                    html += `<div class="dict-definition-item">`;
                                    html += `<span class="dict-def-number">${defIdx + 1}.</span> `;
                                    html += `<span class="dict-definition">${simplifiedDef || ''}</span>`;
                                    html += `</div>`;
                                });
                            }
                        }

                        html += '</div>';
                    }

                    // üá®üá≥ ÂÆåÊï¥‰∏≠ÊñáÈáä‰πâÔºà‰∏≠ÊñáËæìÂÖ•Êó∂‰∏çÊòæÁ§∫ÔºåÂõ†‰∏∫Áî®Êà∑Â∑≤ÁªèÁü•ÈÅì‰∏≠ÊñáÊÑèÊÄùÔºâ
                    if (!result.isChineseInput && result.chineseMeanings && result.chineseMeanings.length > 0) {
                        html += '<div class="dict-section dict-meanings-section">';
                        html += '<h3 class="dict-section-title">üá®üá≥ ‰∏≠ÊñáÈáä‰πâ</h3>';

                        // ÊåâËØçÊÄßÂàÜÁªÑ
                        const meaningsByPOS = {};
                        result.chineseMeanings.forEach(m => {
                            // Ëß£ÊûêÊ†ºÂºè: "ËØçÊÄß Èáä‰πâ" Êàñ "Èáä‰πâ"
                            let pos = '';
                            let meaning = m;
                            const spaceIndex = m.indexOf(' ');
                            if (spaceIndex > 0) {
                                pos = m.substring(0, spaceIndex);
                                meaning = m.substring(spaceIndex + 1);
                            }

                            if (!meaningsByPOS[pos]) {
                                meaningsByPOS[pos] = [];
                            }
                            meaningsByPOS[pos].push(meaning);
                        });

                        // ÊòæÁ§∫ÂàÜÁªÑÁöÑÈáä‰πâ
                        Object.keys(meaningsByPOS).sort().forEach(pos => {
                            if (pos) {
                                html += `<div class="dict-part-ofspeech">${pos}</div>`;
                            }
                            meaningsByPOS[pos].forEach(meaning => {
                                html += `<div class="dict-meaning-item">‚Ä¢ ${meaning}</div>`;
                            });
                        });

                        html += '</div>';
                        html += '</div>';
                    }

                    // üìñ ‰æãÂè•Ôºà‰∏≠Ëã±ÊñáÂØπÁÖßÔºåÂ§ßÂ≠óÂè∑Ôºâ
                    if (result.meanings && result.meanings.length > 0) {
                        let hasExamples = false;
                        result.meanings.forEach(meaning => {
                            if (meaning.definitions) {
                                meaning.definitions.forEach(def => {
                                    if (def.example) hasExamples = true;
                                });
                            }
                        });

                        if (hasExamples) {
                            html += '<div class="dict-section dict-examples-section">';
                            html += '<h3 class="dict-section-title">üìö ‰æãÂè•</h3>';

                            result.meanings.forEach((meaning, idx) => {
                                if (meaning.definitions && meaning.definitions.length > 0) {
                                    meaning.definitions.forEach((def, defIdx) => {
                                        if (def.example) {
                                            html += `<div class="dict-example-item">`;
                                            html += `<div class="dict-example-en-large">üî§ ${def.example}</div>`;
                                            if (def.exampleTranslation) {
                                                html += `<div class="dict-example-cn-large">üí° ${def.exampleTranslation}</div>`;
                                            }
                                            html += `</div>`;
                                        }
                                    });
                                }
                            });

                            html += '</div>';
                        }
                    }

                    // üé¨ Âú∫ÊôØÂè•Â≠êÔºàÁîüÊ¥ªÂ∫îÁî®Ôºâ
                    if (result.sceneExamples && result.sceneExamples.length > 0) {
                        html += '<div class="dict-section dict-scenes-section">';
                        html += '<h3 class="dict-section-title">üé¨ ÁîüÊ¥ªÂú∫ÊôØ</h3>';
                        html += '<div class="dict-scenes-list">';

                        result.sceneExamples.forEach(scene => {
                            html += `<div class="dict-scene-item">`;
                            html += `<div class="dict-scene-tag">${scene.scene}</div>`;
                            html += `<div class="dict-scene-en">${scene.en}</div>`;
                            html += `<div class="dict-scene-cn">${scene.cn}</div>`;
                            html += `</div>`;
                        });

                        html += '</div>';
                        html += '</div>';
                    }

                    // üîó Âêå‰πâËØçÔºàÂèØÁÇπÂáªÔºâ
                    if (result.meanings && result.meanings.length > 0) {
                        let allSynonyms = [];
                        result.meanings.forEach(meaning => {
                            if (meaning.synonyms && meaning.synonyms.length > 0) {
                                allSynonyms = allSynonyms.concat(meaning.synonyms.slice(0, 5));
                            }
                        });

                        if (allSynonyms.length > 0) {
                            html += '<div class="dict-section dict-synonyms-section">';
                            html += '<h3 class="dict-section-title">üîó Ëøë‰πâËØç</h3>';
                            html += '<div class="dict-synonyms-list">';
                            allSynonyms.slice(0, 10).forEach(s => {
                                html += `<span class="dict-synonym-word-large">${s}</span>`;
                            });
                            html += '</div>';
                            html += '</div>';
                        }
                    }

                    // Êìç‰ΩúÊåâÈíÆ
                    html += '<div class="dict-actions">';

                    // Ê∑ªÂä†Âà∞ÁîüËØçÊú¨ÊåâÈíÆÔºà‰ΩøÁî®ÂÖ®Â±ÄÂèòÈáèÂ≠òÂÇ®Êï∞ÊçÆÔºåÈÅøÂÖçJSONËΩ¨‰πâÈóÆÈ¢òÔºâ
                    window.__currentDictResult = result;
                    html += `<button class="dict-action-btn dict-add-btn" onclick="addCurrentDictToWordbook()">üìö Âä†ÂÖ•ÁîüËØçÊú¨</button>`;
                    html += `<button class="dict-action-btn" onclick="closeDictModal()">ÂÖ≥Èó≠</button>`;
                    html += `</div>`;

                    html += '</div>';
                    dictModalBody.innerHTML = html;

                    // Ê∑ªÂä†Âêå‰πâËØçÁÇπÂáª‰∫ã‰ª∂
                    const synonymWords = dictModalBody.querySelectorAll('.dict-synonym-word-large');
                    synonymWords.forEach(synonymEl => {
                        synonymEl.addEventListener('click', () => {
                            const synonymWord = synonymEl.textContent.trim();
                            console.log('üîç ÁÇπÂáªÂêå‰πâËØç:', synonymWord);
                            showDictModal(synonymWord);
                        });
                    });
                }

            } catch (error) {
                console.error('‚ùå ËØçÂÖ∏Êü•ËØ¢Âá∫Èîô:', error);
                if (dictModalBody) {
                    dictModalBody.innerHTML = `
                        <div class="dict-error">
                            <h3>‚ùå Êü•ËØ¢Âá∫Èîô</h3>
                            <p>${error.message || 'ÁΩëÁªúÈîôËØØÔºåËØ∑Ê£ÄÊü•ËøûÊé•'}</p>
                            <button class="dict-action-btn" onclick="closeDictModal()">ÂÖ≥Èó≠</button>
                        </div>
                    `;
                }
            }
        }

        // ‰ªéËØçÂÖ∏Êü•ËØ¢ÁªìÊûúÊ∑ªÂä†Âà∞ÁîüËØçÊú¨Ôºà‰ªéÂÖ®Â±ÄÂèòÈáèËé∑ÂèñÂΩìÂâçÊü•ËØ¢ÁªìÊûúÔºâ
        function addCurrentDictToWordbook() {
            try {
                const dictData = window.__currentDictResult;

                if (!dictData || !dictData.word) {
                    console.error('Ê≤°ÊúâÂèØÁî®ÁöÑËØçÂÖ∏Êï∞ÊçÆ');
                    alert('Ê∑ªÂä†Â§±Ë¥•ÔºåËØ∑ÈáçÊñ∞Êü•ËØ¢ÂçïËØç');
                    return;
                }

                const word = dictData.word;

                // Ê£ÄÊü•ÊòØÂê¶Â∑≤Âú®ÁîüËØçÊú¨‰∏≠Â≠òÂú®
                const existingIndex = wordbookData.findIndex(v => v.word.toLowerCase() === word.toLowerCase());

                if (existingIndex >= 0) {
                    alert('‚ö†Ô∏è ËØ•ÂçïËØçÂ∑≤Âú®ÁîüËØçÊú¨‰∏≠ÔºÅ');
                    return;
                }

                // Ëé∑Âèñ‰∏≠ÊñáÈáä‰πâ
                let chinese = '';
                if (dictData.chineseMeanings && Array.isArray(dictData.chineseMeanings) && dictData.chineseMeanings.length > 0) {
                    // Âè™ÂèñÂâç2‰∏™Èáä‰πâ
                    chinese = dictData.chineseMeanings.slice(0, 2).join('Ôºõ');
                }

                // Ëé∑ÂèñÁ¨¨‰∏Ä‰∏™Ëã±ÊñáÈáä‰πâ‰Ωú‰∏∫meaning
                let meaning = 'Useful word';
                if (dictData.meanings && dictData.meanings.length > 0) {
                    const firstMeaning = dictData.meanings[0];
                    if (firstMeaning.definitions && firstMeaning.definitions.length > 0) {
                        meaning = firstMeaning.definitions[0].definition || 'Useful word';
                    }
                }

                // Ëé∑ÂèñÁ¨¨‰∏Ä‰∏™‰æãÂè•‰Ωú‰∏∫example
                let example = '';
                if (dictData.meanings && dictData.meanings.length > 0) {
                    for (const meaningItem of dictData.meanings) {
                        if (meaningItem.definitions && meaningItem.definitions.length > 0) {
                            for (const def of meaningItem.definitions) {
                                if (def.example) {
                                    example = def.example;
                                    break;
                                }
                            }
                            if (example) break;
                        }
                    }
                }

                // Â¶ÇÊûúÊ≤°Êúâ‰æãÂè•Ôºå‰ΩøÁî®ÈªòËÆ§‰æãÂè•
                if (!example) {
                    example = `${word} is a useful word to learn.`;
                }

                // Ê∑ªÂä†Âà∞ÁîüËØçÊú¨
                const newWord = {
                    word: word,
                    meaning: meaning,
                    chinese: chinese,
                    example: example,
                    addedDate: new Date().toISOString().split('T')[0] // YYYY-MM-DD
                };

                wordbookData.push(newWord);
                saveWordbook();

                // Â•ñÂä±ÁßØÂàÜ
                if (!hasAddedToVocab) {
                    hasAddedToVocab = true;
                    addReward(5, "È¶ñÊ¨°Ê∑ªÂä†ÁîüËØçÊú¨");
                } else {
                    addReward(2, "Ê∑ªÂä†ÁîüËØçÊú¨");
                }

                alert(`‚úÖ "${word}" Â∑≤Ê∑ªÂä†Âà∞ÁîüËØçÊú¨ÔºÅ`);

                // Âà∑Êñ∞ÁîüËØçÊú¨ÊòæÁ§∫
                const wordbookCard = document.getElementById('wordbook');
                if (wordbookCard && !wordbookCard.hidden) {
                    renderWordbook();
                }

                // ÂÖ≥Èó≠ËØçÂÖ∏Ê®°ÊÄÅÊ°Ü
                closeDictModal();
            } catch (error) {
                console.error('‚ùå Ê∑ªÂä†ÁîüËØçÊú¨Â§±Ë¥•:', error);
                alert('Ê∑ªÂä†Â§±Ë¥•ÔºåËØ∑ÈáçËØï„ÄÇ');
            }
        }

        // Á°Æ‰øùÂÖ®Â±ÄÂèØËÆøÈóÆ
        window.exportAllData = exportAllData;
        window.exportWordbook = exportWordbook;
        window.addCurrentDictToWordbook = addCurrentDictToWordbook;
        window.showDictModal = showDictModal;

        // ‰∏¥Êó∂Êï∞ÊçÆÊÅ¢Â§çÂäüËÉΩÔºàÊéßÂà∂Âè∞‰ΩøÁî®Ôºâ
        window.recoverData = function() {
            console.log('üîÑ ÂºÄÂßãÊü•ÊâæÂ§á‰ªΩÊï∞ÊçÆ...');

            const backupKeys = [
                { key: 'petEnglishData_backup', name: 'Â§á‰ªΩÊï∞ÊçÆ' },
                { key: 'petEnglishData_old', name: 'ÊóßÁâàÊï∞ÊçÆ' },
                { key: 'petData', name: 'Â§áÁî®Êï∞ÊçÆ' },
                { key: 'petEnglishData_before_restore', name: 'ÊÅ¢Â§çÂâçÂ§á‰ªΩ' }
            ];

            // Ê£ÄÊü•Êó∂Èó¥Êà≥Â§á‰ªΩ
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.startsWith('petEnglishData_before_save_')) {
                    backupKeys.push({ key: key, name: `‰øùÂ≠òÂâçÂ§á‰ªΩ ${key.replace('petEnglishData_before_save_', '')}` });
                }
            }

            const availableBackups = [];
            backupKeys.forEach(({ key, name }) => {
                const backup = localStorage.getItem(key);
                if (backup) {
                    try {
                        const parsed = JSON.parse(backup);
                        const stats = {
                            key: key,
                            name: name,
                            vocab: parsed.vocab?.length || 0,
                            reading: parsed.readingSets?.length || 0,
                            collocation: parsed.collocationSets?.length || 0,
                            cloze: parsed.clozeSets?.length || 0,
                            data: parsed
                        };
                        if (stats.vocab > 0 || stats.reading > 0 || stats.collocation > 0 || stats.cloze > 0) {
                            availableBackups.push(stats);
                            console.log(`‚úÖ ÊâæÂà∞Â§á‰ªΩ: ${name}`, stats);
                        }
                    } catch (e) {
                        console.warn(`‚ö†Ô∏è Â§á‰ªΩ ${name} Ëß£ÊûêÂ§±Ë¥•`);
                    }
                }
            });

            if (availableBackups.length === 0) {
                console.error('‚ùå Êú™ÊâæÂà∞‰ªª‰ΩïÂ§á‰ªΩÊï∞ÊçÆ');
                alert('‚ùå Êú™ÊâæÂà∞‰ªª‰ΩïÂ§á‰ªΩÊï∞ÊçÆÔºåÊó†Ê≥ïÊÅ¢Â§ç');
                return;
            }

            // ‰ΩøÁî®Á¨¨‰∏Ä‰∏™ÈùûÁ©∫Â§á‰ªΩ
            const backup = availableBackups[0];
            console.log('üîÑ ÂáÜÂ§áÊÅ¢Â§çÂ§á‰ªΩ:', backup.name);

            if (confirm(`ÊâæÂà∞Â§á‰ªΩÊï∞ÊçÆÔºö${backup.name}\n\nÊï∞ÊçÆÁªüËÆ°Ôºö\n- ÂçïËØç: ${backup.vocab} ‰∏™\n- ÈòÖËØª: ${backup.reading} È¢ò\n- Âõ∫ÂÆöÊê≠ÈÖç: ${backup.collocation} È¢ò\n- ÂÆåÂΩ¢Â°´Á©∫: ${backup.cloze} È¢ò\n\nÊòØÂê¶ÊÅ¢Â§çÊ≠§Â§á‰ªΩÔºü`)) {
                try {
                    restoreFromBackup(backup);
                    alert('‚úÖ Êï∞ÊçÆÊÅ¢Â§çÊàêÂäüÔºÅÈ°µÈù¢Â∞ÜÂà∑Êñ∞„ÄÇ');
                    window.location.reload();
                } catch (e) {
                    console.error('‚ùå ÊÅ¢Â§çÂ§±Ë¥•:', e);
                    alert('‚ùå ÊÅ¢Â§çÂ§±Ë¥•: ' + e.message);
                }
            }
        };

        console.log('üí° ÊèêÁ§∫ÔºöÂ¶ÇÊûúÊï∞ÊçÆ‰∏¢Â§±ÔºåËØ∑Âú®ÊéßÂà∂Âè∞ËøêË°å recoverData() Êù•ÊÅ¢Â§ç');

        // ============ üìú ÁâàÊú¨ÂéÜÂè≤ÁÆ°ÁêÜ ============

        // ÁâàÊú¨ÂéÜÂè≤ÁÆ°ÁêÜÂô®Ôºà‰ΩøÁî®ÁâàÊú¨Âè∑ v1, v2, v3...Ôºâ
        const versionManager = {
            // Â≠òÂÇ®key
            storageKey: 'pet_version_history',

            // ËøÅÁßªÊóßÊï∞ÊçÆÔºö‰∏∫Ê≤°ÊúâÁâàÊú¨Âè∑ÁöÑÊóßÊï∞ÊçÆÊ∑ªÂä†ÁâàÊú¨Âè∑
            migrateOldData() {
                try {
                    const versions = this.getVersions();
                    let needsMigration = false;

                    versions.forEach((v, index) => {
                        if (!v.versionNumber) {
                            // ‰∏∫ÊóßÊï∞ÊçÆÂàÜÈÖçÁâàÊú¨Âè∑
                            v.versionNumber = `v${index + 1}`;
                            v.number = index + 1;
                            needsMigration = true;
                            console.log(`üîÑ ËøÅÁßªÊóßÊï∞ÊçÆ: ÁâàÊú¨ ${v.versionNumber}`);
                        }
                    });

                    if (needsMigration) {
                        this.saveVersions(versions);
                        console.log('‚úÖ ÊóßÊï∞ÊçÆËøÅÁßªÂÆåÊàê');
                    }
                } catch (e) {
                    console.error('‚ùå Êï∞ÊçÆËøÅÁßªÂ§±Ë¥•:', e);
                }
            },

            // Ëé∑ÂèñÊâÄÊúâÁâàÊú¨
            getVersions() {
                try {
                    const data = localStorage.getItem(this.storageKey);
                    return data ? JSON.parse(data) : [];
                } catch (e) {
                    console.error('Ëé∑ÂèñÁâàÊú¨ÂéÜÂè≤Â§±Ë¥•:', e);
                    return [];
                }
            },

            // ‰øùÂ≠òÁâàÊú¨ÂàóË°®
            saveVersions(versions) {
                try {
                    localStorage.setItem(this.storageKey, JSON.stringify(versions));
                    return true;
                } catch (e) {
                    console.error('‰øùÂ≠òÁâàÊú¨ÂéÜÂè≤Â§±Ë¥•:', e);
                    return false;
                }
            },

            // Ëé∑Âèñ‰∏ã‰∏Ä‰∏™ÁâàÊú¨Âè∑
            getNextVersionNumber() {
                const versions = this.getVersions();
                if (versions.length === 0) return 1;

                // ÊâæÂá∫ÊúÄÂ§ßÁöÑÁâàÊú¨Âè∑
                let maxNum = 0;
                versions.forEach(v => {
                    // ÂÖºÂÆπÊóßÊï∞ÊçÆÔºöÂ¶ÇÊûúÊ≤°Êúâ versionNumberÔºåÂ∞ùËØï‰ΩøÁî® number Â≠óÊÆµ
                    let verNum = v.versionNumber || v.number;
                    if (verNum) {
                        // ÁßªÈô§ 'v' ÂâçÁºÄÔºàÂ¶ÇÊûúÊúâÔºâ
                        const num = parseInt(String(verNum).replace(/^v/i, ''));
                        if (!isNaN(num) && num > maxNum) {
                            maxNum = num;
                        }
                    }
                });
                return maxNum + 1;
            },

            // ÂàõÂª∫Êñ∞ÁâàÊú¨Âø´ÁÖß
            createVersion(description = '') {
                const versions = this.getVersions();
                const now = new Date();
                const versionNumber = this.getNextVersionNumber();

                const version = {
                    versionNumber: `v${versionNumber}`,
                    number: versionNumber,
                    id: Date.now(), // ‰øùÁïôÂîØ‰∏ÄIDÁî®‰∫éÂÜÖÈÉ®Êìç‰Ωú
                    timestamp: now.toISOString(),
                    date: now.toLocaleString('zh-CN'),
                    description: description || 'Ëá™Âä®‰øùÂ≠ò',
                    data: {
                        vocab: data.vocab || [],
                        readingSets: data.readingSets || [],
                        collocationSets: data.collocationSets || [],
                        clozeSets: data.clozeSets || []
                    },
                    stats: {
                        vocab: (data.vocab || []).length,
                        reading: (data.readingSets || []).length,
                        collocation: (data.collocationSets || []).length,
                        cloze: (data.clozeSets || []).length
                    }
                };

                // Ê∑ªÂä†Âà∞ÂàóË°®ÂºÄÂ§¥ÔºàÊúÄÊñ∞ÁöÑÂú®ÂâçÈù¢Ôºâ
                versions.unshift(version);

                // Âè™‰øùÁïôÊúÄËøë50‰∏™ÁâàÊú¨
                if (versions.length > 50) {
                    versions.splice(50);
                }

                this.saveVersions(versions);
                console.log(`‚úÖ Â∑≤ÂàõÂª∫ÁâàÊú¨Âø´ÁÖß: ${version.versionNumber} - ${version.description}`);
                return version;
            },

            // ÊÅ¢Â§çÂà∞ÊåáÂÆöÁâàÊú¨
            restoreVersion(versionNumber) {
                const versions = this.getVersions();
                const version = versions.find(v => v.versionNumber === versionNumber || v.id === versionNumber);

                if (!version) {
                    alert('‚ùå Êú™ÊâæÂà∞ËØ•ÁâàÊú¨');
                    return false;
                }

                if (!confirm(`Á°ÆÂÆöË¶ÅÊÅ¢Â§çÂà∞ÁâàÊú¨ ${version.versionNumber} ÂêóÔºü\n\n${version.description}\n\nÂàõÂª∫Êó∂Èó¥: ${version.date}\n\nÂΩìÂâçÊï∞ÊçÆ‰ºöË¢´‰øùÂ≠ò‰∏∫Êñ∞ÁâàÊú¨„ÄÇ`)) {
                    return false;
                }

                // ÂÖàÂàõÂª∫ÂΩìÂâçÁä∂ÊÄÅÁöÑÂø´ÁÖß
                this.createVersion('ÊÅ¢Â§çÂâçËá™Âä®Â§á‰ªΩ');

                // ÊÅ¢Â§çÊï∞ÊçÆ
                data.vocab = Array.isArray(version.data.vocab) ? version.data.vocab : [];
                data.readingSets = Array.isArray(version.data.readingSets) ? version.data.readingSets : [];
                data.collocationSets = Array.isArray(version.data.collocationSets) ? version.data.collocationSets : [];
                data.clozeSets = Array.isArray(version.data.clozeSets) ? version.data.clozeSets : [];

                saveDataToLocalStorage();
                updateBankStatistics();

                alert(`‚úÖ Â∑≤ÊàêÂäüÊÅ¢Â§çÂà∞ÁâàÊú¨ ${version.versionNumber}\n\n${version.description}\n\nÈ°µÈù¢Â∞ÜÂà∑Êñ∞„ÄÇ`);
                window.location.reload();
                return true;
            },

            // Âà†Èô§ÁâàÊú¨
            deleteVersion(versionNumber) {
                if (!confirm(`Á°ÆÂÆöÂà†Èô§ÁâàÊú¨ ${versionNumber} ÂêóÔºü\n\nÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄÔºÅ`)) return false;

                const versions = this.getVersions();
                const filtered = versions.filter(v => v.versionNumber !== versionNumber && v.id !== versionNumber);
                this.saveVersions(filtered);
                showVersionHistory(); // Âà∑Êñ∞ÊòæÁ§∫
                return true;
            }
        };

        // ÊòæÁ§∫ÁâàÊú¨ÂéÜÂè≤
        function showVersionHistory() {
            // ÂÖàËøÅÁßªÊóßÊï∞ÊçÆÔºàÂ¶ÇÊûúÊúâÔºâ
            versionManager.migrateOldData();

            const modal = document.getElementById('versionHistoryModal');
            const listContainer = document.getElementById('versionHistoryList');

            if (!modal || !listContainer) return;

            modal.classList.add('show');

            const versions = versionManager.getVersions();

            if (versions.length === 0) {
                listContainer.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: #8ea6ff;">
                        <div style="font-size: 3rem; margin-bottom: 16px;">üì≠</div>
                        <div style="font-size: 1.2rem; margin-bottom: 8px; color: #51627a;">ÊöÇÊó†ÂéÜÂè≤ÁâàÊú¨</div>
                        <div style="font-size: 0.9rem; color: #8ea6ff;">Á≥ªÁªü‰ºöËá™Âä®Âú®ÈáçË¶ÅÊìç‰ΩúÊó∂ÂàõÂª∫ÁâàÊú¨Âø´ÁÖß</div>
                    </div>
                `;
                return;
            }

            let html = '<div style="margin-bottom: 20px;">';
            html += `<div style="font-size: 0.9rem; color: #51627a; margin-bottom: 12px;">
                        üí° ÊèêÁ§∫ÔºöÁâàÊú¨ÊåâÊó∂Èó¥ÂÄíÂ∫èÊéíÂàóÔºàv${versionManager.getNextVersionNumber() - 1 || 0} ÊòØÊúÄÊñ∞ÁâàÊú¨Ôºâ
                     </div>`;
            html += '<button onclick="versionManager.createVersion(\'ÊâãÂä®ÂàõÂª∫Âø´ÁÖß\'); showVersionHistory();" style="padding: 10px 20px; background: linear-gradient(135deg, #70a1ff, #8ea6ff); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">üíæ ÂàõÂª∫ÂΩìÂâçÂø´ÁÖß</button>';
            html += '</div>';

            versions.forEach((version, index) => {
                const isFirst = index === 0;
                // ÂÖºÂÆπÊóßÊï∞ÊçÆÔºöËé∑ÂèñÁâàÊú¨Âè∑
                const displayVersion = version.versionNumber || (version.number ? `v${version.number}` : 'v?');

                html += `
                    <div style="background: ${isFirst ? 'linear-gradient(135deg, #e8f4ff, #f0f4ff)' : '#ffffff'};
                                border: 2px solid ${isFirst ? '#70a1ff' : '#e8eeff'};
                                border-radius: 12px;
                                padding: 20px;
                                margin-bottom: 16px;
                                box-shadow: ${isFirst ? '0 4px 12px rgba(112, 161, 255, 0.15)' : '0 2px 8px rgba(0, 0, 0, 0.05)'};">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 6px;">
                                    <span style="background: linear-gradient(135deg, #4c55a4, #5c6bc0); color: white;
                                                padding: 6px 14px; border-radius: 8px; font-weight: 700; font-size: 1rem;">
                                        ${displayVersion}
                                    </span>
                                    ${isFirst ? '<span style="padding: 4px 12px; background: linear-gradient(135deg, #70a1ff, #8ea6ff); color: white; border-radius: 12px; font-size: 0.75rem; font-weight: 600;">‚≠ê ÊúÄÊñ∞</span>' : ''}
                                </div>
                                <div style="font-weight: 600; color: #1b2540; font-size: 1rem; margin-bottom: 4px;">
                                    ${version.description}
                                </div>
                                <div style="color: #8ea6ff; font-size: 0.8rem;">üìÖ ${version.date}</div>
                            </div>
                            <div style="display: flex; gap: 8px; margin-left: 16px;">
                                <button onclick="versionManager.restoreVersion('${displayVersion}')"
                                        style="padding: 8px 16px; background: #4caf50; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 0.85rem; font-weight: 600; white-space: nowrap;">
                                    ‚Üª ÊÅ¢Â§çÂà∞Ê≠§ÁâàÊú¨
                                </button>
                                ${!isFirst ? `<button onclick="versionManager.deleteVersion('${displayVersion}')"
                                        style="padding: 8px 12px; background: #f5f5f5; color: #ef5350; border: 1px solid #e0e0e0; border-radius: 8px; cursor: pointer; font-size: 0.85rem;">
                                        üóëÔ∏è
                                        </button>` : ''}
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; padding: 12px; background: ${isFirst ? 'rgba(255,255,255,0.6)' : '#f9fbff'}; border-radius: 8px;">
                            <div style="text-align: center;">
                                <div style="color: #8ea6ff; font-size: 0.75rem;">üìù ÂçïËØç</div>
                                <div style="color: #4c55a4; font-weight: 700; font-size: 1.1rem;">${version.stats.vocab}</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="color: #8ea6ff; font-size: 0.75rem;">üìñ ÈòÖËØª</div>
                                <div style="color: #4c55a4; font-weight: 700; font-size: 1.1rem;">${version.stats.reading}</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="color: #8ea6ff; font-size: 0.75rem;">üîó Êê≠ÈÖç</div>
                                <div style="color: #4c55a4; font-weight: 700; font-size: 1.1rem;">${version.stats.collocation}</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="color: #8ea6ff; font-size: 0.75rem;">‚úèÔ∏è ÂÆåÂΩ¢</div>
                                <div style="color: #4c55a4; font-weight: 700; font-size: 1.1rem;">${version.stats.cloze}</div>
                            </div>
                        </div>
                    </div>
                `;
            });

            listContainer.innerHTML = html;
        }

        // ÁªëÂÆö"ÂéÜÂè≤ÁâàÊú¨"ÊåâÈíÆ‰∫ã‰ª∂
        function bindVersionHistoryButton() {
            const btn = document.getElementById('versionHistoryBtn');
            if (btn) {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    showVersionHistory();
                    return false;
                });
            }
        }

        // Âú®ÈáçË¶ÅÊìç‰ΩúÊó∂Ëá™Âä®ÂàõÂª∫ÁâàÊú¨Âø´ÁÖß
        const originalSaveData = saveDataToLocalStorage;
        saveDataToLocalStorage = function() {
            const result = originalSaveData.apply(this, arguments);
            // ÊØèÊ¨°‰øùÂ≠òÊï∞ÊçÆÊó∂ÔºåÂàõÂª∫ÁâàÊú¨Âø´ÁÖßÔºàÊúÄÂ§öÊØè5ÂàÜÈíü‰∏ÄÊ¨°Ôºâ
            const now = Date.now();
            if (!window._lastVersionSave || now - window._lastVersionSave > 5 * 60 * 1000) {
                versionManager.createVersion('Ëá™Âä®‰øùÂ≠ò');
                window._lastVersionSave = now;
            }
            return result;
        };

        // ÂØºÂá∫Âà∞ÂÖ®Â±Ä
        window.versionManager = versionManager;
        window.showVersionHistory = showVersionHistory;

        console.log('üéâ PETËã±ËØ≠Â±ãÂàùÂßãÂåñÂÆåÊàêÔºÅ');
    </script>
</body>

</html>