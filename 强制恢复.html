<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¼ºåˆ¶æ¢å¤æ•°æ®</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }

        .status {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            font-family: monospace;
            white-space: pre-wrap;
            text-align: left;
        }

        .status.success {
            border-left-color: #27ae60;
            background: #d4edda;
        }

        .status.error {
            border-left-color: #e74c3c;
            background: #f8d7da;
        }

        .status.warning {
            border-left-color: #f39c12;
            background: #fff3cd;
        }

        button {
            padding: 15px 30px;
            margin: 10px 5px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
            transform: translateY(-2px);
        }

        .steps {
            background: #e7f3ff;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .step {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 4px;
        }

        .step-number {
            font-weight: bold;
            color: #3498db;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ”§ PETè‹±è¯­å±‹å¼ºåˆ¶æ¢å¤å·¥å…·</h1>

        <div class="steps">
            <h3>ä½¿ç”¨æ­¥éª¤ï¼š</h3>
            <div class="step"><span class="step-number">æ­¥éª¤1ï¼š</span> ç‚¹å‡»"æ£€æŸ¥å†…ç½®æ•°æ®"æŒ‰é’®</div>
            <div class="step"><span class="step-number">æ­¥éª¤2ï¼š</span> ç¡®è®¤æ•°æ®å­˜åœ¨åï¼Œç‚¹å‡»"å¼ºåˆ¶æ¢å¤æ•°æ®"</div>
            <div class="step"><span class="step-number">æ­¥éª¤3ï¼š</span> æ¢å¤æˆåŠŸåï¼Œç‚¹å‡»"æ‰“å¼€åº”ç”¨"</div>
        </div>

        <div id="status" class="status">å‡†å¤‡å°±ç»ªï¼Œè¯·ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹æ¢å¤...</div>

        <div style="text-align: center; margin-top: 30px;">
            <button class="btn-primary" onclick="checkBuiltInData()">1ï¸âƒ£ æ£€æŸ¥å†…ç½®æ•°æ®</button>
            <button class="btn-success" onclick="forceRestoreData()">2ï¸âƒ£ å¼ºåˆ¶æ¢å¤æ•°æ®</button>
            <button class="btn-primary" onclick="openApp()">3ï¸âƒ£ æ‰“å¼€åº”ç”¨</button>
        </div>
    </div>

    <script src="src/pet-content.js"></script>
    <script>
        function updateStatus(text, type = '') {
            const status = document.getElementById('status');
            status.textContent = text;
            status.className = 'status ' + type;
        }

        function checkBuiltInData() {
            updateStatus('æ­£åœ¨æ£€æŸ¥å†…ç½®æ•°æ®...', 'warning');

            setTimeout(() => {
                if (!window.petContent) {
                    updateStatus('âŒ å†…ç½®æ•°æ®åŠ è½½å¤±è´¥\n\næ— æ³•æ‰¾åˆ° window.petContent å¯¹è±¡ã€‚\nè¯·ç¡®ä¿ src/pet-content.js æ–‡ä»¶å­˜åœ¨ä¸”æ­£ç¡®åŠ è½½ã€‚\n\nè¯·æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯ã€‚', 'error');
                    return;
                }

                const stats = {
                    'å•è¯': window.petContent.vocab?.length || 0,
                    'é˜…è¯»': window.petContent.readingSets?.length || 0,
                    'å›ºå®šæ­é…': window.petContent.collocationSets?.length || 0,
                    'å®Œå½¢å¡«ç©º': window.petContent.clozeSets?.length || 0
                };

                const total = stats['å•è¯'] + stats['é˜…è¯»'] + stats['å›ºå®šæ­é…'] + stats['å®Œå½¢å¡«ç©º'];

                if (total === 0) {
                    updateStatus('âŒ å†…ç½®æ•°æ®ä¸ºç©º\n\næ‰€æœ‰æ•°æ®é¡¹éƒ½æ˜¯ç©ºçš„ã€‚\nè¯·æ£€æŸ¥ src/pet-content.js æ–‡ä»¶å†…å®¹ã€‚', 'error');
                } else {
                    updateStatus(`âœ… å†…ç½®æ•°æ®æ£€æŸ¥æˆåŠŸï¼\n\næ•°æ®ç»Ÿè®¡:\n${JSON.stringify(stats, null, 2)}\n\næ€»è®¡: ${total} æ¡æ•°æ®\n\nç°åœ¨å¯ä»¥ç‚¹å‡»"å¼ºåˆ¶æ¢å¤æ•°æ®"æŒ‰é’®ã€‚`, 'success');
                }
            }, 500);
        }

        function forceRestoreData() {
            updateStatus('æ­£åœ¨å¼ºåˆ¶æ¢å¤æ•°æ®...', 'warning');

            setTimeout(() => {
                if (!window.petContent) {
                    updateStatus('âŒ å†…ç½®æ•°æ®æœªåŠ è½½\n\nè¯·å…ˆç‚¹å‡»"æ£€æŸ¥å†…ç½®æ•°æ®"æŒ‰é’®ã€‚', 'error');
                    return;
                }

                const builtInData = {
                    vocab: window.petContent.vocab || [],
                    readingSets: window.petContent.readingSets || [],
                    collocationSets: window.petContent.collocationSets || [],
                    clozeSets: window.petContent.clozeSets || []
                };

                const stats = {
                    'å•è¯': builtInData.vocab.length,
                    'é˜…è¯»': builtInData.readingSets.length,
                    'å›ºå®šæ­é…': builtInData.collocationSets.length,
                    'å®Œå½¢å¡«ç©º': builtInData.clozeSets.length
                };

                // æ¸…é™¤æ‰€æœ‰æ—§æ•°æ®
                const allKeys = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && (key.startsWith('pet') || key.startsWith('Pet'))) {
                        allKeys.push(key);
                    }
                }

                allKeys.forEach(key => {
                    localStorage.removeItem(key);
                });

                // ä¿å­˜åˆ°å¤šä¸ªä½ç½®
                const saveKeys = ['petEnglishData', 'petEnglishData_backup', 'petEnglishData_old', 'petData'];
                let successCount = 0;

                for (const key of saveKeys) {
                    try {
                        localStorage.setItem(key, JSON.stringify(builtInData));
                        successCount++;
                    } catch (e) {
                        console.warn(`ä¿å­˜åˆ° ${key} å¤±è´¥:`, e);
                    }
                }

                if (successCount > 0) {
                    // éªŒè¯ä¿å­˜
                    const verify = localStorage.getItem('petEnglishData');
                    if (verify) {
                        const verifyData = JSON.parse(verify);
                        const verifyStats = {
                            'å•è¯': verifyData.vocab?.length || 0,
                            'é˜…è¯»': verifyData.readingSets?.length || 0,
                            'å›ºå®šæ­é…': verifyData.collocationSets?.length || 0,
                            'å®Œå½¢å¡«ç©º': verifyData.clozeSets?.length || 0
                        };

                        updateStatus(`âœ… æ•°æ®æ¢å¤æˆåŠŸï¼\n\næ¢å¤ç»Ÿè®¡:\n${JSON.stringify(stats, null, 2)}\n\néªŒè¯ç»Ÿè®¡:\n${JSON.stringify(verifyStats, null, 2)}\n\næ•°æ®å¤§å°: ${(JSON.stringify(builtInData).length / 1024).toFixed(2)} KB\n\nå·²ä¿å­˜åˆ° ${successCount} ä¸ªå¤‡ä»½ä½ç½®\n\nç°åœ¨å¯ä»¥ç‚¹å‡»"æ‰“å¼€åº”ç”¨"æŒ‰é’®æŸ¥çœ‹æ•°æ®ã€‚`, 'success');
                    } else {
                        updateStatus('âŒ æ•°æ®éªŒè¯å¤±è´¥\n\næ•°æ®ä¿å­˜åæ— æ³•è¯»å–ã€‚\nè¯·æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒ localStorageã€‚', 'error');
                    }
                } else {
                    updateStatus('âŒ æ•°æ®æ¢å¤å¤±è´¥\n\næ— æ³•ä¿å­˜æ•°æ®åˆ° localStorageã€‚\nè¯·æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒ localStorageã€‚', 'error');
                }
            }, 500);
        }

        function openApp() {
            // éªŒè¯æ•°æ®æ˜¯å¦å­˜åœ¨
            const saved = localStorage.getItem('petEnglishData');
            if (!saved) {
                updateStatus('âš ï¸ æœªæ£€æµ‹åˆ°æ¢å¤çš„æ•°æ®\n\nè¯·å…ˆç‚¹å‡»"å¼ºåˆ¶æ¢å¤æ•°æ®"æŒ‰é’®ã€‚', 'warning');
                return;
            }

            try {
                const data = JSON.parse(saved);
                const stats = {
                    'å•è¯': data.vocab?.length || 0,
                    'é˜…è¯»': data.readingSets?.length || 0,
                    'å›ºå®šæ­é…': data.collocationSets?.length || 0,
                    'å®Œå½¢å¡«ç©º': data.clozeSets?.length || 0
                };

                const total = stats['å•è¯'] + stats['é˜…è¯»'] + stats['å›ºå®šæ­é…'] + stats['å®Œå½¢å¡«ç©º'];
                if (total === 0) {
                    updateStatus('âš ï¸ æ¢å¤çš„æ•°æ®ä¸ºç©º\n\nè¯·é‡æ–°æ‰§è¡Œæ¢å¤æ“ä½œã€‚', 'warning');
                    return;
                }

                // æ•°æ®éªŒè¯é€šè¿‡ï¼Œæ‰“å¼€åº”ç”¨
                window.location.href = 'src/index.html';
            } catch (e) {
                updateStatus('âŒ æ•°æ®éªŒè¯å¤±è´¥\n\nå·²ä¿å­˜çš„æ•°æ®æ— æ³•è§£æã€‚\nè¯·é‡æ–°æ‰§è¡Œæ¢å¤æ“ä½œã€‚', 'error');
            }
        }
    </script>
</body>

</html>