<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®æ¢å¤å·¥å…·</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', Helvetica, Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }

        .section {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .section.warning {
            border-left-color: #f39c12;
            background: #fef9e7;
        }

        .section.success {
            border-left-color: #27ae60;
            background: #e8f8f5;
        }

        .section.error {
            border-left-color: #e74c3c;
            background: #fdedec;
        }

        button {
            padding: 12px 24px;
            margin: 10px 5px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
        }

        .result {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 6px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-card h3 {
            margin: 0 0 10px 0;
            font-size: 32px;
        }

        .stat-card p {
            margin: 0;
            font-size: 14px;
            opacity: 0.9;
        }

        .progress {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            transition: width 0.3s ease;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ”§ PETè‹±è¯­å±‹æ•°æ®æ¢å¤å·¥å…·</h1>

        <div class="section warning">
            <h3>âš ï¸ ä½¿ç”¨è¯´æ˜</h3>
            <p>æ­¤å·¥å…·å°†å¸®åŠ©æ‚¨æ¢å¤PETè‹±è¯­å±‹çš„å†…ç½®æ•°æ®ã€‚å¦‚æœæ‚¨å‘ç°åº”ç”¨ä¸­çš„æ•°æ®ä¸¢å¤±ï¼Œå¯ä»¥ä½¿ç”¨æ­¤å·¥å…·æ¢å¤ã€‚</p>
            <p><strong>æ³¨æ„ï¼šæ­¤æ“ä½œå°†è¦†ç›–å½“å‰çš„localStorageæ•°æ®ï¼</strong></p>
        </div>

        <div class="section">
            <h3>ğŸ“Š å½“å‰æ•°æ®çŠ¶æ€</h3>
            <button class="btn-primary" onclick="checkCurrentData()">æ£€æŸ¥å½“å‰æ•°æ®</button>
            <div id="currentDataResult" class="result" style="display: none;"></div>
        </div>

        <div class="section">
            <h3>ğŸ”„ æ¢å¤å†…ç½®æ•°æ®</h3>
            <button class="btn-success" onclick="restoreBuiltInData()">æ¢å¤å†…ç½®æ•°æ®</button>
            <div id="restoreResult" class="result" style="display: none;"></div>
        </div>

        <div class="section">
            <h3>ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰æ•°æ®</h3>
            <button class="btn-danger" onclick="clearAllData()">æ¸…é™¤æ‰€æœ‰æ•°æ®</button>
            <div id="clearResult" class="result" style="display: none;"></div>
        </div>

        <div class="section success">
            <h3>âœ… éªŒè¯æ¢å¤</h3>
            <button class="btn-primary" onclick="verifyData()">éªŒè¯æ•°æ®</button>
            <div id="verifyResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <script src="src/pet-content.js"></script>
    <script>
        // æ£€æŸ¥å½“å‰æ•°æ®
        function checkCurrentData() {
            const result = document.getElementById('currentDataResult');
            result.style.display = 'block';

            try {
                const petData = localStorage.getItem('petEnglishData');
                const checkinData = localStorage.getItem('petCheckinRecords');

                if (petData) {
                    const parsed = JSON.parse(petData);
                    const stats = {
                        'å•è¯æ•°é‡': parsed.vocab?.length || 0,
                        'é˜…è¯»é¢˜æ•°é‡': parsed.readingSets?.length || 0,
                        'å›ºå®šæ­é…æ•°é‡': parsed.collocationSets?.length || 0,
                        'å®Œå½¢é¢˜æ•°é‡': parsed.clozeSets?.length || 0
                    };

                    result.innerHTML = `<strong>âœ… æ‰¾åˆ°PETåº”ç”¨æ•°æ®</strong>\n\né¢˜åº“ç»Ÿè®¡ï¼š\n${JSON.stringify(stats, null, 2)}\n\næ•°æ®å¤§å°ï¼š${petData.length} å­—èŠ‚\nçº¦ ${(petData.length / 1024).toFixed(2)} KB`;
                } else {
                    result.innerHTML = `<strong>âš ï¸ æ²¡æœ‰æ‰¾åˆ°PETåº”ç”¨æ•°æ®</strong>\n\nlocalStorageä¸­æ²¡æœ‰petEnglishDataé”®ã€‚`;
                }

                if (checkinData) {
                    const checkin = JSON.parse(checkinData);
                    result.innerHTML += `\n\næ‰“å¡è®°å½•ï¼š${checkin.length} æ¡`;
                }
            } catch (e) {
                result.innerHTML = `<strong>âŒ æ£€æŸ¥å¤±è´¥</strong>\n\né”™è¯¯ä¿¡æ¯: ${e.message}`;
            }
        }

        // æ¢å¤å†…ç½®æ•°æ®
        function restoreBuiltInData() {
            const result = document.getElementById('restoreResult');
            result.style.display = 'block';

            try {
                // ç­‰å¾…å†…ç½®æ•°æ®åŠ è½½
                setTimeout(() => {
                    if (!window.petContent) {
                        result.innerHTML = `<strong>âŒ å†…ç½®æ•°æ®åŠ è½½å¤±è´¥</strong>\n\næ— æ³•æ‰¾åˆ°window.petContentå¯¹è±¡ã€‚è¯·ç¡®ä¿src/pet-content.jsæ–‡ä»¶å­˜åœ¨ä¸”æ­£ç¡®åŠ è½½ã€‚`;
                        return;
                    }

                    const builtInData = {
                        vocab: window.petContent.vocab || [],
                        readingSets: window.petContent.readingSets || [],
                        collocationSets: window.petContent.collocationSets || [],
                        clozeSets: window.petContent.clozeSets || []
                    };

                    const stats = {
                        'å•è¯': builtInData.vocab.length,
                        'é˜…è¯»': builtInData.readingSets.length,
                        'å›ºå®šæ­é…': builtInData.collocationSets.length,
                        'å®Œå½¢': builtInData.clozeSets.length
                    };

                    // ä¿å­˜åˆ°localStorage
                    localStorage.setItem('petEnglishData', JSON.stringify(builtInData));

                    result.innerHTML = `<strong>âœ… å†…ç½®æ•°æ®æ¢å¤æˆåŠŸï¼</strong>\n\næ¢å¤çš„æ•°æ®ç»Ÿè®¡ï¼š\n${JSON.stringify(stats, null, 2)}\n\næ•°æ®å¤§å°ï¼š${JSON.stringify(builtInData).length} å­—èŠ‚\nçº¦ ${(JSON.stringify(builtInData).length / 1024).toFixed(2)} KB\n\nç°åœ¨å¯ä»¥æ‰“å¼€ src/index.html æŸ¥çœ‹æ¢å¤åçš„æ•°æ®ã€‚`;
                }, 500);
            } catch (e) {
                result.innerHTML = `<strong>âŒ æ¢å¤å¤±è´¥</strong>\n\né”™è¯¯ä¿¡æ¯: ${e.message}`;
            }
        }

        // æ¸…é™¤æ‰€æœ‰æ•°æ®
        function clearAllData() {
            const result = document.getElementById('clearResult');
            result.style.display = 'block';

            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰localStorageæ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                try {
                    const keys = [];
                    for (let i = 0; i < localStorage.length; i++) {
                        keys.push(localStorage.key(i));
                    }

                    localStorage.clear();

                    result.innerHTML = `<strong>âœ… æ‰€æœ‰æ•°æ®å·²æ¸…é™¤</strong>\n\næ¸…é™¤çš„é”®ï¼š\n${keys.join('\n')}\n\nå…± ${keys.length} ä¸ªé”®`;
                } catch (e) {
                    result.innerHTML = `<strong>âŒ æ¸…é™¤å¤±è´¥</strong>\n\né”™è¯¯ä¿¡æ¯: ${e.message}`;
                }
            } else {
                result.innerHTML = `<strong>âŒ å·²å–æ¶ˆæ¸…é™¤æ“ä½œ</strong>`;
            }
        }

        // éªŒè¯æ•°æ®
        function verifyData() {
            const result = document.getElementById('verifyResult');
            result.style.display = 'block';

            try {
                const petData = localStorage.getItem('petEnglishData');

                if (!petData) {
                    result.innerHTML = `<strong>âš ï¸ éªŒè¯å¤±è´¥</strong>\n\nlocalStorageä¸­æ²¡æœ‰petEnglishDataæ•°æ®ã€‚`;
                    return;
                }

                const parsed = JSON.parse(petData);

                // éªŒè¯æ•°æ®ç»“æ„
                const checks = {
                    'vocabå­˜åœ¨': Array.isArray(parsed.vocab) && parsed.vocab.length > 0,
                    'readingSetså­˜åœ¨': Array.isArray(parsed.readingSets) && parsed.readingSets.length > 0,
                    'collocationSetså­˜åœ¨': Array.isArray(parsed.collocationSets) && parsed.collocationSets.length > 0,
                    'clozeSetså­˜åœ¨': Array.isArray(parsed.clozeSets) && parsed.clozeSets.length > 0
                };

                const allPassed = Object.values(checks).every(v => v);

                let html = `<strong>${allPassed ? 'âœ…' : 'âš ï¸'} æ•°æ®éªŒè¯ç»“æœ</strong>\n\n`;
                html += `éªŒè¯é¡¹ç›®ï¼š\n${JSON.stringify(checks, null, 2)}\n\n`;

                if (allPassed) {
                    html += `æ•°æ®ç»Ÿè®¡ï¼š\n`;
                    html += `- å•è¯ï¼š${parsed.vocab.length} ä¸ª\n`;
                    html += `- é˜…è¯»ï¼š${parsed.readingSets.length} é¢˜\n`;
                    html += `- å›ºå®šæ­é…ï¼š${parsed.collocationSets.length} é¢˜\n`;
                    html += `- å®Œå½¢ï¼š${parsed.clozeSets.length} é¢˜\n\n`;
                    html += `âœ… æ•°æ®ç»“æ„å®Œæ•´ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼`;
                } else {
                    html += `âš ï¸ æ•°æ®ä¸å®Œæ•´ï¼Œè¯·é‡æ–°æ¢å¤ã€‚`;
                }

                result.innerHTML = html;
            } catch (e) {
                result.innerHTML = `<strong>âŒ éªŒè¯å¤±è´¥</strong>\n\né”™è¯¯ä¿¡æ¯: ${e.message}`;
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.onload = () => {
            checkCurrentData();
        };
    </script>
</body>

</html>