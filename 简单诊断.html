<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ç®€å•è¯Šæ–­</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #fff; }
        .log { margin: 5px 0; padding: 5px; background: #2d2d2d; }
        .success { color: #4caf50; }
        .error { color: #f44336; }
        .info { color: #2196f3; }
        button { padding: 10px 20px; margin: 5px; background: #2196f3; color: white; border: none; cursor: pointer; }
        button:hover { background: #1976d2; }
    </style>
</head>
<body>
    <h1>PETåº”ç”¨è¯Šæ–­</h1>
    <div id="logs"></div>
    <button onclick="testAll()">ğŸ” é‡æ–°æµ‹è¯•</button>
    <button onclick="location.href='src/index.html'">ğŸš€ æ‰“å¼€åº”ç”¨</button>

    <script>
        function log(msg, type = 'info') {
            const div = document.createElement('div');
            div.className = 'log ' + type;
            div.textContent = msg;
            document.getElementById('logs').appendChild(div);
            console.log(msg);
        }

        async function testAll() {
            document.getElementById('logs').innerHTML = '';
            log('=== å¼€å§‹è¯Šæ–­ ===', 'info');

            // 1. æ£€æŸ¥ pet-content.js æ–‡ä»¶
            log('1ï¸âƒ£ æ£€æŸ¥ pet-content.js æ–‡ä»¶...', 'info');
            try {
                const response = await fetch('src/pet-content.js');
                if (response.ok) {
                    const content = await response.text();
                    log(`âœ… pet-content.js å­˜åœ¨ (${content.length} å­—ç¬¦)`, 'success');
                } else {
                    log(`âŒ pet-content.js è¿”å›çŠ¶æ€: ${response.status}`, 'error');
                }
            } catch (e) {
                log(`âŒ æ— æ³•åŠ è½½ pet-content.js: ${e.message}`, 'error');
            }

            // 2. åŠ¨æ€åŠ è½½å¹¶æ£€æŸ¥ window.petContent
            log('2ï¸âƒ£ åŠ¨æ€åŠ è½½ pet-content.js...', 'info');
            try {
                const script = document.createElement('script');
                script.src = 'src/pet-content.js';
                script.onload = () => {
                    if (window.petContent) {
                        const stats = {
                            å•è¯: window.petContent.vocab?.length || 0,
                            é˜…è¯»: window.petContent.readingSets?.length || 0,
                            æ­é…: window.petContent.collocationSets?.length || 0,
                            å®Œå½¢: window.petContent.clozeSets?.length || 0
                        };
                        log(`âœ… window.petContent åŠ è½½æˆåŠŸ!`, 'success');
                        log(`   ç»Ÿè®¡: ${JSON.stringify(stats)}`, 'info');

                        // 3. æ¢å¤æ•°æ®
                        log('3ï¸âƒ£ æ¢å¤æ•°æ®åˆ° localStorage...', 'info');
                        try {
                            const data = {
                                vocab: window.petContent.vocab,
                                readingSets: window.petContent.readingSets,
                                collocationSets: window.petContent.collocationSets,
                                clozeSets: window.petContent.clozeSets
                            };
                            localStorage.setItem('petEnglishData', JSON.stringify(data));
                            localStorage.setItem('petEnglishData_backup', JSON.stringify(data));
                            log('âœ… æ•°æ®å·²æ¢å¤åˆ° localStorage', 'success');
                            log('ğŸ‰ ä¿®å¤å®Œæˆï¼ç°åœ¨å¯ä»¥æ‰“å¼€åº”ç”¨äº†', 'success');
                        } catch (e) {
                            log(`âŒ æ¢å¤æ•°æ®å¤±è´¥: ${e.message}`, 'error');
                        }
                    } else {
                        log('âŒ window.petContent æœªå®šä¹‰', 'error');
                    }
                };
                script.onerror = () => {
                    log('âŒ pet-content.js åŠ è½½å¤±è´¥', 'error');
                };
                document.head.appendChild(script);
            } catch (e) {
                log(`âŒ åŠ è½½è„šæœ¬å‡ºé”™: ${e.message}`, 'error');
            }

            // 4. æ£€æŸ¥ localStorage
            log('4ï¸âƒ£ æ£€æŸ¥ localStorage...', 'info');
            setTimeout(() => {
                const keys = ['petEnglishData', 'petEnglishData_backup'];
                for (const key of keys) {
                    const data = localStorage.getItem(key);
                    if (data) {
                        try {
                            const parsed = JSON.parse(data);
                            const total = (parsed.vocab?.length || 0) +
                                         (parsed.readingSets?.length || 0) +
                                         (parsed.collocationSets?.length || 0) +
                                         (parsed.clozeSets?.length || 0);
                            log(`âœ… ${key}: ${total} æ¡æ•°æ®`, 'success');
                        } catch (e) {
                            log(`âš ï¸ ${key}: æ•°æ®æŸå`, 'error');
                        }
                    }
                }
                log('=== è¯Šæ–­å®Œæˆ ===', 'info');
            }, 1000);
        }

        // è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.onload = () => testAll();
    </script>
</body>
</html>
