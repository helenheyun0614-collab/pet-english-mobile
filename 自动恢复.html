<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡ªåŠ¨æ¢å¤æ•°æ®</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .status {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            font-family: monospace;
            white-space: pre-wrap;
            text-align: left;
        }

        .status.success {
            border-left-color: #27ae60;
        }

        .status.error {
            border-left-color: #e74c3c;
        }

        .status.warning {
            border-left-color: #f39c12;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        button {
            padding: 12px 24px;
            margin: 10px 5px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ”§ PETè‹±è¯­å±‹è‡ªåŠ¨æ¢å¤</h1>

        <div id="loading" class="spinner" style="display: none;"></div>
        <div id="status" class="status">æ­£åœ¨åˆå§‹åŒ–...</div>

        <div id="actions" style="display: none;">
            <button class="btn-primary" onclick="openApp()">æ‰“å¼€åº”ç”¨</button>
        </div>
    </div>

    <script src="src/pet-content.js"></script>
    <script>
        function updateStatus(text, type = '') {
            const status = document.getElementById('status');
            status.textContent = text;
            status.className = 'status ' + type;
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        function showActions(show) {
            document.getElementById('actions').style.display = show ? 'block' : 'none';
        }

        function openApp() {
            window.location.href = 'src/index.html';
        }

        async function autoRestore() {
            showLoading(true);
            updateStatus('ğŸ” æ­£åœ¨æ£€æŸ¥ç³»ç»ŸçŠ¶æ€...');

            // ç­‰å¾…å†…ç½®æ•°æ®åŠ è½½
            await new Promise(resolve => setTimeout(resolve, 500));

            // æ£€æŸ¥å†…ç½®æ•°æ®
            if (!window.petContent) {
                showLoading(false);
                updateStatus('âŒ å†…ç½®æ•°æ®åŠ è½½å¤±è´¥\n\næ— æ³•æ‰¾åˆ° window.petContent å¯¹è±¡ã€‚\nè¯·ç¡®ä¿ src/pet-content.js æ–‡ä»¶å­˜åœ¨ä¸”æ­£ç¡®åŠ è½½ã€‚', 'error');
                return;
            }

            updateStatus('âœ… å†…ç½®æ•°æ®åŠ è½½æˆåŠŸ\n\næ­£åœ¨å‡†å¤‡æ¢å¤æ•°æ®...');

            const builtInData = {
                vocab: window.petContent.vocab || [],
                readingSets: window.petContent.readingSets || [],
                collocationSets: window.petContent.collocationSets || [],
                clozeSets: window.petContent.clozeSets || []
            };

            const stats = {
                'å•è¯': builtInData.vocab.length,
                'é˜…è¯»': builtInData.readingSets.length,
                'å›ºå®šæ­é…': builtInData.collocationSets.length,
                'å®Œå½¢': builtInData.clozeSets.length
            };

            updateStatus('ğŸ“Š æ­£åœ¨æ¢å¤æ•°æ®...\n\næ•°æ®ç»Ÿè®¡:\n' + JSON.stringify(stats, null, 2));

            // ä¿å­˜åˆ°å¤šä¸ªä½ç½®
            const saveKeys = ['petEnglishData', 'petEnglishData_backup', 'petEnglishData_old', 'petData'];
            let successCount = 0;

            for (const key of saveKeys) {
                try {
                    localStorage.setItem(key, JSON.stringify(builtInData));
                    successCount++;
                } catch (e) {
                    console.warn(`ä¿å­˜åˆ° ${key} å¤±è´¥:`, e);
                }
            }

            await new Promise(resolve => setTimeout(resolve, 500));

            showLoading(false);

            if (successCount > 0) {
                updateStatus(`âœ… æ•°æ®æ¢å¤æˆåŠŸï¼\n\næ¢å¤ç»Ÿè®¡:\n${JSON.stringify(stats, null, 2)}\n\næ•°æ®å¤§å°: ${(JSON.stringify(builtInData).length / 1024).toFixed(2)} KB\n\nå·²ä¿å­˜åˆ° ${successCount} ä¸ªå¤‡ä»½ä½ç½®\n\nç°åœ¨å¯ä»¥ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ‰“å¼€åº”ç”¨ã€‚`, 'success');
                showActions(true);
            } else {
                updateStatus('âŒ æ•°æ®æ¢å¤å¤±è´¥\n\næ— æ³•ä¿å­˜æ•°æ®åˆ° localStorageã€‚\nè¯·æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒ localStorageã€‚', 'error');
            }
        }

        // é¡µé¢åŠ è½½åè‡ªåŠ¨æ‰§è¡Œæ¢å¤
        window.onload = () => {
            setTimeout(() => {
                autoRestore();
            }, 300);
        };
    </script>
</body>

</html>